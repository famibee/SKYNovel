{"version":3,"file":"ScriptIterator.js","sources":["../src/sn/CallStack.ts","../src/sn/RubySpliter.ts","../src/sn/ScriptIterator.ts"],"sourcesContent":["/* ***** BEGIN LICENSE BLOCK *****\n\tCopyright (c) 2018-2025 Famibee (famibee.blog38.fc2.com)\n\n\tThis software is released under the MIT License.\n\thttp://opensource.org/licenses/mit-license.php\n** ***** END LICENSE BLOCK ***** */\n\nimport type {IHEvt2Fnc, IValMp} from './CmnInterface';\n\nexport interface ICallStackArg {\n\t':resvToken'?\t: string;\t\t// call元のtoken\n\t':hEvt1Time'\t: IHEvt2Fnc;\t// call元のローカル予約イベント\n\t':hMp'\t\t\t: IValMp;\t\t// call元のmp:\n\t':タグ名'?\t\t: string;\n\t':lenIfStk'\t\t: number;\n}\n\nexport class CallStack {\n\tconstructor(readonly fn = '', readonly idx = 0, readonly csArg: ICallStackArg = {':hEvt1Time': {}, ':hMp': {}, ':lenIfStk': 1}) {}\n\n\treadonly\ttoString = ()=> `[fn:${this.fn}, idx:${this.idx}, csArg:${this.csArg}]`;\n\n}\n","/* ***** BEGIN LICENSE BLOCK *****\n\tCopyright (c) 2018-2025 Famibee (famibee.blog38.fc2.com)\n\n\tThis software is released under the MIT License.\n\thttp://opensource.org/licenses/mit-license.php\n** ***** END LICENSE BLOCK ***** */\n\nimport type {HArg} from './Grammar';\nimport type {IPutCh} from './CmnInterface';\n\nexport interface IAutoPage { (idx: number, str: string): void; }\n\nexport class RubySpliter {\n\tstatic\t#sesame\t\t= 'ヽ';\n\tstatic\tsetting(hArg: HArg) {if (hArg.sesame) RubySpliter.#sesame = hArg.sesame}\n\tstatic\tgetSesame() {return RubySpliter.#sesame}\n\n\tstatic\tdestroy() {RubySpliter.#sesame = 'ヽ'}\n\n\t#putCh\t: IPutCh\t= ()=> {};\n\tinit(putCh: IPutCh) {this.#putCh = putCh}\n\n/*\n\t\t★Unicodeで「漢字」の正規表現 – ものかの http://tama-san.com/kanji-regex/\n\t\t2E80..2FDF CJK部首補助＋康熙部首\n\t\t3005 々（漢字の踊り字）\n\t\t3007 〇（漢数字のゼロ）\n\t\t303B 〻（漢字の踊り字）\n\t\t3400..4DBF CJK統合漢字拡張A\n\t\t4E00..9FFF CJK統合漢字\n\t\tF900..FAFF CJK互換漢字\n\t\t20000..2FFFF CJK統合漢字拡張B〜F＋CJK互換漢字追加＋念のためU+2FFFFまで\n\n\t\t[\\x{2E80}-\\x{2FDF}々〇〻\\x{3400}-\\x{4DBF}\\x{4E00}-\\x{9FFF}\\x{F900}-\\x{FAFF}\\x{20000}-\\x{2FFFF}]\n\t\t[\\u2E80-\\u2FDF々〇〻\\u3400-\\u4DBF\\u4E00-\\u9FFF\\uF900-\\uFAFF\\u20000-\\u2FFFF]\n\t\t[⺀-⿟々〇〻㐀-䶿一-鿿豈-﫿\\u20000-\\u2FFFF]\t\t// 含まれない文字がある\n\t\t[⺀-⿟々〇〻㐀-鿿豈-﫿\\u20000-\\u2FFFF]\t\t\t// ヽ--30FD が変に引っかかる。多分\\u2000-\\u2FFF解釈\n\t\t\\\\u{20000}-\\\\u{2FFFF}\t// 五桁だとエラー\n\n\t\t【2022/10/03】ruby正規表現のUnicode プロパティ(とPOSIX文字クラス) - Qiita https://qiita.com/Takayuki_Nakano/items/8d38beaddb84b488d683\n\t\t\t> このHiraganaプロパティ、長音記号は含まれていません。\n\t\t\t> \\p{Han}…簡体字や繁体字、韓国語の漢字…ベトナム語の漢字にもマッチ\n\t\t\n\t\t・Unicode文字一覧表 - instant tools https://tools.m-bsys.com/ex/unicode_table.php\n*/\n\tstatic\t#REG_RUBY\t: RegExp;\n\tstatic\tsetEscape(ce: string) {\n\t\t// 830 match 11293 step(1.7ms) PCRE2 https://regex101.com/r/BBrQtC/1\n\t\t/*\n(?<txt4>\\\\\\S)\n|\t｜(?<str>[^《\\n]+)《(?<ruby>[^》\\n]+)》\n|\t(?: (?<kan>[⺀-⿟々〇〻㐀-鿿豈-﫿]+ [ぁ-ヿ]* | [^　｜《》\\n])\n\t\t《(?<kan_ruby>[^》\\n]+)》)\n|\t(?<txt>\n\t[\\xD800-\\xDBFF][\\xDC00-\\xDFFF]\n|\t[^｜《》]+?\n|\t.)\n\t\t*/\n\t\t// (new RegExp(\"~\")) の場合は、バックスラッシュは２つ必要\n\t\tRubySpliter.#REG_RUBY = new RegExp(\n\t\t\t`${ce ?`(?<ce>\\\\${ce}\\\\S)|` :''}`+\n\t\t\t`｜(?<str>[^《\\\\n]+)《(?<ruby>[^》\\\\n]+)》`+\n\t\t\t`|(?:(?<kan>[⺀-⿟々〇〻㐀-鿿豈-﫿]+[ぁ-ヿ]*|[^　｜《》\\\\n])`+\n\t\t\t`《(?<kan_ruby>[^》\\\\n]+)》)`+\n\t\t\t`|(?<txt>`+\n\t\t\t`[\\uD800-\\uDBFF][\\uDC00-\\uDFFF]`+\t// 上位 + 下位サロゲート\n\t\t\t`|[^｜《》]+?`+\t\t// 不要だが細切れにしないほうが後々効率で有利\n\t\t\t`|.)`,\n\t\t\t'gs'\n\t\t);\n\t}\n\n\tputTxt(text: string) {\n\t\tfor (const {groups} of text.matchAll(RubySpliter.#REG_RUBY)) {\n\t\t\tconst {ruby, kan_ruby, kan='', ce, txt='', str=''} = groups!;\n\t\t\tif (ruby) {this.putTxtRb(decodeURIComponent(str), ruby); continue}\n\n\t\t\tif (kan_ruby) {this.putTxtRb(kan, kan_ruby); continue}\n\t\t\tif (ce) {this.#putCh(ce.slice(1), ''); continue}\n\n\t\t\tfor (const v of Array.from(txt)) this.#putCh(v, '');\n\t\t\t\t// txt.split('')や [...txt] はサロゲートペアで問題\n\t\t}\n\t}\n\n\tputTxtRb(text: string, ruby: string) {\t// テスト用にpublic\n\t\t// 自動区切りを行わない（内部的 json文法）\n\t\tif (/^\\w+｜{\"/.test(ruby)) {this.#putCh(text, ruby); return}\n\n\t\tconst a: string[] = Array.from(text);\n\t\tconst len = a.length;\n\t\tif (/^\\*.?$/.test(ruby)) {\t// 傍点文法\n\t\t\tconst rb_ses = 'center｜'+ (ruby === '*' ?RubySpliter.#sesame :ruby.charAt(1));\n\t\t\tfor (let i=0; i<len; ++i) this.#putCh(a[i]!, rb_ses);\n\t\t\treturn;\n\t\t}\n\n\t\t// 自動区切りを行わない（単漢字など）\n\t\tif (len === 1 || ! ruby.includes(' ')) {\n\t\t\tthis.#putCh(text, decodeURIComponent(ruby));\n\t\t\treturn;\n\t\t}\n\n\t\t// 空白がある場合はユーザが区切りを指定しているものと見なす\n\t\tconst aR = ruby.split(' ');\n\t\tconst lenR = aR.length;\n\t\tconst len_max = (lenR > len) ?lenR :len;\n\t\tfor (let i=0; i<len_max; ++i) this.#putCh(\n\t\t\t(i < len) ? a[i]! : '',\n\t\t\t(i < lenR) ? decodeURIComponent(aR[i]!) : ''\n\t\t);\n\t}\n\n}\n","/* ***** BEGIN LICENSE BLOCK *****\n\tCopyright (c) 2018-2025 Famibee (famibee.blog38.fc2.com)\n\n\tThis software is released under the MIT License.\n\thttp://opensource.org/licenses/mit-license.php\n** ***** END LICENSE BLOCK ***** */\n\nimport {argChk_Boolean, getFn, CmnLib, argChk_Num} from './CmnLib';\nimport type {IHTag, HArg, Script, ITag} from './Grammar';\nimport type {IMain, IVariable, IMark, IPropParser} from './CmnInterface';\nimport type {Config} from './Config';\nimport {CallStack, type ICallStackArg} from './CallStack';\nimport {Grammar, tagToken2Name_Args, tagToken2Name} from './Grammar';\nimport {AnalyzeTagArg} from './AnalyzeTagArg';\nimport {RubySpliter} from './RubySpliter';\nimport type {EventMng} from './EventMng';\nimport type {LayerMng} from './LayerMng';\nimport {DebugMng} from './DebugMng';\nimport type {SoundMng} from './SoundMng';\nimport type {SysBase} from './SysBase';\nimport {SEARCH_PATH_ARG_EXT} from './ConfigBase';\nimport {CmnTween} from './CmnTween';\nimport {Reading, ReadingState} from './Reading';\nimport {BUF_BGM} from './SndBuf';\n\nimport {Loader} from 'pixi.js';\n\ninterface HScript {\n\t[fn: string]: Script;\n};\n\ninterface ISeek {\n\tidx\t\t: number;\n\tln\t\t: number;\n};\n\n\nconst enum BreakState {Running, Wait, Break, Breaking, Step, Stepping, StepOuting, StepOut};\n\nconst enum SndProcOnLoad {\n\tMINIMAL_STOP,\n\tNO_TOUCH,\n\tALL_STOP_AND_PLAY,\n};\n\nexport\tconst\tRPN_COMP_CHIN = 'compChIn';\n\n\nexport class ScriptIterator {\n\t#script\t\t: Script\t= {aToken: [''], len: 1, aLNum: [1]};\n\n\t#scriptFn\t= '';\n\tget scriptFn() {return this.#scriptFn}\n\t#idxToken\t= 0;\n\tget idxToken() {return this.#idxToken}\n\tsubIdxToken() {--this.#idxToken}\n\t#lineNum\t= 0;\n\tget lineNum() {return this.#lineNum}\n\treadonly addLineNum\t= (len: number)=> this.#lineNum += len;\n\tjumpJustBefore() {this.#jumpWork(this.#scriptFn, '', --this.#idxToken)}\n\t\t// 直前にジャンプ\n\n\n\t#aCallStk\t: CallStack[]\t= [];\t// FILOバッファ（push/pop）\n\n\treadonly\t#grm;\n\treadonly\t#alzTagArg\t= new AnalyzeTagArg;\n\n\n\t//MARK: コンストラクタ\n\tconstructor(private readonly cfg: Config, private readonly hTag: IHTag, private readonly main: IMain, private readonly val: IVariable, private readonly prpPrs: IPropParser, private readonly sndMng: SoundMng, private readonly sys: SysBase) {\n\t\t// 変数操作\n\t\thTag.let_ml\t\t= o=> this.#let_ml(o);\t// インラインテキスト代入\n\t\thTag.endlet_ml\t= ()=> false;\t\t\t// インラインテキスト代入終端\n\t\t\t// [if]ブロック内で【未定義のタグ[endlet_ml]です】エラーが発生する対策\n\n\t\t// デバッグ・その他\n\t\thTag.dump_stack\t= ()=> this.#dump_stack();\t// スタックのダンプ\n\t\thTag.dump_script= o=> this.#dump_script(o);\t// スクリプトのダンプ\n\n\t\t// 条件分岐\n\t\thTag['else']\t=\t\t\t\t\t\t\t// その他ifブロック開始\n\t\thTag.elsif\t\t=\t\t\t\t\t\t\t// 別条件のifブロック開始\n\t\thTag.endif\t\t= ()=> this.#endif();\t\t// ifブロックの終端\n\t\thTag['if']\t\t= o=> this.#if(o);\t\t\t// ifブロックの開始\n\n\t\t// ラベル・ジャンプ\n\t\t//hTag.button\t// LayerMng.ts内で定義\t\t// ボタンを表示\n\t\thTag.call\t\t= o=> this.#call(o);\t\t// サブルーチンコール\n\t\thTag.jump\t\t= o=> this.#jump(o);\t\t// シナリオジャンプ\n\t\t//hTag.page\t\t= // ReadState が担当に\t\t// ページ移動\n\t\thTag.pop_stack\t= o=> this.#pop_stack(o);\t// コールスタック破棄\n\t\thTag.return\t\t= o=> this.#return(o);\t\t// サブルーチンから戻る\n\n\t\t// マクロ\n\t\thTag.bracket2macro\t= o=> this.#bracket2macro(o);// 括弧マクロの定義\n\t\thTag.char2macro\t\t= o=> this.#char2macro(o);\t// 一文字マクロの定義\n\t\thTag.endmacro\t\t= o=> this.#return(o);\t\t// マクロ定義の終了\n\t\thTag.macro\t\t\t= o=> this.#macro(o);\t\t// マクロ定義の開始\n\n\t\t// しおり\n\t\t//hTag.copybookmark\t\t// Variable.ts内で定義\t// しおりの複写\n\t\t//hTag.erasebookmark\t// Variable.ts内で定義\t// しおりの消去\n\t\thTag.load\t\t\t= o=> this.#load(o);\t\t\t// しおりの読込\n\t\thTag.reload_script\t= o=> this.#reload_script(o);\t// スクリプト再読込\n\t\thTag.record_place\t= ()=> this.#record_place();\t// セーブポイント指定\n\t\thTag.save\t\t\t= o=> this.#save(o);\t\t\t// しおりの保存\n\n\n\t\tif (cfg.oCfg.debug.token) this.#dbgToken = token=> {if (token.trim() !== '') console.log(`🌱 トークン ${this.#scriptFn}:${this.#lineNum} (i:${this.#idxToken} cs:${this.#aCallStk.length}) %c【${token}】`, 'background-color:#350;')};\n\t\tif (cfg.oCfg.debug.tag) this.#procDebugtag = tag_name=> console.log(`🌲 タグ解析 ${this.#scriptFn}:${this.#lineNum} (i:${this.#idxToken} cs:${this.#aCallStk.length}) %c[${tag_name} %o]`, 'background-color:#30B;', this.#alzTagArg.hPrm);\n\n\t\tval.defTmp('const.sn.aIfStk.length', ()=> this.#aIfStk.length);\n\t\tval.defTmp('const.sn.vctCallStk.length', ()=> this.#aCallStk.length);\n\n\t\tthis.#grm = new Grammar(cfg);\n\t\t\n\t\tconst ce = cfg.oCfg.init.escape;\n\t\tthis.#grm.setEscape(ce);\n\t\tRubySpliter.setEscape(ce);\n\n\t\tif (CmnLib.isDbg) {\n\t\t\tsys.addHook((type, o)=> this.#hHook[type]?.(o));\n\t\t\tthis.isBreak = this.#isBreak_base;\n\n\t\t\tconst fnc = this.analyzeInit;\n\t\t\tthis.analyzeInit = ()=> {\n\t\t\t\tthis.analyzeInit = ()=> {};\n\t\t\t\tthis.sys.send2Dbg('hi', {});\n\t\t\t};\n\t\t\tthis.#hHook.auth = o=> {\n\t\t\t\tconst hLineBP = o.hBreakpoint.hFn2hLineBP;\n\t\t\t\tfor (const [fn, v] of Object.entries(hLineBP)) this.#regBreakPoint(fn, <any>v);\n\n\t\t\t\tScriptIterator.#hFuncBP = {};\n\t\t\t\tfor (const v of o.hBreakpoint.aFunc) {\n\t\t\t\t\tScriptIterator.#hFuncBP[v.name] = 1;\n\t\t\t\t}\n\n\t\t\t\tif (o.stopOnEntry) {\n\t\t\t\t\twhile (true) {\n\t\t\t\t\t\tlet tkn = this.nextToken();\n\t\t\t\t\t\tif (! tkn) break;\t// 初期化前に終了した場合向け\n\n\t\t\t\t\t\tconst uc = tkn.charCodeAt(0);\t// TokenTopUnicode\n\t\t\t\t\t\tif (uc === 91) break;\t// [ タグ開始\n\t\t\t\t\t\tif (uc === 38) break;\t// & 変数操作・変数表示\n\t\t\t\t\t\tif (uc === 42 && tkn.length === 1) break;\t// 単文字の *\n\t\t\t\t\t\tif (uc === 10) this.#lineNum += tkn.length;\t// \\n 改行\n\t\t\t\t\t}\n\t\t\t\t\tthis.sys.callHook('stopOnEntry', {});\n\t\t\t\t\tthis.analyzeInit = fnc;\n\t\t\t\t\tthis.analyzeInit();\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tthis.noticeWait = ()=> {\n\t\t\t\t\t\tthis.noticeWait = ()=> {};\n\t\t\t\t\t\tthis.sys.callHook('stopOnEntry', {});\t// sn全体へ通知\n\n//\t\t\t\t\t\tthis.sys.callHook('continue', {});\t// sn全体へ通知\n//\t\t\t\t\t\tthis.breakState = BreakState.breaking;\n\t\t\t\t\t};\n\n\t\t\t\t\tthis.analyzeInit = fnc;\n\t\t\t\t\tthis.analyzeInit();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse this.recodeDesign = ()=> {};\n\t}\n\tnoticeWait = ()=> {};\n\t#regBreakPoint(fn: string, o: {[ln: number]: any}) {\n\t\tScriptIterator.#hFn2hLineBP[this.#cnvSnPath4Dbg(fn)] = o;\n\t}\n\n\tdestroy() {this.isBreak = this.#record_place = ()=> false}\n\n\treadonly #hHook\t: {[type: string]: (o: any)=> void}\t= {\n\t\t//auth: // constructorで\n\t\t//launch:\t// ここでは冒頭停止に間に合わないのでanalyzeInit()で\n\t\tdisconnect: ()=> {\n\t\t\tScriptIterator.#hFn2hLineBP = {};\n\t\t\tScriptIterator.#hFuncBP = {};\n\t\t\tthis.isBreak = ()=> false;\n\n\t\t\tthis.#hHook.continue!({});\n\t\t\tthis.#breakState = BreakState.Running;\n\t\t},\n\t\trestart: ()=> this.isBreak = ()=> false,\n\n\t\t// ブレークポイント登録\n\t\tadd_break: o=> this.#regBreakPoint(o.fn, o.o),\n\t\tdata_break: o=> {\n\t\t\tif (this.#breakState !== BreakState.Running) return;\n\n\t\t\tthis.#breakState = BreakState.Wait;\n\t\t\tthis.main.setLoop(false, `変数 ${o.dataId}【${o.old_v}】→【${o.new_v}】データブレーク`);\n\t\t\tthis.sys.callHook('stopOnDataBreakpoint', {});\t// sn全体へ通知\n\t\t\tthis.sys.send2Dbg('stopOnDataBreakpoint', {});\n\t\t},\n\t\tset_func_break: o=> {\n\t\t\tScriptIterator.#hFuncBP = {};\n\t\t\tfor (const v of o.a) ScriptIterator.#hFuncBP[v.name] = 1;\n\t\t\tthis.sys.send2Dbg(o.ri, {});\n\t\t},\n\n\t\t// 情報問い合わせ系\n\t\tstack: o=> this.sys.send2Dbg(o.ri, {a: this.#aStack()}),\n\t\teval: o=> {this.sys.send2Dbg(o.ri, {v: this.prpPrs.parse(o.txt)})},\n\n\t\t// デバッガからの操作系\n\t\tcontinue: ()=> {\n\t\t\tif (this.#isIdxOverLast()) return;\n\n\t\t\tthis.#idxToken -= this.#idxDx4Dbg;\n\t\t\tthis.#breakState = BreakState.Breaking;\n\t\t\tthis.main.setLoop(true);\n\t\t\tthis.main.resume();\t// jumpループ後などで停止している場合があるので\n\t\t},\n\t\tstepover: o=> this.#go_stepover(o),\n\t\tstepin: ()=> {\n\t\t\tif (this.#isIdxOverLast()) return;\n\n\t\t\tconst tkn = this.#script.aToken[this.#idxToken -this.#idxDx4Dbg];\n\t\t\tthis.sys.callHook(`stopOnStep${this.#REGSTEPIN.test(tkn ?? '') ?'In' :''}`, {});\t// sn全体へ通知\n\n\t\t\tthis.#idxToken -= this.#idxDx4Dbg;\n\t\t\tthis.#breakState = this.#breakState === BreakState.Wait\n\t\t\t\t? BreakState.Step\n\t\t\t\t: BreakState.Stepping;\n\t\t\tthis.main.setLoop(true);\n\t\t\tthis.main.resume();\t// jumpループ後などで停止している場合があるので\n\t\t},\n\t\tstepout: o=> {\n\t\t\tif (this.#isIdxOverLast()) return;\n\n\t\t\tif (this.#aCallStk.length > 0) this.#go_stepout(true);\n\t\t\telse this.#go_stepover(o);\n\t\t},\n\t\tpause: ()=> {\n\t\t\tthis.#breakState = BreakState.Step;\n\t\t\tthis.main.setLoop(false, '一時停止');\n\t\t\tthis.sys.send2Dbg('stopOnStep', {});\n\t\t},\n\t\tstopOnEntry: ()=> {\n\t\t\tthis.#breakState = BreakState.Step;\n\t\t\tthis.main.setLoop(false, '一時停止');\n\t\t\tthis.sys.send2Dbg('stopOnEntry', {});\n\t\t},\n\t};\n\treadonly #cnvSnPath = (fn: string)=> this.cfg.searchPath(fn, SEARCH_PATH_ARG_EXT.SCRIPT);\n\tstatic\treadonly\t#REG4CODE_FN\t= /(.+)\\/crypto_prj\\/([^\\/]+)\\/[^\\.]+(\\.\\w+)/;\t// https://regex101.com/r/Km54EK/1 141 steps (~0ms)\n\treadonly #cnvSnPath4Dbg = (fn: string)=>\n\t\t(this.sys.pathBaseCnvSnPath4Dbg + this.#cnvSnPath(fn))\n\t\t.replace(ScriptIterator.#REG4CODE_FN, `$1/prj/$2/${this.#scriptFn}$3`);\n\tcnvPath4Dbg = (fn: string)=> this.sys.pathBaseCnvSnPath4Dbg + fn.replace('/crypto_prj/', '/prj/');\n\t#go_stepover(o: any) {\n\t\tif (this.#isIdxOverLast()) return;\n\n\t\tconst tkn = this.#script.aToken[this.#idxToken -this.#idxDx4Dbg];\n\t\tif (this.#REGSTEPIN.test(tkn ?? '')) this.#go_stepout(false);\n\t\telse {\n\t\t\tthis.sys.callHook('stopOnStep', {});\t// sn全体へ通知\n\t\t\tthis.#hHook.stepin!(o);\n\t\t}\n\t}\n\t#go_stepout(out: boolean) {\n\t\tthis.sys.callHook(`stopOnStep${out ?'Out' :''}`, {});\t// sn全体へ通知\n\t\tthis.#csDepth_macro_esc = this.#aCallStk.length -(out ?1 :0);\n\t\tthis.#idxToken -= this.#idxDx4Dbg;\n\t\tthis.#breakState = out ?BreakState.StepOut :BreakState.StepOuting;\n\t\tthis.main.setLoop(true);\n\t\tthis.main.resume();\t// jumpループ後などで停止している場合があるので\n\t}\n\t#csDepth_macro_esc\t= 0;\n\tget #idxDx4Dbg() {\n\t\treturn this.#breakState === BreakState.Break\n\t\t\t|| this.#breakState === BreakState.Step ?1 :0\n\t};\n\t#isIdxOverLast(): boolean {\n\t\tif (this.#idxToken < this.#script.len) return false;\n\t\tthis.sys.callHook('stopOnEntry', {});\t// sn全体へ通知\n\t\tthis.main.setLoop(false, 'スクリプト終端です isIdxOverLast');\n\t\treturn true;\n\t}\n\n\t// reload 再生成 Main に受け渡すため static\n\tstatic\t#hFn2hLineBP: {[fn: string]: {[ln: number]: any}} = {};\n\tstatic\t#hFuncBP: {[tag_name: string]: 1} = {};\n\t#breakState\t= BreakState.Running;\n\t\t// https://raw.githubusercontent.com/famibee/SKYNovel-vscode-extension/master/src/doc/BreakStateSMD.pu\n\tisBreak = (_token: string)=> false;\n\t#isBreak_base(token: string): boolean {\n\t\tswitch (this.#breakState) {\n\t\t\tcase BreakState.StepOuting:\tthis.#subHitCondition();\n\t\t\t\tthis.#breakState = BreakState.StepOut;\tbreak;\n\t\t\tcase BreakState.StepOut:\n\t\t\t\tif (this.#aCallStk.length !== this.#csDepth_macro_esc) break;\n\n\t\t\t\tthis.#breakState = BreakState.Step;\n\t\t\t\tthis.main.setLoop(false, 'ステップ実行');\n\t\t\t\tthis.sys.send2Dbg('stopOnStep', {});\n\t\t\t\treturn true;\t// タグを実行せず、直前停止\n\n\t\t\tcase BreakState.Stepping:\tthis.#subHitCondition();\n\t\t\t\tthis.#breakState = BreakState.Step;\tbreak;\n\t\t\tcase BreakState.Step:\t\tthis.#subHitCondition();\n\t\t\t\tthis.main.setLoop(false, 'ステップ実行');\n\t\t\t\tthis.sys.send2Dbg('stopOnStep', {});\n\t\t\t\treturn true;\t// タグを実行せず、直前停止\n\n\t\t\tcase BreakState.Breaking:\tthis.#subHitCondition();\n\t\t\t\tthis.#breakState = BreakState.Running;\tbreak;\n\n\t\t\tdefault:\n\t\t\t{\t// 関数ブレークポイント\n\t\t\t\tif (tagToken2Name(token) in ScriptIterator.#hFuncBP) {\n\t\t\t\t\tthis.#breakState = BreakState.Break;\n\t\t\t\t\tthis.main.setLoop(false, `関数 ${token} ブレーク`);\n\t\t\t\t\tthis.sys.callHook('stopOnBreakpoint', {});\t// sn全体へ通知\n\t\t\t\t\tthis.sys.send2Dbg('stopOnBreakpoint', {});\n\t\t\t\t\treturn true;\t// タグを実行せず、直前停止\n\t\t\t\t}\n\t\t\t}\n\t\t\t{\t// ブレークポイント\n\t\t\t\tconst bp = ScriptIterator.#hFn2hLineBP[this.#cnvSnPath4Dbg(this.#scriptFn)];\n\t\t\t\tif (! bp) break;\n\t\t\t\tconst o = bp[this.#lineNum];\n\t\t\t\tif (! o) break;\n//console.log(`fn:ScriptIterator.ts line:145 👺 【bs:${this.#breakState} idx:${this.#idxToken} ln:${this.#lineNum} tkn:${this.#script.aToken[this.#idxToken -1]}:】 o:%o`, o);\n\t\t\t\tif (o.condition) {if (! this.prpPrs.parse(o.condition)) break}\n\t\t\t\telse if (('hitCondition' in o) && --o.hitCondition > 0) break;\n\t\t\t\tconst isBreak = this.#breakState === BreakState.Running;\n\t\t\t\tthis.#breakState = BreakState.Break;\n\t\t\t\tthis.main.setLoop(false, isBreak ?(\n\t\t\t\t\t(o.condition ? '条件' :'ヒットカウント') +'ブレーク'\n\t\t\t\t\t) :'ステップ実行');\n\t\t\t\tconst type = isBreak ?'stopOnBreakpoint' :'stopOnStep';\n\t\t\t\tthis.sys.callHook(type, {});\t// sn全体へ通知\n\t\t\t\tthis.sys.send2Dbg(type, {});\n\t\t\t}\n\t\t\t\treturn true;\t// タグを実行せず、直前停止\n\t\t}\n\n\t\treturn false;\t// no break、タグを実行\n\t}\n\t#subHitCondition() {\t// step実行中でbreakしないがヒットカウントだけ減算\n\t\tconst o = ScriptIterator.#hFn2hLineBP[getFn(this.#scriptFn)]?.[this.#lineNum];\n\t\tif (o?.hitCondition) --o.hitCondition;\n\t}\n\n\t#aStack(): {fn: string, ln: number, col: number, nm: string, ma: string}[] {\n\t\tconst idx_n = this.#breakState === BreakState.Breaking ?1 :0;\n\t\tconst tkn0 = this.#script.aToken[this.#idxToken -1 +idx_n]!;\n\n\t\tconst fn0 = this.#cnvSnPath4Dbg(this.#scriptFn);\n\t\tconst tag_name0 = tagToken2Name(tkn0!);\n\t\tconst nm = tag_name0 ?`[${tag_name0}]` :tkn0;\n//console.log(`fn:ScriptIterator.ts aStack breakState:${this.#breakState} idx:${this.#idxToken -1} idx_n:${idx_n} tkn0:${tkn0}: fn0:${fn0} nm:${nm} tkn02:${this.#script.aToken[this.#idxToken -1]}: +tkn02:${this.#script.aToken[this.#idxToken]}:`);\n//console.log(`fn:ScriptIterator.ts     a:%o anum:%o`, this.script.aToken, this.script.aLNum);\n\t\tconst ma = this.val.getVal('mp:const.sn.macro') ?? '{}';\n\t\tif (this.#idxToken === 0) return [{fn: fn0, ln: 1, col: 1, nm, ma: ma,}];\n\n\t\tconst lc0 = this.#cnvIdx2lineCol(this.#script, this.#idxToken);// -1不要\n//console.log(`fn:ScriptIterator.ts     ln:${lc0.ln} col:${lc0.col_s} col2:${this.#script.aLNum[this.#idxToken -1]}`);\n\t\tconst a = [{fn: fn0, ln: lc0.ln, col: lc0.col_s +1, nm: nm, ma: ma}];\n\t\tconst len = this.#aCallStk.length;\n\t\tif (len === 0) return a;\n\n\t\tfor (let i=len -1; i>=0; --i) {\n\t\t\tconst cs = this.#aCallStk[i]!;\n\t\t\tconst st = this.#hScript[cs.fn];\n\t\t\tif (! st) continue;\n\t\t\tconst tkn = st.aToken[cs.idx -1];\n\t\t\tif (! tkn) continue;\n\t\t\tconst lc = this.#cnvIdx2lineCol(st, cs.idx);\t// -1不要\n\n\t\t\tconst tag_name = tagToken2Name(tkn);\n\t\t\ta.push({\n\t\t\t\tfn\t: this.#cnvSnPath4Dbg(cs.fn),\n\t\t\t\tln\t: lc.ln,\n\t\t\t\tcol\t: lc.col_s +1,\n\t\t\t\tnm\t: tag_name ?`[${tag_name}]` :tkn,\n\t\t\t\tma\t: cs.csArg[':hMp']['const.sn.macro'] ?? '{}',\n\t\t\t});\n\t\t}\n\n\t\treturn a;\n\t}\n\n\t// result = true : waitする  resume()で再開\n\t#procDebugtag\t= (_tag_name: string)=> {};\n\t//MARK: タグ解析\n\tasync\tタグ解析(tag_name: string, args: string): Promise<boolean> {\n\t\tconst tag_fnc = this.hTag[tag_name];\n\t\tif (! tag_fnc) throw `未定義のタグ【${tag_name}】です`;\n\n\t\tthis.#alzTagArg.parse(args);\n\t\tthis.#procDebugtag(tag_name);\n\n\t\tconst hPrm = this.#alzTagArg.hPrm;\n\t\tif (hPrm.cond) {\n\t\t\tconst cond = hPrm.cond.val;\n\t\t\tif (! cond || cond.startsWith('&')) throw '属性condは「&」が不要です';\n\t\t\tconst p = this.prpPrs.parse(cond);\n\t\t\tconst ps = String(p);\n\t\t\tif (ps === 'null' || ps === 'undefined') return false;\n\t\t\tif (! p) return false;\n\t\t}\n\n\t\tlet hArg: any = {};\n\t\tconst len = this.#aCallStk.length;\n\t\tconst csa: any = len === 0 ?{} :this.#aCallStk[len -1]!.csArg;\n\t\tif (this.#alzTagArg.isKomeParam) {\n\t\t\tif (len === 0) throw '属性「*」はマクロのみ有効です';\n\t\t\thArg = {...csa};\n\t\t}\n\t\thArg[':タグ名'] = tag_name;\n\t// #region タグ位置のコールスタック情報を埋め込むコード（デバッグ用）\n\t/*\t{\n\t\t\tconst lc0 = this.#cnvIdx2lineCol(this.#script, this.#idxToken);\n\t\t\tlet now = `存在位置 fn:${this.#scriptFn} line:${lc0.ln} col:${lc0.col_s +1}`;\n\t\t\thArg[':path'] = now;\n\t\t\tconst len = this.#aCallStk.length;\n\t\t\tif (len > 0) {\n\t\t\t\tfor (let i=len -1; i>=0; --i) {\n\t\t\t\t\tconst cs = this.#aCallStk[i];\n\t\t\t\t\tconst hMp = cs.csArg[':hMp'];\n\t\t\t\t\tconst from_macro_nm = hMp ?hMp[':タグ名'] :undefined;\n\t\t\t\t\tconst call_nm = cs.csArg[':タグ名'] ?? '';\n\t\t\t\t\tconst lc = this.#cnvIdx2lineCol(this.#hScript[cs.fn], cs.idx);\n\t\t\t\t\tnow += ` <- (${len -i}) fn:${cs.fn} line:${lc.ln\n\t\t\t\t\t\t} col:${lc.col_s +1\n\t\t\t\t\t\t}`+ (from_macro_nm ?'（['+ from_macro_nm +']マクロ内）' :' ')+\n\t\t\t\t\t\t`で [${call_nm} ...]をコール`;\n\t\t\t\t}\n\t\t\t}\n\t\t}*/\n\t// #endregion\n\t// #region タグ位置情報を埋め込むコード（デバッグ用）\n//\t\thArg[':path'] = this.#scriptFn;\n//\t\thArg[':ln'] = this.#lineNum;\n\t// #endregion\n\t\t// valやdefの値について。null はありえない。'null'や'undefined' はありえる。\n\t\t// 省略時以外で undefined はない。a=undefined と書いても 'undefined' になる\n\t\tfor (const [arg_nm, {val, def}] of Object.entries(hPrm)) {\n\t\t\tlet v = val;\n\t\t\tif (v?.startsWith('%')) {\n\t\t\t\tif (len === 0) throw '属性「%」はマクロ定義内でのみ使用できます（そのマクロの引数を示す簡略文法であるため）';\n\t\t\t\tconst mac = csa[v.slice(1)];\n\t\t\t\tif (mac) {hArg[arg_nm] = mac; continue}\n\n\t\t\t\tif (def === undefined || def === 'null') continue;\n\t\t\t\t\t// defの'null'指定。%変数が無い場合、タグやマクロに属性を渡さない\n\t\t\t\tv = def;\n\t\t\t}\n\n\t\t\tv = this.prpPrs.getValAmpersand(v ?? '');\n\t\t\tif (v !== 'undefined') {hArg[arg_nm] = v; continue}\n\n\t\t\tif (def === undefined) continue;\n\t\t\tv = this.prpPrs.getValAmpersand(def);\n\t\t\tif (v !== 'undefined') hArg[arg_nm] = v;\n\t\t\t\t// 存在しない値の場合、属性を渡さない\n\t\t}\n\n\t\t// （一部タグの処理直前に）文字出現処理を終わらせる\n\t\tif (Reading.needGoTxt && this.#setTag2ChIn.has(tag_name)) {\n\t\t\tconst {promise, resolve} = Promise.withResolvers<void>();\n\t\t\tReading.beginProc(RPN_COMP_CHIN, resolve, false, resolve);\n\t\t\tReading.goTxt();\n\t\t\tthis.val.saveKidoku();\n\t\t\tawait promise;\n\t\t}\n\t\t// （一部タグの処理直前に）画面トランジションを止める\n\t\tif (this.#setTag2FinishTrans.has(tag_name)) {\n\t\t\tthis.#evtMng.hideHint();\n\t\t\tawait CmnTween.closeTrans();\n\t\t}\n\t\t// キー押しっぱなしスキップで処理せずスルーする\n\t\tconst fncBypass = this.#hTag2SkipBypass[tag_name];\n\t\tif (fncBypass\n\t\t\t&& argChk_Boolean(hArg, 'canskip', this.#hTag2CanSkip[tag_name] ?? true)\n\t\t\t&& this.#evtMng.isSkipping) return fncBypass(hPrm);\n\n\t\treturn tag_fnc(hArg);\n\t}\n\t\t// 文字出現演出を待つタグ\n\t\t//\tここで列挙せずタグ処理で文字表示を始めたい場合、goTxt()すること\n\t\treadonly\t#setTag2ChIn = new Set([\n\t\t// 変数操作\n\t\t\t// 'clearsysvar',\t// システム変数の全消去\n\t\t\t// 'clearvar',\t\t// ゲーム変数の全消去 \n\t\t\t// 'let_abs',\t\t// 絶対値\n\t\t\t// 'let_char_at',\t// 文字列から一字取りだし\n\t\t\t// 'let_index_of',\t// 文字列で検索\n\t\t\t// 'let_length',\t// 文字列の長さ\n\t\t\t// 'let_ml',\t\t// インラインテキスト代入\n\n\t\t\t// 'let_replace',\t// 正規表現で置換\n\t\t\t// 'let_round',\t\t// 四捨五入\n\t\t\t// 'let_search',\t// 正規表現で検索\n\t\t\t// 'let_substr',\t// 文字列から抜きだし\n\t\t\t// 'let',\t\t\t// 変数代入・演算\n\n\t\t// レイヤ共通\n\t\t\t// 'add_lay',\t\t// レイヤを追加する\n\t\t\t// 'clear_lay',\t// レイヤ設定の消去\n\t\t\t// 'finish_trans',\t// トランス強制終了\n\t\t\t// 'lay',\t// レイヤ設定\n\t\t\t'trans',\t// ページ裏表を交換\n\t\t\t'wt',\t// トランス終了待ち\n\t\t\t// 'add_filter',\t// フィルター追加\n\t\t\t// 'clear_filter',\t// フィルター全削除\n\t\t\t// 'enable_filter',// フィルター個別切替\n\n\t\t// トゥイーンアニメ\n\t\t\t// 'pause_tsy',\t// 一時停止\n\t\t\t// 'resume_tsy',\t// 一時停止再開\n\t\t\t// 'stop_tsy',\t// トゥイーン中断\n\t\t\t// 'tsy',\t\t// トゥイーン開始\n\t\t\t'wait_tsy',\t// トゥイーン終了待ち\n\n\t\t// 文字・文字レイヤ\n\t\t\t// 'autowc',\t// 文字ごとのウェイト\n\t\t\t// 'ch',\t\t// 文字を追加する\n\t\t\t// 'ch_in_style',\t// 文字出現演出定義\n\t\t\t// 'ch_out_style',\t// 文字消去演出定義\n\t\t\t// 'clear_text',\t// 文字消去\n\t\t\t// 'current',\t// デフォルト文字レイヤ設定\n\t\t\t// 'endlet_ml',\t// インラインテキスト代入の終端\n\t\t\t// 'endlink',\t// ハイパーリンクの終了\n\t\t\t// 'er',\t\t// ページ両面の文字消去\n\t\t\t// 'graph',\t\t// インライン画像表示\n\t\t\t// 'link',\t\t// ハイパーリンク\n\t\t\t// 'r',\t\t\t// 改行\n\t\t\t// 'rec_ch',\t// 履歴書き込み\n\t\t\t// 'rec_r',\t\t// 履歴改行\n\t\t\t// 'reset_rec',\t// 履歴リセット\n\t\t\t// 'ruby2',\t\t// 文字列と複数ルビの追加\n\t\t\t// 'set_focus',\t// フォーカス移動\n\t\t\t// 'span',\t\t// インラインスタイル設定\n\t\t\t// 'tcy',\t\t// 縦中横を表示する\n\n\t\t// 画像・画像レイヤ\n\t\t\t// 'add_face',\t// 差分名称の定義\n\t\t\t'wv',\t\t// 動画再生終了待ち\n\n\t\t// HTMLフレーム\n\t\t\t// 'add_frame',\t// フレーム追加\n\t\t\t// 'frame',\t// フレームに設定\n\t\t\t// 'let_frame',\t// フレーム変数を取得\n\t\t\t// 'set_frame',\t// フレーム変数に設定\n\t\t\t// 'tsy_frame',\t// フレームをトゥイーン開始\n\n\t\t// イベント\n\t\t\t// 'clear_event',\t// イベントを全消去\n\t\t\t// 'enable_event',\t// イベント有無の切替\n\t\t\t// 'event',\t// イベントを予約\n\t\t\t'l',\t// 行末クリック待ち\n\t\t\t'p',\t// 改ページクリック待ち\n\t\t\t's',\t// 停止する\n\t\t\t'wait',\t\t// ウェイトを入れる\n\t\t\t'waitclick',\t// クリックを待つ\n\n\t\t// ＢＧＭ・効果音\n\t\t\t// 'fadebgm',\t// BGMのフェード\n\t\t\t// 'fadeoutbgm',// BGMのフェードアウト\n\t\t\t// 'fadeoutse',\t// 効果音のフェードアウト\n\t\t\t// 'fadese',\t// 効果音のフェード\n\t\t\t// 'playbgm',\t// BGM の演奏\n\t\t\t// 'playse',\t// 効果音の再生\n\t\t\t// 'stop_allse',// 全効果音再生の停止\n\t\t\t// 'stopbgm',\t// BGM 演奏の停止\n\t\t\t// 'stopfadese',// 音声フェードの停止\n\t\t\t// 'stopse',\t// 効果音再生の停止\n\t\t\t// 'volume',\t// BGMや効果音の音量を指定\n\t\t\t'wb',\t// BGM フェードの終了待ち\n\t\t\t'wf',\t// 効果音フェードの終了待ち\n\t\t\t'wl',\t// BGM 再生の終了待ち\n\t\t\t'ws',\t// 効果音再生の終了待ち\n\t\t\t// 'xchgbuf',\t// サウンドバッファの交換\n\n\t\t// 条件分岐\n\t\t\t// 'else',\t// その他ifブロック開始\n\t\t\t// 'elsif',\t// 別条件のifブロック開始\n\t\t\t// 'endif',\t// ifブロックの終端\n\t\t\t// 'if',\t// ifブロックの開始\n\n\t\t// ラベル・ジャンプ\n\t\t\t// 'button',\t// ボタンを表示\n\t\t\t// 'call',\t\t// サブルーチンコール\n\t\t\t// 'jump',\t\t// シナリオジャンプ\n\t\t\t// 'page',\t\t// ページ移動\n\t\t\t// 'pop_stack',\t// コールスタック破棄\n\t\t\t// 'return',\t// サブルーチンから戻る\n\n\t\t// マクロ\n\t\t\t// 'bracket2macro',\t// 括弧マクロの定義\n\t\t\t// 'char2macro',\t// 一文字マクロの定義\n\t\t\t// 'endmacro',\t// マクロ定義の終了\n\t\t\t// 'macro',\t\t// マクロ定義の開始\n\n\t\t// しおり\n\t\t\t// 'copybookmark',\t// しおりの複写\n\t\t\t// 'erasebookmark',\t// しおりの消去\n\t\t\t// 'load',\t\t\t// しおりの読込\n\t\t\t// 'record_place',\t// セーブポイント指定\n\t\t\t// 'reload_script',\t// スクリプト再読込\n\t\t\t// 'save',\t\t\t// しおりの保存\n\n\t\t// 画面揺らし\n\t\t\t'quake',\t\t// 画面を揺らす\n\t\t\t// 'stop_quake',// 画面揺らし中断\n\t\t\t'wq',\t\t// 画面揺らし終了待ち\n\n\t\t// システム\n\t\t\t// 'close',\t\t// アプリの終了\n\t\t\t// 'export',\t// プレイデータをエクスポート\n\t\t\t// 'import',\t// プレイデータをインポート\n\t\t\t// 'loadplugin',\t// プラグインの読み込み\n\t\t\t// 'navigate_to',\t// ＵＲＬを開く\n\t\t\t// 'snapshot',\t\t// スナップショット\n\t\t\t// 'title',\t\t// タイトル指定\n\t\t\t// 'toggle_full_screen',\t// 全画面状態切替\n\t\t\t// 'update_check',\t// 更新チェック機能\n\t\t\t// 'window',\t// アプリウインドウ設定\n\n\t\t// デバッグ・その他\n\t\t\t// 'dump_lay',\t\t// レイヤのダンプ\n\t\t\t// 'dump_script',\t// 外部へスクリプトを表示\n\t\t\t// 'dump_stack',\t// スタックのダンプ\n\t\t\t// 'dump_val',\t\t// 変数のダンプ\n\t\t\t// 'log',\t\t// ログ出力\n\t\t\t// 'trace',\t\t// デバッグ表示へ出力\n\t\t]);\n\t\treadonly\t#setTag2FinishTrans = new Set([\n\t\t\t'finish_trans',\t// トランス強制終了\n\t\t\t'trans',\t\t// ページ裏表を交換\n\t\t\t'quake',\t\t// 画面を揺らす\n\t\t\t'stop_quake',\t// 画面揺らし中断\n\t\t\t'add_filter',\t// フィルター追加\n\t\t]);\n\t\t// キー押しっぱなしスキップで処理せずスルーするタグ\n\t\treadonly\t#hTag2SkipBypass: {[tag_name: string]: ITag} = {\n\t\t\t'wt'\t\t: ()=> false,\t// トランス終了待ち\n\t\t\t'wait_tsy'\t: o=> this.hTag.stop_tsy!(o),\t// トゥイーン終了待ち\n\t\t\t// 'wv',\t\t：タグ内部で処理\t// 動画再生終了待ち\n\t\t\t'wait'\t\t\t: ()=> false,\t// ウェイトを入れる\n\t\t\t// 'playbgm',\t：スルー不可\t\t// BGM の演奏\n\t\t\t// 'playse',\t：タグ内部で処理\t// 効果音の再生\n\t\t\t'wb'\t: ()=> this.hTag.stopfadese!({buf: BUF_BGM}),\n\t\t\t\t\t\t\t\t\t\t\t// BGM フェードの終了待ち\n\t\t\t'wf'\t: o=> this.hTag.stopfadese!(o),\t// 効果音フェードの終了待ち\n\t\t\t// 'ws'\t\t：タグ内部で処理\t// 効果音再生の終了待ち\n\t\t\t'wq'\t: ()=> this.hTag.stop_quake!({}),\t// 画面揺らし終了待ち\n\t\t\t// fade系\t：タグ内部で処理\n\t\t\t// 'ch'\t\t：タグ内部で処理\t// 文字を追加する\n\t\t\t// 'tsy'\t：タグ内部で処理\t// トゥイーン開始\n\t\t\t// 'trans'\t：タグ内部で処理\t// ページ裏表を交換\n\t\t\t'quake'\t\t: ()=> false,\t\t// 画面を揺らす\n\t\t};\n\t\t// タグ処理中にクリックなどで即終わらせられるタグ（canskip 属性がある）\n\t\treadonly\t#hTag2CanSkip: {[tag_name: string]: boolean} = {\n\t\t\t\t\t\t// デフォルト値\n\t\t\t'wt'\t\t: true ,\t// [wt]トランス終了待ち\n\t\t\t'wait_tsy'\t: true ,\t// [wait_tsy]トゥイーン終了待ち\n\t\t\t'wv'\t\t: true ,\t// [wv]動画再生終了待ち\n\t\t\t'wait'\t\t: true ,\t// [wait]ウェイトを入れる\n\t\t\t'playbgm'\t: false,\t// [playbgm]BGM の演奏\n\t\t\t'playse'\t: true ,\t// [playse]効果音の再生\n\t\t\t'wb'\t\t: false,\t// [wb]BGM フェードの終了待ち\n\t\t\t'wf'\t\t: false,\t// [wf]効果音フェードの終了待ち\n\t\t\t'ws'\t\t: false,\t// [ws]効果音再生の終了待ち\n\t\t\t'wq'\t\t: true ,\t// [wq]画面揺らし終了待ち\n\t\t};\n\n\n\t#evtMng\t: EventMng;\n\t#layMng\t: LayerMng;\n\tsetOtherObj(evtMng: EventMng, layMng: LayerMng): void {\n\t\tthis.#evtMng = evtMng;\n\t\tthis.#layMng = layMng;\n\t}\n\n\n\t//MARK: インラインテキスト代入\n\t#let_ml(hArg: HArg) {\n\t\tconst {name} = hArg;\n\t\tif (! name) throw 'nameは必須です';\n\n\t\tlet ml = '';\n\t\tconst len = this.#script.len;\n\t\tfor (; this.#idxToken<len; ++this.#idxToken) {\n\t\t\tml = this.#script.aToken[this.#idxToken]!;\n\t\t\tif (ml !== '') break;\n\t\t}\n\t\thArg.text = ml;\n\t\thArg.cast = 'str';\n\t\tthis.hTag['let']!(hArg);\n\t\tthis.#idxToken += 2;\n\t\tthis.#lineNum += (ml.match(/\\n/g) ?? []).length;\n\n\t\treturn false;\n\t}\n\n\n\t//MARK: スタックのダンプ\n\t#dump_stack() {\n\t\tif (this.#idxToken === 0) {\n\t\t\tconsole.group(`🥟 [dump_stack] スクリプト現在地 fn:${this.#scriptFn} line:${1} col:${0}`);\n\t\t\tconsole.groupEnd();\n\t\t\treturn false;\n\t\t}\n\n\t\tconst lc0 = this.#cnvIdx2lineCol(this.#script, this.#idxToken);\n\t\tconst now = `スクリプト現在地 fn:${this.#scriptFn} line:${lc0.ln} col:${lc0.col_s +1}`;\n\t\tconsole.group(`🥟 [dump_stack] ${now}`);\n\t\tconst len = this.#aCallStk.length;\n\t\tif (len > 0) {\n\t\t\tconsole.info(now);\n\t\t\tfor (let i=len -1; i>=0; --i) {\n\t\t\t\tconst cs = this.#aCallStk[i]!;\n\t\t\t\tconst hMp = cs.csArg[':hMp'];\n\t\t\t\tconst from_macro_nm = hMp ?hMp[':タグ名'] :undefined;\n\t\t\t\tconst call_nm = cs.csArg[':タグ名'] ?? '';\n\t\t\t\tconst lc = this.#cnvIdx2lineCol(this.#hScript[cs.fn]!, cs.idx);\n\t\t\t\tconsole.info(\n\t\t\t\t\t`${len -i}つ前のコール元 fn:${cs.fn} line:${lc.ln\n\t\t\t\t\t} col:${lc.col_s +1\n\t\t\t\t\t}`+ (from_macro_nm ?'（['+ from_macro_nm +']マクロ内）' :' ')+\n\t\t\t\t\t`で [${call_nm} ...]をコール`\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t\tconsole.groupEnd();\n\n\t\treturn false;\n\t}\n\t#cnvIdx2lineCol(st: Script, idx: number): {ln: number, col_s: number, col_e: number} {\n\t\tconst ret = {ln: 1, col_s: 0, col_e: 0};\n\t\tif (! st) return ret;\n\n\t\tlet i = idx -1;\n\t\tconst lN = ret.ln = st.aLNum[i]!;\n\t\twhile (st.aLNum[i] === lN) {\n\t\t\tif (! st.aToken[i]!.startsWith('\\n')) {\n\t\t\t\tconst len = st.aToken[i]!.length;\n//console.log(`fn:ScriptIterator.ts line:586 cnvIdx2lineCol tkn:${st.aToken[i]} len:${len} s:${ret.col_s} e:${ret.col_e}`);\n\t\t\t\tif (ret.col_e > 0) ret.col_s += len;\n\t\t\t\tret.col_e += len;\n\t\t\t}\n\t\t\tif (--i < 0) break;\n\t\t}\n\n\t\treturn ret;\n\t}\n\n\n\t//MARK: 外部へスクリプトを表示\n\t#dump_script(hArg: HArg) {\n\t\tconst {set_fnc, break_fnc} = hArg;\n\t\tif (! set_fnc) throw 'set_fncは必須です';\t// スクリプトを返すコールバック\n\n\t\tthis.#fncSet = (globalThis as any)[set_fnc];\n\t\tif (! this.#fncSet) {\n\t\t\tif (argChk_Boolean(hArg, 'need_err', true)) throw `HTML内に関数${set_fnc}が見つかりません`;\n\t\t\tthis.#fncSet = ()=> {};\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.noticeBreak = (goto: boolean)=> {\n\t\t\tif (this.#fnLastBreak !== this.#scriptFn) {\n\t\t\t\tthis.#fnLastBreak = this.#scriptFn;\n\t\t\t\tthis.#fncSet(\n\t\t\t\t\tthis.#hScrCache4Dump[this.#scriptFn] ??= this.#script.aToken.join('')\n\t\t\t\t);\n\t\t\t}\n\t\t\tthis.#fncBreak(this.#lineNum, goto);\n\t\t};\n\t\tthis.noticeBreak(true);\t// 一度目のthis.fncBreak()はスルー（まだ読んでないし）\n\n\t\tif (! break_fnc) return false;\t// Break通知コールバック\n\n\t\tthis.#fncBreak = (globalThis as any)[break_fnc];\n\t\tif (! this.#fncBreak) {\n\t\t\tif (argChk_Boolean(hArg, 'need_err', true)) throw `HTML内に関数${break_fnc}が見つかりません`;\n\t\t\tthis.#fncBreak = ()=> {};\n\t\t}\n\n\t\treturn false;\n\t}\n\t#fncSet: (txt: string)=> void = ()=> {};\n\t#fncBreak: (ln: number, goto: boolean)=> void = ()=> {};\n\t#fnLastBreak = '';\n\t#hScrCache4Dump: {[fn: string]: string;} = {};\n\tnoticeBreak = (_goto: boolean)=> {}\n\n\n\t#dumpErrLine = 5;\n\tdumpErrForeLine() {\n\t\tif (this.#idxToken === 0) {\n\t\t\tconsole.group(`🥟 Error line (from 0 rows before) fn:${this.#scriptFn}`);\n\t\t\tconsole.groupEnd();\n\t\t\treturn;\n\t\t}\n\n\t\tlet s = '';\n\t\tfor (let i=this.#idxToken -1; i>=0; --i) {\n\t\t\ts = this.#script.aToken[i] + s;\n\t\t\tif ((s.match(/\\n/g) ?? []).length >= this.#dumpErrLine) break;\n\t\t}\n\t\tconst a = s.split('\\n').slice(-this.#dumpErrLine);\n\t\tconst len = a.length;\n\t\tconsole.group(`🥟 Error line (from ${len} rows before) fn:${this.#scriptFn}`);\n\t\tconst ln_txt_width = String(this.#lineNum).length;\n\t\tconst lc = this.#cnvIdx2lineCol(this.#script, this.#idxToken);\n\t\tfor (let i=0; i<len; ++i) {\n\t\t\tconst ln = this.#lineNum -len +i +1;\n\t\t\tconst mes = `${String(ln).padStart(ln_txt_width, ' ')}: %c`;\n\t\t\tconst e = a[i]!;\n\t\t\tconst line = (e.length > 75) ?e.slice(0, 75) +'…' :e;\t// 長い場合は後略\n\t\t\tif (i === len -1) console.info(\n\t\t\t\tmes + line.slice(0, lc.col_s) +'%c'+ line.slice(lc.col_s),\n\t\t\t\t'color: black; background-color: skyblue;', 'color: black; background-color: pink;'\n\t\t\t)\n\t\t\telse console.info(mes + line, 'color: black; background-color: skyblue;');\n\t\t}\n\t\tconsole.groupEnd();\n\t\t//console.log('Linkの出力   : %o', 'file:///Volumes/MacHD2/_Famibee/SKYNovel/prj/mat/main.sn');\n\t}\n\n\n\t#aIfStk\t: number[]\t= [-1];\t// 先頭に積む FIFOバッファ（unshift / shift）\n\t//MARK: ifブロックの終端\n\t#endif() {\n\t\tconst t = this.#aIfStk[0];\n\t\tif (! t) throw `this.#aIfStk が異常です`;\n\t\tif (t === -1) throw 'ifブロック内ではありません';\n\n\t\tthis.#idxToken = t;\n\t\tthis.#aIfStk.shift();\t// 最初の要素を取り除く\n\n\t\treturn false;\n\t}\n\t//MARK: ifブロックの開始\n\t#if(hArg: HArg) {\n\t\t//console.log('if idxToken:'+ this.#idxToken);\n\t\tconst {exp} = hArg;\n\t\tif (! exp) throw 'expは必須です';\n\t\tif (exp.startsWith('&')) throw '属性expは「&」が不要です';\n\n\t\tlet cntDepth = 0;\t\t// if深度カウンター\n\t\tlet\tidxGo = this.prpPrs.parse(exp) ?this.#idxToken :-1;\n\t\tconst lnIf = this.#script.aLNum[this.#idxToken];\n\t\tlet zLn = this.#lineNum -(lnIf || 0);\t// ??ではなく。NaN は falsy\n\t\tconst len = this.#script.len;\n\t\tfor (; this.#idxToken<len; ++this.#idxToken) {\n\t\t\tconst ln = this.#script.aLNum[this.#idxToken];\n\t\t\tthis.#script.aLNum[this.#idxToken] = (ln || 0)+ zLn; // ??はNaN不可\n\t\t\tconst tkn = this.#script.aToken[this.#idxToken];\n\t\t\t//console.log(`[if]トークン ${this.#scriptFn}:${this.#lineNum} idx:${this.#idxToken} realLn:${this.#script.aLNum[this.#idxToken]} idxGo:${idxGo} cntDepth:${cntDepth} token<${tkn}>`);\n\t\t\tif (! tkn) continue;\n\n\t\t\tconst uc = tkn.charCodeAt(0);\t// TokenTopUnicode\n\t\t\tif (uc === 10) {this.#lineNum += tkn.length; continue}\t// \\n 改行\n\t\t\tif (uc !== 91) continue;\t// [ タグ開始以外\n\n\t\t\tconst [tag_name, args] = tagToken2Name_Args(tkn);\n\t\t\tif (! (tag_name in this.hTag)) throw `未定義のタグ[${tag_name}]です`;\n\t\t\tthis.#alzTagArg.parse(args);\n\n\t\t\tswitch (tag_name) {\n\t\t\tcase 'if':\t++cntDepth; break;\n\n\t\t\tcase 'elsif':\n\t\t\t\tif (cntDepth > 0) break;\n\t\t\t\tif (idxGo > -1) break;\n\n\t\t\t\tconst e = this.#alzTagArg.hPrm.exp?.val;\n\t\t\t\tif (! e) throw 'expは必須です';\n\t\t\t\tif (e.startsWith('&')) throw '属性expは「&」が不要です';\n\t\t\t\tif (this.prpPrs.parse(e)) idxGo = this.#idxToken +1;\n\t\t\t\tbreak;\n\n\t\t\tcase 'else':\n\t\t\t\tif (cntDepth > 0) break;\n\t\t\t\tif (idxGo === -1) idxGo = this.#idxToken +1;\n\t\t\t\tbreak;\n\n\t\t\tcase 'endif':\n\t\t\t\tif (cntDepth > 0) {--cntDepth; break}\n\t\t\t\tif (idxGo === -1) {\n\t\t\t\t\t++this.#idxToken;\n\t\t\t\t\tthis.#script.aLNum[this.#idxToken]! += zLn;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tthis.#aIfStk.unshift(this.#idxToken +1);\t// 先頭に要素追加\n\t\t\t\t\tthis.#idxToken = idxGo;\n\t\t\t\t\tthis.#lineNum = this.#script.aLNum[this.#idxToken]!;\n\t\t\t\t\t\t// +zLn 不要\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t\tthrow '[endif]がないままスクリプト終端です';\n\t\t//return false;\n\t}\n\n\n\t//MARK: サブルーチンコール\n\t#call(hArg: HArg) {\n\t\tif (! argChk_Boolean(hArg, 'count', false)) this.#eraseKidoku();\n\n\t\tconst {fn} = hArg;\n\t\tif (fn) this.#cnvSnPath(fn);\t// chk only\n\t\tthis.#callSub({...hArg, ':hEvt1Time': ReadingState.popLocalEvts()});\n\t\t\t// ':hEvt1Time'の扱いだけは[macro]と異なる\n\n\t\tif (argChk_Boolean(hArg, 'clear_local_event', false)) this.hTag.clear_event!({});\n\t\treturn this.#jumpWork(fn, hArg.label);\n\t}\n\t#callSub(h: any) {\n\t\tconst csa: ICallStackArg = {...h, ':hMp': this.val.cloneMp(), ':lenIfStk': this.#aIfStk.length};\n\t\tthis.#script.aLNum[this.#idxToken] = this.#lineNum;\t// 戻ったときの行番号\n\t\tif (! this.#resvToken) {csa[':resvToken'] = ''; this.#clearResvToken()}\n\t\tthis.#aCallStk.push(new CallStack(this.#scriptFn, this.#idxToken, csa));\n\t\tthis.#aIfStk.unshift(-1);\t// 最初に要素を追加\n\t}\n\n\t//MARK: シナリオジャンプ\n\t#jump(hArg: HArg) {\n\t\tif (! argChk_Boolean(hArg, 'count', true)) this.#eraseKidoku();\n\n\t\tthis.#aIfStk[0] = -1;\n\t\treturn this.#jumpWork(hArg.fn, hArg.label);\n\t}\n\n\t//MARK: コールスタック破棄\n\t#pop_stack(hArg: HArg) {\n\t\tif (argChk_Boolean(hArg, 'clear', false)) this.#aCallStk = [];\n\t\telse if (! this.#aCallStk.pop()) throw 'スタックが空です';\n\t\tthis.#clearResvToken();\n\t\tthis.#aIfStk = [-1];\n\t\tthis.val.setMp({});\n\n\t\treturn false;\n\t}\n\n\t//MARK: サブルーチンから戻る\n\t#return(hArg: HArg) {\n\t\tconst cs = this.#aCallStk.pop();\n\t\tif (! cs) throw 'スタックが空です';\n\t\tconst csa = cs.csArg;\n\t\tthis.#aIfStk = this.#aIfStk.slice(-csa[':lenIfStk']);\t// 最初の要素を取り除く\n\n\t\tconst hMp = csa[':hMp'];\t// マクロからの復帰の場合にmp:値も復帰\n\t\tif (hMp) this.val.setMp(hMp);\n\n\t\tconst after_token = csa[':resvToken'];\n\t\tif (after_token) this.nextToken = ()=> {\n\t\t\tthis.#clearResvToken();\n\t\t\treturn after_token;\n\t\t}\n\t\telse this.#clearResvToken();\n\t\tif (csa[':hEvt1Time']) ReadingState.pushLocalEvts(csa[':hEvt1Time']);\n\n\t\tconst {fn, label} = hArg;\n\t\tif (fn || label) return this.#jumpWork(fn, label);\n\n\t\tif (cs.fn in this.#hScript) {this.#jump_light(cs); return false}\n\t\treturn this.#jumpWork(cs.fn, '', cs.idx);\t// 確実にスクリプトロードなので\n\t}\n\n\t#resvToken\t= '';\n\t#clearResvToken() {\n\t\tthis.#resvToken = '';\n\t\tthis.nextToken = this.#nextToken_Proc;\n\t}\n\n\n\t#skipLabel = '';\n\t#jumpWork(fn = '', label = '', idx = 0): boolean {\n\t\tif (CmnLib.debugLog) console.log(`📜 %c1:jumpWork%c fn:${fn} lbl:${label} idx:${idx}`, 'color:#3B0;', '');\n\t\tif (! fn && ! label) this.main.errScript('[jump系] fnまたはlabelは必須です');\n\t\tif (label) {\n\t\t\tif (! label.startsWith('*')) this.main.errScript('[jump系] labelは*で始まります');\n\t\t\tthis.#skipLabel = label;\n\t\t\tif (! this.#skipLabel.startsWith('**')) this.#idxToken = idx;\n\t\t}\n\t\telse {\n\t\t\tthis.#skipLabel = '';\n\t\t\tthis.#idxToken = idx;\n\t\t}\n\n\t\tif (! fn) {this.analyzeInit(); return false}\n\t\tif (fn.includes('@')) throw `[jump系] fn には文字「@」は禁止です`;\n\n\t\tconst full_path = this.#cnvSnPath(fn);\n\t\tif (fn === this.#scriptFn) {this.analyzeInit(); return false}\n\t\tthis.#scriptFn = fn;\n\t\tconst st = this.#hScript[fn];\n\t\tif (st) {this.#script = st; this.analyzeInit(); return false}\n\n\t\tconst RPN_JUMPWORK = `jumpWork fn:${fn}`;\n\t\tReading.beginProc(RPN_JUMPWORK);\n\t\tlet fp_diff = '';\n\t\tconst ldr = new Loader;\n\t\ttry {\n\t\t\tfp_diff = this.#cnvSnPath(fn +'@');\n\t\t\t// 派生ファイルが存在する場合\n\t\t\tldr.add({name: fn +':base', url: full_path});\n\t\t\tldr.add({name: fn, url: fp_diff});\n\t\t} catch {\n\t\t\t// 派生ファイルはない\n\t\t\tldr.add({name: fn, url: full_path});\n\t\t}\n\t\tldr.use(async (res, next)=> {\n\t\t\ttry {\n\t\t\t\tres.data = await this.sys.dec(res.extension, res.data);\n\t\t\t} catch (e) {\n\t\t\t\tthis.main.errScript(`[jump系]snロード失敗です fn:${res.name} ${e}`, false);\n\t\t\t}\n\t\t\tnext();\n\t\t})\n\t\t.load((_ldr, hRes)=> {\n\t\t\tReading.endProc(RPN_JUMPWORK);\n\t\t\tif (fp_diff) {\t// 派生ファイルが存在する場合\n\t\t\t\tconst scrBase = hRes[fn +':base']!.data;\n\t\t\t\tconst scrDiff = hRes[fn]!.data;\n\t\t\t\tconst aBase = scrBase.split('\\n');\n\t\t\t\tconst aDiff = scrDiff.split('\\n');\n\t\t\t\tconst lenB = aBase.length;\n\t\t\t\tconst lenD = aDiff.length;\n\t\t\t\t// 【派生スクリプト】の空行へ、【基底スクリプト】の同じ行の内容をコピー\n\t\t\t\tfor (let i=0; i<lenD && i<lenB; ++i) aDiff[i] ||= aBase[i];\n\n\t\t\t\t// 【接尾辞つきファイル】として扱う\n\t\t\t\thRes[fn]!.data = aDiff.join('\\n');\n\t\t\t\tdelete hRes[fn +':base'];\n\t\t\t}\n\n\t\t\tthis.nextToken = this.#nextToken_Proc;\n\t\t\tthis.#lineNum = 1;\n\n\t\t\tthis.#resolveScript(hRes[fn]!.data);\n\t\t\tthis.hTag.record_place!({});\n\t\t\tthis.analyzeInit();\n\t\t});\n\n\t\treturn true;\n\t}\n\tprivate\tanalyzeInit(): void {\n\t\tif (CmnLib.debugLog) console.log(`📜 %c9:analyzeInit%c fn:${this.#scriptFn} lbl:${this.#skipLabel} idx:${this.#idxToken}`, 'color:#3B0;', '');\n\t\tconst o = this.#seekScript(this.#script, Boolean(this.val.getVal('mp:const.sn.macro.name')), this.#lineNum, this.#skipLabel, this.#idxToken);\n\t\tthis.#idxToken\t= o.idx;\n\t\tthis.#lineNum\t= o.ln;\n\t}\n\n\t// シナリオ解析処理ループ・冒頭処理\n\tnextToken = ()=> '';\t// 初期化前に終了した場合向け\n\t#nextToken_Proc(): string {\n\t\tif (this.#errOverScr()) return '';\n\n\t\tthis.#recordKidoku();\n\n\t\t// トークンの行番号更新\n\t\tthis.#script.aLNum[this.#idxToken] ||= this.#lineNum;\t// ??はNaN不可\n\t\tconst token = this.#script.aToken[this.#idxToken]!;\n\t\tthis.#dbgToken(token);\n\t\t++this.#idxToken;\n\n\t\treturn token;\n\t}\n\t#dbgToken = (_token: string)=> {};\n\t#errOverScr(): boolean {\n\t\tif (this.#idxToken < this.#script.len) return false;\n\t\tthis.main.errScript('スクリプト終端です errOverScr');\n\t\treturn true;\n\t}\n\n\n\treadonly #REG_NONAME_LABEL\t\t= /(\\*{2,})([^\\|]*)/;\n\treadonly #REG_TOKEN_MACRO_BEGIN\t= /^\\[macro\\s/;\n\treadonly #REG_TOKEN_MACRO_END\t= /^\\[endmacro[\\s\\]]/;\n\t#seekScript(st: Script, inMacro: boolean, ln: number, skipLabel: string, idx: number): ISeek {\n\t\t//console.log(`seekScript (from)inMacro:${inMacro} (from)ln:${ln} (to)skipLabel:${skipLabel}: (to)idx:${idx}`);\n\t\tconst len = st.aToken.length;\n\t\tif (! skipLabel) {\t// ラベルジャンプ以外（先頭から開始）\n\t\t\tif (this.#errOverScr()) return {idx, ln};\n\n\t\t\tif (! st.aLNum[idx]) {\t// NaN、undefined は falsy\n\t\t\t\tln = 1;\n\t\t\t\tfor (let j=0; j<idx; ++j) {\n\t\t\t\t\t// 走査ついでにトークンの行番号も更新\n\t\t\t\t\tst.aLNum[j] ||= ln;\t// ??はNaN不可\n\n\t\t\t\t\tconst tkn = st.aToken[j]!;\n\t\t\t\t\tif (tkn.startsWith('\\n')) ln += tkn.length;\t// \\n 改行\n\t\t\t\t\telse ln += (tkn.match(/\\n/g) ?? []).length;\n\t\t\t\t}\n\t\t\t\tst.aLNum[idx] = ln;\n\t\t\t}\n\t\t\telse ln = st.aLNum[idx];\n\n\t\t\treturn {idx, ln};\n\t\t}\n\n\t\t// 無名ラベルジャンプ\n\t\tst.aLNum[0] = 1;\n\t\tconst a_skipLabel = skipLabel.match(this.#REG_NONAME_LABEL);\n\t\tif (a_skipLabel) {\n\t\t\tskipLabel = a_skipLabel[1]!;\n\t\t\tlet i = idx;\n\t\t\tswitch (a_skipLabel[2]) {\n\t\t\tcase 'before':\n\t\t\t\twhile (st.aToken[--i] !== skipLabel) {\n\t\t\t\t\tif (i === 0) DebugMng.myTrace('[jump系 無名ラベルbefore] '\n\t\t\t\t\t\t+ ln +'行目以前で'+ (inMacro ?'マクロ内に' :'')\n\t\t\t\t\t\t+ 'ラベル【'+ skipLabel +'】がありません', 'ET');\n\t\t\t\t\tif (inMacro && st.aToken[i]!.search(this.#REG_TOKEN_MACRO_BEGIN) > -1) DebugMng.myTrace('[jump系 無名ラベルbefore] マクロ内にラベル【'+ skipLabel +'】がありません', 'ET');\n\t\t\t\t}\n\t\t\t\treturn {idx: i +1, ln: st.aLNum[i]!};\t//\tbreak;\n\n\t\t\tcase 'after':\n\t\t\t\twhile (st.aToken[++i] !== skipLabel) {\n\t\t\t\t\tif (i === len) DebugMng.myTrace('[jump系 無名ラベルafter] '\n\t\t\t\t\t\t+ ln +'行目以後でマクロ内にラベル【'+ skipLabel +'】がありません', 'ET');\n\t\t\t\t\tif (st.aToken[i]!.search(this.#REG_TOKEN_MACRO_END) > -1) DebugMng.myTrace('[jump系 無名ラベルafter] '\n\t\t\t\t\t\t+ ln +'行目以後でマクロ内にラベル【'+ skipLabel +'】がありません', 'ET');\n\t\t\t\t}\n\t\t\t\treturn {idx: i +1, ln: st.aLNum[i]!};\t//\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tDebugMng.myTrace('[jump系] 無名ラベル指定【label='+ skipLabel +'】が間違っています', 'ET');\n\t\t\t}\n\t\t}\n\n\t\t// ラベルジャンプ\n\t\tln = 1;\n\t\t// (new RegExp(\"~\")) の場合は、バックスラッシュは２つ必要\n\t\tconst reLabel = new RegExp(\n\t\t\t'^'+ skipLabel.replaceAll('*', '\\\\*') +'(?=\\\\s|;|\\\\[|\\\\||$)');\n\t\tlet in_let_ml = false;\n\t\tfor (let i=0; i<len; ++i) {\n\t\t\t// 走査ついでにトークンの行番号も更新\n\t\t\tst.aLNum[i] ||= ln;\t// ??はNaN不可\n\n\t\t\tconst tkn = st.aToken[i]!;\n\t\t\tif (in_let_ml) {\n\t\t\t\tif (this.#grm.testTagEndLetml(tkn)) in_let_ml = false;\n\t\t\t\telse ln += (tkn.match(/\\n/g) ?? []).length;\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst uc = tkn.charCodeAt(0);\t// TokenTopUnicode\n\t\t\tif (uc === 10) {ln += tkn.length; continue}\t// \\n 改行\n\t\t\tif (uc === 42) {\t// 42 = *\n\t\t\t\tif (tkn.search(reLabel) > -1) return {idx: i +1, ln};//\tbreak;\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif (uc !== 91) continue;\t// [ タグ開始\n\n\t\t\tln += (tkn.match(/\\n/g) ?? []).length;\n\t\t\tif (this.#grm.testTagLetml(tkn)) in_let_ml = true;\n\t\t}\n\t\tif (in_let_ml) throw '[let_ml]の終端・[endlet_ml]がありません';\n\n\t\tDebugMng.myTrace(`[jump系] ラベル【${skipLabel}】がありません`, 'ET');\n\t\tthrow 'Dummy';\n\t}\n\n\t#hScript\t: HScript\t= Object.create(null);\t//{} シナリオキャッシュ\n\t#resolveScript(txt: string) {\n\t\tlet mes = '';\n\t\ttry {\n\t\t\tmes = 'ScriptIterator.resolveScript';\n\t\t\tconst scr = this.#grm.resolveScript(txt);\n\t\t\tmes = 'ScriptIterator.replaceScript_Wildcard';\n\t\t\tthis.#replaceScript_Wildcard(scr);\n\t\t\tthis.#hScript[this.#scriptFn] = this.#script = scr;\n\t\t}\n\t\tcatch (e) {\n\t\t\tif (e instanceof Error) mes += `例外 mes=${e.message}(${e.name})`;\n\t\t\telse mes = String(e);\n\t\t\tthis.main.errScript(mes, false);\n\t\t}\n\t\tthis.val.touchAreaKidoku(this.#scriptFn);\n\t}\n\n\t#jump_light(cs: CallStack) {\n\t\t// jumpでは連続マクロでスタックオーバーフローになるので簡易版を\n\t\t// 主に[return]やマクロ終了でジャンプ先がチェック不要な場合用\n\t\t// analyzeInit()とかもジャンプ前にやってて不要だし\n\t\tthis.#scriptFn\t= cs.fn;\n\t\tthis.#idxToken\t= cs.idx;\n\t\tconst st = this.#hScript[this.#scriptFn];\n\t\tif (st) this.#script = st;\n\t\tthis.#lineNum = this.#script.aLNum[cs.idx]!;\n//console.log(`fn:ScriptIterator.ts %cjump_light cs ${cs.fn}:${this.#lineNum} idx:${cs.idx}`, 'background-color:#a03b79;');\n\t}\n\n\n\treadonly #REG_WILDCARD\t= /^\\[(call|loadplugin)\\s/;\n\treadonly #REG_WILDCARD2\t= /\\bfn\\s*=\\s*[^\\s\\]]+/;\n\t#replaceScript_Wildcard(scr: Script) {\n\t\tfor (let i=scr.len -1; i>=0; --i) {\n\t\t\tconst token = scr.aToken[i]!;\n\t\t\tif (! this.#REG_WILDCARD.test(token)) continue;\n\n\t\t\tconst [tag_name, args] = tagToken2Name_Args(token);\n\t\t\tthis.#alzTagArg.parse(args);\n\n\t\t\tconst p_fn = this.#alzTagArg.hPrm.fn;\n\t\t\tif (! p_fn) continue;\n\t\t\tconst {val: fn} = p_fn;\n\t\t\tif (! fn || ! fn.endsWith('*')) continue;\n\n\t\t\tscr.aToken.splice(i, 1, '\\t', '; '+ token);\n\t\t\tscr.aLNum.splice(i, 1, NaN, NaN);\n\n\t\t\tconst ext = tag_name === 'loadplugin'\n\t\t\t\t? SEARCH_PATH_ARG_EXT.CSS\n\t\t\t\t: SEARCH_PATH_ARG_EXT.SN;\n\t\t\tconst a = this.cfg.matchPath('^'+ fn.slice(0, -1) +'.*', ext);\n\t\t\tfor (const v of a) {\n\t\t\t\tconst nt = token.replace(\n\t\t\t\t\tthis.#REG_WILDCARD2,\n\t\t\t\t\t'fn='+ decodeURIComponent(getFn(v[ext]!))\n\t\t\t\t);\n\t\t\t\t//console.log('\\t='+ nt +'=');\n\t\t\t\tscr.aToken.splice(i, 0, nt);\n\t\t\t\tscr.aLNum.splice(i, 0, NaN);\n\t\t\t}\n\t\t}\n\t\tscr.len = scr.aToken.length;\n\t}\n\n\n\t#recordKidoku() {\n\t\tconst areas = this.val.touchAreaKidoku(this.#scriptFn);\n\n\t\t// マクロ内やサブルーチンではisKidokuを変更させない\n\t\tif (this.#aCallStk.length > 0) {areas.record(this.#idxToken); return}\n\n\t\tthis.#isKidoku = areas.search(this.#idxToken);\n\t\tthis.val.setVal_Nochk('tmp', 'const.sn.isKidoku', this.#isKidoku);\n\t\tif (this.#isKidoku) return;\n\n\t\tareas.record(this.#idxToken);\n\t\t// saveKidoku()\n\t\t\t// 厳密にはここですべきだが、パフォーマンスに問題があるので\n\t\t\t// クリック待ちを期待できるwait、waitclick、s、l、pタグで\n\t\t\t// saveKidoku()をコール。\n\t}\n\t#isKidoku\t= false;\n\tget isKidoku() {return this.#isKidoku};\n\t#eraseKidoku() {\n\t\tthis.val.getAreaKidoku(this.#scriptFn)?.erase(this.#idxToken);\n\t\tthis.#isKidoku = false;\n\t}\n\tget isNextKidoku(): boolean {\n\t\tlet fn\t= this.#scriptFn;\n\t\tlet idx\t= this.#idxToken;\n\t\tlet len\t= this.#script.len;\n\t\tif (this.#aCallStk.length > 0) {\n\t\t\tconst cs = this.#aCallStk[0]!;\n\t\t\tfn  = cs.fn;\n\t\t\tidx = cs.idx;\n\t\t\tconst st = this.#hScript[fn];\n\t\t\tif (st) len = st.len;\n\t\t}\n\n\t\tconst areas = this.val.getAreaKidoku(fn);\n\t\tif (idx === len) return false;\t// スクリプト終端\n\n\t\treturn areas.search(idx);\n\t}\n\n\n\tget normalWait(): number {\n\t\treturn this.#isKidoku\n\t\t? (\n\t\t\tthis.val.tagCh_doWait_Kidoku\n\t\t\t?\tthis.val.tagCh_msecWait_Kidoku\n\t\t\t:\t0\n\t\t)\n\t\t: (\n\t\t\tthis.val.tagCh_doWait\n\t\t\t?\tthis.val.tagCh_msecWait\n\t\t\t:\t0\n\t\t);\n\t}\n\n\n\t//MARK: 括弧マクロの定義\n\t#bracket2macro(hArg: HArg) {\n\t\tthis.#grm.bracket2macro(hArg, this.hTag, this.#script, this.#idxToken);\n\n\t\treturn false;\n\t}\n\n\t//MARK: 一文字マクロの定義\n\t#char2macro(hArg: HArg) {\n\t\tthis.#grm.char2macro(hArg, this.hTag, this.#script, this.#idxToken);\n\n\t\treturn false;\n\t}\n\n\t//MARK: マクロ定義の開始\n\treadonly\t#REG_NG4MAC_NM = /[\"'#;\\\\]　]+/;\n\t#macro(hArg: HArg) {\n\t\tconst {name} = hArg;\n\t\tif (! name) throw 'nameは必須です';\n\t\tif (name in this.hTag) throw `[${name}]はタグかすでに定義済みのマクロです`;\n\t\tif (this.#REG_NG4MAC_NM.test(name)) throw `[${name}]はマクロ名として異常です`;\n\n\t\tconst ln = this.#lineNum;\n\t\tconst cs = new CallStack(this.#scriptFn, this.#idxToken);\n\t\tthis.#strStepin += '|'+ name;\n\t\t// (new RegExp(\"~\")) の場合は、バックスラッシュは２つ必要\n\t\tthis.#REGSTEPIN = new RegExp(`\\\\[(${this.#strStepin})\\\\b`);\n\t\tthis.hTag[name] = hArgM=> {\n\t\t\thArgM.design_unit = hArg.design_unit;\n\t\t\tthis.#callSub(hArgM);\n\n\t\t\t// AIRNovelの仕様：親マクロが子マクロコール時、*がないのに値を引き継ぐ\n\t\t\t//for (const k of Object.keys(hArg)) this.val.setVal_Nochk('mp', k, hArg[k]);\n\t\t\tthis.val.setMp(hArgM as any);\n\t\t\tthis.val.setVal_Nochk('mp', 'const.sn.macro', JSON.stringify({\n\t\t\t\tname: hArg.name,\n\t\t\t}));\t// ムダに大きいスクリプター用情報を削除\n\t\t\tthis.val.setVal_Nochk('mp', 'const.sn.me_call_scriptFn', this.#scriptFn);\n\n\t\t\tthis.#lineNum = ln;\n\t\t\tthis.#jump_light(cs);\n\n\t\t\treturn false;\n\t\t};\n\n\t\tfor (; this.#idxToken < this.#script.len; ++this.#idxToken) {\n\t\t\t// トークンの行番号更新\n\t\t\tthis.#script.aLNum[this.#idxToken] ||= this.#lineNum; // ??はNaN不可\n\n\t\t\tconst token = this.#script.aToken[this.#idxToken]!;\n\t\t\tif (token.search(this.#REG_TOKEN_MACRO_END) > -1) {\n\t\t\t\t++this.#idxToken;\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tconst uc = token.charCodeAt(0);\t// TokenTopUnicode\n\t\t\tif (uc === 10) this.#lineNum += token.length;\t// \\n 改行\n\t\t\telse if (uc === 91) this.#lineNum += (token.match(/\\n/g) ?? []).length;\t// [ タグ開始\n\t\t}\n\t\tthrow `マクロ[${name}]定義の終端・[endmacro]がありません`;\n\t}\n\t#strStepin\t= 'call';\n\t#REGSTEPIN\t= /\\[(call)\\b/;\t// https://regex101.com/r/Lk9ASK/1\n\n\n\t//MARK: しおりの読込\n\t#load(hArg: HArg) {\n\t\tif (('fn' in hArg) !== ('label' in hArg)) throw 'fnとlabelはセットで指定して下さい';\n\n\t\tconst place = argChk_Num(hArg, 'place', 0);\n\t\tconst mark = this.val.getMark(place);\n\n\t\treturn this.loadFromMark(hArg, mark, SndProcOnLoad.ALL_STOP_AND_PLAY);\n\t}\n\tloadFromMark(hArg: HArg, mark: IMark, snd: SndProcOnLoad = SndProcOnLoad.MINIMAL_STOP) {\n\t\tthis.hTag.clear_event!({});\n\t\tthis.val.mark2save(mark);\n\t\tthis.val.setMp({});\n\t\tthis.#layMng.recPagebreak();\n\n\t\tlet ap: Promise<void>[] = [];\n\t\tif (snd !== SndProcOnLoad.NO_TOUCH) ap = this.sndMng\n\t\t.playLoopFromSaveObj(snd === SndProcOnLoad.ALL_STOP_AND_PLAY);\n\n\t\tif (argChk_Boolean(hArg, 'do_rec', true)) this.#mark = {\n\t\t\thSave\t: this.val.cloneSave(),\n\t\t\thPages\t: {...mark.hPages},\n\t\t\taIfStk\t: [...mark.aIfStk],\n\t\t}\n\n\t\tconst o: HArg = {\n\t\t\tenabled\t: this.val.getVal('save:const.sn.autowc.enabled'),\n\t\t\ttext\t: this.val.getVal('save:const.sn.autowc.text'),\n\t\t\ttime\t: Number(this.val.getVal('save:const.sn.autowc.time')),\n\t\t};\n\t\tthis.hTag.autowc!(o);\n\n\t\tthis.#aIfStk = [...this.#mark.aIfStk];\n\t\tthis.#aCallStk = [];\n\t\tCmnTween.stopAllTw();\n\n\t\tconst p = Promise.allSettled([...ap, ...this.#layMng.playback(this.#mark.hPages)])\n\t\t.then(()=> this.#layMng.cover(false))\n\t\t.catch(e=> console.error(`loadFromMark e:%o`, e));\n\t\tconst {index, fn} = hArg;\n\t\tif (index) {\t// ページ移動用\n\t\t\tif (CmnLib.debugLog) console.log(`📜 %cloadFromMark index:${index} move!%c fn:${fn}`, 'color:#3B0;', '');\n\t\t\tp.then(()=> {\n\t\t\t\tif (! this.#jumpWork(fn, '', index)) this.main.resume();\n\t\t\t\t// if (ret)\t\t// 中で非同期で endProc() を呼ぶのでまかせる\n\t\t\t\t// if (! ret)\t// 同期でなにもせずすぐ返る\n\t\t\t});\n\t\t\treturn true;\n\t\t}\n\n\t\tthis.#layMng.cover(true);\t// ページ移動では全画面黒で覆わない\n\t\tconst fn2 = String(this.val.getVal('save:const.sn.scriptFn'));\n\t\tconst idx = Number(this.val.getVal('save:const.sn.scriptIdx'));\n\t\tdelete this.#hScript[fn2];\t// 必ずスクリプトを再読込。吉里吉里に動作を合わせる\n\t\tconst {label} = hArg;\n\t\tif (label) p.then(()=> {\n\t\t\tthis.#scriptFn = fn2;\n\t\t\tthis.#idxToken = idx;\n\t\t\tif (! this.hTag.call!({fn, label})) this.main.resume();\n\t\t});\n\t\telse p.then(()=> {\n\t\t\tif (! this.#jumpWork(fn2, '', idx)) this.main.resume();\n\t\t});\n\t\treturn true;\n\t}\n\n\t//MARK: スクリプト再読込\n\t#reload_script(hArg: HArg) {\t// 最後の[record_place]から再開\n\t\tconst mark = this.val.getMark(0);\n\t\t// 起動から再読込までの間に追加・変更・削除されたファイルがあるかも、に対応\n\t\t//\tdelete this.hScript[this.#scriptFn];\t// これだと[reload_script]位置になる\n\t\tdelete this.#hScript[getFn(mark.hSave['const.sn.scriptFn'])];\n\n\t\t// 派生ファイルを削除\n\t\tconst h: HScript = {};\n\t\tfor (const fn in this.#hScript) {\n\t\t\ttry {this.#cnvSnPath(fn +'@')}\n\t\t\tcatch {h[fn] = this.#hScript[fn]!}\t// 派生ファイル以外を残す\n\t\t}\n\t\tthis.#hScript = h;\n\n\t\thArg.do_rec = false;\n\t\treturn this.loadFromMark(hArg, mark, SndProcOnLoad.NO_TOUCH);\n\t}\n\n\n\t//MARK: セーブポイント指定\n\t#mark: IMark = {\n\t\thSave\t: {},\n\t\thPages\t: {},\n\t\taIfStk\t: [-1],\n\t};\n\t#record_place = ()=> {\n\t\tconst {fn, idx} = this.nowScrIdx();\n\t\tthis.val.setVal_Nochk('save', 'const.sn.scriptFn', fn);\n\t\tthis.val.setVal_Nochk('save', 'const.sn.scriptIdx', idx);\n\t\tthis.#mark = {\n\t\t\thSave\t: this.val.cloneSave(),\n\t\t\thPages\t: this.#layMng.record(),\n\t\t\taIfStk\t: this.#aIfStk.slice(this.#aCallStk.length),\n\t\t};\n\n\t\treturn false;\n\t}\n\tnowScrIdx(): {fn: string, idx: number} {\n\t\tconst len = this.#aCallStk.length;\n\t\tif (len === 0) return {\n\t\t\tfn\t: this.#scriptFn,\n\t\t\tidx\t: this.#idxToken,\n\t\t};\n\n\t\tconst cs = this.#aCallStk[0]!;\n\t\treturn {\n\t\t\tfn\t: cs.fn,\n\t\t\tidx\t: cs.idx,\n\t\t}\n\t}\n\tnowMark(): IMark {return {...this.#mark}}\n\n\t//MARK: スクリプト停止位置（マクロなどなら最上位の呼び元）\n\tnowScrFnLn(): {fn: string, ln: number, col_s: number, col_e: number} {\n\t\tconst {fn, idx} = this.nowScrIdx();\n\t\tconst st = this.#hScript[fn]!;\n\t\tconst o = this.#cnvIdx2lineCol(st, idx);\t// -1不要\n\t\treturn {fn, ...o};\n\t}\n\n\t//MARK: しおりの保存\n\t#save(hArg: HArg) {\n\t\tif (! ('place' in hArg)) throw 'placeは必須です';\n\t\tconst place = Number(hArg.place);\n\n\t\tdelete hArg[':タグ名'];\n\t\tdelete hArg.place;\n\t\thArg.text = hArg.text ?? '';\n\t\tthis.#mark.json = hArg;\n\t\tthis.val.setMark(place, this.#mark);\n\n\t\tconst now_sp = Number(this.val.getVal('sys:const.sn.save.place'));\n\t\tif (place === now_sp) this.val.setVal_Nochk('sys', 'const.sn.save.place', now_sp +1);\n\n\t\treturn false;\n\t}\n\n\n\trecodeDesign(hArg: HArg) {\n\t\tlet fn = '';\n\t\tlet idx = 0;\n\n\t\tconst len = this.#aCallStk.length;\n\t\tif (hArg.design_unit && len > 0) {\n\t\t\t// デザインモードでこのマクロへの引数変更とするか（内部をサーチさせない）\n\t\t\tconst cs = this.#aCallStk[0]!;\n\t\t\tfn = cs.fn;\n\t\t\tidx = cs.idx;\n\t\t}\n\t\telse {\n\t\t\tfn = this.#scriptFn;\n\t\t\tidx = this.#idxToken;\n\t\t}\n\t\thArg[':path']\t= this.#cnvSnPath4Dbg(fn);\n\t\tconst scr = this.#hScript[fn]!;\n\t\tconst lc = this.#cnvIdx2lineCol(scr, idx);\n\t\thArg[':ln']\t\t= lc.ln;\n\t\thArg[':col_s']\t= lc.col_s;\n\t\thArg[':col_e']\t= lc.col_e;\n\t\tconst idx_1 = idx -1;\n\t\thArg[':idx_tkn']= idx_1;\n\t\thArg[':token']\t= scr.aToken[idx_1];\n\n\t\tthis.sys.send2Dbg('_recodeDesign', hArg);\n\t}\n\treplace(idx: number, val: string) {this.#script.aToken[idx] = val}\n\n}\n"],"names":["CallStack","fn","idx","csArg","RubySpliter","#sesame","hArg","#putCh","putCh","#REG_RUBY","ce","text","groups","ruby","kan_ruby","kan","txt","str","v","a","len","rb_ses","i","aR","lenR","len_max","RPN_COMP_CHIN","ScriptIterator","cfg","hTag","main","val","prpPrs","sndMng","sys","o","#let_ml","#dump_stack","#dump_script","#endif","#if","#call","#jump","#pop_stack","#return","#bracket2macro","#char2macro","#macro","#load","#reload_script","#record_place","#save","#dbgToken","token","#scriptFn","#lineNum","#idxToken","#aCallStk","#procDebugtag","tag_name","#alzTagArg","#aIfStk","#grm","Grammar","CmnLib","type","#hHook","#isBreak_base","fnc","hLineBP","#regBreakPoint","#hFuncBP","tkn","uc","#script","#jumpWork","AnalyzeTagArg","#hFn2hLineBP","#cnvSnPath4Dbg","#breakState","#aStack","#isIdxOverLast","#idxDx4Dbg","#go_stepover","#REGSTEPIN","#go_stepout","#cnvSnPath","SEARCH_PATH_ARG_EXT","#REG4CODE_FN","out","#csDepth_macro_esc","_token","#subHitCondition","tagToken2Name","bp","isBreak","getFn","idx_n","tkn0","fn0","tag_name0","nm","ma","lc0","#cnvIdx2lineCol","cs","st","#hScript","lc","_tag_name","args","tag_fnc","hPrm","cond","p","ps","csa","arg_nm","def","mac","Reading","#setTag2ChIn","promise","resolve","#setTag2FinishTrans","#evtMng","CmnTween","fncBypass","#hTag2SkipBypass","argChk_Boolean","#hTag2CanSkip","BUF_BGM","#layMng","evtMng","layMng","name","ml","now","hMp","from_macro_nm","call_nm","ret","lN","set_fnc","break_fnc","#fncSet","goto","#fnLastBreak","#hScrCache4Dump","#fncBreak","_goto","#dumpErrLine","s","ln_txt_width","ln","mes","e","line","exp","cntDepth","idxGo","lnIf","zLn","tagToken2Name_Args","#eraseKidoku","#callSub","ReadingState","h","#resvToken","#clearResvToken","after_token","label","#jump_light","#nextToken_Proc","#skipLabel","full_path","RPN_JUMPWORK","fp_diff","ldr","Loader","res","next","_ldr","hRes","scrBase","scrDiff","aBase","aDiff","lenB","lenD","#resolveScript","#seekScript","#errOverScr","#recordKidoku","#REG_NONAME_LABEL","#REG_TOKEN_MACRO_BEGIN","#REG_TOKEN_MACRO_END","inMacro","skipLabel","j","a_skipLabel","DebugMng","reLabel","in_let_ml","scr","#replaceScript_Wildcard","#REG_WILDCARD","#REG_WILDCARD2","p_fn","ext","nt","areas","#isKidoku","#REG_NG4MAC_NM","#strStepin","hArgM","place","argChk_Num","mark","snd","ap","#mark","index","fn2","now_sp","idx_1"],"mappings":"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"}