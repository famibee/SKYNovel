{"version":3,"file":"LayerMng.js","sources":["../src/sn/Pages.ts","../src/sn/DesignCast.ts","../src/sn/SpritesMng.ts","../src/sn/GrpLayer.ts","../src/sn/Hyphenation.ts","../src/sn/htm2tx.ts","../src/sn/TxtStage.ts","../src/sn/Button.ts","../src/sn/TxtLayer.ts","../src/sn/FrameMng.ts","../src/sn/Log.ts","../src/sn/LayerMng.ts"],"sourcesContent":["/* ***** BEGIN LICENSE BLOCK *****\n\tCopyright (c) 2018-2025 Famibee (famibee.blog38.fc2.com)\n\n\tThis software is released under the MIT License.\n\thttp://opensource.org/licenses/mit-license.php\n** ***** END LICENSE BLOCK ***** */\n\nimport type {HArg} from './Grammar';\nimport type {IVariable} from './CmnInterface';\nimport type {Layer} from './Layer';\nimport type {SysBase} from './SysBase';\nimport {argChk_Boolean} from './CmnLib';\n\nimport type {Container} from 'pixi.js';\n\nexport class Pages {\n\t#pg: {fore: Layer, back: Layer};\n\n\tconstructor(layname: string, readonly cls: string, fore: Container, back: Container, readonly hArg: HArg, readonly sys: SysBase, readonly val: IVariable, readonly ret: {isWait: boolean}) {\n\t\tconst fncF = sys.hFactoryCls[cls];\n\t\tif (! fncF) throw `å±æ€§ classã€${cls}ã€‘ãŒä¸æ­£ã§ã™`;\n\n\t\tconst f = fncF();\n\t\tconst b = fncF();\n\t\tf.layname =\n\t\tb.layname = layname;\n\t\tconst nm = hArg[':id_tag'] = `layer:${layname} cls:${cls} page:`;\n\t\tf.ctn.name = f.name = nm +'A';\n\t\tb.ctn.name = b.name = nm +'B';\n\t\tfore.addChild(f.ctn);\n\t\tback.addChild(b.ctn);\n\t\targChk_Boolean(hArg, 'visible', true);\n\t\targChk_Boolean(hArg, 'visible', true);// SKYNovelã§ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯trueã¨ã™ã‚‹\n\t\tret.isWait = f.lay(hArg) || b.lay(hArg);\n\t\tthis.#pg = {fore: f, back: b};\n\t\tback.visible = false;\n\n\t\t// çµ„ã¿è¾¼ã¿å¤‰æ•°\n\t\tconst valnm = `const.sn.lay.${layname}`;\n\t\tval.setVal_Nochk('tmp', valnm, true);\n\t\tval.defTmp(valnm +'.fore.alpha', ()=> this.#pg.fore.alpha);\n\t\tval.defTmp(valnm +'.back.alpha', ()=> this.#pg.back.alpha);\n\t\tval.defTmp(valnm +'.fore.height', ()=> this.#pg.fore.height);\n\t\tval.defTmp(valnm +'.back.height', ()=> this.#pg.back.height);\n\t\tval.defTmp(valnm +'.fore.visible', ()=> this.#pg.fore.ctn.visible);\n\t\tval.defTmp(valnm +'.back.visible', ()=> this.#pg.back.ctn.visible);\n\t\tval.defTmp(valnm +'.fore.width', ()=> this.#pg.fore.width);\n\t\tval.defTmp(valnm +'.back.width', ()=> this.#pg.back.width);\n\t\tval.defTmp(valnm +'.fore.x', ()=> this.#pg.fore.x);\n\t\tval.defTmp(valnm +'.back.x', ()=> this.#pg.back.x);\n\t\tval.defTmp(valnm +'.fore.y', ()=> this.#pg.fore.y);\n\t\tval.defTmp(valnm +'.back.y', ()=> this.#pg.back.y);\n\t}\n\tdestroy() {\n\t\tthis.#pg.fore.destroy();\n\t\tthis.#pg.back.destroy();\n\t}\n\n\treadonly lay = (hArg: HArg)=> this.getPage(hArg).lay(hArg);\n\treadonly getPage = (hArg: HArg)=>\n\t\tPages.argChk_page(hArg, 'fore') !== 'back'\n\t\t\t? this.#pg.fore\n\t\t\t: this.#pg.back;\n\tstatic\targChk_page(hash: HArg, def: string): string {\n\t\tconst v = hash.page ?? def;\n\t\tif (v === 'fore' || v === 'back') {hash.page = v; return v}\n\n\t\tthrow Error('å±æ€§ pageã€'+ v +'ã€‘ãŒä¸æ­£ã§ã™');\n\t}\n\tget fore(): Layer {return this.#pg.fore}\n\tget back(): Layer {return this.#pg.back}\n\n\ttransPage(aPrm: Promise<void>[]): void {\n\t\t[this.#pg.back, this.#pg.fore] = [this.#pg.fore, this.#pg.back];\n\t\tthis.#pg.back.copy(this.#pg.fore, aPrm);\n\t}\n\n}\n","/* ***** BEGIN LICENSE BLOCK *****\n\tCopyright (c) 2021-2025 Famibee (famibee.blog38.fc2.com)\n\n\tThis software is released under the MIT License.\n\thttp://opensource.org/licenses/mit-license.php\n** ***** END LICENSE BLOCK ***** */\n\nimport type {HArg} from './Grammar';\nimport type {IPropParser} from './CmnInterface';\nimport type {SysBase} from './SysBase';\nimport type {ScriptIterator} from './ScriptIterator';\nimport type {HPage} from './LayerMng';\nimport type {HPRM} from './AnalyzeTagArg';\nimport type {TxtStage} from './TxtStage';\nimport type {Button} from './Button';\nimport type {GrpLayer} from './GrpLayer';\nimport type {Config} from './Config';\n\nimport type {Application, Text, Sprite} from 'pixi.js';\n\n\nexport class DesignCast {\n\tstatic\tinit(_appPixi: Application, _sys: SysBase, _scrItr: ScriptIterator, _prpPrs: IPropParser, _cfg: Config, _hPages: HPage) { /* empty */ }\n\tstatic\tcvsResizeDesign() { /* empty */ }\n//\tstatic\treadonly\t#alzTagArg\t= new AnalyzeTagArg;\n\n\n\tconstructor(readonly bg_col: string, readonly isLay = false) {}\n\tdestroy() { /* empty */ }\n\n\tgethArg(): HArg {return this.hArg}\n\tprotected\thArg\t: HArg\t= {};\n\tsethArg(hArg: HArg): void {\n\t\tthis.hArg = hArg;\n\t}\n\n\tsetOther(_hPrm: HPRM) { /* empty */ }\n\n\tadopt(_idcCh: DesignCast) {\t// é¤Šå­ç¸çµ„\n\t}\n\n\tstatic\tenterMode() { /* empty */ }\n\tstatic\tallHide() { /* empty */ }\n\tset visible(_v: boolean) { /* empty */ }\n\tstatic\tleaveMode() { /* empty */ }\n\n\n\tcvsResize() { /* empty */ }\n\tmake() { /* empty */ }\n\tstatic replaceToken(_o: unknown) { /* empty */ }\n\n}\n\n\n// ç”»åƒãƒ¬ã‚¤ãƒ¤\nexport class GrpLayDesignCast extends DesignCast {\n\tconstructor(_ctn: Sprite, _gl: GrpLayer) {super('#29e', true)}\n\tsetSp(_sp: Sprite) { /* empty */ }\n}\n\n// æ–‡å­—ãƒ¬ã‚¤ãƒ¤\nexport class TxtLayDesignCast extends DesignCast {\n\tconstructor(_ctn: Sprite, _ts: TxtStage) {\n\t\tsuper('#29e', true);\n\t}\n}\n// æ–‡å­—ãƒ¬ã‚¤ãƒ¤ãƒ»ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°\nexport class TxtLayPadDesignCast extends DesignCast {\n\tconstructor(_ts: TxtStage) {super('#9e2')}\n}\n\n// æ–‡å­—ãƒ¬ã‚¤ãƒ¤ãƒ»ãƒœã‚¿ãƒ³åŸºæœ¬\nexport class BtnDesignCast extends DesignCast {\n\tconstructor(protected readonly btn: Button, override readonly hArg: HArg) {\n\t\tsuper('#e92');\n\t}\n}\n// æ–‡å­—ãƒ¬ã‚¤ãƒ¤ãƒ»æ–‡å­—ãƒœã‚¿ãƒ³\nexport class TxtBtnDesignCast extends BtnDesignCast {\n\tconstructor(btn: Button, hArg: HArg, _txt: Text) {\n\t\tsuper(btn, hArg);\n\t}\n}\n\n// æ–‡å­—ãƒ¬ã‚¤ãƒ¤ãƒ»ç”»åƒãƒœã‚¿ãƒ³\nexport class PicBtnDesignCast extends BtnDesignCast {\n\tsetSp(_sp: Sprite) { /* empty */ }\n}\n","/* eslint-disable @typescript-eslint/no-unsafe-member-access */\n/* ***** BEGIN LICENSE BLOCK *****\n\tCopyright (c) 2023-2025 Famibee (famibee.blog38.fc2.com)\n\n\tThis software is released under the MIT License.\n\thttp://opensource.org/licenses/mit-license.php\n** ***** END LICENSE BLOCK ***** */\n\nimport {Config} from './Config';\nimport {type IEvtMng, argChk_Boolean, argChk_Num, getFn, int} from './CmnLib';\nimport type {IMain, IVariable, SYS_DEC_RET} from './CmnInterface';\nimport {DebugMng} from './DebugMng';\nimport {SEARCH_PATH_ARG_EXT} from './ConfigBase';\nimport type {SysBase} from './SysBase';\nimport type {SoundMng} from './SoundMng';\nimport type {HArg} from './Grammar';\nimport {Layer} from './Layer';\nimport {Reading} from './Reading';\n\nimport {Sprite, type Container, Texture, AnimatedSprite, LoaderResource, utils, Loader, Rectangle, BLEND_MODES} from 'pixi.js';\n\ntype IFncCompSpr = (sp: Sprite)=> void;\n\ntype Iface = {\n\tfn\t\t\t: string;\n\tdx\t\t\t: number;\n\tdy\t\t\t: number;\n\tblendmode\t: number;\n}\ntype Ihface = { [name: string]: Iface; }\n\ntype IResAniSpr = {\n\taTex\t: Texture[];\n\tmeta\t: {\n\t\tanimationSpeed? :number;\n\t};\n}\n\n\nexport class SpritesMng {\n\tstatic\t#cfg\t: Config;\n\tstatic\t#val\t: IVariable;\n\tstatic\t#sys\t: SysBase;\n\tstatic\t#main\t: IMain;\n\tstatic\tinit(cfg: Config, val: IVariable, sys: SysBase, main: IMain, sndMng: SoundMng) {\n\t\tSpritesMng.#cfg = cfg;\n\t\tSpritesMng.#val = val;\n\t\tSpritesMng.#sys = sys;\n\t\tSpritesMng.#main = main;\n\t\tif (sys.arg.crypto) {\n\t\t\tSpritesMng.#cachePicMov = (r, res, next)=> SpritesMng.#dec2cachePicMov(r, res, next);\n\t\t\tSpritesMng.#cacheAniSpr = (r, res, next)=> SpritesMng.#dec2cacheAniSpr(r, res, next);\n\t\t}\n\n\t\tconst fnc = ()=> {\n\t\t\tconst vol = SpritesMng.#glbVol * SpritesMng.#movVol;\n\t\t\tfor (const v of Object.values(SpritesMng.#hFn2hve)) v.volume = vol;\n\t\t};\n\t\tsndMng.setNoticeChgVolume(\n\t\t\tvol=> {SpritesMng.#glbVol = vol; fnc()},\n\t\t\tvol=> {SpritesMng.#movVol = vol; fnc()}\n\t\t);\n\t}\n\tstatic\t#movVol\t= 1;\n\tstatic\t#glbVol\t= 1;\n\n\tstatic\t#evtMng\t: IEvtMng;\n\tstatic\tsetEvtMng(evtMng: IEvtMng) {SpritesMng.#evtMng = evtMng}\n\n\n\tconstructor(readonly csvFn = '', readonly ctn?: Container, private fncFirstComp: IFncCompSpr = ()=> { /* empty */ }, private fncAllComp: (isStop: boolean)=> void = ()=> { /* empty */ }) {\n\t\tif (! csvFn) return;\n\n\t\tthis.#addChild = ctn ? sp=> {ctn.addChild(sp); this.#aSp.push(sp)} : ()=> { /* empty */ };\n\t\tthis.ret = SpritesMng.#csv2Sprites(\n\t\t\tcsvFn,\n\t\t\tsp=> this.fncFirstComp(sp),\t\t\t// å·®ã—æ›¿ãˆè€ƒæ…®\n\t\t\tisStop=> this.fncAllComp(isStop),\t// å·®ã—æ›¿ãˆè€ƒæ…®\n\t\t\tsp=> this.#addChild(sp)\t\t\t\t// å·®ã—æ›¿ãˆè€ƒæ…®\n\t\t);\n\t}\n\treadonly ret: boolean\t\t= false;\n\t#addChild\t: (sp: Sprite)=> void;\n\t#aSp\t\t: Container[]\t= [];\n\n\tdestroy() {\t\t// ã“ã‚Œã‚’ã‚„ã‚‹ãŸã‚ã®ã‚¯ãƒ©ã‚¹ã€ã¨ã™ã‚‰äº‘ãˆã‚‹\n\t\tthis.fncFirstComp\t= ()=> { /* empty */ };\n\t\tthis.fncAllComp\t\t= ()=> { /* empty */ };\n\t\tthis.#addChild\t\t= sp=> sp.destroy();\n\n\t\tfor (const sp of this.#aSp) {\n\t\t\tSpritesMng.stopVideo(sp.name);\n\t\t\t// eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n\t\t\tsp.parent?.removeChild(sp);\n\t\t\tsp.destroy();\n\t\t}\n\t\tthis.#aSp = [];\n\t}\n\n\tstatic\tdestroy() {\n\t\tSpritesMng.#hFace\t= {};\n\t\tSpritesMng.#hFn2ResAniSpr\t= {};\n\t\t//SpritesMng.#ldrHFn\t= {};\n\t\tSpritesMng.#hFn2hve\t= {};\n\t}\n\n\n\t//static #ldrHFn: {[fn: string]: 1} = {};\n\tstatic\t#csv2Sprites(csv: string, fncFirstComp: IFncCompSpr, fncAllComp: (isStop: boolean)=> void, addChild: (sp: Sprite)=> void): boolean {\n\t\tif (! csv) return false;\n\n\t\tlet needLoad = false;\n\t\tif (csv.startsWith('data:')) {\t// Data URI\n\t\t\tconst fnc = ()=> {\n\t\t\t\tconst sp = Sprite.from(csv);\n\t\t\t\taddChild(sp);\n\t\t\t\tfncFirstComp(sp);\n\t\t\t\tfncAllComp(needLoad);\n\t\t\t};\n\t\t\tif (csv in utils.TextureCache) fnc();\n\t\t\telse {needLoad = true; (new Loader).add(csv, csv).load(fnc)}\n\n\t\t\treturn needLoad;\n\t\t}\n\n\t\tconst aComp: {fn: string, fnc: IFncCompSpr}[] = [];\n\t\tconst ldr = new Loader;\n\t\tfor (const fn0 of csv.split(',')) {\n\t\t\tif (! fn0) throw 'faceå±æ€§ã«ç©ºè¦ç´ ãŒå«ã¾ã‚Œã¾ã™';\n\n\t\t\t// å·®åˆ†çµµã‚’é‡ã­ã‚‹\n\t\t\tconst {dx, dy, blendmode, fn} = SpritesMng.#hFace[fn0] ?? {\n\t\t\t\tfn\t: fn0,\n\t\t\t\tdx\t: 0,\n\t\t\t\tdy\t: 0,\n\t\t\t\tblendmode\t: BLEND_MODES.NORMAL\n\t\t\t};\n\t\t\taComp.push({fn, fnc: sp=> {\n\t\t\t\t// eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n\t\t\t\tif (! sp.transform) return;\t// ã‚¨ãƒ©ãƒ¼äºˆé˜²\n\t\t\t\tsp.x = dx;\n\t\t\t\tsp.y = dy;\n\t\t\t\tsp.blendMode = blendmode;\n\t\t\t}});\n\n\t\t\tif (fn in SpritesMng.#hFn2ResAniSpr) continue;\n\t\t\tif (fn in utils.TextureCache) continue;\n\t\t\t//if (fn in utils.BaseTextureCache) continue;\t\t// è­¦å‘Šã«å¤‰åŒ–ãªã—\n\t\t\tif (fn in Loader.shared.resources) continue;\n\t\t\t//if (fn in SpritesMng.#ldrHFn) {\n\t\t\t\t// ã“ã“ã«æ¥ã‚‹ã¨ã„ã†ä¸­é€”åŠç«¯ãªçŠ¶æ…‹ãŒã‚ã‚‹ã€‚ãŠé™°ã§è­¦å‘ŠãŒå‡ºã¦ã—ã¾ã†\n\t\t\t\t// ï¼ˆè­¦å‘Šã‚’æ¶ˆãã†ã¨ã™ã‚‹ï¼‰ä»¥ä¸‹ã®è©¦ã¿ã¯åŠ¹ã‹ãªã„ã€‚ç›´å‰ã® if ã§ãã‚‚ãã‚‚ã“ã“ã«æ¥ãªã„\n\t\t\t\t//\tTexture.removeFromCache(fn);\n\t\t\t\t//\tdelete utils.TextureCache[fn];\n\t\t\t\t//\tdelete Loader.shared.resources[fn];\n\t\t\t\t// continue;\t// ã“ã‚Œã¯å³ç¦ã€å¾¡æ³•åº¦ã€‚\n\t\t\t\t\t// ç”»åƒãƒœã‚¿ãƒ³ã‚„æ–‡å­—ãƒœã‚¿ãƒ³èƒŒæ™¯ã§åŒã˜ç”»åƒã‚’ã€é–“ã‚’ç½®ã‹ãšãƒ­ãƒ¼ãƒ‰ã—ãŸå ´åˆã«æœ€åˆä¸€ã¤ã—ã‹è¡¨ç¤ºã•ã‚Œãªããªã‚‹ã€‚ä»¥ä¸‹ã¯ç¢ºèªç”¨ã‚®ãƒ£ãƒ©ãƒªãƒ¼\n\t\t\t\t\t// http://localhost:8082/index.html?cur=ch_button\n\t\t\t//}\n\t\t\t//SpritesMng.#ldrHFn[fn] = 1;\n\n\t\t\tneedLoad = true;\n\t\t\tconst url = SpritesMng.#cfg.searchPath(fn, SEARCH_PATH_ARG_EXT.SP_GSM);\n\t\t\tconst xt = this.#sys.arg.crypto\n\t\t\t? {xhrType: url.endsWith('.json')\n\t\t\t\t? LoaderResource.XHR_RESPONSE_TYPE.TEXT\n\t\t\t\t: LoaderResource.XHR_RESPONSE_TYPE.BUFFER}\n\t\t\t: {};\n\t\t\tldr.add({...xt, name: fn, url});\n\t\t}\n\t\tconst comp1 = aComp.at(0);\n\t\tif (comp1) comp1.fnc = fncFirstComp;\n\n\t\t// eslint-disable-next-line @typescript-eslint/no-explicit-any\n\t\tconst fncLoaded = (_: any, hRes: {[fn: string]: LoaderResource})=> {\n\t\t\tfor (const {fn, fnc} of aComp) {\n\t\t\t\tconst sp = SpritesMng.#mkSprite(fn, hRes);\n\t\t\t\tsp.name = fn;\t// 4 Debug?\n\t\t\t\taddChild(sp);\n\t\t\t\tfnc(sp);\n\t\t\t}\n\t\t\tfncAllComp(needLoad);\n\t\t}\n\t\tif (needLoad) {\n\t\t\tldr.use((res, next)=> {\n\t\t\t\ttry {\n\t\t\t\t\tif (res.extension === 'json') {\n\t\t\t\t\t\t// eslint-disable-next-line @typescript-eslint/no-unsafe-argument\n\t\t\t\t\t\tvoid this.#sys.dec('json', res.data)\n\t\t\t\t\t\t.then(str=> SpritesMng.#cacheAniSpr(str, res, next));\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// eslint-disable-next-line @typescript-eslint/no-unsafe-argument\n\t\t\t\t\tvoid this.#sys.decAB(res.data).then(aiv=> SpritesMng.#cachePicMov(aiv, res, next));\n\t\t\t\t} catch (e) {\n\t\t\t\t\tconst mes = `ç”»åƒ/å‹•ç”»ãƒ­ãƒ¼ãƒ‰å¤±æ•—ã§ã™ fn:${res.name} ${String(e)}`;\n\t\t\t\t\tif (SpritesMng.#evtMng.isSkipping) console.warn(mes); else console.error('%c'+ mes, 'color:#FF3300;');\n\t\t\t\t}\n\t\t\t})\n\t\t\t.load(fncLoaded);\n\t\t}\n\t\telse queueMicrotask(()=> fncLoaded(0, {}));\n\n\t\treturn needLoad;\n\t}\n\tstatic\t#hFace\t\t\t: Ihface\t= {};\n\tstatic\t#hFn2ResAniSpr\t: {[fn: string]: IResAniSpr} = {};\n\n\n\t// eslint-disable-next-line @typescript-eslint/no-explicit-any\n\tstatic #cachePicMov = (_r: SYS_DEC_RET, {type, name, data}: any, next: ()=> void)=> {\n\t\tswitch (type) {\n\t\t\tcase LoaderResource.TYPE.VIDEO:{\n\t\t\t\tconst hve = <HTMLVideoElement>data;\n\t\t\t\thve.volume = SpritesMng.#glbVol;\n\t\t\t\tSpritesMng.#hFn2hve[name] = SpritesMng.#charmVideoElm(hve);\n\t\t\t}\n\t\t}\n\t\tnext();\n\t}\n\tstatic #sortAFrameName(aFn: string[]): string[] {\n\t\tconst a_base_name = /([^\\d]+)\\d+\\.(\\w+)/.exec(aFn[0] ?? '');\n\t\tif (! a_base_name) return [];\n\n\t\tconst [, d1='', d2=''] = a_base_name;\n\t\tconst is = d1.length;\n\t\tconst ie = -d2.length -1;\n\t\treturn aFn.sort((a, b)=> int(a.slice(is, ie)) > int(b.slice(is, ie)) ?1 :-1);\n\t}\n\n\t// eslint-disable-next-line @typescript-eslint/no-explicit-any\n\tstatic #dec2cachePicMov(r: SYS_DEC_RET, res: any, next: ()=> void) {\n\t\tres.data = r;\n\t\tif (res.extension !== 'bin') next();\n\n\t\tif (r instanceof HTMLImageElement) {\n\t\t\t// eslint-disable-next-line @typescript-eslint/no-unsafe-argument\n\t\t\tvoid Texture.fromLoader(r, res.url, res.name).then(r=> {\n\t\t\t\tres.texture = r;\n\t\t\t\t//Texture.addToCache(Texture.from(r), res.name);\n\t\t\t\t// res.texture = Texture.from(r);\n\t\t\t\t\t// ã§ã‚‚è‰¯ã„ãŒã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥è¿½åŠ ã¨ã€ãã‚Œã§csv2Sprites()å†…ã§ä½¿ç”¨ã™ã‚‹ã®ã§\n\t\t\t\tres.type = LoaderResource.TYPE.IMAGE;\n\t\t\t\t// URL.revokeObjectURL(r.src);\t// TODO: ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç ´æ£„\n\t\t\t});\n\t\t\tnext();\n\t\t\treturn;\n\t\t}\n\n\t\tif (r instanceof HTMLVideoElement) {\n\t\t\tr.volume = SpritesMng.#glbVol;\n\t\t\tSpritesMng.#hFn2hve[res.name] = SpritesMng.#charmVideoElm(r);\n\n\t\t\tres.type = LoaderResource.TYPE.VIDEO;\n//\t\t\tURL.revokeObjectURL(r.src);\n\t\t}\n\t\tnext();\n\t}\n\tstatic #charmVideoElm(hve: HTMLVideoElement): HTMLVideoElement {\n\t\t// ã€PixiJSã€‘iOSã¨Chromeã§AutoPlayå¯èƒ½ãªãƒ“ãƒ‡ã‚ªSpriteã®è¨­å®š - Qiita https://qiita.com/masato_makino/items/8316e7743acac514e361\n\t\tif (SpritesMng.#val.getVal('const.sn.needClick2Play')) {\n\t\t\t// ãƒ–ãƒ©ã‚¦ã‚¶å®Ÿè¡Œã§ã€ã‚¯ãƒªãƒƒã‚¯ã•ã‚Œã‚‹ã¾ã§éŸ³å£°å†ç”ŸãŒå·®ã—æ­¢ã‚ã‚‰ã‚Œã¦ã„ã‚‹çŠ¶æ…‹ã‹ã€‚ãªã«ã‹ã‚¯ãƒªãƒƒã‚¯ã•ã‚Œã‚Œã° falseã«ãªã‚‹\n\t\t\tDebugMng.trace_beforeNew(`[layç³»] ${DebugMng.strPos()}æœªã‚¯ãƒªãƒƒã‚¯çŠ¶æ…‹ã§å‹•ç”»ã‚’è‡ªå‹•å†ç”Ÿã—ã¾ã™ã€‚éŸ³å£°ã¯ãƒŸãƒ¥ãƒ¼ãƒˆã•ã‚Œã¾ã™`, 'W');\n\t\t\thve.muted = true;\t// Chromeå¯¾å¿œï¼šè‡ªå‹•å†ç”Ÿã‚’è¨±å¯ã•ã›ã‚‹ãŸã‚ã€‚ãªã„ã¨å†é–‹æ™‚ã« DOMException\n\t\t}\n\t\thve.setAttribute('playsinline', '');\t// iOSå¯¾å¿œ\n\t\treturn hve;\n\t}\n\n\t// eslint-disable-next-line @typescript-eslint/no-explicit-any\n\tstatic #cacheAniSpr = (_r: string, {type, spritesheet, name, data}: any, next: ()=> void)=> {\n\t\tswitch (type) {\n\t\t\tcase LoaderResource.TYPE.JSON:{\t// switchã¯å¿…é ˆ\n\t\t\t\tconst aFn = <string[]>spritesheet._frameKeys;\n\t\t\t\tSpritesMng.#sortAFrameName(aFn);\n\t\t\t\tSpritesMng.#hFn2ResAniSpr[name] = {\n\t\t\t\t\taTex: aFn.map(fn=> Texture.from(fn)),\n\t\t\t\t\tmeta: <IResAniSpr['meta']>data.meta,\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t\tnext();\n\t}\n\n\t// eslint-disable-next-line @typescript-eslint/no-explicit-any\n\tstatic #dec2cacheAniSpr(r: string, res: any, next: ()=> void) {\n\t\t// eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n\t\tconst {meta, frames} = res.data = JSON.parse(r);\n\t\tres.type = LoaderResource.TYPE.JSON;\n\t\tif (! meta?.image) {next(); return}\n\n\t\t// eslint-disable-next-line @typescript-eslint/no-unsafe-argument\n\t\tconst fn = getFn(meta.image);\n\t\tconst url = SpritesMng.#cfg.searchPath(fn, SEARCH_PATH_ARG_EXT.SP_GSM);\n\t\t(new Loader)\n\t\t.use((res2, next2)=> {\n\t\t\t// eslint-disable-next-line @typescript-eslint/no-unsafe-argument\n\t\t\tthis.#sys.decAB(res2.data)\n\t\t\t.then(r2=> {\n\t\t\t\tres2.data = r2;\n\t\t\t\tif (r2 instanceof HTMLImageElement) {\n\t\t\t\t\tres2.type = LoaderResource.TYPE.IMAGE;\n\t\t\t\t\tURL.revokeObjectURL(r2.src);\n\t\t\t\t}\n\t\t\t\tnext2();\n\t\t\t})\n\t\t\t.catch((e: unknown)=> this.#main.errScript(`ç”»åƒ/å‹•ç”»ãƒ­ãƒ¼ãƒ‰å¤±æ•—ã§ã™ dec2res4Cripto fn:${res2.name} ${String(e)}`, false));\n\t\t})\n\t\t.add({name: fn, url, xhrType: LoaderResource.XHR_RESPONSE_TYPE.BUFFER})\n\t\t.load((ldr, _hRes)=> {\n\t\t\tfor (const {data} of Object.values(ldr.resources)) {\n\t\t\t\t// eslint-disable-next-line @typescript-eslint/no-unsafe-argument\n\t\t\t\tconst {baseTexture} = Texture.from(data);\n\t\t\t\tconst aFr = Object.values(<{[nm: string]: {\n\t\t\t\t\tframe: {x: number; y: number; w: number; h: number;}\n\t\t\t\t}}>frames);\n\t\t\t\tSpritesMng.#hFn2ResAniSpr[res.name] = {\n\t\t\t\t\taTex: aFr.map(({frame: {x, y, w, h}})=> new Texture(\n\t\t\t\t\t\tbaseTexture,\n\t\t\t\t\t\tnew Rectangle(x, y, w, h),\n\t\t\t\t\t)),\n\t\t\t\t\t// eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n\t\t\t\t\tmeta,\n\t\t\t\t};\n\t\t\t}\n\t\t\tnext();\n\t\t});\n\t}\n\n\t\tstatic\t#mkSprite(fn: string, hRes: {[fn: string]: LoaderResource}): Sprite {\n\t\t\tconst ras = SpritesMng.#hFn2ResAniSpr[fn];\n\t\t\tif (ras) {\n\t\t\t\tconst asp = new AnimatedSprite(ras.aTex);\n\t\t\t\tasp.animationSpeed = ras.meta.animationSpeed ?? 1.0;\n\t\t\t\tasp.play();\n\t\t\t\treturn asp;\n\t\t\t}\n\t\t\tif (fn in utils.TextureCache) return Sprite.from(fn);\n\t\t\tconst hve = SpritesMng.#hFn2hve[fn];\n\t\t\tif (hve) return Sprite.from(hve);\n\n\t\t\tconst r = hRes[fn];\n\t\t\treturn r ?new Sprite(r.texture) :new Sprite;\n\t\t}\n\tstatic\t#hFn2hve\t: {[fn: string]: HTMLVideoElement} = {};\n\tstatic\tgetHFn2VElm(fn: string) {return SpritesMng.#hFn2hve[fn]}\n\n\tstatic\twv(hArg: HArg): boolean {\n\t\t// å‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«åæŒ‡å®šã§ã„ã„ã‹ãªã¨ã€‚ãªãœãªã‚‰ã€Œãƒ«ãƒ¼ãƒ—ã§å†ç”Ÿã—ã¤ã¤ã€\n\t\t// åŒãƒ•ã‚¡ã‚¤ãƒ«åã®åˆ¥ã®å‹•ç”»ã®å†ç”Ÿã¯å¾…ã¡ãŸã„ã€ãªã‚“ã¦çŠ¶æ³ã¯æ™®é€šã¯ç„¡ã„ã ã‚ã†ã¨\n\t\tconst {fn} = hArg;\n\t\tif (! fn) throw 'fnã¯å¿…é ˆã§ã™';\n\t\tconst hve = SpritesMng.#hFn2hve[fn];\n\t\tif (! hve || hve.loop) return false;\n\n\t\tif (SpritesMng.#evtMng.isSkipping || hve.ended) {SpritesMng.stopVideo(fn); return false}\n\n\t\tconst RPN_WV = 'wv fn:'+ fn;\n\t\tconst stop = argChk_Boolean(hArg, 'stop', true);\n\t\tconst fnc = ()=> {if (stop) SpritesMng.stopVideo(fn)};\n\t\tReading.beginProc(RPN_WV, fnc, true, fnc);\n\t\thve.addEventListener('ended', ()=> Reading.notifyEndProc(RPN_WV), {once: true, passive: true});\n\n\t\treturn true;\n\t}\n\n\tstatic\tstopVideo(fn: string) {\n\t\tconst hve = SpritesMng.#hFn2hve[fn];\n\t\tif (! hve) return;\n\n\t\t// eslint-disable-next-line @typescript-eslint/no-dynamic-delete\n\t\tdelete SpritesMng.#hFn2hve[fn];\n\t\thve.pause();\n\t\thve.currentTime = hve.duration;\n\t}\n\n\n\tstatic\tadd_face(hArg: HArg): boolean {\n\t\tconst {name} = hArg;\n\t\tif (! name) throw 'nameã¯å¿…é ˆã§ã™';\n\t\tif (name in SpritesMng.#hFace) throw 'ä¸€ã¤ã®nameï¼ˆ'+ name +'ï¼‰ã«å¯¾ã—ã¦åŒã˜ç”»åƒã‚’è¤‡æ•°å‰²ã‚Šå½“ã¦ã‚‰ã‚Œã¾ã›ã‚“';\n\n\t\tconst {fn = name} = hArg;\n\t\tSpritesMng.#hFace[name] = {\n\t\t\tfn,\n\t\t\tdx: argChk_Num(hArg, 'dx', 0),\n\t\t\tdy: argChk_Num(hArg, 'dy', 0),\n\t\t\tblendmode: Layer.getBlendmodeNum(hArg.blendmode ?? '')\n\t\t};\n\n\t\treturn false;\n\t}\n//\tstatic\tclearFace2Name(): void {SpritesMng.hFace = {}}\n\n}\n","/* ***** BEGIN LICENSE BLOCK *****\n\tCopyright (c) 2018-2025 Famibee (famibee.blog38.fc2.com)\n\n\tThis software is released under the MIT License.\n\thttp://opensource.org/licenses/mit-license.php\n** ***** END LICENSE BLOCK ***** */\n\nimport {Layer, type T_RecordPlayBack_lay} from './Layer';\n\nimport {CmnLib, argChk_Boolean, argChk_Num} from './CmnLib';\nimport type {HArg} from './Grammar';\nimport type {IMain, IVariable} from './CmnInterface';\nimport type {Config} from './Config';\nimport type {SysBase} from './SysBase';\nimport {EventListenerCtn} from './EventListenerCtn';\nimport type {SoundMng} from './SoundMng';\nimport type {IMakeDesignCast} from './LayerMng';\nimport {GrpLayDesignCast} from './DesignCast';\nimport {SpritesMng} from './SpritesMng';\nimport {Reading} from './Reading';\n\nimport {Sprite, AnimatedSprite, RenderTexture, type Application} from 'pixi.js';\n\n\nexport type T_RP_layGrp = T_RecordPlayBack_lay & {\n\tsBkFn\t: string;\n\tsBkFace\t: string;\n}\n\n\nexport class GrpLayer extends Layer {\n\tstatic\treadonly\t#elc\t= new EventListenerCtn;\n\n\tstatic\t#appPixi: Application;\n\tstatic\tinit(main: IMain, cfg: Config, appPixi: Application, sys: SysBase, sndMng: SoundMng, val: IVariable): void {\n\t\tGrpLayer.#appPixi = appPixi;\n\t\tSpritesMng.init(cfg, val, sys, main, sndMng);\n\t}\n\tstatic\tdestroy() {GrpLayer.#elc.clear(); SpritesMng.destroy()}\n\n\treadonly\t#idc\t= new GrpLayDesignCast(this.ctn, this);\n\tconstructor() {\n\t\tsuper();\n\t\tif (CmnLib.isDbg) {\n\t\t\tthis.#setIdcSp = sp=> this.#idc.setSp(sp);\n\t\t\tthis.cvsResize = ()=> {super.cvsResize(); this.#idc.cvsResize()}\n\t\t}\n\t}\n\t#setIdcSp\t: (sp: Sprite)=> void\t= ()=> { /* empty */ };\n\n\t#csvFn\t\t= '';\n\t#sBkFn\t\t= '';\n\t#sBkFace\t= '';\n\toverride readonly\tlay = (hArg: HArg)=> {\n\t\tconst RPN_GRP_LAY = Reading.procID +`GrpLayer lay name:${this.name_}`;\n\t\tconst ret = this.#laySub(hArg, isStop=> {\n\t\t\tif (isStop) Reading.endProc(RPN_GRP_LAY);\n\t\t});\n\t\tif (ret) Reading.beginProc(RPN_GRP_LAY);\n\t\treturn ret;\n\t}\n\t#laySub(hArg: HArg, resolve: (isStop: boolean)=> void): boolean {\n\t\tconst {fn, face = ''} = hArg;\n\t\tthis.#idc.sethArg(hArg);\n\t\tif (! fn) {\n\t\t\tsuper.lay(hArg);\n\n\t\t\tif (this.ctn.children.length > 0) this.setPos(hArg);\n\t\t\tthis.#sBkFn = '';\n\t\t\tthis.#csvFn = this.#sBkFace = face;\n\t\t\tresolve(false);\n\t\t\treturn false;\n\t\t}\n\n\t\tconst inFn = 'fn' in hArg;\n\t\tconst inFace = 'face' in hArg;\n\n\t\tthis.clearLay({clear_filter: argChk_Boolean(hArg, 'clear_filter', true)});\n\t\tif (inFn) this.#sBkFn = fn;\t// clearLay()å¾Œã«ç½®ãäº‹\n\t\tif (inFace) this.#sBkFace = face;\n\t\tsuper.lay(hArg);\t// filterè¨­å®šã—ã¦ã‚‹å ´åˆã‚‚\n\n\t\thArg.dx = 0;\n\t\thArg.dy = 0;\n\n\t\tthis.#sps.destroy();\n\t\tthis.#sps = new SpritesMng(\n\t\t\tthis.#csvFn = fn + (face ?','+ face :''),\n\t\t\tthis.ctn,\n\t\t\tsp=> {\n\t\t\t\tif ('width' in hArg || 'height' in hArg) {\n\t\t\t\t\tsp.width = argChk_Num(hArg, 'width', 0);\n\t\t\t\t\tsp.height = argChk_Num(hArg, 'height', 0);\n\t\t\t\t}\n\t\t\t\tthis.#width = sp.width;\n\t\t\t\tthis.#height = sp.height;\n\t\t\t\tLayer.setXY(sp, hArg, this.ctn, true);\n\t\t\t\tLayer.setBlendmode(this.ctn, hArg);\n\t\t\t//\tif (hArg.page === 'fore') this.rsvEvent(sp);\t// ======\n\t\t\t\t\t// [lay page=fore]ã®ã¿swfã‚¢ãƒ‹ãƒ¡çµ‚äº†ã‚¤ãƒ™ãƒ³ãƒˆç™ºç”Ÿ\n\t\t\t\tthis.#setIdcSp(sp);\n\t\t\t},\n\t\t\tisStop=> resolve(isStop),\n\t\t);\n\t\treturn this.#sps.ret;\n\t}\n\t#sps\t= new SpritesMng;\n\t#width\t= 0;\n\t#height\t= 0;\n\toverride\tget\twidth() {return this.#width}\n\toverride\tget\theight() {return this.#height}\n\n\n\toverride\trenderStart() {\n\t\tthis.#spTsy = new Sprite(this.#rtTsy);\n\t\tthis.#spTsy.visible = false;\n\t\tthis.ctn.addChildAt(this.#spTsy, 0);\n\t\tthis.#spTsy.position.set(-this.ctn.x, -this.ctn.y);\n\n\t\tlet fncRenderFore = ()=> {\n\t\t\tconst a = this.ctn.alpha;\n\t\t\tthis.ctn.alpha = 1;\n\t\t\tfor (const s of this.ctn.children) s.visible = true;\n\t\t\tthis.#spTsy.visible = false;\n\t\t\tGrpLayer.#appPixi.renderer.render(this.ctn, {renderTexture: this.#rtTsy});\t// clear: true\n\t\t\tthis.ctn.alpha = a;\n\t\t\tfor (const s of this.ctn.children) s.visible = false;\n\t\t}\n\t\tif (! this.containMovement) {\n\t\t\tconst oldFnc = fncRenderFore;\t// å‹•ããŒãªã„ãªã‚‰æœ€åˆã«ä¸€åº¦\n\t\t\tfncRenderFore = ()=> {fncRenderFore = ()=> { /* empty */ }; oldFnc()};\n\t\t}\n\t\tthis.#fncRender = ()=> {\n\t\t\tfncRenderFore();\n\t\t\tthis.#spTsy.visible = true;\n\t\t};\n\t\tGrpLayer.#appPixi.ticker.add(this.#fncRender);\n\t}\n\t#rtTsy\t= RenderTexture.create({\n\t\twidth\t: CmnLib.stageW,\n\t\theight\t: CmnLib.stageH,\n\t});\n\t#spTsy\t= new Sprite;\n\t#fncRender = ()=> { /* empty */ };\n\toverride\trenderEnd() {\n\t\tGrpLayer.#appPixi.ticker.remove(this.#fncRender);\n\t\tthis.ctn.removeChild(this.#spTsy);\n\t\tfor (const s of this.ctn.children) s.visible = true;\n\t\tthis.#spTsy.destroy(true);\n\n\t\tthis.#rtTsy = RenderTexture.create({\n\t\t\twidth\t: CmnLib.stageW,\n\t\t\theight\t: CmnLib.stageH,\n\t\t});\n\t}\n\n\n\tsetPos(hArg: HArg): void {\n\t\tLayer.setXY(\n\t\t\tthis.ctn.children[0] ?? this.ctn,\n\t\t\thArg,\n\t\t\tthis.ctn,\n\t\t\ttrue\n\t\t);\n\t}\n\n\t// ã‚¢ãƒ‹ãƒ¡ãƒ»å‹•ç”»ã‚’å«ã‚€ã‹\n\toverride get containMovement() {\n\t\tif (this.#csvFn === '') return false;\n\n\t\tconst c = this.ctn.children;\n\t\treturn this.#csvFn.split(',').some(\n\t\t\t(fn, i)=> c[i] instanceof AnimatedSprite || SpritesMng.getHFn2VElm(fn)\n\t\t);\n\t}\n\n\toverride clearLay(hArg: HArg): void {\n\t\tsuper.clearLay(hArg);\n\t\tthis.#sps.destroy();\n\t\tthis.#sBkFn\t\t= '';\n\t\tthis.#sBkFace\t= '';\n\t\tthis.#csvFn\t\t= '';\n\t}\n\toverride readonly record = ()=> ({...super.record(),\n\t\tsBkFn\t\t: this.#sBkFn,\n\t\tsBkFace\t\t: this.#sBkFace,\n//\t\tidc_hArg\t: this.#idc.gethArg(),\n\t});\n\toverride playback(hLay: T_RP_layGrp, aPrm: Promise<void>[]): void {\n\t\tsuper.playback(hLay, aPrm);\n\t\tif (hLay.sBkFn === '' && hLay.sBkFace === '') {\n\t\t\tthis.#sBkFn\t\t= '';\n\t\t\tthis.#sBkFace\t= '';\n//\t\t\tthis.#idc.sethArg(hLay.idc_hArg);\n\t\t\treturn;\n\t\t}\n\n\t\taPrm.push(new Promise(re=> this.#laySub(\n\t\t\t{fn: hLay.sBkFn, face: hLay.sBkFace, left: hLay.x, top: hLay.y, alpha: hLay.alpha, blendmode: Layer.getNum2Blendmode(hLay.blendMode), rotation: hLay.rotation, scale_x: hLay.scale_x, scale_y: hLay.scale_y},\n\t\t\t_isStop=> {this.ctn.position.set(hLay.x, hLay.y); re()},\n\t\t\t\t// Layer.setXY()ã®å¾Œã«å†åº¦ç§»å‹•\n\t\t)));\n\t}\n\n\toverride makeDesignCast(gdc: IMakeDesignCast) {\n\t\tif (! this.ctn.visible) return;\n\t\tgdc(this.#idc);\n\t}\n\t//makeDesignCastChildren(_gdc: IMakeDesignCast) {}\n\n\toverride cvsResize() {super.cvsResize()}\n\n\toverride showDesignCast() {this.#idc.visible = true}\n\t//showDesignCastChildren() {}\n\n\toverride readonly dump = ()=> super.dump() +`, \"pic\":\"${this.#csvFn}\"`;\n\n}\n","/* eslint-disable no-irregular-whitespace */\n/* eslint-disable @typescript-eslint/no-non-null-assertion */\n/* eslint-disable @typescript-eslint/restrict-template-expressions */\n/* ***** BEGIN LICENSE BLOCK *****\n\tCopyright (c) 2024-2025 Famibee (famibee.blog38.fc2.com)\n\n\tThis software is released under the MIT License.\n\thttp://opensource.org/licenses/mit-license.php\n** ***** END LICENSE BLOCK ***** */\n\nimport {argChk_Boolean, argChk_Num} from './CmnLib';\nimport type {HArg} from './Grammar';\n\nimport type {Rectangle} from 'pixi.js';\n\n\nexport type IChRect = {\n\tch\t\t: string;\n\trect\t: Rectangle;\n\telm\t\t: HTMLElement;\n}\n\nexport type T_RP_Hyphenation = {\n\tè¡Œé ­ç¦å‰‡?\t\t: string;\n\tè¡Œæœ«ç¦å‰‡?\t\t: string;\n\tåˆ†å‰²ç¦æ­¢?\t\t: string;\n\tã¶ã‚‰ä¸‹ã’?\t\t: string;\n\tbreak_fixed\t\t: boolean;\n\tbreak_fixed_left: number;\n\tbreak_fixed_top\t: number;\n\tbura\t\t\t: boolean;\n}\n\n\nconst defè¡Œé ­ç¦å‰‡\t= 'ã€ã€‚ï¼Œï¼ï¼‰ï¼½ï½ã€‰ã€ã€ã€‘ã€•â€ã€Ÿããƒã…ã‡ã‰ã£ã‚ƒã‚…ã‚‡ã‚ã‚¡ã‚£ã‚¥ã‚§ã‚©ãƒƒãƒ£ãƒ¥ãƒ§ãƒ®ãƒµãƒ¶ï¼ï¼Ÿ!?â€¼â‰ãƒ»ãƒ¼ã‚ã‚ãƒ½ãƒ¾ã€…';\nconst defè¡Œæœ«ç¦å‰‡\t= 'ï¼»ï¼ˆï½›ã€ˆã€Œã€ã€ã€”â€œã€';\nconst defåˆ†å‰²ç¦æ­¢\t= 'â”€â€¥â€¦';\nconst defã¶ã‚‰ä¸‹ã’\t= defè¡Œé ­ç¦å‰‡;\n\nconst defRegè¡Œé ­ç¦å‰‡\t= new RegExp(`[${defè¡Œé ­ç¦å‰‡}]`);\nconst defRegè¡Œæœ«ç¦å‰‡\t= new RegExp(`[${defè¡Œæœ«ç¦å‰‡}]`);\nconst defRegåˆ†å‰²ç¦æ­¢\t= new RegExp(`[${defåˆ†å‰²ç¦æ­¢}]`);\nconst defRegã¶ã‚‰ä¸‹ã’\t= defRegè¡Œé ­ç¦å‰‡;\n\n\nexport class Hyphenation {\n\t#sè¡Œé ­ç¦å‰‡\t\t= defè¡Œé ­ç¦å‰‡;\n\t#sè¡Œæœ«ç¦å‰‡\t\t= defè¡Œæœ«ç¦å‰‡;\n\t#såˆ†å‰²ç¦æ­¢\t\t= defåˆ†å‰²ç¦æ­¢;\n\t#sã¶ã‚‰ä¸‹ã’\t\t= defã¶ã‚‰ä¸‹ã’;\n\tget è¡Œé ­ç¦å‰‡() {return this.#sè¡Œé ­ç¦å‰‡}\n\tget è¡Œæœ«ç¦å‰‡() {return this.#sè¡Œæœ«ç¦å‰‡}\n\tget åˆ†å‰²ç¦æ­¢() {return this.#såˆ†å‰²ç¦æ­¢}\n\tget ã¶ã‚‰ä¸‹ã’() {return this.#sã¶ã‚‰ä¸‹ã’}\n\n\t#regè¡Œé ­ç¦å‰‡\t= defRegè¡Œé ­ç¦å‰‡;\n\t#regè¡Œæœ«ç¦å‰‡\t= defRegè¡Œæœ«ç¦å‰‡;\n\t#regåˆ†å‰²ç¦æ­¢\t= defRegåˆ†å‰²ç¦æ­¢;\n\t#regã¶ã‚‰ä¸‹ã’\t= defRegã¶ã‚‰ä¸‹ã’;\n\n\tbreak_fixed\t\t= false;\n\tbreak_fixed_left= 0;\n\tbreak_fixed_top\t= 0;\n\tbura\t\t\t= false;\n\tlay(hArg: HArg) {\n\t\tif (hArg.kinsoku_sol) {\n\t\t\tthis.#sè¡Œé ­ç¦å‰‡ = hArg.kinsoku_sol;\n\t\t\tthis.#regè¡Œé ­ç¦å‰‡ = new RegExp(`[${this.#sè¡Œé ­ç¦å‰‡}]`);\n\t\t}\n\t\tif (hArg.kinsoku_eol) {\n\t\t\tthis.#sè¡Œæœ«ç¦å‰‡ = hArg.kinsoku_eol;\n\t\t\tthis.#chkç¦å‰‡ã®ç«¶åˆ_ã¶ã‚‰è¡Œæœ«();\n\t\t\tthis.#regè¡Œæœ«ç¦å‰‡ = new RegExp(`[${this.#sè¡Œæœ«ç¦å‰‡}]`);\n\t\t}\n\t\tif (hArg.kinsoku_dns) {\n\t\t\tthis.#såˆ†å‰²ç¦æ­¢ = hArg.kinsoku_dns;\n\t\t\tthis.#chkç¦å‰‡ã®ç«¶åˆ_ã¶ã‚‰åˆ†ç¦();\n\t\t\tthis.#regåˆ†å‰²ç¦æ­¢ = new RegExp(`[${this.#såˆ†å‰²ç¦æ­¢}]`);\n\t\t}\n\t\tif (hArg.kinsoku_bura) {\n\t\t\tthis.#sã¶ã‚‰ä¸‹ã’ = hArg.kinsoku_bura;\n\t\t\tthis.#chkç¦å‰‡ã®ç«¶åˆ_ã¶ã‚‰è¡Œæœ«();\n\t\t\tthis.#chkç¦å‰‡ã®ç«¶åˆ_ã¶ã‚‰åˆ†ç¦();\n\t\t\tthis.#regã¶ã‚‰ä¸‹ã’ = new RegExp(`[${this.#sã¶ã‚‰ä¸‹ã’}]`);\n\t\t}\n\t\tif ('bura' in hArg) this.bura = argChk_Boolean(hArg, 'bura', false);\n\n\t\tthis.break_fixed\t\t= argChk_Boolean(hArg, 'break_fixed', this.break_fixed);\n\t\tthis.break_fixed_left\t= argChk_Num(hArg, 'break_fixed_left', this.break_fixed_left);\n\t\tthis.break_fixed_top\t= argChk_Num(hArg, 'break_fixed_top', this.break_fixed_top);\n\t}\n\t\t// ç¦å‰‡ã®ç«¶åˆï¼ˆã¶ã‚‰ä¸‹ã’ ã¨ è¡Œæœ«ç¦å‰‡ ã®ä¸¡æ–¹ã«å«ã¾ã‚Œã‚‹æ–‡å­—ãŒã‚ã£ã¦ã¯ãªã‚‰ãªã„ï¼‰\n\t\t#chkç¦å‰‡ã®ç«¶åˆ_ã¶ã‚‰è¡Œæœ«() {\n\t\t\t// å‡¦ç†é€Ÿåº¦æœ€é©åŒ–ã§ä¸»å¾“ã‚’å¤‰ãˆã‚‹ã€‚é•·ã„æ–¹ã‚’ãƒã‚¤ãƒ†ã‚£ãƒ–ã«ã‚„ã‚‰ã›ã‚‹\n\t\t\tconst lenè¡Œæœ«ç¦å‰‡ = this.#sè¡Œæœ«ç¦å‰‡.length;\n\t\t\tconst lenã¶ã‚‰ä¸‹ã’ = this.#sã¶ã‚‰ä¸‹ã’.length;\n\t\t\tif (lenè¡Œæœ«ç¦å‰‡ < lenã¶ã‚‰ä¸‹ã’) {\n\t\t\t\tfor (let i=0; i<lenè¡Œæœ«ç¦å‰‡; ++i) {\n\t\t\t\t\tconst c = this.#sè¡Œæœ«ç¦å‰‡[i];\n\t\t\t\t\tif (this.#sã¶ã‚‰ä¸‹ã’.includes(c!)) throw `ç¦å‰‡ã®ç«¶åˆãŒã‚ã‚Šã¾ã™ã€‚æ–‡å­— ${c} ãŒã¶ã‚‰ä¸‹ã’ ã¨ è¡Œæœ«ç¦å‰‡ ã®ä¸¡æ–¹ã«å«ã¾ã‚Œã¾ã™`;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\tfor (let i=0; i<lenã¶ã‚‰ä¸‹ã’; ++i) {\n\t\t\t\t\tconst c = this.#sã¶ã‚‰ä¸‹ã’[i];\n\t\t\t\t\tif (this.#sè¡Œæœ«ç¦å‰‡.includes(c!)) throw `ç¦å‰‡ã®ç«¶åˆãŒã‚ã‚Šã¾ã™ã€‚æ–‡å­— ${c} ãŒã¶ã‚‰ä¸‹ã’ ã¨ è¡Œæœ«ç¦å‰‡ ã®ä¸¡æ–¹ã«å«ã¾ã‚Œã¾ã™`;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t// ç¦å‰‡ã®ç«¶åˆï¼ˆã¶ã‚‰ä¸‹ã’ ã¨ åˆ†å‰²ç¦æ­¢ ã®ä¸¡æ–¹ã«å«ã¾ã‚Œã‚‹æ–‡å­—ãŒã‚ã£ã¦ã¯ãªã‚‰ãªã„ï¼‰\n\t\t#chkç¦å‰‡ã®ç«¶åˆ_ã¶ã‚‰åˆ†ç¦() {\n\t\t\t// å‡¦ç†é€Ÿåº¦æœ€é©åŒ–ã§ä¸»å¾“ã‚’å¤‰ãˆã‚‹ã€‚é•·ã„æ–¹ã‚’ãƒã‚¤ãƒ†ã‚£ãƒ–ã«ã‚„ã‚‰ã›ã‚‹\n\t\t\tconst lenåˆ†å‰²ç¦æ­¢ = this.#såˆ†å‰²ç¦æ­¢.length;\n\t\t\tconst lenã¶ã‚‰ä¸‹ã’ = this.#sã¶ã‚‰ä¸‹ã’.length;\n\t\t\tif (lenåˆ†å‰²ç¦æ­¢ < lenã¶ã‚‰ä¸‹ã’) {\n\t\t\t\tfor (let i=0; i<lenåˆ†å‰²ç¦æ­¢; ++i) {\n\t\t\t\t\tconst c = this.#såˆ†å‰²ç¦æ­¢[i];\n\t\t\t\t\tif (this.#sã¶ã‚‰ä¸‹ã’.includes(c!)) throw `ç¦å‰‡ã®ç«¶åˆãŒã‚ã‚Šã¾ã™ã€‚æ–‡å­— ${c} ãŒã¶ã‚‰ä¸‹ã’ ã¨ åˆ†å‰²ç¦æ­¢ ã®ä¸¡æ–¹ã«å«ã¾ã‚Œã¾ã™`;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\tfor (let i=0; i<lenã¶ã‚‰ä¸‹ã’; ++i) {\n\t\t\t\t\tconst c = this.#sã¶ã‚‰ä¸‹ã’[i];\n\t\t\t\t\tif (this.#såˆ†å‰²ç¦æ­¢.includes(c!)) throw `ç¦å‰‡ã®ç«¶åˆãŒã‚ã‚Šã¾ã™ã€‚æ–‡å­— ${c} ãŒã¶ã‚‰ä¸‹ã’ ã¨ åˆ†å‰²ç¦æ­¢ ã®ä¸¡æ–¹ã«å«ã¾ã‚Œã¾ã™`;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\treNew(to: Hyphenation) {\n\t\tto.#genKinsoku(this.#sè¡Œé ­ç¦å‰‡, this.#sè¡Œæœ«ç¦å‰‡, this.#såˆ†å‰²ç¦æ­¢, this.#sã¶ã‚‰ä¸‹ã’);\n\n\t\tto.break_fixed\t\t= this.break_fixed;\n\t\tto.break_fixed_left\t= this.break_fixed_left;\n\t\tto.break_fixed_top\t= this.break_fixed_top;\n\t\tto.bura\t\t\t\t= this.bura;\n\t}\n\t\t#genKinsoku(sè¡Œé ­ç¦å‰‡: string, sè¡Œæœ«ç¦å‰‡: string, såˆ†å‰²ç¦æ­¢: string, sã¶ã‚‰ä¸‹ã’: string) {\n\t\t\tif (this.#sè¡Œé ­ç¦å‰‡\t!== sè¡Œé ­ç¦å‰‡) {\n\t\t\t\tthis.#sè¡Œé ­ç¦å‰‡\t= sè¡Œé ­ç¦å‰‡;\n\t\t\t\tthis.#regè¡Œé ­ç¦å‰‡ = new RegExp(`[${sè¡Œé ­ç¦å‰‡}]`);\n\t\t\t}\n\t\t\tif (this.#sè¡Œæœ«ç¦å‰‡\t!== sè¡Œæœ«ç¦å‰‡) {\n\t\t\t\tthis.#sè¡Œæœ«ç¦å‰‡\t= sè¡Œæœ«ç¦å‰‡;\n\t\t\t\tthis.#regè¡Œæœ«ç¦å‰‡ = new RegExp(`[${sè¡Œæœ«ç¦å‰‡}]`);\n\t\t\t}\n\t\t\tif (this.#såˆ†å‰²ç¦æ­¢\t!== såˆ†å‰²ç¦æ­¢) {\n\t\t\t\tthis.#såˆ†å‰²ç¦æ­¢\t= såˆ†å‰²ç¦æ­¢;\n\t\t\t\tthis.#regåˆ†å‰²ç¦æ­¢ = new RegExp(`[${såˆ†å‰²ç¦æ­¢}]`);\n\t\t\t}\n\t\t\tif (this.#sã¶ã‚‰ä¸‹ã’\t!== sã¶ã‚‰ä¸‹ã’) {\n\t\t\t\tthis.#sã¶ã‚‰ä¸‹ã’\t= sã¶ã‚‰ä¸‹ã’;\n\t\t\t\tthis.#regã¶ã‚‰ä¸‹ã’ = new RegExp(`[${sã¶ã‚‰ä¸‹ã’}]`);\n\t\t\t}\n\t\t}\n\trecord() {\n\t\tconst o: T_RP_Hyphenation = {\n\t\t\tbreak_fixed\t\t\t: this.break_fixed,\n\t\t\tbreak_fixed_left\t: this.break_fixed_left,\n\t\t\tbreak_fixed_top\t\t: this.break_fixed_top,\n\t\t\tbura\t\t\t\t: this.bura,\n\t\t};\n\t\tif (this.#sè¡Œé ­ç¦å‰‡ === defè¡Œé ­ç¦å‰‡) o.è¡Œé ­ç¦å‰‡ = this.#sè¡Œé ­ç¦å‰‡;\n\t\tif (this.#sè¡Œæœ«ç¦å‰‡ === defè¡Œæœ«ç¦å‰‡) o.è¡Œæœ«ç¦å‰‡ = this.#sè¡Œæœ«ç¦å‰‡;\n\t\tif (this.#såˆ†å‰²ç¦æ­¢ === defåˆ†å‰²ç¦æ­¢) o.åˆ†å‰²ç¦æ­¢ = this.#såˆ†å‰²ç¦æ­¢;\n\t\tif (this.#sã¶ã‚‰ä¸‹ã’ === defã¶ã‚‰ä¸‹ã’) o.ã¶ã‚‰ä¸‹ã’ = this.#sã¶ã‚‰ä¸‹ã’;\n\t\t\t// ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã¨åŒã˜ãªã‚‰JSONã§çœç•¥\n\t\treturn o;\n\t}\n\tplayback(hLay?: T_RP_Hyphenation) {\n\t\tif (! hLay) return;\t\t// é€”ä¸­è¿½åŠ ãªã®ã§\n\n\t\tthis.#genKinsoku(\n\t\t\thLay.è¡Œé ­ç¦å‰‡ ?? defè¡Œé ­ç¦å‰‡,\n\t\t\thLay.è¡Œæœ«ç¦å‰‡ ?? defè¡Œæœ«ç¦å‰‡,\n\t\t\thLay.åˆ†å‰²ç¦æ­¢ ?? defåˆ†å‰²ç¦æ­¢,\n\t\t\thLay.ã¶ã‚‰ä¸‹ã’ ?? defã¶ã‚‰ä¸‹ã’,\n\t\t);\n\n\t\tthis.break_fixed\t\t= hLay.break_fixed;\n\t\tthis.break_fixed_left\t= hLay.break_fixed_left;\n\t\tthis.break_fixed_top\t= hLay.break_fixed_top;\n\t\tthis.bura\t\t\t\t= hLay.bura;\n\t}\n\n\thyph(htmTxt: HTMLSpanElement, cnvRect :(rng: Range, ch: string)=> Rectangle, tategaki: boolean, begin: number, bkHtm: string): [IChRect[], number] {\n\t\tlet a: IChRect[];\n\t\tlet len = 0;\n\t\tlet i = 2;\t\t// æœ¬æ¥ 1 ã ãŒã²ã¨æ–‡å­—ç›®ã®è¡Œé ­ç¦å‰‡æ–‡å­—ã‚’ç„¡è¦–ã—ãŸã„ã®ã§\n\t\tlet fncFirstChk = (len: number)=> {\n\t\t\tfncFirstChk = ()=> false;\n\n\t\t\tif (begin === len) {\t// å³ã‚¯ãƒªãƒƒã‚¯æˆ»ã‚Šãªã©ã§æ–‡å­—è¡¨ç¤ºãŒå´©ã‚Œã‚‹ä»¶ã®å¯¾å¿œ\n\t\t\t\tif (begin > 0) htmTxt.innerHTML = bkHtm.replaceAll('class=\"sn_ch\"', 'class=\"sn_ch sn_ch_in_default\"');\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\treturn len < 2;\n\t\t};\n//console.log(`ğŸ´ç¦å‰‡å‡¦ç†åˆ¤å®šãƒ«ãƒ¼ãƒ— begin:${begin}`);\n\t\tdo {\n\t\t\ta = this.#getChRects(htmTxt, cnvRect);\n\t\t\tlen = a.length;\n\t\t\tif (fncFirstChk(len)) break;\n\n\t\t\t// ç¦å‰‡å‡¦ç†åˆ¤å®šãƒ«ãƒ¼ãƒ—\n\t\t\tlet sl_xy = -Infinity;\t// å‰å›ã®xy\n//console.log(`- len:${len} a_ch:${a.map((v, i)=> v.elm.tagName === 'RT' ?[] :[i, v.ch])}:`);\n\t\t\tfor (; i<len; ++i) {\n\t\t\t\tconst {elm, rect, ch} = a[i]!;\n\t\t\t\tif (elm.tagName === 'RT') continue;\t// ãƒ«ãƒ“ã¯ã‚¹ã‚­ãƒƒãƒ—\n\n\t\t\t\tconst xy = tategaki ?rect.y :rect.x;\n//if (sl_xy > 790)\n//console.log(`ğŸ´ sl_xy:${sl_xy.toFixed(2)} xy:${xy.toFixed(2)} i:${i} ch:${ch}: rect:(${rect.left.toFixed(2)}, ${rect.top.toFixed(2)}, ${rect.width.toFixed(2)}, ${rect.height.toFixed(2)})`);\n\t\t\t\tif (sl_xy <= xy\t// ã€ < ã€‘ã§ã¯[tcy]äºŒæ–‡å­—ç›®ã‚’èª¤åˆ¤å®šã™ã‚‹\n\t\t\t\t// [r]ã«ã‚ˆã‚‹æ”¹è¡Œå¾Œã¯è¿½ã„å‡ºã—å‡¦ç†ã‚’ã—ãªã„ã‚ˆã†ã«\n\t\t\t\t|| elm.previousElementSibling?.tagName === 'SPAN'\n\t\t\t\t// eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n\t\t\t\t&&\telm.previousElementSibling?.innerHTML.includes('<br>')\n\t\t\t\t// <span class=\"offrec\"> ã€œ </span> å¤–ã—\n\t\t\t\t|| elm.parentElement?.previousElementSibling?.tagName === 'SPAN'\n\t\t\t\t// eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n\t\t\t\t&&\telm.parentElement?.previousElementSibling?.innerHTML.includes('<br>')) {\n\t\t\t\t\tsl_xy = xy;\n\t\t\t\t\tif (! this.break_fixed) {\n\t\t\t\t\t\tthis.break_fixed_left = rect.x;\n\t\t\t\t\t\tthis.break_fixed_top = rect.y;\n\t\t\t\t\t}\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n/*\n\t// [r]ãªã©ã®æ”¹è¡Œã¯ã“ã†ã€‚TxtLayer.#tagCh_sub()ã«ã‚ˆã‚Š <span> ã«å…¥ã‚Œã‚‰ã‚Œã‚‹\n\t<span class=â€‹\"sn_ch\" style=â€‹\"display:â€‹ inline;â€‹animation-delay:â€‹ 10ms;â€‹\">\n\t\t<br>\n\tâ€‹</span>\n\n\t// ä¸Šè¨˜ãŒä¸‹è¨˜ã«å›²ã¾ã‚Œã¦ã„ã‚‹å ´åˆã‚‚ã‚ã‚‹ã€‚previousElementSibling ä½¿ç”¨æ™‚ã¯æ³¨æ„\n\t<span class=\"offrec\"> ã€œ </span>\n\n\n\t// ç¦å‰‡å‡¦ç†ã«ã‚ˆã‚‹è‡ªå‹•æ”¹è¡Œã¯ã“ã†\n\t<br>\n*/\n\n\t\t\t\tconst p_i = this.#i2pi(a, i);\n\t\t\t\tconst {elm: p_elm, rect: p_rect, ch: p_ch} = a[p_i]!;\n//console.log(`ğŸ´ === è‡ªå‹•æ”¹è¡Œç™ºç”Ÿï¼ å‰æ–‡å­—:${p_i}:${p_ch}:%o ä»Šæ–‡å­—:${i}:${ch}:(${ch.charCodeAt(0).toString(16)})%o`, a[p_i].elm, a[i].elm);\n\t\t\t\tif (! this.break_fixed) {\n\t\t\t\t\tthis.break_fixed_left = p_rect.x;\n\t\t\t\t\tthis.break_fixed_top = p_rect.y;\n\t\t\t\t\tconst sty = globalThis.getComputedStyle(p_elm);\n\t\t\t\t\tconst rs = parseFloat(sty.fontSize);\n\t\t\t\t\tif (tategaki)\tthis.break_fixed_top += rs;\n\t\t\t\t\telse\t\t\tthis.break_fixed_left += rs;\n\t\t\t\t}\n\n\t\t\t\tsl_xy = -Infinity;\t// è‡ªå‹•æ”¹è¡Œç™ºç”Ÿï¼\n\t\t\t\tconst oldI = i;\n\t\t\t\tconst {cont, ins} = this.bura\n\t\t\t\t\t? this.hyph_alg_bura(a, p_i, p_ch, i)\n\t\t\t\t\t: this.hyph_alg(a, p_i, p_ch, i, ch);\n\t\t\t\ti = ins;\n//console.log(`ğŸ´ === cont:${cont} ins:${i} :${a[i].ch}:%o ã®å‰ã«æ”¹è¡Œã‚’æŒ¿å…¥`, a[i].elm);\n\t\t\t\tif (cont) continue;\n\n\t\t\t\t// æ”¹è¡ŒæŒ¿å…¥\n\t\t\t\tconst elm2 = a[i]!.elm;\n\t\t\t\tconst pal = elm2.parentElement!;\n\t\t\t\tconst br = document.createElement('br');\n\t\t\t\tif (pal.classList.contains('sn_tx')) pal.insertBefore(br, elm2); else {\n\t\t\t\t\tconst ppal = pal.parentElement!;\n\t\t\t\t\tif (ppal.classList.contains('sn_ch')) {\n\t\t\t\t\t\tppal.parentElement!.insertBefore(br, ppal);\n\t\t\t\t\t}\n\t\t\t\t\telse ppal.insertBefore(br, pal);\n\t\t\t\t}\n\n\t\t\t\ti += 2;\t// ã„ã¾è¿½åŠ ã—ãŸ<br>ã®ã¶ã‚“ã¨ã€æ¬¡ã¸è¡Œã +1\n\t\t\t\tif (i < oldI) i = oldI;\t// æ°¸ä¹…ãƒ«ãƒ¼ãƒ—é˜²å¾¡\n\t\t\t\tlen = -1;\t// doãƒ«ãƒ¼ãƒ—å…ˆé ­ã«æˆ»ã‚‹\n\t\t\t\tbreak;\n\t\t\t}\n\t\t} while (len < 0);\n\n\t\treturn [a, len];\n\t}\n\t\t// ä¸€ã¤å‰ã®è¦ç´ ã‚’æ¢ã™ï¼ˆãƒ«ãƒ“å¯¾å¿œï¼‰\n\t\t#i2pi(a: IChRect[], i: number): number {\n\t\t\tconst p_i = i -1;\n\t\t\tconst {elm} = a[p_i]!;\n\t\t\tif (elm.tagName !== 'RT') return p_i -(\n\t\t\t\telm.style.textCombineUpright === 'all'\n\t\t\t\t? Array.from(elm.textContent).length -1\n\t\t\t\t: 0\n\t\t\t);\n\n\t\t\treturn p_i -Array.from(elm.textContent).length;\n\t\t\t\t// ã‚µãƒ­ã‚²ãƒ¼ãƒˆãƒšã‚¢å¯¾ç­–\n\t\t}\n\n\t#getChRects(elm: Node, cnvRect :(range: Range, ch: string)=> Rectangle): IChRect[] {\t// æ³¨æ„ï¼‰å†å¸°é–¢æ•°\n\t\tconst ret: IChRect[] = [];\n\t\tif (elm.nodeType !== elm.TEXT_NODE) return Array.from(elm.childNodes).map(v=> this.#getChRects(v, cnvRect)).flat();\n\n\t\tconst rng = elm.ownerDocument!.createRange();\n\t\trng.selectNodeContents(elm);\n\t\tlet pos = 0;\n\t\tconst end = rng.endOffset;\n\t\t// ã§ãã‚Œã°ä¸€æ–‡å­—ãšã¤ã€Œafter-edge - baselineã€ã‚’èª¿ã¹ãŸã„ãŒã€æš«å®šæ‰‹æ®µã‚’å–ã‚‹\n\t\t//const styles = globalThis.getComputedStyle(this.htmTxt);\n\t\t//console.log('lh:'+ styles.lineHeight +' fs:'+ styles.fontSize);\n\t\twhile (pos < end) {\n\t\t\trng.setStart(elm, pos);\n\t\t\trng.setEnd(elm, ++pos);\n\t\t\tconst ch = rng.toString();\n\t\t\tret.push({\n\t\t\t\tch,\n\t\t\t\trect: cnvRect(rng, ch),\n\t\t\t\telm\t: rng.startContainer.parentElement!,\n\t\t\t});\n\t\t}\n\t\trng.detach();\n\n\t\treturn ret;\n\t}\n\n\t/**\n\t * æŠ½è±¡åŒ–ã—ãŸç¦å‰‡å‡¦ç†ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ \n\t * @method hyph_alg\n\t * @param {IChRect[]} a - æ–‡ç« ã®æŠ½è±¡åŒ–é…åˆ—\n\t * @param {number} p_i - å‡¦ç†è¦ç´ ã®ä¸€ã¤å‰ã®æ·»å­—\n\t * @param {string} p_ch - å‡¦ç†è¦ç´ ã®ä¸€ã¤å‰ã®æ–‡å­—\n\t * @param {number} i - å‡¦ç†è¦ç´ ã®æ·»å­—\n\t * @param {string} ch - å‡¦ç†è¦ç´ ã®æ–‡å­—\n\t * @return {Object} result æˆ»ã‚Šå€¤\n\t * @return {boolean} result.cont - true: å‘¼ã³å…ƒã§æ”¹è¡ŒæŒ¿å…¥ã›ãš continue\n\t * @return {number} result.ins - æ‰‹å‰ã«æ”¹è¡Œã‚’æŒ¿å…¥ã™ã¹ãè¦ç´ ã®æ·»å­—\n\t */\n\thyph_alg(\t// ãƒ†ã‚¹ãƒˆç”¨ã«public\n\t\ta\t: IChRect[],\n\t\tp_i\t: number,\n\t\tp_ch: string,\n\t\tii\t: number,\t// i >= 2\n\t\tch\t: string,\n\t): {cont: boolean, ins: number} {\n\t\t// è¿½ã„å‡ºã—èµ°æŸ»\n\t\tlet i = ii;\n\t\tif (this.#regè¡Œæœ«ç¦å‰‡.test(p_ch)) { /* empty */ }\t// ä¸€ã¤å‰\n\t\telse if (this.#regè¡Œé ­ç¦å‰‡.test(ch)) {\t//ï¼ˆç¾åœ¨åœ° -> å‰æ–¹èµ°æŸ»ï¼‰\n\t\t\twhile ((i = this.#i2pi(a, i)) >= 0) {\n\t\t\t\tif (! this.#regè¡Œé ­ç¦å‰‡.test(a[i]!.ch)) break;// è¡Œé ­ç¦å‰‡ã¯ã‚¹ã‚­ãƒƒãƒ—\n\t\t\t}\n\t\t}\n\t\telse if (p_ch === ch && this.#regåˆ†å‰²ç¦æ­¢.test(p_ch)) { /* empty */ }// ä¸€ã¤å‰ï¼†ç¾åœ¨åœ°\n\t\telse return {cont: true, ins: i +1};\t// è¿½ã„å‡ºã—ãªã—\n\n\t\t// è¿½ã„å‡ºã—ã«ã‚ˆã‚‹æ–°è¡Œæœ«äºŒæ¬¡åˆ¤å®šï¼ˆä¸€ã¤å‰ -> å‰æ–¹èµ°æŸ»ï¼‰\n\t\ti = p_i;\n\t\twhile ((i = this.#i2pi(a, i)) >= 0) {\n\t\t\tif (! this.#regè¡Œæœ«ç¦å‰‡.test(a[i]!.ch)) break;\t// è¡Œæœ«ç¦å‰‡ã¯ã‚¹ã‚­ãƒƒãƒ—\n\t\t}\n\t\treturn {cont: false, ins: i +1};\n\t}\n\n\t/**\n\t * æŠ½è±¡åŒ–ã—ãŸç¦å‰‡å‡¦ç†ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ \n\t * @method hyph_alg\n\t * @param {IChRect[]} a - æ–‡ç« ã®æŠ½è±¡åŒ–é…åˆ—\n\t * @param {number} p_i - å‡¦ç†è¦ç´ ã®ä¸€ã¤å‰ã®æ·»å­—\n\t * @param {string} p_ch - å‡¦ç†è¦ç´ ã®ä¸€ã¤å‰ã®æ–‡å­—\n\t * @param {number} i - å‡¦ç†è¦ç´ ã®æ·»å­—\n\t * @return {Object} result æˆ»ã‚Šå€¤\n\t * @return {boolean} result.cont - true: å‘¼ã³å…ƒã§æ”¹è¡ŒæŒ¿å…¥ã›ãš continue\n\t * @return {number} result.ins - æ‰‹å‰ã«æ”¹è¡Œã‚’æŒ¿å…¥ã™ã¹ãè¦ç´ ã®æ·»å­—\n\t */\n\thyph_alg_bura(\t// ãƒ†ã‚¹ãƒˆç”¨ã«public\n\t\ta\t: IChRect[],\n\t\tp_i\t: number,\n\t\tp_ch: string,\n\t\ti\t: number,\t// i >= 2\n\t): {cont: boolean, ins: number} {\n\t\tconst pp_i = this.#i2pi(a, p_i);\t// æ”¹è¡Œå¾Œã®ãƒ«ãƒ“ã§è¿½ã„å‡ºã—ç™ºç”Ÿ\n\t\tconst {ch: pp_ch} = a[pp_i]!;\n//console.log(`ğŸ´ hyph_alg_bura pp:${pp_i}:${pp_ch}: p:${p_i}:${p_ch}: i:${i}:${a[i].ch}:`);\n\t\t// æ”¹è¡Œå‰äºŒå€‹ç›®ã«ã€Œã¶ã‚‰ä¸‹ã’ã€ãŒã‚ã‚‹\n\t\tif (this.#regã¶ã‚‰ä¸‹ã’.test(pp_ch) || this.#regè¡Œé ­ç¦å‰‡.test(pp_ch)) {\n\t\t\tlet j = p_i;\n\t\t\t// æ”¹è¡Œå‰ã«ã‚‚ã€Œã¶ã‚‰ä¸‹ã’ã€ãŒã‚ã‚‹\n\t\t\tif (this.#regã¶ã‚‰ä¸‹ã’.test(p_ch) || this.#regè¡Œé ­ç¦å‰‡.test(p_ch)) ++j;\n\n\t\t\t// ã¶ã‚‰ä¸‹ã’å¾Œâ€¦â€¦è¿½ã„å‡ºã—èµ°æŸ»\n\t\t\tconst p_j = this.#i2pi(a, j);\t// pp_i ã§ã¯ãªã„\n\t\t\tconst {ch: last_ch} = a[p_j]!;\t// è¡Œæœ«\n\t\t\tconst {ch: head_ch} = a[j]!;\t\t// è¡Œé ­\n\t\t\t// åˆ†å‰²ç¦æ­¢\n\t\t\tif (last_ch === head_ch && this.#regåˆ†å‰²ç¦æ­¢.test(head_ch)) return {cont: false, ins: p_j};\n\n\t\t\tif (! this.#regè¡Œæœ«ç¦å‰‡.test(last_ch)) return {cont: false, ins: j};\n\t\t\t// è¡Œæœ«ç¦å‰‡\n\t\t\tj = p_j;\n\t\t\tdo {\n\t\t\t\tif (! this.#regè¡Œæœ«ç¦å‰‡.test(a[j]!.ch)) break;\t// è¡Œç¦ã¯ã‚¹ã‚­ãƒƒãƒ—\n\t\t\t} while ((j = this.#i2pi(a, j)) >= 0);\n\t\t\treturn {cont: false, ins: j +1};\t// è¡Œæœ«ç¦å‰‡\n\t\t}\n\n\t\t// æ”¹è¡Œå‰äºŒå€‹ç›®ã«ã€Œã¶ã‚‰ä¸‹ã’ã€ãŒãªã„\n\t\tconst ppp_i = this.#i2pi(a, pp_i);\n\t\tif (i >= 3) {\n\t\t\tconst {ch: ppp_ch} = a[ppp_i]!;\n//console.log(`-- æ”¹è¡Œå‰äºŒå€‹ç›®ã«ã€Œã¶ã‚‰ä¸‹ã’ã€ãŒãªã„ ppp:${ppp_i}:${ppp_ch}: pp:${pp_i}:${pp_ch}: i:${i}`);\n\t\t\t// æ”¹è¡Œå‰äºŒå€‹ç›®ã«ã€Œåˆ†å‰²ç¦æ­¢ã€\n\t\t\tif (this.#regåˆ†å‰²ç¦æ­¢.test(pp_ch)) {\t// åˆ†å‰²ç¦æ­¢\n//console.log(`   == æ”¹è¡Œå‰äºŒå€‹ç›®ã«ã€Œåˆ†å‰²ç¦æ­¢ã€:${ppp_ch === pp_ch}`);\n\t\t\t\tif (ppp_ch === pp_ch) return {cont: false, ins: ppp_i};\n\t\t\t}\n\t\t\t// æ”¹è¡Œå‰ä¸‰å€‹ç›®ã«ã€Œè¡Œæœ«ç¦å‰‡ã€\n\t\t\tif (this.#regè¡Œæœ«ç¦å‰‡.test(ppp_ch)) {\t// è¡Œæœ«ç¦å‰‡\n\t\t\t\tlet j = ppp_i;\n//console.log(`   == æ”¹è¡Œå‰ä¸‰å€‹ç›®ã«ã€Œè¡Œæœ«ç¦å‰‡ã€ j:${j}:${a[j].ch}:`);\n\t\t\t\twhile ((j = this.#i2pi(a, j)) >= 0) {\n//console.log(`      -- ch:${a[j].ch}`);\n\t\t\t\t\tif (! this.#regè¡Œæœ«ç¦å‰‡.test(a[j]!.ch)) break;// è¡Œç¦ã¯ã‚¹ã‚­ãƒƒãƒ—\n\t\t\t\t}\n//console.log(`   === j:${j +1}:${a[j +1].ch}: tn:${a[j +1].elm.parentElement?.tagName}`);\n\t\t\t\treturn {cont: false, ins: j +1};\t// è¡Œæœ«ç¦å‰‡\n\t\t\t}\n\t\t}\n\n\t\treturn {cont: false, ins: pp_i};\n\t}\n\n}\n","/* eslint-disable @typescript-eslint/no-unsafe-argument */\n/* eslint-disable @typescript-eslint/no-non-null-assertion */\n/* eslint-disable @typescript-eslint/prefer-nullish-coalescing */\n/* eslint-disable @typescript-eslint/restrict-plus-operands */\n/* eslint-disable @typescript-eslint/no-unsafe-member-access */\n/* eslint-disable @typescript-eslint/no-unsafe-call */\n/* eslint-disable @typescript-eslint/no-explicit-any */\n/* eslint-disable @typescript-eslint/no-unsafe-return */\n/* eslint-disable @typescript-eslint/restrict-template-expressions */\n/* ***** BEGIN LICENSE BLOCK *****\n\tCopyright (c) 2025-2025 Famibee (famibee.blog38.fc2.com)\n\n\tThis software is released under the MIT License.\n\thttp://opensource.org/licenses/mit-license.php\n** ***** END LICENSE BLOCK ***** */\n\nimport type {T_InfTxLay} from './TxtStage';\nimport {DebugMng} from './DebugMng';\n\nimport {Texture} from 'pixi.js';\n\n\nexport function htm2tx(fnc: (tx2: any)=> void, htmTxt: HTMLSpanElement, infTL :T_InfTxLay, padTx4x: number, padTx4y: number, hidden = true) {\n\t\t// tsayen/dom-to-image: Generates an image from a DOM node using HTML5 canvas https://github.com/tsayen/dom-to-image\n\n/*---*/\n\t\tconst util = {\n\t\t\tescape: (str: string)=> str.replaceAll(/([.*+?^${}()|[\\]/\\\\])/g, '\\\\$1'),\n\t\t\tmimeType: (url: any)=> {\n\t\t\t\tconst extension = parseExtension(url).toLowerCase();\n\t\t\t\treturn mimes()[extension] || '';\n\t\t\t},\n\t\t\tdataAsUrl,\n\t\t\tisDataUrl,\n\t\t\tresolveUrl,\n\t\t\tgetAndEncode,\n\t\t\tasArray: (arrayLike: StyleSheetList)=> {\n\t\t\t\tconst a: StyleSheet[] = [];\n\t\t\t\tconst len = arrayLike.length;\n\t\t\t\tfor (let i=0; i<len; ++i) a.push(arrayLike[i]!);\n\t\t\t\treturn a;\n\t\t\t},\n\t\t};\n\t\t\tfunction mimes(): any {\n\t\t\t\t// Only WOFF and EOT mime types for fonts are 'real'\n\t\t\t\t// * see http://www.iana.org/assignments/media-types/media-types.xhtml\n\t\t\t\tconst WOFF = 'application/font-woff';\n\t\t\t\tconst JPEG = 'image/jpeg';\n\n\t\t\t\treturn {\n\t\t\t\t\t'woff': WOFF,\n\t\t\t\t\t'woff2': WOFF,\n\t\t\t\t\t'ttf': 'application/font-truetype',\n\t\t\t\t\t'eot': 'application/vnd.ms-fontobject',\n\t\t\t\t\t'png': 'image/png',\n\t\t\t\t\t'jpg': JPEG,\n\t\t\t\t\t'jpeg': JPEG,\n\t\t\t\t\t'gif': 'image/gif',\n\t\t\t\t\t'tiff': 'image/tiff',\n\t\t\t\t\t'svg': 'image/svg+xml'\n\t\t\t\t};\n\t\t\t}\n\n\n\t\tconst inliner = newInliner();\n\n\n\t\tconst fontFaces = newFontFaces();\n\n\n\t\tfunction embedFonts(node: any) {\n\t\t\treturn fontFaces.resolveAll()\n\t\t\t.then(cssText=> {\n\t\t\t\tconst styleNode = document.createElement('style');\n\t\t\t\tnode.appendChild(styleNode);\n\t\t\t\tstyleNode.appendChild(document.createTextNode(cssText));\n\t\t\t//console.log('cssText:%s:', cssText);\t//------------\n\t\t\t\treturn node;\n\t\t\t});\n\t\t}\n\n\n\t\t\tfunction parseExtension(url: any) {\n\t\t\t\tconst match = /\\.([^./]*?)$/g.exec(url);\n\t\t\t\treturn match?.[1] ?? '';\n\t\t\t}\n\n\t\t\tfunction isDataUrl(url: any) {\n\t\t\t\treturn url.search(/^(data:)/) !== -1;\n\t\t\t}\n\n\t\t\tfunction resolveUrl(url: any, baseUrl: any) {\n\t\t\t\tconst doc = document.implementation.createHTMLDocument();\n\t\t\t\tconst base = doc.createElement('base');\n\t\t\t\tdoc.head.appendChild(base);\n\t\t\t\tconst a = doc.createElement('a');\n\t\t\t\tdoc.body.appendChild(a);\n\t\t\t\t// eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n\t\t\t\tbase.href = baseUrl;\n\t\t\t\t// eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n\t\t\t\ta.href = url;\n\t\t\t\treturn a.href;\n\t\t\t}\n\n\t\t\tfunction getAndEncode(url: any) {\n\t\t\t\tconst TIMEOUT = 30000;\n\t\t\t\t//if(domtoimage.impl.options.cacheBust) {\n\t\t\t\t\t// Cache bypass so we dont have CORS issues with cached images\n\t\t\t\t\t// Source: https://developer.mozilla.org/en/docs/Web/API/XMLHttpRequest/Using_XMLHttpRequest#Bypassing_the_cache\n\t\t\t\t//\turl += ((/\\?/).test(url) ? \"&\" : \"?\") + (new Date).getTime();\n\t\t\t\t//}\n\n\t\t\t\treturn new Promise(function(resolve) {\n\t\t\t\t\tconst request = new XMLHttpRequest;\n\n\t\t\t\t\trequest.onreadystatechange = done;\n\t\t\t\t\trequest.ontimeout = timeout;\n\t\t\t\t\trequest.responseType = 'blob';\n\t\t\t\t\trequest.timeout = TIMEOUT;\n\t\t\t\t\trequest.open('GET', url, true);\n\t\t\t\t\trequest.send();\n\n\t\t\t\t\t//let placeholder;\n\t\t\t\t\t//if(domtoimage.impl.options.imagePlaceholder) {\n\t\t\t\t\t//\tlet split = domtoimage.impl.options.imagePlaceholder.split(/,/);\n\t\t\t\t\t//\tif(split && split[1]) {\n\t\t\t\t\t//\t\tplaceholder = split[1];\n\t\t\t\t\t//\t}\n\t\t\t\t\t//}\n\n\t\t\t\t\tfunction done() {\n\t\t\t\t\t\tif (request.readyState !== 4) return;\n\n\t\t\t\t\t\tif (request.status !== 200) {\n\t\t\t\t\t\t//\tif(placeholder) {\n\t\t\t\t\t\t//\t\tresolve(placeholder);\n\t\t\t\t\t\t//\t} else {\n\t\t\t\t\t\t\t\tfail('cannot fetch resource: ' + url + ', status: ' + request.status);\n\t\t\t\t\t\t//\t}\n\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst encoder = new FileReader;\n\t\t\t\t\t\tencoder.onloadend = function() {\n\t\t\t\t\t\t\t// eslint-disable-next-line @typescript-eslint/no-base-to-string\n\t\t\t\t\t\t\tconst content = encoder.result!.toString().split(/,/)[1];\n\t\t\t\t\t\t\tresolve(content);\n\t\t\t\t\t\t};\n\t\t\t\t\t\tencoder.readAsDataURL(request.response);\n\t\t\t\t\t}\n\n\t\t\t\t\tfunction timeout() {\n\t\t\t\t\t//\tif(placeholder) {\n\t\t\t\t\t//\t\tresolve(placeholder);\n\t\t\t\t\t//\t} else {\n\t\t\t\t\t\t\tfail('timeout of ' + TIMEOUT + 'ms occured while fetching resource: ' + url);\n\t\t\t\t\t//\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tfunction fail(message: any) {\n\t\t\t\t\t\tconsole.error(message);\n\t\t\t\t\t\tresolve('');\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction dataAsUrl(content: any, type: any) {\n\t\t\t\treturn 'data:' + type + ';base64,' + content;\n\t\t\t}\n\n\n\t\tfunction newInliner() {\n\t\t\tconst URL_REGEX = /url\\(['\"]?([^'\"]+?)['\"]?\\)/g;\n\n\t\t\treturn {\n\t\t\t\tinlineAll,\n\t\t\t\tshouldProcess,\n\t\t\t};\n\n\t\t\tfunction shouldProcess(str: any) {\n\t\t\t\treturn str.search(URL_REGEX) !== -1;\n\t\t\t}\n\n\t\t\tfunction readUrls(str: any) {\n\t\t\t\tconst result: string[] = [];\n\t\t\t\tlet match: RegExpExecArray | null;\n\t\t\t\t// eslint-disable-next-line no-cond-assign\n\t\t\t\twhile (match = URL_REGEX.exec(str)) {\n\t\t\t\t\tresult.push(match[1]!);\n\t\t\t\t}\n\t\t\t\treturn result.filter(function(url) {\n\t\t\t\t\treturn ! util.isDataUrl(url);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction inline(str: any, url: any, baseUrl: any, get: any) {\n\t\t\t\treturn Promise.resolve(url)\n\t\t\t\t\t.then(url=> baseUrl ? util.resolveUrl(url, baseUrl) : url)\n\t\t\t\t\t.then(get || util.getAndEncode)\n\t\t\t\t\t.then(data=> util.dataAsUrl(data, util.mimeType(url)))\n\t\t\t\t\t.then(dataUrl=> str.replace(urlAsRegex(url), '$1' + dataUrl + '$3'));\n\n\t\t\t\tfunction urlAsRegex(url: any) {\n\t\t\t\t\treturn new RegExp('(url\\\\([\\'\"]?)(' + util.escape(url) + ')([\\'\"]?\\\\))', 'g');\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction inlineAll(str: any, baseUrl: any, get?: any) {\n\t\t\t\tif (nothingToInline()) return Promise.resolve(str);\n\n\t\t\t\treturn Promise.resolve(str)\n\t\t\t\t\t.then(readUrls)\n\t\t\t\t\t.then(urls=> {\n\t\t\t\t\t\tlet done = Promise.resolve(str);\n\t\t\t\t\t\tfor (const url of urls) done = done.then(string=> inline(string, url, baseUrl, get));\n\t\t\t\t\t\treturn done;\n\t\t\t\t\t});\n\n\t\t\t\tfunction nothingToInline() {\n\t\t\t\t\treturn ! shouldProcess(str);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfunction newFontFaces() {\n\t\t\treturn {\n\t\t\t\tresolveAll,\n\t\t\t\timpl: {readAll}\n\t\t\t};\n\n\t\t\tfunction resolveAll() {\n\t\t\t\treturn readAll()\n\t\t\t\t.then(webFonts=> Promise.allSettled(\n\t\t\t\t\twebFonts.map((webFont: any)=> webFont.resolve())\n\t\t\t\t))\n\t\t\t\t// eslint-disable-next-line @typescript-eslint/no-base-to-string\n\t\t\t\t.then(cssStrings=> cssStrings.join('\\n'));\n\t\t\t}\n\n\t\t\tfunction readAll() {\n\t\t\t\treturn Promise.resolve(util.asArray(document.styleSheets))\n\t\t\t\t\t.then(getCssRules)\n\t\t\t\t\t.then(selectWebFontRules)\n\t\t\t\t\t.then(rules=> rules.map(newWebFont));\n\t\t\t\t\t\t// console.log('map:%o:', rules) ||\n\n\t\t\t\tfunction selectWebFontRules(cssRules: any) {\n\t\t\t\t\treturn cssRules\n\t\t\t\t\t.filter((rule: any)=> rule.type === CSSRule.FONT_FACE_RULE)\n\t\t\t\t\t.filter((rule: any)=> inliner.shouldProcess(rule.style.getPropertyValue('src')));\n\t\t\t\t}\n\n\t\t\t\tfunction getCssRules(styleSheets: any) {\n\t\t\t\t\tconst cssRules: any = [];\n\t\t\t\t\tfor (const sheet of styleSheets) {\n\t\t\t\t\t//console.log('1:%o', sheet);\t//-------\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tif (sheet.href) continue;\n\t\t\t\t\t\t//console.log(sheet.cssRules);\n\t\t\t\t\t\t\tutil.asArray(sheet.cssRules || []).forEach(cssRules.push.bind(cssRules));\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcatch (e) {\n\t\t\t\t\t\t\tconsole.error('Error while reading CSS rules from ' + sheet.href, String(e));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn cssRules;\n\t\t\t\t}\n\n\t\t\t\tfunction newWebFont(webFontRule: any) {\n\t\t\t\t\t//console.log('newWebFont:%o:', webFontRule);\t//-------\n\t\t\t\t\treturn {\n\t\t\t\t\t\tresolve: function resolve() {\n\t\t\t\t\t\t\t// eslint-disable-next-line @typescript-eslint/no-unsafe-assignment, @typescript-eslint/prefer-optional-chain\n\t\t\t\t\t\t\tconst baseUrl = (webFontRule.parentStyleSheet || {}).href;\n\t\t\t\t\t\t\treturn inliner.inlineAll(webFontRule.cssText, baseUrl);\n\t\t\t\t\t\t},\n\t\t\t\t\t\tsrc() {\n\t\t\t\t\t\t\treturn webFontRule.style.getPropertyValue('src');\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n/*\n\t\tfetch('http://localhost:8080/prj/mat/my_himajihoso.woff2')\n\t\t.then(response=> {\n\t\t\tif (response.ok) return response.blob();\n\t\t\tthrow new Error('Network response was not ok.');\n\t\t})\n\t\t.then(blob=> new Promise((resolve, reject)=> {\n\t\t\tconst reader = new FileReader;\n\t\t\treader.onloadend = ()=> resolve(reader.result);\n\t\t\treader.onerror = reject;\n\t\t\treader.readAsDataURL(blob);\n\t\t}))\n\t\t.then(dataUrl => {\n\t\t\t// data:application/font-woff2;base64,d09GMk9U\n\t\t\tconst css =\n\t\t\t'body { margin: 0px; padding: 0px; overflow: hidden; }\\n'+\n\t\t\t'body { line-height: 36px; }\\n'+\n\n\t\t\t`@font-face { font-family: my_himajihoso; src: url(\"${\n\t\t\t\t'data:application/font-woff;base64,'+\n\t\t\t\tString(dataUrl)\n\t\t\t\t.split(/,/)[1]\n\t\t//\t\t.replace(/([.*+?^${}()|\\[\\]\\/\\\\])/g, '\\\\$1')\n\t\t\t}\"); }`;\n\n\t\tconsole.log('css:'+ css);\n\t\tconsole.log('@font-face { font-family: my_himajihoso; src: url(\"data:application/font-woff;base64,d09GMk9UVE8AAA...bhUAAA==\"); }\\n');\n\t\t\tthis.styleHtmTxt.appendChild(document.createTextNode(css));\n*/\n\n\t\tPromise.resolve(htmTxt)\n\t\t.then(node=> {\t//console.log(`ğŸ‡ toSvg`);\n\t\t\tconst cln = <HTMLSpanElement>node.cloneNode(true);\n\t\t\tcln.style.padding = '0px';\t\t// ã‚„ã‚„ã“ã—ã„ã®ã§ã‚·ãƒ³ãƒ—ãƒ«ã«\n\t\t\tcln.style.paddingRight = padTx4x +'px';\n\t\t\tcln.style.paddingTop = padTx4y +'px';\n\t\t\tcln.style.left = '0px';\n\t\t\tcln.style.top = '0px';\n\t\t\tcln.style.width = infTL.$width -infTL.pad_left -infTL.pad_right +'px';\n\t\t\tcln.style.height = infTL.$height -infTL.pad_top -infTL.pad_bottom +'px';\n\t\t\t//console.log(cln.style.cssText);\n\t\t\thtmTxt.hidden = hidden;\n\t\t\treturn cln;\n\t\t})\n\t\t.then(embedFonts)\n\t\t.then(node=> {\t//console.log(`ğŸˆ makeSvgDataUri`);\n\t\t\tnode.setAttribute('xmlns', 'http://www.w3.org/1999/xhtml');\n\t\t\tconst img = new Image;\n\t\t\t//img.crossOrigin = 'Anonymous';\t//--ã„ã¾ã®ã¨ã“ä¸è¦\n\t\t\timg.src = `data:image/svg+xml;charset=utf-8,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"${infTL.$width\n\t\t\t}px\" height=\"${infTL.$height\n\t\t\t}px\"><foreignObject x=\"0\" y=\"0\" width=\"100%\" height=\"100%\">${\n\t\t\t\t(new XMLSerializer).serializeToString(node)\n\t\t\t\t.replaceAll('#', '%23').replaceAll('\\n', '%0A')\n\t\t\t}</foreignObject></svg>` // ? + (new Date).getTime();\n\t\t\treturn new Promise(re=> {img.onload = ()=> re(img)});\n\t\t})\n\t\t.then(img=> new Promise(re=> setTimeout(()=> re(img) , 100)))\n\t\t\t// ç„¡ãã™ã¨Safariã§ãƒ†ã‚¯ã‚¹ãƒãƒ£å–ã‚Œãªã„å ´åˆãŒã‚ã£ãŸ\n\t\t\t// clearTimeout()ä¸è¦ã¨åˆ¤æ–­\n\t\t.then((img: any)=> {\t//console.log(`ğŸ‰ toPng`);\n\t\t\tconst canvas = document.createElement('canvas');\n\t\t\tcanvas.width = infTL.$width;\n\t\t\tcanvas.height = infTL.$height;\n\t\t\tcanvas.getContext('2d')!.drawImage(img, 0, 0);\n\t\t\tfnc(Texture.from(canvas));\n\t\t})\n\t\t.catch((e: unknown)=> DebugMng.myTrace(`goTxt() = ${e}`));\n\t}\n","/* eslint-disable @typescript-eslint/no-unsafe-argument */\n/* eslint-disable @typescript-eslint/restrict-plus-operands */\n/* eslint-disable @typescript-eslint/no-unsafe-member-access */\n/* ***** BEGIN LICENSE BLOCK *****\n\tCopyright (c) 2019-2025 Famibee (famibee.blog38.fc2.com)\n\n\tThis software is released under the MIT License.\n\thttp://opensource.org/licenses/mit-license.php\n** ***** END LICENSE BLOCK ***** */\n\nimport {CmnLib, type IEvtMng, argChk_Boolean, argChk_Num} from './CmnLib';\nimport type {HArg} from './Grammar';\nimport type {Config} from './Config';\nimport {CmnTween} from './CmnTween';\nimport {SpritesMng} from './SpritesMng';\nimport {DebugMng} from './DebugMng';\nimport type {IMakeDesignCast} from './LayerMng';\n//import {TxtLayDesignCast, TxtLayPadDesignCast} from './DesignCast';\nimport type {SysBase} from './SysBase';\nimport type {T_RP_Hyphenation, IChRect} from './Hyphenation';\nimport {Hyphenation} from './Hyphenation';\nimport {type ScriptIterator, RPN_COMP_CHIN} from './ScriptIterator';\nimport {Reading} from './Reading';\nimport {htm2tx} from './htm2tx';\n\nimport {Container, Sprite, Graphics, Rectangle, Renderer, Application} from 'pixi.js';\nimport {Tween} from '@tweenjs/tween.js'\n\n\nexport type T_InfTxLay = {\n\tfontsize\t: number;\n\t$width\t\t: number;\t// ãƒ¬ã‚¤ãƒ¤ã‚µã‚¤ã‚ºã§ã‚ã‚Šã€èƒŒæ™¯è‰²ï¼ˆç”»åƒï¼‰ã‚µã‚¤ã‚º\n\t$height\t\t: number;\n\tpad_left\t: number;\t// paddingLeftï¼ˆãƒ¬ã‚¤ãƒ¤ã‚µã‚¤ã‚ºã®å†…å´ã®ã‚¹ãƒšãƒ¼ã‚µãƒ¼ï¼‰\n\tpad_right\t: number;\t// paddingRight\n\tpad_top\t\t: number;\t// paddingTop\n\tpad_bottom\t: number;\t// paddingBottom\n}\n\ntype T_SpTw = {\n\tsp\t: Container;\n\ttw\t: Tween<Container> | undefined;\n}\n\n\nexport type T_RP_layTxtStage = {\n\tinfTL\t\t: T_InfTxLay;\n\tcssText\t\t: string;\n\tleft\t\t: number;\n\t// eslint-disable-next-line @typescript-eslint/no-explicit-any\n\tch_filter\t: any[];\n\tfi_easing\t: string;\n\tfo_easing\t: string;\n\thyph\t\t: T_RP_Hyphenation;\n}\n\ntype T_ChInOutStyle = {\n\twait\t: number;\n\talpha\t: number;\n\tx\t\t: string;\n\ty\t\t: string;\n\twidth?\t: string;\n\theight?\t: string;\n\tnx\t\t: number;\n\tny\t\t: number;\n\tscale_x\t: number;\n\tscale_y\t: number;\n\trotate\t: number;\n\tjoin\t: boolean;\n\tease\t: string;\n\tdelay?\t: number;\n};\n\nexport class TxtStage extends Container {\n\tstatic\t#cfg\t: Config;\n\tstatic\t#appPixi: Application;\n\tstatic\tinit(cfg: Config, appPixi: Application): void {\n\t\tTxtStage.#cfg = cfg;\n\t\tTxtStage.#appPixi = appPixi;\n\t}\n\tstatic\t#evtMng\t: IEvtMng;\n\tstatic\t#scrItr\t: ScriptIterator;\n\tstatic\tsetEvtMng(evtMng: IEvtMng, scrItr: ScriptIterator) {\n\t\tTxtStage.#evtMng = evtMng;\n\t\tTxtStage.#scrItr = scrItr;\n\t}\n\n\tstatic\tdestroy() {\n\t\t// eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n\t\tTxtStage.#hChInStyle\t= Object.create(null);\n\t\t// eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n\t\tTxtStage.#hChOutStyle\t= Object.create(null);\n\n\t\tTxtStage.delBreak();\n\t}\n\n\n\t\t\t\t#htmTxt\t= document.createElement('span');\t// ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°å…ƒ\n\treadonly\t#cntTxt\t\t\t= new Container;\t\t\t// ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°å…ˆ\n\treadonly\t#grpDbgMasume\t= new Graphics;\n\tstatic\treadonly\t#hWarnStyle = {\n\t\t'background-color'\t\t: 0,\n\t\t'border-bottom-width'\t: 0,\n\t\t'border-left-width'\t\t: 0,\n\t\t'border-right-width'\t: 0,\n\t\t'border-top-width'\t\t: 0,\n\t\t'margin-bottom'\t: 0,\n\t\t'margin-left'\t: 0,\n\t\t'margin-right'\t: 0,\n\t\t'margin-top'\t: 0,\n\t};\n\n\n\t#hyph\t= new Hyphenation;\n\tnoticeCompTxt\t= ()=> { /* empty */ };\n\n\t#fncMasume;\n\n\n\tconstructor(private readonly ctn: Sprite, private readonly canFocus: ()=> boolean, private readonly sys: SysBase) {\n\t\tsuper();\n\n\t\tthis.#htmTxt.classList.add('sn_tx');\n\t\tthis.#htmTxt.style.position = 'absolute';\n\t\t// eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n\t\tTxtStage.#appPixi.view.parentElement!.appendChild(this.#htmTxt);\n\n\t\tthis.addChild(this.#cntTxt);\n\n\t\tthis.addChild(this.#grpDbgMasume);\n\t\tthis.#grpDbgMasume.name = 'grpDbgMasume';\n\t\tconst fncMasumeLog = CmnLib.debugLog\n\t\t\t// eslint-disable-next-line @typescript-eslint/restrict-template-expressions\n\t\t\t? ({ch, rect: {x, y, width, height}}: IChRect)=> console.log(`ğŸŒ masume ch:${ch} x:${x} y:${y} w:${width} h:${height}`)\n\t\t\t: ()=> { /* empty */ };\n\t\tthis.#fncMasume = TxtStage.#cfg.oCfg.debug.masume\n\t\t\t? (cr: IChRect)=> {\n\t\t\t\tfncMasumeLog(cr);\n\n\t\t\t\tconst {x, y, width, height} = cr.rect;\n\t\t\t\tthis.#grpDbgMasume\n\t\t\t\t.beginFill(0x66CCFF, 0.5)\n\t\t\t\t.lineStyle(2, 0xFF3300, 1)\n\t\t\t\t.drawRect(x, y, width, height)\n\t\t\t\t.endFill();\n\t\t\t}\n\t\t\t: ()=> { /* empty */ };\n\n//\t\tthis.#idc = new TxtLayDesignCast(ctn, this);\n//\t\tthis.#idc.adopt(this.#idcCh);\n\n\t\tthis.noticeCompTxt = sys.isApp && TxtStage.#cfg.oCfg.debug.dumpHtm\n\t\t? ()=> {\n\t\t\tReading.notifyEndProc(RPN_COMP_CHIN);\n\n\t\t\tconst htm = this.#htmTxt.innerHTML;\n\t\t\tif (htm === '') return;\n\t\t\tconst {fn, ln} = TxtStage.#scrItr.nowScrFnLn();\n\t\t\tconst id = `dumpHtm ${\n\t\t\t\tctn.name.slice(0, -7)\t// æœ«å°¾ã€Œ page=Bã€å‰Šã‚Š\n\t\t\t\t.replaceAll(':', '=')\t\t\t// ãƒ•ã‚¡ã‚¤ãƒ«åã§å›°ã‚‹æ–‡å­—\n\t\t\t}(fn=${fn} line=${String(ln)})`;\n\t\t\tvoid sys.outputFile(\n\t\t\t\tsys.path_downloads + id +'.htm',\n`<!doctype html><html><head><meta charset=utf-8><title>${id}</title>\n<h1>${id}</h1>${\n\thtm\t// outerHTML ã‹ã‚‰ã®ãƒ¬ã‚¤ãƒ¤å†ç¾ãªã©ã—ãŸã„ã¨ã“ã ãŒã‚ªãƒ¼ãƒãƒ¼ã‚¹ãƒšãƒƒã‚¯\n\t.replaceAll(/ class=\"sn_ch\"|animation-delay: \\d+ms; ?| data-add=\"{&quot;ch_in_style&quot;:&quot;default&quot;, &quot;ch_out_style&quot;:&quot;default&quot;}\"/g, '')\n\t.replaceAll(' style=\"\"', '')\t// chromeã§è­¦å‘ŠãŒå‡ºã‚‹ã®ã§\n\t.replaceAll(/(<\\/?ruby>)/g, '\\n$1\\n')\n\t.replaceAll(/<(br|\\/span)>/g, '<$1>\\n')\n}`,\n\t\t\t);\n\t\t}\n\t\t: ()=> Reading.notifyEndProc(RPN_COMP_CHIN);\n\t}\n\n//\treadonly\t#idc\t:TxtLayDesignCast;\n//\treadonly\t#idcCh\t= new TxtLayPadDesignCast(this);\n\t#infTL :T_InfTxLay = {\n\t\tfontsize\t: 24,\n\t\t$width\t\t: 0,\t// ãƒ¬ã‚¤ãƒ¤ã‚µã‚¤ã‚ºã§ã‚ã‚Šã€èƒŒæ™¯è‰²ï¼ˆç”»åƒï¼‰ã‚µã‚¤ã‚º\n\t\t$height\t\t: 0,\n\t\tpad_left\t: 0,\t// paddingLeftï¼ˆãƒ¬ã‚¤ãƒ¤ã‚µã‚¤ã‚ºã®å†…å´ã®ã‚¹ãƒšãƒ¼ã‚µãƒ¼ï¼‰\n\t\tpad_right\t: 0,\t// paddingRight\n\t\tpad_top\t\t: 0,\t// paddingTop\n\t\tpad_bottom\t: 0,\t// paddingBottom\n\t}\n\n\tlay(hArg: HArg) {\n\t\tconst s = this.#htmTxt.style;\n\t\tif ('style' in hArg) {\n\t\t\tif (hArg.style) {\n\t\t\t\tconst cln = document.createElement('span');\n\t\t\t\tcln.style.cssText = hArg.style;\n\t\t\t\tconst len = cln.style.length;\n\t\t\t\tfor (let i=0; i<len; ++i) {\n\t\t\t\t\t// eslint-disable-next-line @typescript-eslint/no-explicit-any\n\t\t\t\t\tconst key: any = cln.style[i];\n\t\t\t\t\tif (key in TxtStage.#hWarnStyle) {\n\t\t\t\t\t\tDebugMng.myTrace(`${String(key)}ã¯æŒ‡å®šã§ãã¾ã›ã‚“`, 'W');\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\t// eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n\t\t\t\t\ts[key] = cln.style[key]!;\n\t\t\t\t}\n\t\t\t\tif (! cln.style.opacity && 'alpha' in hArg) s.opacity = String(this.ctn.alpha);\n\t\t\t}\n\t\t\telse this.#htmTxt.style.cssText = '';\n\t\t}\n\t\telse if ('alpha' in hArg) s.opacity = String(this.ctn.alpha);\n\n\t\tif ('width' in hArg) s.width = String(hArg.width ?? '0') +'px';\n\t\tif ('height' in hArg) s.height = String(hArg.height ?? '0') +'px';\n\t\tif ('pl' in hArg) s.paddingLeft = String(hArg.pl ?? '0') +'px';\n\t\tif ('pr' in hArg) s.paddingRight = String(hArg.pr ?? '0') +'px';\n\t\tif ('pt' in hArg) s.paddingTop = String(hArg.pt ?? '0') +'px';\n\t\tif ('pb' in hArg) s.paddingBottom = String(hArg.pb ?? '0') +'px';\n\t\tthis.#hyph.lay(hArg);\n\t\tthis.#lay_sub();\n//\t\tthis.#idc.sethArg(hArg);\n\n\t\t// CSSãƒ»ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã§å³ã‚„ä¸Šã«ã¯ã¿å‡ºã‚‹åˆ†ã®ä½™è£•\n\t\tthis.#left = this.ctn.position.x;\n\t\t\t//-(CmnLib.isSafari && !CmnLib.isMobile && this.#isTategaki\n\t\t\t//\t? this.#infTL.pad_left +this.#infTL.pad_right\n\t\t\t//\t: 0);\t// ç„¡åŠ¹åŒ– 2022/02/09\n\t\t// eslint-disable-next-line @typescript-eslint/restrict-template-expressions\n\t\ts.transformOrigin = `${this.ctn.pivot.x}px ${this.ctn.pivot.y}px`;\n\t\tthis.cvsResize();\n\t\ts.display = this.ctn.visible ?'inline' :'none';\n\n\t\t// ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã‚­ãƒ£ã‚¹ãƒˆå¤‰æ›´æ™‚ãƒ»ã‚¯ãƒªãƒƒã‚¯å¾…ã¡è¡¨ç¤ºã‚’è¿½å¾“ã•ã›ã‚‹ï¼ˆé«˜é€Ÿå†æå†™ï¼‰\n\t\tif (':redraw' in hArg && this.#lenHtmTxt > 0) {\n\t\t\tconst aSpan = [\n\t\t\t\tthis.#htmTxt.innerHTML.replaceAll(/(animation-delay: )\\d+ms/g, '$10ms'),\n\t\t\t\t'<span class=\\'sn_ch\\' data-add=\\'{\"ch_in_style\":\"default\"}\\'>&emsp;</span>',\n\t\t\t];\n\t\t\tthis.#clearText();\t// æ¶ˆå»\n\t\t\tthis.goTxt(aSpan, true);\t// é«˜é€Ÿ goTxt()\n\t\t}\n\t}\n\t// oxlint-disable-next-line no-unused-private-class-members\n\t#lh_half\t= 0;\t// ã€Œgã€ãªã©ã§ä¸‹ãŒæ¬ ã‘ã‚‹å•é¡Œå¯¾ç­–\n\t#lay_sub() {\n\t\tconst s = this.#htmTxt.style;\n\t\tconst fs = parseFloat(s.fontSize || '0');\n\t\tthis.#infTL.fontsize = fs;\n\n\t\tthis.#infTL.pad_left = parseFloat(s.paddingLeft || '0');\n\t\tthis.#infTL.pad_right = parseFloat(s.paddingRight || '0');\n\t\tthis.#infTL.pad_top = parseFloat(s.paddingTop || '0');\n\t\tthis.#infTL.pad_bottom = parseFloat(s.paddingBottom || '0');\n\t\tthis.#infTL.$width = parseFloat(s.width || '0');\n\t\tthis.#infTL.$height = parseFloat(s.height || '0');\n\t\tthis.position.set(this.#infTL.pad_left, this.#infTL.pad_top);\n\n\t\tthis.#isTategaki = s.writingMode === 'vertical-rl';\n\n\t\tthis.#padTx4x = 0;\n\t\tthis.#padTx4y = 0;\n\n\t\t// eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n\t\tconst lh = s.lineHeight ?? '0';\n\t\tthis.#lh_half = this.#isTategaki\n\t\t\t? 0\n\t\t\t: (\tlh.endsWith('px')\n\t\t\t\t? parseFloat(lh)\n\t\t\t\t: fs *parseFloat(lh) -fs) /2;\n\t\t\t// globalThis.getComputedStyle(this.htmTxt)ãŒãƒãƒ§ã‚¤ãƒãƒ§ã‚¤å€¤ã‚’è¿”ã•ãªã„ã®ã§\n\t}\n\tcvsResize() {\n\t\tconst s = this.#htmTxt.style;\n\t\tconst cvsScale = this.sys.cvsScale;\n\t\t// eslint-disable-next-line @typescript-eslint/restrict-template-expressions\n\t\ts.left = `${this.sys.ofsLeft4elm +this.#left *cvsScale}px`;\n\t\t// eslint-disable-next-line @typescript-eslint/restrict-template-expressions\n\t\ts.top = `${this.sys.ofsTop4elm +this.ctn.position.y *cvsScale}px`;\n\t\t// eslint-disable-next-line @typescript-eslint/restrict-template-expressions\n\t\ts.transform = `rotate(${this.ctn.angle}deg) scale(${this.ctn.scale.x *cvsScale}, ${this.ctn.scale.y *cvsScale})`;\n\n//\t\tthis.#idc.cvsResize();\n//\t\tthis.#idcCh.cvsResize();\n\t}\n\t#left = 0;\n\t#isTategaki = false;\n\tget tategaki() {return this.#isTategaki}\n\t#padTx4x = 0;\n\t#padTx4y = 0;\n\n\tget\tinfTL(): T_InfTxLay {return this.#infTL}\n\tget\tgetWidth() {return this.#infTL.$width}\n\tget\tgetHeight() {return this.#infTL.$height}\n\n\tsetMySize(width: number, height: number) {\n\t\tthis.#infTL.$width = width;\n\t\tthis.#infTL.$height = height;\n\t\tthis.#htmTxt.style.width = String(this.#infTL.$width) +'px';\n\t\tthis.#htmTxt.style.height = String(this.#infTL.$height) +'px';\n\t}\n\n\n\t#aGoTxt\t: (()=> void)[] = [];\t// FIFOå®Ÿè¡Œãƒãƒƒãƒ•ã‚¡\n\tgoTxt(aSpan: string[], instant: boolean) {\n\t\tconst f = ()=> this.#goTxt_Proc(aSpan, instant);\n\t\tif (this.#aGoTxt.push(f) === 1) f();\t// len=1 ã§å®Ÿè¡Œä¸­ã‚’ç¤ºã™\n\t}\n\n\t#aRect\t: IChRect[]\t= [];\n\t#lenHtmTxt = 0;\n\tstatic\treadonly\t#SPAN_LAST = '<span class=\\'sn_ch sn_ch_last\\'>&emsp;</span>';\n\t#goTxt_Proc(aSpan: string[], instant: boolean) {\n\t\tTxtStage.#cntBreak.visible = false;\n\n\t\tlet begin = this.#aRect.length;\n\t\tlet bkHtm = '';\n\t\tif (begin === 0) {\t// åˆå›\n\t\t\tif (TxtStage.#cfg.oCfg.debug.masume) {\n\t\t\t\tif (CmnLib.debugLog) console.log(`ğŸŒ masume ${\n\t\t\t\t\t// eslint-disable-next-line @typescript-eslint/restrict-template-expressions\n\t\t\t\t\tthis.name} v:${this.visible} l:${this.x} t:${this.y\n\t\t\t\t\t// eslint-disable-next-line @typescript-eslint/restrict-template-expressions\n\t\t\t\t\t} a:${this.alpha} pl:${this.#infTL.pad_left\n\t\t\t\t\t// eslint-disable-next-line @typescript-eslint/restrict-template-expressions\n\t\t\t\t\t} pr:${this.#infTL.pad_right\n\t\t\t\t\t// eslint-disable-next-line @typescript-eslint/restrict-template-expressions\n\t\t\t\t\t} pt:${this.#infTL.pad_top} pb:${this.#infTL.pad_bottom\n\t\t\t\t\t// eslint-disable-next-line @typescript-eslint/restrict-template-expressions\n\t\t\t\t\t} w:${this.#infTL.$width} h:${this.#infTL.$height}`);\n\n\t\t\t\tthis.#grpDbgMasume.clear()\n\t\t\t\t.beginFill(0x33FF00, 0.2)\t// æ–‡å­—ãƒ¬ã‚¤ãƒ¤\n\t\t\t\t.lineStyle(1, 0x33FF00, 1)\n\t\t\t\t.drawRect(-this.#infTL.pad_left, -this.#infTL.pad_top, this.#infTL.$width, this.#infTL.$height)\n\t\t\t\t\t// è¦ªã®è¦ªã® cntInsidePadding ãŒ padding ã¶ã‚“æ°´å¹³ç§»å‹•ã—ã¦ã‚‹ã®ã§å¼•ãã€‚\n\t\t\t\t.endFill()\n\n\t\t\t\t.beginFill(0x0033FF, 0.2)\t// cntInsidePadding\n\t\t\t\t.lineStyle(2, 0x0033FF, 1)\n\t\t\t\t.drawRect(0, 0,\n\t\t\t\tthis.#infTL.$width -this.#infTL.pad_left -this.#infTL.pad_right,\n\t\t\t\tthis.#infTL.$height -this.#infTL.pad_top -this.#infTL.pad_bottom)\n\t\t\t\t.endFill();\n\t\t\t}\n\n\t\t\tthis.#htmTxt.innerHTML = [...aSpan].join('').replaceAll(/[\\n\\t]/g, '') +TxtStage.#SPAN_LAST;\t// æœ«å°¾æ”¹è¡Œå‰Šé™¤æŒ™å‹•å¯¾ç­–\n\n\t\t\tif (! this.#hyph.break_fixed) {\n\t\t\t\tconst sty = globalThis.getComputedStyle(this.#htmTxt);\n\t\t\t\tconst rs = parseFloat(sty.fontSize);\n\t\t\t\tif (this.#isTategaki) {\n\t\t\t\t\tthis.#hyph.break_fixed_left = (this.#infTL.$width -this.#infTL.pad_left -this.#infTL.pad_right -rs *1.5) *this.sys.cvsScale;\n\t\t\t\t\tthis.#hyph.break_fixed_top = 0;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tthis.#hyph.break_fixed_left = 0;\n\t\t\t\t\tthis.#hyph.break_fixed_top = rs /2 *this.sys.cvsScale;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tbkHtm = this.#htmTxt.innerHTML;\n\t\t\t// æœ«å°¾æ”¹è¡Œå‰Šé™¤æŒ™å‹•å¯¾ç­–\n\t\t\t--begin;\n//console.log(`fn:TxtStage.ts nm=${this.name} begin:${begin} bkHtm=${bkHtm}=`);\n\t\t\tthis.#htmTxt.getElementsByClassName('sn_ch_last').item(0)?.remove();\n\t\t\t\t// å‰å›ã®æœ«å°¾ã‚’å‰Šé™¤\n\n\t\t\tthis.#htmTxt.querySelectorAll(':scope > br').forEach(e=> e.remove());\t// å‰å›ã®ç¦å‰‡å‡¦ç†ã‚’ä¸€åº¦å‰Šé™¤\n\t\t\t\t// :scope - CSS: ã‚«ã‚¹ã‚±ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¹ã‚¿ã‚¤ãƒ«ã‚·ãƒ¼ãƒˆ | MDN https://developer.mozilla.org/ja/docs/Web/CSS/:scope\n\t\t\tthis.#htmTxt.insertAdjacentHTML(\n\t\t\t\t'beforeend',\n\t\t\t\taSpan.slice(this.#lenHtmTxt).join('').replaceAll(/[\\n\\t]/g, '')\n\t\t\t\t+TxtStage.#SPAN_LAST\t// æœ«å°¾æ”¹è¡Œå‰Šé™¤æŒ™å‹•å¯¾ç­–\n\t\t\t);\n\t\t}\n\t\t\t// å¾Œã®ç¦å‰‡å‡¦ç†åˆ¤å®šã§èª¤åˆ¤å®šã™ã‚‹ã®ã§ã€innerHTML æ™‚ã«ãƒ ãƒ€ãªæ”¹è¡Œã‚„ã‚¿ãƒ–ã¯å‰Šé™¤\n\t\t\t// [r]ã¯å¾Œè¿°ã‚³ãƒ¡ãƒ³ãƒˆã®HTMLã‚¿ã‚°ã«ãªã£ã¦ã‚‹ã®ã§å•é¡Œãªã—\n\n\t\t// ãƒ«ãƒ“ä»˜ãæ–‡å­—ã«èƒŒæ™¯æŒ‡å®šï¼ˆstyle='background:'ï¼‰ãŒã‚ã‚‹å ´åˆã€ã€Œæ–‡å­—ã€ã¨ã€Œãƒ«ãƒ“ã€ã¨ã€Œãã®äºŒã¤ã‚’å«ã‚“ã é ˜åŸŸã€ã®ä¸‰ã¤ãŒå€‹åˆ¥ã«å¡—ã‚‰ã‚Œã‚‹ãŒã€ä¸‰ã¤ã‚ã¯èƒŒæ™¯æŒ‡å®šã‚’å‰Šé™¤ã™ã‚‹\n\t\tthis.#htmTxt.querySelectorAll('.sn_ch:has(> ruby)').forEach(v=> {(<HTMLElement>v).style.background = ''});\t// :hasç›´å‰ã«ç©ºç™½å³ç¦\n\n\t\tthis.#lenHtmTxt = aSpan.length;\n//console.log(`fn:TxtStage.ts nm=${this.name} === ==${this.#htmTxt.innerHTML.slice(360)}==`);\n\n\t\t// this.#getChRects()ä½¿ç”¨æº–å‚™\n\t\tconst cvsScale = this.sys.cvsScale;\n\t\tconst bcr = this.#htmTxt.getBoundingClientRect();\n\t\tconst sx = bcr.left +this.#infTL.pad_left;\n\t\tconst sy = bcr.top +this.#infTL.pad_top;\n\t\tlet cnvRect :(rng: Range, ch: string)=> Rectangle;\n\t\tif (cvsScale === 1) cnvRect = (rng, ch)=> {\n\t\t\tconst r = rng.getBoundingClientRect();\n\t\t\treturn new Rectangle(\n\t\t\t\tr.left -sx,\n\t\t\t\tr.top  -sy,\n\t\t\t\tr.width,\n\t\t\t\tr.height +('gjqy'.includes(ch) ?this.#lh_half :0)\n\t\t\t);\n\t\t};\n\t\telse {\n\t\t\t// Resizeã‚’æ„è­˜ã—ã¦DOMä½ç½®ã‚’PIXIã«å¤‰æ›\n\t\t\t// transform scale ã‚’ä¸€æ™‚çš„ã«å¤‰æ›´ã™ã‚‹æ‰‹ã‚‚ã‚ã‚‹ãŒã€ã‚„ã‚„ãšã‚Œã‚‹ã—DOMå½±éŸ¿å¤§\n\t\t\tconst ox = this.sys.ofsPadLeft_Dom2PIXI +bcr.left *(1- cvsScale);\n\t\t\tconst oy = this.sys.ofsPadTop_Dom2PIXI +bcr.top *(1- cvsScale);\n\t\t\tcnvRect = (rng, ch)=> {\n\t\t\t\tconst r = rng.getBoundingClientRect();\n\t\t\t\treturn new Rectangle(\n\t\t\t\t\t(r.left -ox) /cvsScale -sx,\n\t\t\t\t\t(r.top  -oy) /cvsScale -sy,\n\t\t\t\t\tr.width /cvsScale,\n\t\t\t\t\t(r.height +('gjqy'.includes(ch) ?this.#lh_half :0)) /cvsScale,\n\t\t\t\t);\n\t\t\t};\n\t\t}\n\n\t\tconst [a, len] = this.#hyph.hyph(this.#htmTxt, cnvRect, this.#isTategaki, begin, bkHtm);\n\t\tthis.#aRect = a;\n\n\t\tconst ease = CmnTween.ease(this.#fi_easing);\n\n\t\tfor (let i=begin; i<len; ++i) {\n\t\t\t// eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n\t\t\tconst cr = this.#aRect[i]!;\n\t\t\tconst {elm: {dataset, parentElement}, rect} = cr;\n\t\t\t// eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n\t\t\tconst arg = JSON.parse(dataset.arg ?? '{\"delay\": 0}');\n\t\t\t// eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n\t\t\tconst add = JSON.parse(dataset.add ?? '{}');\n\t\t\tconst cis = TxtStage.#hChInStyle[add.ch_in_style];\n\t\t\tthis.#fncMasume(cr);\n\n\t\t\tif (dataset.cmd === 'grp') {\n\t\t\t\tconst cnt = new Container;\t// è¦ªã‚³ãƒ³ãƒ†ãƒŠã‹ã¾ã—ã€å³spWork()\n\t\t\t\tthis.#cntTxt.addChild(cnt);\n\t\t\t\t\t// æ¬¡ã®csv2SpritesãŒå³çµ‚ã‚ã‚‹å ´åˆã‚‚ã‚ã‚‹ã®ã§å…ˆã«è¡Œãªã†\n\t\t\t\tnew SpritesMng(arg.pic, cnt, sp=> {\n\t\t\t\t\tthis.#spWork(cnt, arg, add, rect, ease, cis ?? {});\n\t\t\t\t\t// eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n\t\t\t\t\tif (! cnt.parent) cnt.removeChild(sp);\n\t\t\t\t});\n\t\t\t}\n\t\t\tif (dataset.lnk) {\n\t\t\t\t// eslint-disable-next-line @typescript-eslint/no-unnecessary-type-assertion, @typescript-eslint/no-non-null-assertion\n\t\t\t\tconst eCh = <HTMLElement>parentElement!.closest('[data-arg]')!;\n\t\t\t\t// eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n\t\t\t\tconst aLnk = JSON.parse(eCh.dataset.arg ?? '{}');\n\t\t\t\taLnk.key = `lnk=[${String(i)}] `+ this.name;\n\t\t\t\tconst sp = new Sprite;\n\t\t\t\tthis.#spWork(sp, aLnk, add, rect, ease, cis ?? {});\n\n\t\t\t\t// eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n\t\t\t\tconst st_normal = aLnk.style ?? '';\n\t\t\t\t// eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n\t\t\t\tconst st_hover = st_normal +(aLnk.style_hover ?? '');\n\t\t\t\t// eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n\t\t\t\tconst st_clicked = st_normal +(aLnk.style_clicked ?? '');\n\t\t\t\t// eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n\t\t\t\tconst st_r_normal = aLnk.r_style ?? '';\n\t\t\t\t// eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n\t\t\t\tconst st_r_hover = st_r_normal +(aLnk.r_style_hover ?? '');\n\t\t\t\t// eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n\t\t\t\tconst st_r_clicked = st_r_normal +(aLnk.r_style_clicked ?? '');\n\n\t\t\t\tconst nlRt = Array.from(eCh.getElementsByTagName('rt'));\n\t\t\t\tfor (const e of nlRt) e.dataset.st_r_bk = e.style.cssText;\n\t\t\t\tconst st_bk = eCh.style.cssText;\n\t\t\t\tconst fncStyle = (st: string, st_r: string)=> {\n\t\t\t\t\teCh.style.cssText = st_bk + st;\n\t\t\t\t\tfor (const e of nlRt) e.style.cssText = e.dataset.st_r_bk + st_r;\n\t\t\t\t};\n\n\t\t\t\tconst enabled = argChk_Boolean(aLnk, 'enabled', true);\n\t\t\t\tif (enabled) TxtStage.#evtMng.button(aLnk, sp,\n\t\t\t\t\t()=> fncStyle(st_normal, st_r_normal),\n\t\t\t\t\t()=> {\n\t\t\t\t\t\tif (! this.canFocus()) return false;\n\n\t\t\t\t\t\tfncStyle(st_hover, st_r_hover);\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t},\n\t\t\t\t\t()=> fncStyle(st_clicked, st_r_clicked)\n\t\t\t\t);\n\t\t\t\telse fncStyle(\n\t\t\t\t\tst_normal +(aLnk.style_disable ?? 'color: gray;'),\n\t\t\t\t\tst_r_normal +(aLnk.r_style_disable ?? 'color: gray;')\n\t\t\t\t);\n\t\t\t\tthis.#cntTxt.addChild(sp);\n\t\t\t}\n\t\t}\n\n\t\t// æ–‡å­—å‡ºç¾æ¼”å‡ºãƒ»é–‹å§‹ã€œçµ‚äº†\n\t\tconst chs = Array.from(<HTMLCollectionOf<HTMLElement>>this.#htmTxt.getElementsByClassName('sn_ch_yet'));\n// console.log(`fn:TxtStage.ts nm=${this.name} StartChIn <==`);\n\t\tthis.#fncEndChIn = ()=> {\n// console.log(`fn:TxtStage.ts nm=${this.name} fncEndChIn ==> '${lastElm?.textContent}' cls:${lastElm?.className}:`);\n\n\t\t\tthis.#fncEndChIn = ()=> false;\n\t\t\tfor (const v of chs) v.className = 'sn_ch';\n\t\t\tTxtStage.#cntBreak.position.set(\n\t\t\t\tthis.#hyph.break_fixed_left,\n\t\t\t\tthis.#hyph.break_fixed_top,\n\t\t\t);\n\t\t\tTxtStage.#cntBreak.visible = true;\n\t\t\t/*\n\t\t\t\tã“ã‚Œã‚‰ã¯ã‚»ãƒƒãƒˆã§ç¢ºèªã™ã‚‹ã“ã¨ã€‚å…¼ã­åˆã„ã«ã‚ˆã‚Šã€ã„ãšã‚Œã‹ãŒç ´ç¶»ã™ã‚‹å ´åˆãŒã‚ã‚‹\n\t\t\t\t\t- æœ«å°¾æ–‡å­—è¡¨ç¤ºã§ã‚«ãƒ¼ã‚½ãƒ«ãŒæ¬¡è¡Œå…ˆé ­ã«æ¥ã¦ã—ã¾ã†ã“ã¨ã®ãªã„ã‚ˆã†\n\t\t\t\t\t- æ”¹è¡Œâ†’ã‚¯ãƒªãƒƒã‚¯å¾…ã¡ã€ã®å¾Œã§æ”¹è¡ŒãŒæ¶ˆãˆãªã„ã‚ˆã†\n\t\t\t\t\t- å†’é ­ã‚¯ãƒªãƒƒã‚¯å¾…ã¡ï¼‹æ”¹è¡Œã§ã®è¡¨ç¤ºç¢ºèª\n\t\t\t*/\n\t\t\tthis.noticeCompTxt();\n\n\t\t\t// eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n\t\t\tconst f = this.#aGoTxt.shift()!;\t// å®Ÿè¡Œä¸­ã®ä¸€å€‹å¿…ãšå…¥ã£ã¦ã‚‹ï¼ˆclearTextæ³¨æ„ï¼‰\n\t\t\tif (this.#aGoTxt.length > 0) f();\t// ã¾ã ã‚ã‚Œã°å®Ÿè¡Œå¾…ã¡ãªã®ã§å®Ÿè¡Œ\n\n\t\t\treturn true;\n\t\t};\n\n\t\t// ã‚¢ãƒ‹ãƒ¡é–‹å§‹ï¼ˆsn_ch ã‚’ç½®æ›ã—ãªã„ã‚ˆã†æ³¨æ„ï¼‰\n\t\tfor (const v of chs) v.className = v.className.replace('sn_ch_yet sn', 'go');\n\t\tif (begin > 0) ++begin;\t// æœ«å°¾æ”¹è¡Œå‰Šé™¤æŒ™å‹•å¯¾ç­–\n\n\t\t// æ–‡å­—è¡¨ç¤ºã«æ™‚é–“ã‚’ã‹ã‘ã‚‹æœ€å¾Œã®æ–‡å­—ã‚’æ¢ã™ã€‚æœ«å°¾ã¯ãƒ€ãƒŸãƒ¼ï¼ˆ#SPAN_LASTï¼‰\n\t\tlet lastElm: HTMLElement | undefined = undefined;\n\t\tfor (let i=len -2; i>=0; --i) {\t\t// æœ«å°¾ã®æ‰‹å‰ã‹ã‚‰\n\t\t\t// eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n\t\t\tconst {elm} = this.#aRect[i]!;\n\t\t\tif (elm.tagName !== 'SPAN') continue;\t// ãƒ«ãƒ“ä»¥å¤–\n\n//console.log(`fn:TxtStage.ts nm=${this.name} txt:${elm.textContent}: i:${i} begin:${begin} len:${len} elm:%o`, elm);\n\t\t\tlastElm = elm.parentElement?.tagName === 'RUBY'\n\t\t\t\t? elm.parentElement.parentElement ?? elm // [tcy]ã‚‚[graph]ã‚‚\n\t\t\t\t: elm;\n\t\t\tbreak;\n\t\t}\n\t\tif (! lastElm || instant || begin === len) {this.#fncEndChIn(); return}\n\t\t\t// ã€Œanimation-duration: 0ms;ã€ã ã¨ animationend ãŒç™ºç”Ÿã—ãªã„ã®ã§ã€‚\n\t\t\t// if ä¸‰é …ç›®ã® === ã¯å³ã‚¯ãƒªãƒƒã‚¯æˆ»ã‚Šã§èµ·ã“ã‚‹\n\n\t\tlastElm.addEventListener('animationend', ()=> this.#fncEndChIn(), {once: true});\t// ã‚¯ãƒªãƒƒã‚¯ã‚­ãƒ£ãƒ³ã‚»ãƒ«æ™‚ã¯ç™ºç”Ÿã—ãªã„\n\t\t\t// å·®ã—æ›¿ãˆã‚‹ã®ã§ã€Œ()=> ã€å½¢å¼ã®ã¾ã¾ã«ã™ã‚‹ã“ã¨\n\t}\n\t#fncEndChIn: ()=> boolean\t= ()=> false;\n\t// eslint-disable-next-line @typescript-eslint/no-explicit-any\n\t#spWork(sp: Container, arg: T_ChInOutStyle, add: any, rct: Rectangle, ease: (k: number)=> number, cis: any) {\n\t\tsp.alpha = 0;\n\t\tif (arg.x) rct.x = arg.x.startsWith('=')\n\t\t\t? rct.x +parseInt(arg.x.slice(1))\n\t\t\t: parseInt(arg.x);\n\t\tif (arg.y) rct.y = arg.y.startsWith('=')\n\t\t\t? rct.y +parseInt(arg.y.slice(1))\n\t\t\t: parseInt(arg.y);\n\t\tif (arg.width) rct.width = parseInt(arg.width);\n\t\tif (arg.height) rct.height = parseInt(arg.height);\n\t\tif (arg.wait) cis.wait = arg.wait;\n\t\tsp.width = rct.width;\n\t\tsp.height = rct.height;\n\t\tif (cis.x) sp.position.set(\n\t\t\t// eslint-disable-next-line @typescript-eslint/no-unsafe-call\n\t\t\tcis.x.startsWith('=') ?rct.x +sp.width  *cis.nx :cis.nx,\n\t\t\t// eslint-disable-next-line @typescript-eslint/no-unsafe-call\n\t\t\tcis.y.startsWith('=') ?rct.y +sp.height *cis.ny :cis.ny\n\t\t);\n\t\telse sp.position.set(rct.x, rct.y,);\n\t\tconst st: T_SpTw = {\n\t\t\tsp,\n\t\t\ttw: new Tween(sp)\n\t\t\t.to({ alpha: 1, x: rct.x, y: rct.y, width: rct.width, height: rct.height, angle: 0 }, cis.wait ?? 0)\n\t\t\t.easing(ease)\n\t\t\t.delay((add.wait ?? 0) +(arg.delay ?? 0))\n\t\t\t.onComplete(()=> {\n\t\t\t\tst.tw = undefined;\n\t\t\t\t//(ç•¥)\tif (rct.width === 0 || rct.height === 0) return;\n\t\t\t\t//if (sp instanceof Sprite) sp.cacheAsBitmap = true;\n\t\t\t\t// ã“ã‚Œã‚’æœ‰åŠ¹ã«ã™ã‚‹ã¨[snapshot]ã§æ–‡å­—ãŒå‡ºãªã„\n\t\t\t})\n\t\t\t.start(),\n\t\t};\n\t\tthis.#aSpTw.push(st);\n\t}\n\t#aSpTw\t\t: T_SpTw[]\t= [];\n\n\tskipChIn(): boolean {\t// true: æ–‡å­—å‡ºç¾ä¸­ã ã£ãŸã®ã§ã€åœæ­¢ã™ã‚‹\n\t\tlet wasChInIng = this.#fncEndChIn();\n\t\tfor (const st of this.#aSpTw) {\t// Text Skipã€‚stop() ã¨ end() ã¯åˆ¥ï¼\n\t\t\tif (st.tw) {st.tw.stop().end(); wasChInIng = true}\n\t\t}\n\t\tthis.#aSpTw = [];\n\t\treturn wasChInIng;\n\t}\n\n\t// eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n\tstatic\t#hChInStyle: {[nm: string]: T_ChInOutStyle}\t= Object.create(null);\n\tstatic\treadonly\t#REG_NG_CHSTYLE_NAME_CHR\t= /[{\\s.,*{]/;\n\t\t// https://regex101.com/r/APC91I/1\n\tstatic\tinitChStyle() {\n\t\t// eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n\t\tTxtStage.#hChInStyle = Object.create(null);\n\t\t// eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n\t\tTxtStage.#hChOutStyle = Object.create(null);\n\t}\n\tstatic\tgetChInStyle(name: string) {return TxtStage.#hChInStyle[name]}\n\tstatic\tch_in_style(hArg: HArg): T_ChInOutStyle {\n\t\tconst {name} = hArg;\n\t\tif (! name) throw 'nameã¯å¿…é ˆã§ã™';\n\t\tif (TxtStage.#REG_NG_CHSTYLE_NAME_CHR.test(name)) throw `nameã€${name}ã€‘ã«ä½¿ãˆãªã„æ–‡å­—ãŒå«ã¾ã‚Œã¾ã™`;\n\t\tif (name in TxtStage.#hChInStyle) throw `nameã€${name}ã€‘ã¯ã™ã§ã«ã‚ã‚Šã¾ã™`;\n\n\t\tconst x = String(hArg.x ?? '=0');\n\t\tconst y = String(hArg.y ?? '=0');\n\t\tconst ret = TxtStage.#hChInStyle[name] = {\n\t\t\twait\t: argChk_Num(hArg, 'wait', 500),\t// ã‚¢ãƒ‹ãƒ¡ãƒ»FIæ™‚é–“\n\t\t\talpha\t: argChk_Num(hArg, 'alpha', 0),\n\t\t\tx,\t// åˆæœŸxå€¤\n\t\t\ty,\t// [tsy]ã¨åŒæ§˜ã«çµ¶å¯¾ãƒ»ç›¸å¯¾æŒ‡å®šå¯èƒ½\n\t\t\t// {x:500}\t\t\tXä½ç½®ã‚’500ã«\n\t\t\t// {x:'=500'}\t\tç¾åœ¨ã®Xä½ç½®ã«+500åŠ ç®—ã—ãŸä½ç½®\n\t\t\t// {x:'=-500'}\t\tç¾åœ¨ã®Xä½ç½®ã«-500åŠ ç®—ã—ãŸä½ç½®\n\t\t\t// {x:'250,500'}\t+250ã‹ã‚‰ï¼‹500ã¾ã§ã®é–“ã§ãƒ©ãƒ³ãƒ€ãƒ ãªå€¤ã‚’Xä½ç½®ã«\n\t\t\t// {x:'=250,500'}\t+250ã‹ã‚‰ï¼‹500ã¾ã§ã®é–“ã§ãƒ©ãƒ³ãƒ€ãƒ ãªå€¤ã‚’ç¾åœ¨ã®Xä½ç½®ã«åŠ ç®—\n\t\t\tnx\t\t: parseFloat(x.at(0) === '=' ? x.slice(1) : x),\n\t\t\tny\t\t: parseFloat(y.at(0) === '=' ? y.slice(1) : y),\n\t\t\tscale_x\t: argChk_Num(hArg, 'scale_x', 1),\n\t\t\tscale_y\t: argChk_Num(hArg, 'scale_y', 1),\n\t\t\trotate\t: argChk_Num(hArg, 'rotate', 0),\n\t\t\tjoin\t: argChk_Boolean(hArg, 'join', true),\n\t\t\t\t\t\t// æ–‡å­—ã‚’é †ç•ªã«å‡ºã™ã‹ï¼ˆtrueï¼‰åŒæ™‚ã‹ï¼ˆfalseï¼‰\n\t\t\tease\t: hArg.ease ?? 'ease-out',\n\t\t};\n\t\treturn ret;\n\t}\n\n\t// eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n\tstatic\t#hChOutStyle: {[nm: string]: T_ChInOutStyle}= Object.create(null);\n\tstatic\tgetChOutStyle(name: string) {return TxtStage.#hChOutStyle[name]}\n\tstatic\tch_out_style(hArg: HArg): T_ChInOutStyle {\n\t\tconst {name} = hArg;\n\t\tif (! name) throw 'nameã¯å¿…é ˆã§ã™';\n\t\tif (TxtStage.#REG_NG_CHSTYLE_NAME_CHR.test(name)) throw `nameã€${name}ã€‘ã«ä½¿ãˆãªã„æ–‡å­—ãŒå«ã¾ã‚Œã¾ã™`;\n\t\tif (name in TxtStage.#hChOutStyle) throw `nameã€${name}ã€‘ã¯ã™ã§ã«ã‚ã‚Šã¾ã™`;\n\n\t\tconst x = String(hArg.x ?? '=0');\n\t\tconst y = String(hArg.y ?? '=0');\n\t\tconst ret = TxtStage.#hChOutStyle[name] = {\n\t\t\twait\t: argChk_Num(hArg, 'wait', 500),\t// ã‚¢ãƒ‹ãƒ¡ãƒ»FIæ™‚é–“\n\t\t\talpha\t: argChk_Num(hArg, 'alpha', 0),\n\t\t\tx,\t// åˆæœŸxå€¤\n\t\t\ty,\t// [tsy]ã¨åŒæ§˜ã«çµ¶å¯¾ãƒ»ç›¸å¯¾æŒ‡å®šå¯èƒ½\n\t\t\t// {x:500}\t\t\tXä½ç½®ã‚’500ã«\n\t\t\t// {x:'=500'}\t\tç¾åœ¨ã®Xä½ç½®ã«+500åŠ ç®—ã—ãŸä½ç½®\n\t\t\t// {x:'=-500'}\t\tç¾åœ¨ã®Xä½ç½®ã«-500åŠ ç®—ã—ãŸä½ç½®\n\t\t\t// {x:'250,500'}\t+250ã‹ã‚‰ï¼‹500ã¾ã§ã®é–“ã§ãƒ©ãƒ³ãƒ€ãƒ ãªå€¤ã‚’Xä½ç½®ã«\n\t\t\t// {x:'=250,500'}\t+250ã‹ã‚‰ï¼‹500ã¾ã§ã®é–“ã§ãƒ©ãƒ³ãƒ€ãƒ ãªå€¤ã‚’ç¾åœ¨ã®Xä½ç½®ã«åŠ ç®—\n\t\t\tnx\t\t: parseFloat(x.at(0) === '=' ? x.slice(1) : x),\n\t\t\tny\t\t: parseFloat(y.at(0) === '=' ? y.slice(1) : y),\n\t\t\tscale_x\t: argChk_Num(hArg, 'scale_x', 1),\n\t\t\tscale_y\t: argChk_Num(hArg, 'scale_y', 1),\n\t\t\trotate\t: argChk_Num(hArg, 'rotate', 0),\n\t\t\tjoin\t: argChk_Boolean(hArg, 'join', false),\n\t\t\t\t\t\t// æ–‡å­—ã‚’é †ç•ªã«å‡ºã™ã‹ï¼ˆtrueï¼‰åŒæ™‚ã‹ï¼ˆfalseï¼‰\n\t\t\tease\t: hArg.ease ?? 'ease-out',\n\t\t};\n\t\treturn ret;\n\t}\n\n\tstatic\treadonly\t#cntBreak\t= new Container;\n\tstatic\t\t\t\t#spsBreak\t= new SpritesMng;\n\tdispBreak(o: HArg) {\n\t\tTxtStage.delBreak();\n\n\t\tconst cnt = TxtStage.#cntBreak;\n\t\tcnt.visible = false;\n\t\tthis.addChild(cnt);\t// æ¬¡ã®csv2SpritesãŒå³çµ‚ã‚ã‚‹å ´åˆã‚‚ã‚ã‚‹ã®ã§å…ˆã«è¡Œãªã†\n\t\tTxtStage.#spsBreak.destroy();\n\t\tTxtStage.#spsBreak = new SpritesMng(o.pic, cnt, sp=> {\n\t\t\t// eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n\t\t\tif (cnt.parent) {\n\t\t\t\tsp.x = argChk_Num(o, 'x', 0);\n\t\t\t\tsp.y = argChk_Num(o, 'y', 0);\n\t\t\t\tsp.width = argChk_Num(o, 'width', this.#infTL.fontsize);\n\t\t\t\tsp.height = argChk_Num(o, 'height', this.#infTL.fontsize);\n\t\t\t}\n\t\t\telse cnt.removeChild(sp);\n\t\t});\n\t}\n\tstatic\tdelBreak() {\n\t\tconst cnt = TxtStage.#cntBreak;\n\t\t// eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n\t\tcnt.parent?.removeChild(cnt);\t// è¤‡æ•°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¦ã‚¤ãƒ³ãƒ‰ã‚¦ã‚’æƒ³å®š\n\t\tTxtStage.#spsBreak.destroy();\n\t}\n\n\t#fi_easing\t= 'Quadratic.Out';\n\t#fo_easing\t= 'Quadratic.Out';\n\t#clearText() {\n\t\tthis.#grpDbgMasume.clear();\n\t\tthis.#aRect = [];\n\t\tthis.#lenHtmTxt = 0;\n\t\tthis.#aGoTxt = [];\n\n\t\t//utils.clearTextureCache();\t// æ”¹ãƒšãƒ¼ã‚¸ã¨æ€ã‚ã‚Œã‚‹ã“ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§\n\t\tthis.skipChIn();\n\t\tconst n = <HTMLSpanElement>this.#htmTxt.cloneNode(true);\n\t\t//this.htmTxt.innerHTML = '';\t\tä»¥ä¸‹ã®æ–¹ãŒæ—©ã„ã‚‰ã—ã„\n\t\tn.textContent = '';\n\t\tconst old = this.#htmTxt;\n\t\tconst a = Array.from(<HTMLCollectionOf<HTMLElement>>old.getElementsByClassName('sn_ch'));\n\t\t// eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n\t\told.parentElement!.insertBefore(n, old);\n\n\t\tlet sum_wait = 0;\n\t\ta.forEach(elm=> {\n\t\t\t// eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n\t\t\tconst add = JSON.parse(\n\t\t\t\telm.dataset.add ??\t\t\t\t// é€šå¸¸æ–‡å­—\n\t\t\t\telm.children[0]?.getAttribute('data-add') ??\t// ãƒ«ãƒ“\n\t\t\t\telm.children[0]?.children[0]\n\t\t\t\t\t?.getAttribute('data-add') ?? '{}'\t\t// ç¸¦ä¸­æ¨ª\n\t\t\t);\n\t\t\tif (! add.ch_out_style) return;\n\n\t\t\tconst cos = TxtStage.#hChOutStyle[add.ch_out_style];\n\t\t\tif (! cos) return;\n\t\t\tif (cos.wait === 0) {elm.style.display = 'none'; return}\n\n\t\t\tsum_wait += cos.wait;\n\t\t\tif (! cos.join) elm.style.animationDelay = '0ms';\n\t\t\telm.classList.add(`go_ch_out_${String(add.ch_out_style)}`);\n\t\t});\n\n\t\tconst end = ()=> {\n\t\t\t// eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n\t\t\told.parentElement!.removeChild(old);\n\t\t\tfor (const c of this.#cntTxt.removeChildren()) {\n\t\t\t\tif (c instanceof Container) TxtStage.#evtMng.unButton(c);\n\t\t\t\tc.destroy();\n\t\t\t}\n\t\t};\n\t\tif (sum_wait === 0) {this.#htmTxt.textContent = ''; end()}\n\t\telse old.lastElementChild?.addEventListener('animationend', end, {once: true});\n\n\t\tthis.#htmTxt = n;\n\n\t\t//this.#hyph.clear();\t// ã‚¯ãƒªã‚¢ã¯ã—ãªã„\n\t}\n\treNew(): TxtStage {\n\t\tthis.#clearText();\n\n\t\tconst to = new TxtStage(this.ctn, ()=> this.canFocus(), this.sys);\n\t\tto.#infTL = this.#infTL;\n\t\tto.#htmTxt.style.cssText = this.#htmTxt.style.cssText;\n\t\tto.#left = this.#left;\n\t\tto.name = this.name;\n\t\tto.#lay_sub();\n//\t\tto.#idc.sethArg(this.#idc.gethArg());\n\n\t\tto.#ch_filter = this.#ch_filter;\n\t\tto.#fi_easing = this.#fi_easing;\n\t\tto.#fo_easing = this.#fo_easing;\n\n\t\tthis.#hyph.reNew(to.#hyph);\n\n\t\tthis.destroy();\n\n\t\treturn to;\n\t}\n\t// eslint-disable-next-line @typescript-eslint/no-explicit-any\n\t#ch_filter\t: any[] | undefined = undefined;\t// æ–‡å­—ã«ã‹ã‘ã‚‹ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼\n\n\n\trecord() {return {\n\t\tinfTL\t\t: this.#infTL,\n\n\t\tcssText\t\t: this.#htmTxt.style.cssText,\n\t\tleft\t\t: this.#left,\n//\t\tidc_hArg\t: this.#idc.gethArg(),\n\n\t\tch_filter\t: this.#ch_filter,\n\t\tfi_easing\t: this.#fi_easing,\n\t\tfo_easing\t: this.#fo_easing,\n\n\t\thyph\t\t: this.#hyph.record(),\n\t}}\n\tplayback(hLay: T_RP_layTxtStage) {\n\t\tthis.#infTL = hLay.infTL;\n\t\tthis.position.set(this.#infTL.pad_left, this.#infTL.pad_top);\n\n\t\tthis.#htmTxt.style.cssText = hLay.cssText;\n\t\tthis.#left = hLay.left;\n\t\tthis.#lay_sub();\n//\t\tthis.#idc.sethArg(hLay.idc_hArg);\n\n\t\tthis.#ch_filter\t= hLay.ch_filter;\n\t\tthis.#fi_easing\t= hLay.fi_easing;\n\t\tthis.#fo_easing\t= hLay.fo_easing;\n\n\t\tthis.#hyph.playback(hLay.hyph);\n\t}\n\n\tget cssText() {return this.#htmTxt.style.cssText}\n\tset cssText(ct: string) {this.#htmTxt.style.cssText = ct}\n\n\t#sss :Sprite | undefined = undefined;\n\tsnapshot(rnd: Renderer, re: ()=> void) {\n\t\thtm2tx(tx=> {\n\t\t\tthis.#sss = Sprite.from(tx);\t// Safariã ã‘æ–‡å­—å½±ãŒæ˜ ã‚‰ãªã„\n\t\t\tif (this.#isTategaki) {\n\t\t\t\tthis.#sss.x += CmnLib.stageW -(this.#left +this.#infTL.$width)\n\t\t\t\t//- ((CmnLib.isSafari && !CmnLib.isMobile)\t// ç„¡åŠ¹åŒ– 2022/02/09\n\t\t\t\t//\t? 0\n\t\t\t\t//\t: this.#infTL.pad_left +this.#infTL.pad_right);\n\t\t\t}\n\t\t\tthis.#sss.y -= this.#padTx4y;\n\t\t\tthis.#sss.texture.frame = new Rectangle(\n\t\t\t\t0,\n\t\t\t\t0,\n\t\t\t\tMath.min(this.#sss.width, this.#infTL.$width -this.#left),\n\t\t\t\tMath.min(this.#sss.height, this.#infTL.$height),\n\t\t\t);\t// ã“ã‚ŒãŒãªã„ã¨ç”»é¢ã‚µã‚¤ã‚ºã‚’è¶…ãˆã‚‹\n\t\t\tthis.#cntTxt.addChild(this.#sss);\n\t\t\trnd.render(this.#sss, {clear: false});\n\t\t\tre();\n\t\t}, this.#htmTxt, this.#infTL, this.#padTx4x, this.#padTx4y, false);\n\t}\n\tsnapshot_end() {\n\t\tif (! this.#sss) return;\n\t\tthis.#cntTxt.removeChild(this.#sss);\n\t\tthis.#sss = undefined;\n\t}\n\n\tmakeDesignCast(_gdc: IMakeDesignCast) {\n//\tmakeDesignCast(gdc: IMakeDesignCast) {\n//\t\tgdc(this.#idc);\n\n//\t\tconst o = this.#idc.gethArg();\n//\t\tthis.#idcCh.sethArg({...o, ':id_dc': o[':id_tag'] +'_pad'});\n//\t\tgdc(this.#idcCh);\n\t}\n\tshowDesignCast() { /* empty */ }\n//\tshowDesignCast() {this.#idc.visible = true; this.#idcCh.visible = true}\n\n\tdump(): string {\n\t\tconst aStyle: string[] = [];\n\t\tconst s = this.#htmTxt.style;\n\t\tconst len = s.length;\n\t\tfor (let i=0; i<len; ++i) {\n\t\t\t// eslint-disable-next-line @typescript-eslint/no-explicit-any\n\t\t\tconst key: any = s[i];\n\t\t\t// eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n\t\t\taStyle.push(`\"${String(key)}\":\"${s[key]!.replaceAll(/([\"\\\\])/g, '\\\\$1')}\"`);\n\t\t}\n\t\t// eslint-disable-next-line @typescript-eslint/no-unnecessary-type-assertion, @typescript-eslint/no-non-null-assertion\n\t\treturn `\"txt\":\"${this.#htmTxt.textContent!.replaceAll(/([\"\\\\])/g, '\\\\$1')\n\t\t}\", \"style\":{${aStyle.join(',')}}`;\n\t\t\t// 4Debugã€‚++ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã—ã€dumpè¡¨ç¤ºã•ã›ã¦ã‚‚è‰¯ã•ã’\n\t}\n\n\toverride destroy() {\n\t\tTxtStage.delBreak();\n\n\t\t// eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n\t\tthis.#htmTxt.parentElement!.removeChild(this.#htmTxt);\n\t\tthis.removeChild(this.#cntTxt);\n\t\tthis.removeChild(this.#grpDbgMasume);\n\t\tsuper.destroy();\n\t}\n}\n","/* ***** BEGIN LICENSE BLOCK *****\n\tCopyright (c) 2018-2025 Famibee (famibee.blog38.fc2.com)\n\n\tThis software is released under the MIT License.\n\thttp://opensource.org/licenses/mit-license.php\n** ***** END LICENSE BLOCK ***** */\n\nimport {uint, type IEvtMng, argChk_Boolean, argChk_Num, mesErrJSON} from './CmnLib';\nimport type {HArg} from './Grammar';\nimport {SpritesMng} from './SpritesMng';\nimport {Layer} from './Layer';\nimport type {Config} from './Config';\nimport type {IMakeDesignCast} from './LayerMng';\n//import {DesignCast, TxtBtnDesignCast, PicBtnDesignCast} from './DesignCast';\n\nimport {Container, Text, Rectangle, Texture, TextStyle, type Sprite, Graphics} from 'pixi.js';\n\n\nexport class Button extends Container {\n\tstatic\tfontFamily\t= '\\'Hiragino Sans\\', \\'Hiragino Kaku Gothic ProN\\', \\'æ¸¸ã‚´ã‚·ãƒƒã‚¯ Medium\\', meiryo, sans-serif';\n\tstatic\t#procMasume4txt = (_me: Button, _txt: Text)=> { /* empty */ };\n\tstatic\t#procMasume4pic = (_me: Button, _sp: Sprite, _w3: number, _h: number)=> { /* empty */ };\n\tstatic\tinit(cfg: Config) {\n\t\tif (! cfg.oCfg.debug.masume) return;\n\n\t\tButton.#procMasume4txt = (me, txt)=> me.addChild(\n\t\t\t(new Graphics)\n\t\t\t.beginFill(0x883388, 0.2)\n\t\t\t.lineStyle(1, 0x883388, 1)\n\t\t\t.drawRect(txt.x, txt.y, txt.width, txt.height)\n\t\t\t.endFill()\n\t\t);\n\t\tButton.#procMasume4pic = (me, sp, w3, h)=> me.addChild(\n\t\t\t(new Graphics)\n\t\t\t.beginFill(0x883388, 0.2)\n\t\t\t.lineStyle(1, 0x883388, 1)\n\t\t\t.drawRect(sp.x, sp.y, w3, h)\n\t\t\t.endFill()\n\t\t);\n\t}\n\n\tsetText(_text: string) { /* empty */ }\n\tgetBtnBounds = ()=> this.#rctBtnTxt;\n\t\t// æ–‡å­—ãƒœã‚¿ãƒ³ã¯èƒŒæ™¯ç”»åƒã‚’å«ã¾ãªã„ä½ç½®æŒ‡å®šãªã®ã§ã€ãã®å½“ãŸã‚Šåˆ¤å®šç”¨\n\t#rctBtnTxt\t= new Rectangle;\n\n\t#sps\t\t= new SpritesMng;\n\n//\t#idc\t\t: DesignCast;\n\treadonly\t#o\t: {\n\t\ttype\t: 'pic'|'text';\n\t\tenabled\t: boolean;\n\t\tx\t\t: number;\n\t\ty\t\t: number;\n\t\trotation: number;\n\t\t\t// flash : rotation is in degrees.\n\t\t\t// pixijs: rotation is in radians, angle is in degrees.\n\t\tpivot_x\t: number;\n\t\tpivot_y\t: number;\n\t\tscale_x\t: number;\n\t\tscale_y\t: number;\n\t\talpha\t: number;\n\t\ttext\t: string;\n\t\tb_pic\t: string;\n\t\twidth\t: number;\n\t\theight\t: number;\n\t};\n\n\tconstructor(private readonly hArg: HArg, readonly evtMng: IEvtMng, readonly resolve: ()=> void, private readonly canFocus: ()=> boolean) {\n\t\tsuper();\n/*\n\t\tif (CmnLib.isDbg) {\n\t\t\tthis.makeDesignCast = gdc=> gdc(this.#idc);\n\t\t\tthis.cvsResize = ()=> this.#idc.cvsResize();\n\t\t}\n*/\n\t\tthis.#o = {\n\t\t\ttype\t: 'pic',\n\t\t\tenabled\t: argChk_Boolean(hArg, 'enabled', true),\n\t\t\tx\t\t: this.x = uint(hArg.left ?? 0),\n\t\t\ty\t\t: this.y = uint(hArg.top ?? 0),\n\t\t\trotation: this.angle = argChk_Num(hArg, 'rotation', this.angle),\n\t\t\t\t// flash : rotation is in degrees.\n\t\t\t\t// pixijs: rotation is in radians, angle is in degrees.\n\t\t\tpivot_x\t: this.pivot.x = argChk_Num(hArg, 'pivot_x', this.pivot.x),\n\t\t\tpivot_y\t: this.pivot.y = argChk_Num(hArg, 'pivot_y', this.pivot.y),\n\t\t\tscale_x\t: this.scale.x = argChk_Num(hArg, 'scale_x', this.scale.x),\n\t\t\tscale_y\t: this.scale.y = argChk_Num(hArg, 'scale_y', this.scale.y),\n\t\t\talpha\t: 1,\n\t\t\ttext\t: '',\n\t\t\tb_pic\t: '',\n\t\t\twidth\t: 0,\n\t\t\theight\t: 0,\n\t\t};\n\t\tthis.getBtnBounds = ()=> {\n\t\t\tthis.#rctBtnTxt.x = this.#o.x;\n\t\t\tthis.#rctBtnTxt.y = this.#o.y;\n\t\t\treturn this.#rctBtnTxt;\n\t\t};\n\n\t\tif (this.#o.enabled) evtMng.button(hArg, this, ()=> this.normal(), ()=> this.#hover(), ()=> this.#clicked());\t// ã‚ã¨ã§å·®ã—æ›¿ãˆã‚‹ã®ã§ã‚¢ãƒ­ãƒ¼å¿…é ˆ\n\n\t\t// == ç”»åƒã‹ã‚‰ç”Ÿæˆ\n\t\tif (hArg.pic) {\n\t\t\tthis.#o.type = 'pic';\t// dumpç”¨\n\t\t\t// this.#idc = new PicBtnDesignCast(this, hArg);\n\n\t\t\tthis.#sps = new SpritesMng(\n\t\t\t\thArg.pic,\n\t\t\t\tthis,\n\t\t\t\tsp=> {\n\t\t\t\t\tthis.#loaded_pic(sp);\n\t\t\t\t\tthis.#rctBtnTxt.width  = sp.width  * this.#o.scale_x;\n\t\t\t\t\tthis.#rctBtnTxt.height = sp.height * this.#o.scale_y;\n\t\t\t\t},\n\t\t\t\t_isStop=> resolve(),\n\t\t\t);\n\t\t\treturn;\n\t\t}\n\t\tif (! hArg.text) throw 'textã¾ãŸã¯picå±æ€§ã¯å¿…é ˆã§ã™';\n\n\t\t// == æ–‡å­—åˆ—ã‹ã‚‰ç”Ÿæˆ\n\t\tconst height = argChk_Num(hArg, 'height', 30);\n\t\tconst style = new TextStyle({\n\t\t\talign\t\t: 'center',\n\t\t\tdropShadow\t: true,\n\t\t\tdropShadowAlpha\t: 0.7,\n\t\t\tdropShadowColor\t: 'white',\n\t\t\tdropShadowBlur\t: 7,\n\t\t\tdropShadowDistance\t: 0,\n\t\t\tfill\t\t: this.#o.enabled ?'black' :'gray',\n\t\t\tfontFamily\t: Button.fontFamily,\n\t\t\tfontSize\t: height,\n\t\t\tpadding\t\t: 5,\n\t\t});\n\t\tif (hArg.style) try {\n\t\t\t// eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n\t\t\tconst o = JSON.parse(hArg.style);\n\t\t\t// eslint-disable-next-line @typescript-eslint/no-explicit-any, @typescript-eslint/no-unsafe-argument, @typescript-eslint/no-unsafe-member-access\n\t\t\tfor (const [nm, v] of Object.entries(o)) (<any>style)[nm] = v;\n\t\t//\tstyle = {...style, ...JSON.parse(hArg.style)};\t// ä¸Šæ‰‹ãã„ã‹ãªã„\n\n\t\t\t// eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n\t\t\tthis.#o = {...this.#o, ...o};\n\t\t} catch (e) {\n\t\t\tif (e instanceof SyntaxError) throw new Error(mesErrJSON(hArg, 'style', e.message));\n\t\t\telse throw 'fn:Button.ts style';\n\t\t}\n\n\t\tconst txt = new Text(hArg.text ?? '', style);\n\t\ttxt.alpha = argChk_Num(hArg, 'alpha', txt.alpha);\t// ä¸Šã«ã¾ã¨ã‚ãªã„\n\t\ttxt.width = argChk_Num(hArg, 'width', 100);\n\t\ttxt.height = hArg.height = height;\n\t\tthis.setText = text=> {txt.text = text};\n\n\t\tthis.#o = {...this.#o,\n\t\t\ttype\t: 'text',\t// dumpç”¨\n\t\t\talpha\t: txt.alpha,\n\t\t\ttext\t: txt.text,\n\t\t\twidth\t: txt.width,\n\t\t\theight\t: txt.height,\n\t\t};\n//\t\tthis.#idc = new TxtBtnDesignCast(this, hArg, txt);\n\n\t\tlet isStop = false;\n\t\tthis.#o.width = this.width;\n\t\tthis.#o.height = this.height;\n\t\tif (hArg.b_pic) {\n\t\t\tthis.#o.b_pic = hArg.b_pic;\n\t\t\tthis.#sps = new SpritesMng(\n\t\t\t\thArg.b_pic,\n\t\t\t\tthis,\n\t\t\t\tsp=> {\n\t\t\t\t\tthis.#loaded_b_pic(sp, txt);\n\t\t\t\t\tthis.#o.width = this.width;\n\t\t\t\t\tthis.#o.height = this.height;\n\t\t\t\t\ttxt.name = JSON.stringify(this.#o);\n\t\t\t\t},\n\t\t\t\tisStop=> {\n\t\t\t\t\tLayer.setBlendmode(this, hArg);\n\t\t\t\t\tif (isStop) resolve();\n\t\t\t\t},\n\t\t\t);\n\t\t\tisStop = this.#sps.ret;\n\t\t}\n\t\ttxt.name = JSON.stringify(this.#o);\n\n\t\tthis.addChild(txt);\n\t\tthis.#rctBtnTxt.width = txt.width;\t// addChild()å¾Œã«å–å¾—ã™ã‚‹ã“ã¨\n\t\tthis.#rctBtnTxt.height = txt.height;\n\t//x\tthis.#rctBtnTxt = txt.getBounds();\t// ä¸Šæ‰‹ãã„ã‹ãªã„\n\n\t\tif (! hArg.b_pic) Layer.setBlendmode(this, hArg);\t// é‡ãªã‚Šé †ã§ã“ã“\n\t\tButton.#procMasume4txt(this, txt);\n\t\tif (! this.#o.enabled) {if (! isStop) resolve(); return}\n\n\t\tconst style_hover = style.clone();\n\t\tif (hArg.style_hover) try {\n\t\t\t// eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n\t\t\tconst o = JSON.parse(hArg.style_hover);\n\t\t\t// eslint-disable-next-line @typescript-eslint/no-unsafe-argument, @typescript-eslint/no-explicit-any, @typescript-eslint/no-unsafe-member-access\n\t\t\tfor (const [nm, v] of Object.entries(o)) (<any>style_hover)[nm] = v;\n\t\t} catch (e) {\n\t\t\tif (e instanceof SyntaxError) throw new Error(mesErrJSON(hArg, 'style_hover', e.message));\n\t\t\telse throw 'fn:Button.ts style_hover';\n\t\t}\n\t\telse style_hover.fill = 'white';\n\n\t\tconst style_clicked = style_hover.clone();\n\t\tif (hArg.style_clicked) try {\n\t\t\t// eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n\t\t\tconst o = JSON.parse(hArg.style_clicked);\n\t\t\t// eslint-disable-next-line @typescript-eslint/no-unsafe-argument, @typescript-eslint/no-explicit-any, @typescript-eslint/no-unsafe-member-access\n\t\t\tfor (const [nm, v] of Object.entries(o)) (<any>style_clicked)[nm] = v;\n\t\t} catch (e) {\n\t\t\tif (e instanceof SyntaxError) throw new Error(mesErrJSON(hArg, 'style_clicked', e.message));\n\t\t\telse throw 'fn:Button.ts style_clicked';\n\t\t}\n\t\telse style_clicked.dropShadow = false;\n\n\t\tthis.normal = ()=> {txt.style = style};\n\t\tthis.#hover = ()=> {\n\t\t\tif (! canFocus()) return false;\n\t\t\ttxt.style = style_hover;\n\t\t\treturn true;\n\t\t};\n\t\tthis.#clicked = ()=> {txt.style = style_clicked};\n\n\t\tif (! isStop) resolve();\n\t}\n\n\toverride\tdestroy(): void {\n\t\tthis.evtMng.unButton(this);\n\t\tthis.#sps.destroy();\n\t\tsuper.destroy();\n\t}\n\n\tmakeDesignCast(_gdc: IMakeDesignCast) { /* empty */ }\n\tshowDesignCast() { /* empty */ }\n//\tshowDesignCast() {this.#idc.visible = true}\n\tcvsResize() { /* empty */ }\n\n\t#loaded_b_pic(sp: Sprite, txt: Text) {\n\t\tthis.setChildIndex(sp, 0);\n\t\tsp.alpha = txt.alpha;\n\t\tsp.setTransform(\n\t\t\ttxt.x, txt.y,\n\t\t\t1, 1, txt.rotation, 0, 0,\n\t\t\t(sp.width -txt.width) /2,\n\t\t\t(sp.height -txt.height) /2,\n\t\t);\n\n\t\tsp.name = txt.name;\n\t}\n\n\tnormal\t\t: ()=> void\t\t= ()=> { /* empty */ };\n\t#hover\t\t: ()=> boolean\t= ()=> false;\n\t#clicked\t: ()=> void\t\t= ()=> { /* empty */ };\n\t#loaded_pic(sp: Sprite) {\n\t\tthis.#o.alpha = sp.alpha = argChk_Num(this.hArg, 'alpha', sp.alpha);\n//\t\t(this.#idc as PicBtnDesignCast).setSp(sp);\n\n\t\tconst w_3 = sp.width /3;\n\t\tconst w = this.#o.enabled ?w_3 :sp.width;\n\t\tconst h = sp.height;\n\t\tconst tx = sp.texture.baseTexture;\n\t\tconst txNormal = new Texture(tx, new Rectangle(0, 0, w_3, h));\n\t\tconst txClicked = new Texture(tx, new Rectangle(w_3, 0, w_3, h));\n\t\tconst txHover = new Texture(tx, new Rectangle(w_3 *2, 0, w_3, h));\n\t\tconst normal = ()=> {sp.texture = txNormal};\n\t\tif (this.#o.enabled) normal();\n\n\t\tthis.normal\t= normal;\n\t\tthis.#hover\t\t= ()=> {\n\t\t\tif (! this.canFocus()) return false;\n\t\t\tsp.texture = txHover;\n\t\t\treturn true;\n\t\t};\n\t\tthis.#clicked\t= ()=> {sp.texture = txClicked};\n\n\t\tif ('width' in this.hArg) {\n\t\t\tthis.#o.width = uint(this.hArg.width);\n\t\t\tthis.scale.x *= this.#o.width /w;\n\t\t}\n\t\telse this.#o.width = w;\n\t\tif ('height' in this.hArg) {\n\t\t\tthis.#o.height = uint(this.hArg.height);\n\t\t\tthis.scale.y *= this.#o.height /h;\n\t\t}\n\t\telse this.#o.height = h;\n\t\tsp.name = JSON.stringify(this.#o);\t// dumpç”¨\n\n\t\tButton.#procMasume4pic(this, sp, w, h);\n\t}\n\n}\n","/* eslint-disable @typescript-eslint/no-unsafe-member-access */\n/* eslint-disable @typescript-eslint/restrict-template-expressions */\n/* ***** BEGIN LICENSE BLOCK *****\n\tCopyright (c) 2018-2025 Famibee (famibee.blog38.fc2.com)\n\n\tThis software is released under the MIT License.\n\thttp://opensource.org/licenses/mit-license.php\n** ***** END LICENSE BLOCK ***** */\n\nimport {Layer, type T_RecordPlayBack_lay} from './Layer';\nimport {uint, CmnLib, type IEvtMng, argChk_Boolean, argChk_Num, initStyle, addStyle, argChk_Color} from './CmnLib';\nimport type {IHTag, HArg} from './Grammar';\nimport type {IVariable, IPutCh} from './CmnInterface';\nimport {type T_RP_layTxtStage, TxtStage} from './TxtStage';\nimport type {Config} from './Config';\nimport {RubySpliter} from './RubySpliter';\nimport {SpritesMng} from './SpritesMng';\nimport {Button} from './Button';\nimport {LayerMng, type IMakeDesignCast} from './LayerMng';\nimport type {SysBase} from './SysBase';\nimport {DebugMng} from './DebugMng';\nimport {SEARCH_PATH_ARG_EXT} from './ConfigBase';\nimport {Reading} from './Reading';\nimport type {ScriptIterator} from './ScriptIterator';\nimport type {T_LOG} from './Log';\n\nimport {Sprite, DisplayObject, Graphics, Container, Renderer, Application} from 'pixi.js';\n\n\nexport type T_RP_layTxt = T_RecordPlayBack_lay & {\n\tenabled\t\t: boolean;\n\tr_cssText\t: string;\n\tr_align\t\t: string;\n\ttxs\t\t\t: T_RP_layTxtStage;\n\tb_alpha\t\t: number;\n\tb_alpha_isfixed\t: boolean;\n\tb_do\t\t: string;\n\tb_pic\t\t: string;\n\tb_color\t\t: string;\n\tbtns\t\t: string[];\n}\n\nexport type T_cmdTxt_JSON = {\n\tid?\t\t\t: string;\n\n\t':link'?\t: string;\n\ttext?\t\t: string;\t// 4 ch\n\twait?\t\t: string;\t// 4 ch\n\t\t// JSON.stringify ã¯æ•°å­—ã§ã‚‚æ–‡å­—ã«ã™ã‚‹ï¼ˆHArg ã¨ç›¸é•ï¼‰\n\trecord?\t\t: boolean;\t// 4 ch\n\n\tpic?\t\t: string;\t// 4 graph\n\n\tfn?\t\t\t: string;\t// 4 link\n\tlabel?\t\t: string;\t// 4 link\n\turl?\t\t: string;\t// 4 link\n\n\tstyle?\t\t: string;\t// 4 tcy, link\n\tr_style?\t: string;\n\tstyle_hover\t\t: string;\t// 4 link\n\tstyle_clicked\t: string;\t// 4 link\n\tr_align?\t: string;\t// 4 pushSpan(), mergePushSpan()\n\n\tt?\t: string;\t// 4 tcy\n\tr?\t: string;\t// 4 tcy\n\n\tin_style?\t: string;\t// 4 set_ch_in\n\tout_style?\t: string;\t// 4 set_ch_out\n\n\n\tdelay?\t: number;\t// JSON å—ã‘æ¸¡ã—å¾Œãªã®ã§ number ã§ã‚‚ã„ã„\n}\n\n\nexport class TxtLayer extends Layer {\n\tstatic\t#cfg\t\t: Config;\n\tstatic\t#val\t\t: IVariable;\n\tstatic\t#isPageFore\t: (me: TxtLayer)=> boolean;\n\tstatic\t#log\t\t: T_LOG;\n\tstatic\tinit(cfg: Config, hTag: IHTag, val: IVariable, log: T_LOG, isPageFore: (me: TxtLayer)=> boolean, appPixi: Application): void {\n\t\tthis.#cfg = cfg;\n\t\tTxtStage.init(cfg, appPixi);\n\t\tthis.#val = val;\n\t\tthis.#log = log;\n\t\tthis.#isPageFore = isPageFore;\n\n\t\tval.setDoRecProc(doRec=> this.chgDoRec(doRec));\n\n\t\thTag.autowc\t\t\t= o=> this.#autowc(o);\t// æ–‡å­—ã‚’è¿½åŠ ã™ã‚‹\n\t\thTag.autowc({enabled: false, text: '', time: 0});\n\t\thTag.ch_in_style\t= o=> this.#ch_in_style(o);\t// æ–‡å­—å‡ºç¾æ¼”å‡º\n\t\thTag.ch_out_style\t= o=> this.#ch_out_style(o);\t// æ–‡å­—æ¶ˆå»æ¼”å‡º\n\n\t\t// ã‚®ãƒ£ãƒ©ãƒªãƒ¼ãƒªãƒ­ãƒ¼ãƒ‰ç”¨åˆæœŸåŒ–\n\t\tTxtStage.initChStyle();\n\t\tinitStyle();\n\n\t\taddStyle(\n\t\t\tcfg.matchPath('.+', SEARCH_PATH_ARG_EXT.FONT)\n\t\t\t.flatMap(o=> Object.values(o).map(v=> `\n@font-face {\n\tfont-family: '${v}';\n\tsrc: url('${this.#cfg.searchPath(String(v), SEARCH_PATH_ARG_EXT.FONT)}');\n}\n`)).join('')\n\n\t\t\t// æ–‡å­—å‡ºç¾æ¼”å‡ºé–¢ä¿‚\n\t\t\t+`\n.sn_tx {\n\tpointer-events: none;\n\tuser-select: none;\n\t-webkit-touch-callout: none;\n\tbox-sizing: border-box;\n}\n.sn_ch {\n\tposition: relative;\n\tdisplay: inline-block;\n}\n`\t// ã€Œsn_chã€ã¨ã€Œsn_ch_in_ã€œã€ã®ä¸­èº«ãŒé‡è¤‡ã—ã¦ã„ã‚‹ãŒã€ã“ã‚Œã¯å¿…é ˆ\n\t\t);\n\n\t\tthis.#ch_in_style({\n\t\t\tname\t: 'default',\n\t\t\twait\t: 500,\n\t\t\talpha\t: 0,\n\t\t\tx\t\t: '=0.3',\n\t\t\ty\t\t: '=0',\n\t\t\tscale_x\t: 1,\n\t\t\tscale_y\t: 1,\n\t\t\trotate\t: 0,\n\t\t\tjoin\t: true,\n\t\t\tease\t: 'ease-out',\n\t\t});\n\t\tthis.#ch_out_style({\n\t\t\tname\t: 'default',\n\t\t\twait\t: 0,\n\t\t\talpha\t: 0,\n\t\t\tx\t\t: '=0',\n\t\t\ty\t\t: '=0',\n\t\t\tscale_x\t: 1,\n\t\t\tscale_y\t: 1,\n\t\t\trotate\t: 0,\n\t\t\tjoin\t: false,\n\t\t\tease\t: 'ease-out',\n\t\t});\n\t}\n\n\t// æ–‡å­—å‡ºç¾æ¼”å‡º\n\tstatic\t#ch_in_style(hArg: HArg) {\n\t\tconst o = TxtStage.ch_in_style(hArg);\n\t\tconst x = o.x.startsWith('=') ?`${o.nx *100}%` :`${o.nx}px`;\n\t\tconst y = o.y.startsWith('=') ?`${o.ny *100}%` :`${o.ny}px`;\n\t\tconst {name} = hArg;\n\t\taddStyle(`\n.sn_ch_in_${name} {\n\tposition: relative;\n\tdisplay: inline-block;\n}\n.go_ch_in_${name} {\n\topacity: ${o.alpha};\n\tposition: relative;\n\tdisplay: inline-block;\n\tanimation: sn_ch_in_${name} ${o.wait}ms ${o.ease} 0s both;\n}\n@keyframes sn_ch_in_${name} {\n\tfrom {transform: rotate(${o.rotate}deg) scale(${o.scale_x}, ${o.scale_y}) translate(${x}, ${y})}\n\tto {opacity: 1; transform: none;}\n}\n`);\n\n\t\treturn false;\n\t}\n\t// æ–‡å­—æ¶ˆå»æ¼”å‡º\n\tstatic\t#ch_out_style(hArg: HArg) {\n\t\tconst o = TxtStage.ch_out_style(hArg);\n\t\tconst x = o.x.startsWith('=') ?`${o.nx *100}%` :`${o.nx}px`;\n\t\tconst y = o.y.startsWith('=') ?`${o.ny *100}%` :`${o.ny}px`;\n\t\tconst {name} = hArg;\n\t\taddStyle(`\n.go_ch_out_${name} {\n\tposition: relative;\n\tdisplay: inline-block;\n\tanimation: go_ch_out_${name} ${o.wait}ms ${o.ease} 0s both;\n}\n@keyframes go_ch_out_${name} {\n\tto {\n\t\topacity: ${o.alpha};\n\t\ttransform: rotate(${o.rotate}deg) scale(${o.scale_x}, ${o.scale_y}) translate(${x}, ${y});\n\t}\n`);\n\n\t\treturn false;\n\t}\n\n\n\tstatic\t#evtMng\t: IEvtMng;\n\tstatic\t#sys\t: SysBase;\n\tstatic setEvtMng(evtMng: IEvtMng, sys: SysBase, scrItr: ScriptIterator) {\n\t\tthis.#evtMng = evtMng;\n\t\tthis.#sys = sys;\n\t\tTxtStage.setEvtMng(evtMng, scrItr);\n\t}\n\n\t// æ–‡å­—ã”ã¨ã®ã‚¦ã‚§ã‚¤ãƒˆ\n\tstatic #doAutoWc\t= false;\n\tstatic #hAutoWc\t: {[ch: string]: number}\t= {};\n\tstatic #autowc(hArg: HArg) {\n\t\tthis.#doAutoWc = argChk_Boolean(hArg, 'enabled', this.#doAutoWc);\n\t\tthis.#val.setVal_Nochk('save', 'const.sn.autowc.enabled', this.#doAutoWc);\n\n\t\tconst {text} = hArg;\n\t\tif ('text' in hArg !== 'time' in hArg) throw '[autowc] textã¨timeã¯åŒæ™‚æŒ‡å®šå¿…é ˆã§ã™';\n\t\tthis.#val.setVal_Nochk('save', 'const.sn.autowc.text', text);\n\t\tif (! text) {\n\t\t\tthis.#val.setVal_Nochk('save', 'const.sn.autowc.time', '');\n\t\t\treturn false;\n\t\t}\n\n\t\tconst len = text.length;\n\t\tif (this.#doAutoWc && len === 0) throw '[autowc] enabled === false ã‹ã¤ text === \"\" ã¯è¨±ã•ã‚Œã¾ã›ã‚“';\n\n\t\tconst a = String(hArg.time).split(',');\n\t\tif (a.length !== len) throw '[autowc] textæ–‡å­—æ•°ã¨timeã«è¨˜è¿°ã•ã‚ŒãŸå¾…ã¡æ™‚é–“ï¼ˆã‚³ãƒ³ãƒåŒºåˆ‡ã‚Šï¼‰ã¯åŒæ•°ã«ã—ã¦ä¸‹ã•ã„';\n\t\tthis.#hAutoWc = {};\t// æ¯å›ã‚¯ãƒªã‚¢ã‚’ä»•æ§˜ã¨ã™ã‚‹\n\t\t// eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n\t\tfor (let i=0; i<len; ++i) this.#hAutoWc[text[i]!] = uint(a[i]);\n\t\tthis.#val.setVal_Nochk('save', 'const.sn.autowc.time', hArg.time);\n\n\t\treturn false;\n\t}\n\n\n\t// ãƒãƒƒã‚¯\n\t#b_color\t\t\t= 0x000000;\n\t#b_alpha\t\t\t= 0;\n\t#b_alpha_isfixed\t= false;\n\t#b_do\t\t\t: DisplayObject | undefined\t= undefined;\n\t#b_pic\t\t\t= '';\t// èƒŒæ™¯ç”»åƒç„¡ã—ï¼ˆï¼å˜è‰²å¡—ã‚Šï¼‰\n\n\t// æ–‡å­—è¡¨ç¤º\n\t#txs\t= new TxtStage(this.ctn, ()=> this.canFocus(), TxtLayer.#sys);\n\n\treadonly\t#rbSpl\t= new RubySpliter;\n\treadonly\t#htmRb\t= document.createElement('span');// cssãƒã‚§ãƒƒã‚¯ãƒ»ä¿å­˜ç”¨\n\tstatic\treadonly\t#hWarnR_Style = {\n\t\t'text-align'\t\t: 0,\n\t\t'text-align-last'\t: 0,\n\t\t'height'\t: 0,\n\t\t'width'\t\t: 0,\n\t\t'padding-left'\t\t: 0,\n\t\t'padding-right'\t\t: 0,\n\t\t'padding-top'\t\t: 0,\n\t\t'padding-bottom'\t: 0,\n\t};\n\n\treadonly\t#cntBtn\t= new Container<Button>;\n\n\tconstructor() {\n\t\tsuper();\n\n\t\tthis.ctn.addChild(this.#txs);\n\n\t\tthis.#rbSpl.init(this.#putCh);\n\n\t\tthis.ctn.addChild(this.#cntBtn);\t// ãƒœã‚¿ãƒ³ã¯paddingã®å½±éŸ¿ã‚’å—ã‘ãªã„\n\t\tthis.#cntBtn.name = 'cntBtn';\n\n\t\tconst padding = 16;\t// åˆæœŸpadding\n\t\tthis.lay({style: `width: ${CmnLib.stageW}px; height: ${CmnLib.stageH}px; font-family: 'Hiragino Sans', 'Hiragino Kaku Gothic ProN', 'æ¸¸ã‚´ã‚·ãƒƒã‚¯ Medium', meiryo, sans-serif; color: white; font-size: 24px; line-height: 1.5; padding: ${padding}px;`, in_style: 'default', out_style: 'default', back_clear: 'true'});\n\t}\n\toverride destroy() {\n\t\tif (this.#b_do) {this.ctn.removeChild(this.#b_do).destroy(); this.#b_do = undefined}\n\n\t\tTxtLayer.#log.pagebreak();\n\t\tthis.#txs.destroy();\n\t}\n\tstatic\tdestroy() {\n\t\tthis.#doAutoWc = false;\n\t\tthis.#hAutoWc = {};\n\n\t\tthis.#rec = tx=> tx;\n\t}\n\toverride set name(nm: string) {this.name_ = nm; this.#txs.name = nm}\n\toverride get name() {return this.name_}\t// getã¯ç¶™æ‰¿ã—ãªã„ã‚‰ã—ã„\n\n\n\toverride cvsResize() {this.#txs.cvsResize()}\n\toverride cvsResizeChildren() {\n\t\tfor (const b of this.#cntBtn.children) b.cvsResize();\n\t}\n\n\tprotected\toverride\tprocSetX(x: number) {this.#txs.lay({x})}\n\tprotected\toverride\tprocSetY(y: number) {this.#txs.lay({y})}\n\n\toverride lay(hArg: HArg) {\n\t\tsuper.lay(hArg);\n\t\tLayer.setXY(this.ctn, hArg, this.ctn);\n\n\t\thArg[':id_tag'] = this.name_.slice(0, -7);\t// Designç”¨\n\t\tRubySpliter.setting(hArg);\n\t\tthis.#setFfs(hArg);\n\t\tthis.#txs.lay(hArg);\n\n\t\tif ('r_align' in hArg) this.#r_align = hArg.r_align ?? '';\n\t\tthis.#ruby_pd = CmnLib.isSafari\n\t\t? this.#txs.tategaki\t\t// Safariã§ã¯è¦ªæ–‡å­—å¹… l ã¯ç–‘ä¼¼å€¤\n\t\t\t? (v, l)=> `text-align: start; height: ${l}em; padding-top: ${v}; padding-bottom: ${v};`\n\t\t\t: (v, l)=> `text-align: start; width: ${l}em; padding-left: ${v}; padding-right: ${v};`\n\t\t: this.#txs.tategaki\n\t\t\t? v=> `text-align: justify; text-align-last: justify; padding-top: ${v}; padding-bottom: ${v};`\n\t\t\t: v=> `text-align: justify; text-align-last: justify; padding-left: ${v}; padding-right: ${v};`;\n\t\t// eslint-disable-next-line @typescript-eslint/unbound-method\n\t\tif (CmnLib.isFirefox) this.#mkStyle_r_align = this.#mkStyle_r_align4ff;\n\n\t\tif ('r_style' in hArg) {\n\t\t\tif (hArg.r_style) {\n\t\t\t\tconst cln = document.createElement('span');\n\t\t\t\tcln.style.cssText = hArg.r_style;\n\t\t\t\tconst len = cln.style.length;\n\t\t\t\tconst s = this.#htmRb.style;\n\t\t\t\tfor (let i=0; i<len; ++i) {\n\t\t\t\t\t// eslint-disable-next-line @typescript-eslint/no-explicit-any, @typescript-eslint/no-unsafe-assignment\n\t\t\t\t\tconst key = <any>cln.style[i];\n\t\t\t\t\tif (key in TxtLayer.#hWarnR_Style) {\n\t\t\t\t\t\tDebugMng.myTrace(`${key}ã¯æŒ‡å®šã§ãã¾ã›ã‚“`, 'W');\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tconst v = cln.style[key];\n\t\t\t\t\tif (v) s[key] = v;\n\t\t\t\t}\n\t//\t\t\tif ((! cln.style.opacity) && ('alpha' in hArg)) s.opacity = String(this.spLay.alpha);\n\t\t\t}\n\t\t\telse this.#htmRb.style.cssText = '';\n\t\t}\n\n\t\tif ('alpha' in hArg) for (const b of this.#cntBtn.children) b.alpha = this.ctn.alpha;\n\n\t\tthis.#set_ch_in(hArg);\n\t\tthis.#set_ch_out(hArg);\n\n\t\tconst RPN_TXT_LAY = Reading.procID +`TxtLayer lay name:${this.name_}`;\n\t\tconst ret = this.#drawBack(hArg, isStop=> {\n\t\t\tif (isStop) Reading.endProc(RPN_TXT_LAY);\n\t\t});\n\t\tif (ret) Reading.beginProc(RPN_TXT_LAY);\n\t\treturn ret;\n\t}\n\t#set_ch_in(hArg: T_cmdTxt_JSON | HArg) {\n\t\tconst {in_style} = hArg;\n\t\tif (! in_style) return;\n\t\tconst cis = TxtStage.getChInStyle(in_style);\n\t\tif (! cis) throw `å­˜åœ¨ã—ãªã„in_styleã€${in_style}ã€‘ã§ã™`;\n\t\tthis.#$ch_in_style = in_style;\n\t\tthis.#ch_in_join = cis.join;\n\t}\n\t#$ch_in_style\t= '';\n\t#ch_in_join\t\t= true;\n\n\toverride get\twidth() {return this.#txs.getWidth}\n\toverride get\theight() {return this.#txs.getHeight}\n\n\t#set_ch_out(hArg: T_cmdTxt_JSON | HArg) {\n\t\tconst {out_style} = hArg;\n\t\tif (! out_style) return;\n\t\tconst cos = TxtStage.getChOutStyle(out_style);\n\t\tif (! cos) throw `å­˜åœ¨ã—ãªã„out_styleã€${out_style}ã€‘ã§ã™`;\n\t\tthis.#$ch_out_style = out_style;\n\t}\n\t#$ch_out_style\t= '';\n\n\t#sps\t= new SpritesMng;\n\t#drawBack(hArg: HArg, fncComp: (isStop: boolean)=> void): boolean {\n\t\tif ('back_clear' in hArg) {\n\t\t\tif (argChk_Boolean(hArg, 'back_clear', false)) {\n\t\t\t\tthis.#b_color = 0x000000;\n\t\t\t\tthis.#b_alpha = 0;\n\t\t\t\tthis.#b_alpha_isfixed = false;\n\t\t\t\tthis.#b_pic = '';\n\t\t\t}\n\t\t\tfncComp(false);\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.#b_alpha = argChk_Num(hArg, 'b_alpha', this.#b_alpha);\n\t\tthis.#b_alpha_isfixed = argChk_Boolean(hArg, 'b_alpha_isfixed', this.#b_alpha_isfixed);\n\t\tconst alpha = (this.#b_alpha_isfixed\n\t\t\t? 1\n\t\t\t: Number(TxtLayer.#val.getVal('sys:TextLayer.Back.Alpha'))\n\t\t) *this.#b_alpha;\n\t\tif (hArg.b_pic) {\n\t\t\tif (this.#b_pic !== hArg.b_pic) {\n\t\t\t\tthis.#b_pic = hArg.b_pic;\n\t\t\t\tif (this.#b_do) {\n\t\t\t\t\tthis.ctn.removeChild(this.#b_do);\t// Graphics ã‹ã‚‚\n\t\t\t\t\tthis.#b_do.destroy();\t// Graphics ã‹ã‚‚\n\t\t\t\t}\n\t\t\t\t//this.#sps.destroy();\t// Graphics ã‹ã‚‚ãªã®ã§ä½¿ç”¨ä¸å¯\n\t\t\t\tthis.#sps = new SpritesMng(this.#b_pic, this.ctn, sp=> {\n\t\t\t\t\tthis.#b_do = sp;\n\t\t\t\t\tsp.name = 'back(pic)';\n\t\t\t\t\tsp.visible = alpha > 0;\n\t\t\t\t\tsp.alpha = alpha;\n\t\t\t\t\t//CmnLib.adjustRetinaSize(this.b_pic, sp);\n\t\t\t\t\tthis.#txs.setMySize(sp.width, sp.height);\n\t\t\t\t\t\t// ã¡ãªã¿ã«å·¦ä¸Šè¡¨ç¤ºä½ç½®ã¯æœ¬ãƒ¬ã‚¤ãƒ¤ã¨åŒã˜\n\t\t\t\t\tthis.ctn.setChildIndex(sp, 0);\n\t\t\t\t\tfncComp(true);\n\t\t\t\t});\n\t\t\t\treturn this.#sps.ret;\n\t\t\t}\n\t\t}\n\t\telse if ('b_color' in hArg) {\n\t\t\tthis.#b_color = argChk_Color(hArg, 'b_color', 0x000000);\n\t\t\tif (this.#b_do) {\n\t\t\t\tthis.ctn.removeChild(this.#b_do);\t// Graphics ã‹ã‚‚\n\t\t\t\tthis.#b_do.destroy();\t// Graphics ã‹ã‚‚\n\t\t\t\t//this.#sps.destroy();\t// Graphics ã‹ã‚‚ãªã®ã§ä½¿ç”¨ä¸å¯\n\t\t\t}\n\t\t\tthis.#b_pic = '';\t// å¿˜ã‚Œãšã‚¯ãƒªã‚¢\n\t\t\tthis.ctn.addChildAt(\n\t\t\t\t(this.#b_do = new Graphics)\n\t\t\t\t.beginFill(this.#b_color, alpha)\n\t\t\t\t.lineStyle(undefined)\n\t\t\t\t.drawRect(0, 0, this.#txs.getWidth, this.#txs.getHeight)\n\t\t\t\t.endFill(), 0);\n\t\t\tthis.#b_do.name = 'back(color)';\n\t\t\t//cacheAsBitmap = true;\t// ã“ã‚Œã‚’æœ‰åŠ¹ã«ã™ã‚‹ã¨ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆãŒæ’®ã‚Œãªã„ï¼Ÿï¼Ÿ\n\t\t}\n\n\t\tif (this.#b_do) {\n\t\t\tthis.#b_do.visible = alpha > 0;\n\t\t\t\t// é€æ˜ã®æ™‚ã¯è¡¨ç¤ºã—ãªã„ã€‚ã“ã†ã—ãªã„ã¨é€æ˜ãƒ†ã‚­ã‚¹ãƒˆãƒ¬ã‚¤ãƒ¤ä¸‹ã®ãƒœã‚¿ãƒ³ãŒ\n\t\t\t\t// æŠ¼ã›ãªããªã‚‹ï¼ˆé€æ˜ã ãŒå¡—ã‚ŠãŒã‚ã‚‹ã¨ã„ã†æ‰±ã„ãªã®ã§ï¼‰\n\t\t\tthis.#b_do.alpha = alpha;\n\t\t}\n\t\tfncComp(false);\n\n\t\treturn false;\n\t}\n\tchgBackAlpha(g_alpha: number): void {\n\t\tconst alpha = this.#b_alpha_isfixed\n\t\t\t? this.#b_alpha\n\t\t\t: g_alpha * this.#b_alpha;\n\t\tif (this.#b_do instanceof Graphics) {\n\t\t\t// eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n\t\t\tif (this.#b_do) {\n\t\t\t\tthis.ctn.removeChild(this.#b_do);\n\t\t\t\tthis.#b_do.destroy();\n\t\t\t}\n\t\t\tthis.ctn.addChildAt(\n\t\t\t\t(this.#b_do = new Graphics)\n\t\t\t\t.beginFill(this.#b_color, alpha)\n\t\t\t\t.lineStyle(undefined)\n\t\t\t\t.drawRect(0, 0, this.#txs.getWidth, this.#txs.getHeight)\n\t\t\t\t.endFill(), 0);\n\t\t\tthis.#b_do.name = 'back(color)';\n\t\t\t//cacheAsBitmap = true;\t// ã“ã‚Œã‚’æœ‰åŠ¹ã«ã™ã‚‹ã¨ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆãŒæ’®ã‚Œãªã„ï¼Ÿï¼Ÿ\n\t\t}\n\t\tif (this.#b_do) {\n\t\t\tthis.#b_do.visible = alpha > 0;\n\t\t\t\t// é€æ˜ã®æ™‚ã¯è¡¨ç¤ºã—ãªã„ã€‚ã“ã†ã—ãªã„ã¨é€æ˜ãƒ†ã‚­ã‚¹ãƒˆãƒ¬ã‚¤ãƒ¤ä¸‹ã®ãƒœã‚¿ãƒ³ãŒ\n\t\t\t\t// æŠ¼ã›ãªããªã‚‹ï¼ˆé€æ˜ã ãŒå¡—ã‚ŠãŒã‚ã‚‹ã¨ã„ã†æ‰±ã„ãªã®ã§ï¼‰\n\t\t\tthis.#b_do.alpha = alpha;\n\t\t}\n\t}\n\n\t#setFfs(hArg: HArg) {\n\t\tif ('noffs' in hArg) {\n\t\t\tthis.#strNoFFS = hArg.noffs ?? '';\n\t\t\t// eslint-disable-next-line no-irregular-whitespace\n\t\t\tthis.#regNoFFS = new RegExp(`[ã€€${this.#strNoFFS}]`);\n\t\t}\n\t\tif (! ('ffs' in hArg)) return;\n\n\t\t// eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n\t\tthis.#ffs ??= '';\n\t\tthis.#fncFFSStyle = this.#ffs === ''\n\t\t\t? ()=> ''\n\t\t\t: ch=> this.#regNoFFS.test(ch)\n\t\t\t\t? ''\n\t\t\t\t: ` font-feature-settings: ${this.#ffs};`;\n\t}\n\t#ffs\t= '';\n\t#fncFFSStyle\t= (_ch: string)=> '';\n\t#strNoFFS\t= '';\n\t// eslint-disable-next-line no-irregular-whitespace\n\t#regNoFFS\t= /[ã€€]/;\n\t// SafariãŒå…¨ä½“ã«ã€Œfont-feature-settingsã€ã—ãŸå¾Œã€ç‰¹å®šæ–‡å­—ã®ã€Œfont-feature-settings: initial;ã€ã‚’å—ã‘ä»˜ã‘ã¦ãã‚Œãªã„ã®ã§ã‚ã–ã‚ã–ä¸€ã¤ãšã¤æŒ‡å®š\n\n\n\tstatic\tchgDoRec(doRec: boolean) {\n\t\tthis.#rec = doRec\n\t\t\t? tx=> tx\n\t\t\t: tx=> `<span class='offrec'>${tx}</span>`;\n\t\t\t\t// å›²ã‚“ã é ˜åŸŸã¯å±¥æ­´ã§éè¡¨ç¤º\n\t}\n\tstatic\t#rec = (tx: string)=> tx;\n\n\tisCur\t= false;\n\t#ruby_pd: (v: string, l: number)=> string = ()=> '';\n\t#mkStyle_r_align: (ch: string, rb: string, r_align: string, add_sty?: string)=> string = (ch, rb, r_align, add_sty='')=> {\n\t\tif (! r_align) return ` style='${add_sty}'`;\n\n\t\tconst len = ch.length *2;\n\t\tif (len -rb.length < 0) return ` style='text-align: ${r_align}; ${add_sty}'`;\n\n\t\tlet st = '';\n\t\tswitch (r_align) {\n\t\tcase 'justify':\n\t\t\tst = this.#ruby_pd('0', len);\tbreak;\n\t\tcase '121':\n\t\t\tst = this.#ruby_pd(`calc(${(len -rb.length) /(rb.length *2)}em)`, len);\tbreak;\n\t\tcase 'even':\n\t\t\tst = this.#ruby_pd(`calc(${(len -rb.length) /(rb.length +1)}em)`, len);\tbreak;\n\t\tcase '1ruby':\n\t\t\tst = this.#ruby_pd('1em', len);\tbreak;\n\t\tdefault:\n\t\t\tst = `text-align: ${r_align};`;\n\t\t}\n\t\treturn ` style='${st} ${add_sty}'`;\n\t};\n\t#r_align\t= '';\n\t#mkStyle_r_align4ff(ch: string, rb: string, r_align: string, add_sty=''): string {\n\t\tif (! r_align) return ` style='${add_sty}'`;\n\n\t\tconst len = ch.length *2;\n\t\tif (len -rb.length < 0) return ` style='text-align: ${r_align}; ${add_sty}'`;\n\n\t\tlet st = '';\n\t\tswitch (r_align) {\n\t\t\tcase 'left':\tst = 'ruby-align: start;';\tbreak;\n\t\t\tcase 'center':\tst = 'ruby-align: center;';\tbreak;\n\t\t\tcase 'right':\t// ã‚¨ãƒ¬ã‚¬ãƒ³ãƒˆã«ã‚µãƒãƒ¼ãƒˆã§ãã¦ã„ãªã„\n\t\t\t\tst = 'ruby-align: start;';\tbreak;\n\t\t\tcase 'justify':\tst = 'ruby-align: space-between;';\tbreak;\n\t\t\tcase '121':\t\tst = 'ruby-align: space-around;';\tbreak;\n\t\t\tcase 'even':{\n\t\t\t\tconst ev = (len -rb.length) /(rb.length +1);\n\t\t\t\tst = 'ruby-align: space-between; '+\n\t\t\t\t(this.#txs.tategaki\n\t\t\t\t\t? `padding-top: ${ev}em; padding-bottom: ${ev}em;`\n\t\t\t\t\t: `padding-left: ${ev}em; padding-right: ${ev}em;`);\n\t\t\t}\tbreak;\n\t\t\tcase '1ruby':\tst = 'ruby-align: space-between; '+\n\t\t\t\t(this.#txs.tategaki\n\t\t\t\t\t? 'padding-top: 1em; padding-bottom: 1em;'\n\t\t\t\t\t: 'padding-left: 1em; padding-right: 1em;');\n\t\t\t\tbreak;\n\t\t\tdefault:\t\tst = `text-align: ${r_align};`;\n\t\t}\n\t\treturn ` style='${st} ${add_sty}'`;\n\t}\n\n\ttagCh(text: string): void {this.#rbSpl.putTxt(text)}\n\t#needGoTxt = false;\n\tget needGoTxt() {return this.#needGoTxt}\n\treadonly\t#putCh\t: IPutCh = (ch, iruby)=> {\n\t\tlet ruby = iruby;\n\t\tif (TxtLayer.#cfg.oCfg.debug.putCh) console.log(`ğŸ–Š æ–‡å­—è¡¨ç¤º text:\\`${ch}\\`(${ch.charCodeAt(0).toString(16)}) ruby:\\`${ruby}\\` name:\\`${this.name_}\\``);\n\n\t\tconst a_ruby = ruby.split('ï½œ');\n\t\tlet add_htm = '';\n\t\tconst [a0, ...a1_] = a_ruby;\n\t\tconst a1 = a1_.join('ï½œ');\n\t\tswitch (a_ruby.length) {\n\t\tcase 1:\t\t// å­—oræ˜¥ã€Šã¯ã‚‹ã€‹\n\t\t\tthis.#needGoTxt = true;\n\t\t\tif (ch === '\\n') {\n\t\t\t\tif (this.#firstCh) {// ï¼‘æ–‡å­—ç›®ã«ãƒ«ãƒ“ãŒç„¡ã„å ´åˆã€ä¸å¯è¦–ãƒ«ãƒ“ã§è¡Œæƒãˆ\n\t\t\t\t\tthis.#firstCh = false;\n\t\t\t\t\tadd_htm = '<ruby>&emsp;<rt>&emsp;</rt></ruby><br/>';\n\t\t\t\t}\n\t\t\t\telse add_htm = '<br/>';\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tif (this.#firstCh) {\t// ï¼‘æ–‡å­—ç›®ã«ãƒ«ãƒ“ãŒç„¡ã„å ´åˆã€ä¸å¯è¦–ãƒ«ãƒ“ã§è¡Œæƒãˆ\n\t\t\t\tthis.#firstCh = false;\n\t\t\t\tif (ruby === '') ruby = '&emsp;';\n\t\t\t}\n\t\t\tadd_htm = this.#tagCh_sub(ch, ruby, this.#r_align);\n\t\t\tbreak;\n\n\t\tdefault:\t// ã€Šgrpï½œ{\"id\":\"break\",\"pic\":\"breakline\"}ã€‹\n\t\t\tswitch (a0) {\t// ãƒ«ãƒ“æƒãˆæŒ‡å®šã¨åŒæ™‚ã‚·ãƒªãƒ¼ã‚º\n\t\t\tcase 'start':\t// åˆæœŸå€¤\n\t\t\tcase 'left':\t//ï¼ˆè‚©ä»˜ãï¼‰å…ˆé ­è¦ªæ–‡å­—ã‹ã‚‰ã€ãƒ«ãƒ“é–“ã¯å¯†ç€\n\t\t\tcase 'center':\t//ï¼ˆä¸­ä»˜ãï¼‰ã‚»ãƒ³ã‚¿ãƒ¼åˆã‚ã›ã€ã€ƒ\n\t\t\tcase 'right':\t//ï¼ˆå³ï¼ä¸‹æƒãˆï¼‰æœ«å°¾è¦ªæ–‡å­—ã‹ã‚‰ã€ã€ƒ\n\t\t\tcase 'justify':\t//ï¼ˆä¸¡ç«¯æƒãˆï¼‰å…ˆé ­ã‹ã‚‰æœ«å°¾è¦ªæ–‡å­—é–“ã«ã€ãƒ«ãƒ“é–“ã¯å‡ç­‰ã«ã‚ã‘ã‚‹\n\t\t\tcase '121':\t\t//ï¼ˆ1-2-1(JIS)ï¼‰ãƒ«ãƒ“ã®å‰å¾Œã‚’æ¯”ç‡1ã€ãƒ«ãƒ“é–“ã‚’æ¯”ç‡2ã§ã‚ã‘ã‚‹\n\t\t\tcase 'even':\t//ï¼ˆå‡ç­‰ã‚¢ã‚­ï¼‰ãƒ«ãƒ“ã®å‰å¾Œã€ãƒ«ãƒ“é–“ã‚‚å‡ç­‰ã«ã‚ã‘ã‚‹\n\t\t\tcase '1ruby':\t//ï¼ˆ1ãƒ«ãƒ“æ–‡å­—ã‚¢ã‚­ï¼‰ãƒ«ãƒ“ã®å‰å¾Œã‚’ãƒ«ãƒ“ä¸€æ–‡å­—ç©ºã‘ã€ãƒ«ãƒ“é–“ã¯å‡ç­‰ã«ã‚ã‘ã‚‹\n\t\t\t\tthis.#firstCh = false;\n\t\t\t\tthis.#needGoTxt = true;\n\t\t\t\tadd_htm = this.#tagCh_sub(ch, a1, a0);\n\t\t\t\tbreak;\n\n\t\t\tcase 'gotxt':\n\t\t\t\tthis.#popSpan();\n\t\t\t\tif (this.#needGoTxt) {\n\t\t\t\t\tif (this.isCur) TxtLayer.#log.recText(\n\t\t\t\t\t\tthis.#aSpan.join('')\n\t\t\t\t\t\t.replace(/^<ruby>&emsp;<rt>&emsp;<\\/rt><\\/ruby>(<br\\/>)+/, '')\n\t\t\t\t\t\t\t// å‰æ–¹ã®ç©ºè¡Œã‚’trim\n\t\t\t\t\t\t.replaceAll(/style='(anim\\S+ [^;]+;\\s*)+/g, 'style=\\'')\n\t\t\t\t\t\t\t// 2 matches (40 step, 205Âµs) https://regex101.com/r/u1H6v2/1\n\t\t\t\t\t\t.replaceAll(/( style=''| data-(add|arg|cmd)='[^']+'|\\n+|\\t+)/g, '')\n\t\t\t\t\t\t\t// 2 matches (94 step, 175Âµs) https://regex101.com/r/5DFUmv/1\n\t\t\t\t\t\t.replaceAll(/class='sn_ch[^']+/g, 'class=\\'sn_ch')\n\t\t\t\t\t\t\t// ä¸è¦æƒ…å ±å‰Šé™¤\n\t\t\t\t\t\t\t// 2 matches (28 step, 280Âµs) https://regex101.com/r/XhBbYo/1\n\t\t\t\t\t\t.replaceAll('display: none;', '')\t// å±¥æ­´æƒ…å ±å¯è¦–åŒ–\n\t\t\t\t\t\t.replaceAll('class=\\'offrec\\'', 'style=\\'display: none;\\'')\n\t\t\t\t\t);\t\t// å›²ã‚“ã é ˜åŸŸã¯å±¥æ­´ã§éè¡¨ç¤º\n\n\t\t\t\t\tthis.#txs.goTxt(this.#aSpan, this.#cumDelay === 0);\n\t\t\t\t\tthis.#needGoTxt = false;\n\t\t\t\t\tthis.#cumDelay = 0;\n\t\t\t\t}\n\t\t\t\telse if (this.isCur) this.#txs.noticeCompTxt();\n\t\t\t\treturn;\t// breakã§ã¯ãªã„\n\n\t\t\tcase 'add':{\t// æ–‡å­—å¹…ã‚’æŒãŸãªã„æ±ç”¨çš„ãªå‘½ä»¤ï¼ˆå¿…ãšadd_closeã™ã‚‹ã“ã¨ï¼‰\n\t\t\t\tconst o = <T_cmdTxt_JSON>JSON.parse(a1);\n\n\t\t\t\tconst {style='', wait=null} = o;// wait=0ã«ã™ã‚‹ã¨èƒŒæ™¯ãŒæœ€åˆã‹ã‚‰å‡ºã‚‹\n\t\t\t\tconst {cl, sty} = this.#o2domArg(true, wait ?uint(wait): null);\n\t\t\t\tthis.#aSpan.push(`<span${cl} style='${sty} display: inline; ${style}'>`);\t// display: inline; ãŒãªã„ã¨å‰ã®æ”¹è¡ŒãŒæ”¹è¡Œã—ãªããªã‚‹\n\t\t\t\tdelete o.style;\t// èƒŒæ™¯styleãªã©ã‚’[ch]ã§ä¸€å¡Šã¨ã™ã‚‹\n\t\t\t\tthis.#pushSpan(o);\n\t\t\t}\treturn;\t// breakã§ã¯ãªã„\n\t\t\tcase 'add_close':\n\t\t\t\tthis.#aSpan.push('</span>');\n\t\t\t\tthis.#popSpan();\n\t\t\t\treturn;\t// breakã§ã¯ãªã„\n\n\t\t\tcase 'grp':\t//\tç”»åƒãªã© ã€Šgrpï½œ{\"id\":\"break\",\"pic\":\"breakline\"}ã€‹\n\t\t\t\tthis.#needGoTxt = true;\n\t\t\t{\n\t\t\t\tconst o = <T_cmdTxt_JSON>JSON.parse(a1);\n\t\t\t\t// ç›´å¾Œã® dispBreak() ã®ãŸã‚ oã‚’æ›´æ–°\n\t\t\t\to.id ??= String(this.#aSpan.length);\n\t\t\t\tif (o.id === 'break') {\n\t\t\t\t\tthis.#txs.dispBreak(<HArg>o);\n\t\t\t\t\treturn;\t// breakã§ã¯ãªã„\n\t\t\t\t}\n\n\t\t\t\tthis.#firstCh = false;\n\t\t\t\t// ç›´å¾Œã® JSON.stringify() ã®ãŸã‚ oã‚’æ›´æ–°\n\t\t\t\to.delay = this.#cumDelay;\t// ç”»åƒã®ã‚¹ãƒ©ã‚¤ãƒ‰ã‚¤ãƒ³ã§ä½¿ã†\n\t\t\t\to.r ??= '';\n\t\t\t\to.style ??= '';\n\t\t\t\to.r_style ??= '';\n\t\t\t\tconst {r, wait=null, r_style} = o;\n\t\t\t\tconst {cl, sty, lnk} = this.#o2domArg(true, wait ?uint(wait): null);\n\t\t\t\tadd_htm = `<span${cl} style='${sty} ${o.style\n\t\t\t\t}'><ruby><span data-cmd='grp' data-arg='${JSON.stringify(o)\n\t\t\t\t}'${lnk} style='${sty} display: inline;'>&emsp;</span><rt${lnk}${\n\t\t\t\t\tthis.#mkStyle_r_align('ã€€', r, this.#r_align,\n\t\t\t\t\tthis.#htmRb.style.cssText\t// ã“ã®ä¸¦ã³ã§ä¸Šæ›¸ãã•ã‚Œã¦ã„ã\n\t\t\t\t\t+ (this.#stkASpan.at(-1)?.o.r_style ?? '')\n\t\t\t\t\t+ r_style)\n\t\t\t\t}>${o.r}</rt></ruby></span>`;\n\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tcase 'tcy':\t// ãƒ«ãƒ“ä»˜ãç¸¦ä¸­æ¨ª\n\t\t\t\tthis.#firstCh = false;\n\t\t\t\tthis.#needGoTxt = true;\n\t\t\t{\n\t\t\t\tconst {t='', r='', wait=null, style='', r_style=''} = <T_cmdTxt_JSON>JSON.parse(a1);\n\t\t\t\tif (TxtLayer.#val.doRecLog()) {\n\t\t\t\t\tthis.#page_text += ch +(ruby ?`ã€Š${ruby}ã€‹` :'');\n\t\t\t\t\tthis.#page_plain_text += t;\n\t\t\t\t}\n\n\t\t\t\tconst rb = CmnLib.isSafari\n\t\t\t\t\t? r.replaceAll(/[A-Za-z0-9]/g, s=> String.fromCharCode(s.charCodeAt(0) + 65248))\n\t\t\t\t\t\t// è‹±æ•°å­—ã‚’å…¨è§’ã«(Safariã§ç¸¦ä¸­æ¨ªãƒ«ãƒ“ãŒåŠè§’æ–‡å­—ã ã¨ã€\n\t\t\t\t\t\t// é¸æŠçŸ©å½¢ãŒæ¨ªå€’ã—ã«ãªã‚‹ä¸å…·åˆå¯¾ç­–)\n\t\t\t\t\t: r;\n\t\t\t\tconst {cl, sty, lnk} = this.#o2domArg(true, wait ?uint(wait): null);\n\t\t\t\tadd_htm = `<span${cl} style='${sty}${this.#fncFFSStyle(t)} ${style}'><ruby><span${lnk} style='${sty} display: inline; text-combine-upright: all;'>${t}</span><rt${lnk}${\n\t\t\t\t\tthis.#mkStyle_r_align(t, rb, this.#r_align,\n\t\t\t\t\tthis.#htmRb.style.cssText\t// ã“ã®ä¸¦ã³ã§ä¸Šæ›¸ãã•ã‚Œã¦ã„ã\n\t\t\t\t\t+ (this.#stkASpan.at(-1)?.o.r_style ?? '')\n\t\t\t\t\t+ r_style)\n\t\t\t\t}>${rb}</rt></ruby></span>`;\n\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tcase 'del':\t//if (a1 !== 'break') throw 'æ–‡å­—ãƒ¬ã‚¤ãƒ¤delã‚³ãƒãƒ³ãƒ‰ã¯ã€ç¾åœ¨id=breakã®ã¿ã‚µãƒãƒ¼ãƒˆã—ã¾ã™';\n\t\t\t\tTxtStage.delBreak();\n\t\t\t\treturn;\t// breakã§ã¯ãªã„\n\n\t\t\tcase 'span':\n\t\t\t\tthis.#needGoTxt = true;\n\t\t\t\tthis.#mergePushSpan(<T_cmdTxt_JSON>JSON.parse(a1));\n\t\t\t\treturn;\t// breakã§ã¯ãªã„\n\n\t\t\tcase 'link':\n\t\t\t\tthis.#needGoTxt = true;\n\t\t\t{\n\t\t\t\tconst o = <T_cmdTxt_JSON>JSON.parse(a1);\n\t\t\t\to[':link'] = ' data-lnk=\\'@\\'';\n\t\t\t\tconst {cl, sty, curpos} = this.#o2domArg(false, o.wait ?uint(o.wait): null);\n\t\t\t\tthis.#aSpan.push(`<span${cl} style='${sty} display: inline; ${o.style ?? ''}' ${curpos} data-arg='${a1}'>`);\n\t\t\t\t\t// display: inline; ã‚’å‰Šé™¤ã™ã‚‹ã¨ãƒ«ãƒ“ã‚‚ãƒªãƒ³ã‚¯èƒŒæ™¯ã«å«ã¾ã‚Œã‚‹\n\t\t\t\t\t// ãŸã ã—å½“ãŸã‚Šåˆ¤å®šã¯æ–‡å­—ãƒ»ãƒ«ãƒ“ä¸Šã®ã¿\n\t\t\t\tdelete o.style;\n\t\t\t\tthis.#mergePushSpan(o);\n\t\t\t}\treturn;\t// breakã§ã¯ãªã„\n\n\t\t\tcase 'endlink':\n\t\t\t\tthis.#needGoTxt = true;\n\t\t\t\tthis.#aSpan.push('</span>');\n\t\t\t\tthis.#popSpan();\n\t\t\t\treturn;\t// breakã§ã¯ãªã„\n\n\t\t\tdefault:\t// ãƒ«ãƒ“ã‚ã‚Šæ–‡å­—åˆ—\n\t\t\t\tthis.#needGoTxt = true;\n\t\t\t\tadd_htm = this.#tagCh_sub(ch, ruby, this.#r_align);\n\t\t\t}\n\t\t\tbreak;\n\t\t}\n\t\tthis.#aSpan.push(TxtLayer.#rec(add_htm));\n\t}\n\t#tagCh_sub(ch: string, rb: string, r_align: string): string {\n\t\tconst ht = ch===' ' ?'&nbsp;' :ch==='ã€€' ?'&emsp;' :ch;\n\t\tif (TxtLayer.#val.doRecLog()) {\n\t\t\tthis.#page_text += ht +(rb ?`ã€Š${rb}ã€‹` :'');\n\t\t\tif (ch !== ' ') this.#page_plain_text += ch;\n\t\t}\n\t\tconst {cl, sty, lnk} = this.#o2domArg(true, null, ch);\n\n\t\tif (rb) return `<span${cl} style='${sty} ${this.#fncFFSStyle(ch)\n\t\t//<ruby style='ruby-position:under;'>\t// ä¸‹ä»˜ãƒ«ãƒ“\n\t\t}'><ruby>${\t// æ–‡å­—å€‹åˆ¥ã«å‡ºç¾ã•ã›ã‚‹ãŸã‚ä»¥ä¸‹ã«ã‚‚ ${cl} ãŒå¿…è¦\n\t\t\tArray.from(ch).map((c, i)=> `<span${cl}${lnk} style='${\n\t\t\t\ti > 0 ?this.#o2domArg(true, null, ch).sty :sty\n\t\t\t} display: inline;'>${\n\t\t\t\tc===' ' ?'&nbsp;' :c==='ã€€' ?'&emsp;' :c\n\t\t\t}</span>`).join('')\n\t\t\t\t// display: inline; ãŒãªã„ã¨[span]åŒºé–“å¤–ã®ãƒ«ãƒ“ãŒæµ®ã\n\t\t}<rt${lnk}${this.#mkStyle_r_align(ch, rb, r_align,\n\t\t\tthis.#htmRb.style.cssText\t// ã“ã®ä¸¦ã³ã§ä¸Šæ›¸ãã•ã‚Œã¦ã„ã\n\t\t\t+ (this.#stkASpan.at(-1)?.o.r_style ?? ''))\n\t\t}>${rb}</rt></ruby></span>`;\t// <span>ã«å…¥ã‚Œãªã„ã¨å´©ã‚Œä¸€æ–‡å­—ãšã¤å‡ºãªã„\n\n\t\treturn `<span${cl} style='${sty} ${this.#fncFFSStyle(ch)}'${lnk}>${ht}</span>`;\n\t}\n\t#o2domArg(isAddWait: boolean, argWait: number | null, ch = '\\n') {\n\t\tconst wait = this.#ch_in_join ?argWait\n\t\t\t?? this.#stkASpan.at(0)?.o.wait\t// è¦ªè¦ç´ \n\t\t\t?? (TxtLayer.#doAutoWc\t// ()ã¯å¿…è¦\n\t\t\t\t? TxtLayer.#hAutoWc[ch.at(0) ?? ''] ?? 0\n\t\t\t\t: LayerMng.msecChWait) :0;\n\t\tif (TxtLayer.#evtMng.isSkipping) this.#cumDelay = 0;\n\t\telse if (isAddWait && this.#ch_in_join) this.#cumDelay += uint(wait);\n\t\t\t// ... += uint(wait)*5\t// ã“ã†ã™ã‚‹ã¨å‡ºç¾è¦–èªãƒ†ã‚¹ãƒˆãŒã§ãã‚‹\n\t\tconst curpos = `data-add='{\"ch_in_style\":\"${this.#$ch_in_style}\", \"ch_out_style\":\"${this.#$ch_out_style}\"}'`;\n\n\t\treturn {\n\t\t\tcl\t: ` class='sn_ch sn_ch_yet sn_ch_in_${this.#$ch_in_style}'`,\t// TxtStage.goTxt()ã¯ã“ã‚Œå˜ä½ã§æ–‡å­—å‡ºç¾ã•ã›ã‚‹\n\t\t\tsty\t: `animation-delay: ${this.#cumDelay}ms;${\n\t\t\t\tthis.#stkASpan.at(-1)?.o.style ?? ''\n\t\t\t}`,\t\t// TxtStage.goTxt()ã¯ã“ã‚Œå˜ä½ã§æ–‡å­—å‡ºç¾ã•ã›ã‚‹\n\t\t\tlnk\t: (this.#stkASpan.at(0)?.o[':link'] ?? '')+' '+ curpos,\n\t\t\tcurpos,\n\t\t};\n\t}\n\t#cumDelay\t= 0;\n\t#firstCh\t= true;\n\t#aSpan\t\t: string[]\t= [];\n\t#stkASpan\t: {\n\t\to\t\t: T_cmdTxt_JSON;\n\t\tr_align\t\t\t: string;\n\t\tch_in_style\t\t: string;\n\t\tch_out_style\t: string;\n\t}[] = [];\n\n\t#pushSpan(o :T_cmdTxt_JSON) {\n\t\tthis.#stkASpan.push({\n\t\t\to,\n\t\t\tr_align\t\t\t: this.#r_align,\n\t\t\tch_in_style\t\t: this.#$ch_in_style,\n\t\t\tch_out_style\t: this.#$ch_out_style,\n\t\t});\n\t\tif (o.r_align) this.#r_align = o.r_align;\n\t\tthis.#set_ch_in(o);\n\t\tthis.#set_ch_out(o);\n\t}\n\t#popSpan() {\n\t\tconst stk = this.#stkASpan.pop();\n\t\tif (! stk) return;\n\n\t\tthis.#r_align = stk.r_align;\n\t\tthis.#set_ch_in({in_style: stk.ch_in_style});\n\t\tthis.#set_ch_out({out_style: stk.ch_out_style});\n\t}\n\t#mergePushSpan(o :T_cmdTxt_JSON) {\n\t\tconst stk = this.#stkASpan.at(-1);\n\t\tif (! stk) {this.#pushSpan(o); return}\n\n\t\tstk.o = {...stk.o, ...o};\n\t\tif (! o.style && ! o.r_style) {stk.o.style = ''; stk.o.r_style = ''}\n\t\t\t// ã©ã¡ã‚‰ã‚‚æŒ‡å®šã•ã‚Œã¦ãªã‘ã‚Œã°ã‚¯ãƒªã‚¢\n\t\tif (o.r_align) this.#r_align = o.r_align;\n\t\tthis.#set_ch_in(o);\n\t\tthis.#set_ch_out(o);\n\t}\n\n\treadonly click = ()=> {\t// true: æ–‡å­—å‡ºç¾ä¸­ã ã£ãŸã®ã§ã€åœæ­¢ã™ã‚‹\n\t\tif (! this.ctn.interactiveChildren || ! this.ctn.visible) return false;\n\t\treturn this.#txs.skipChIn();\n\t}\n\n\tclearText(): void {\n\t\tthis.ctn.addChild(this.#txs = this.#txs.reNew());\n\n\t\tthis.#cumDelay = 0;\n\t\tthis.#firstCh = true;\n\t\tthis.#aSpan = [];\n\t\tthis.#page_text = '';\n\t\tthis.#page_plain_text = '';\n\t\tTxtLayer.#log.pagebreak();\n\t}\n\t#page_text\t\t\t= '';\n\t#page_plain_text\t= '';\n\tget pageText() {return this.#page_text.replace('ã€Š&emsp;ã€‹', '')}\n\tget pagePlainText() {return this.#page_plain_text}\n\n\tget enabled() {return this.ctn.interactiveChildren}\n\tset enabled(e) {this.ctn.interactiveChildren = e}\n\n\treadonly\taddButton = (hArg: HArg)=> new Promise<void>(re=> {\n\t\t// ç›´å¾Œã® JSON.stringify() ã®ãŸã‚ hArg ã‚’æ›´æ–°\n\t\thArg.key = `btn=[${this.#cntBtn.children.length}] `+ this.name_;\n\t\thArg[':id_tag'] = hArg.key.slice(0, -7);\t// Designç”¨\n\t\targChk_Boolean(hArg, 'hint_tate', this.#txs.tategaki);\t// hintç”¨\n\t\tconst btn = new Button(hArg, TxtLayer.#evtMng, ()=> re(), ()=> this.canFocus());\n\t\tbtn.name = JSON.stringify(hArg).replaceAll('\"', '\\'');// playbackæ™‚ã«ä½¿ç”¨\n\t\tthis.#cntBtn.addChild(btn);\n\t});\n\tcanFocus(): boolean {\n\t\t// eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n\t\treturn (this.ctn.interactiveChildren ?? false)\n\t\t&& this.ctn.visible\n\t\t&& TxtLayer.#isPageFore(this);\n\t}\n\n\n\toverride clearLay(hArg: HArg): void {\n\t\tsuper.clearLay(hArg);\n\n\t\tthis.clearText();\n\t\t// ä¸Šã§å‘¼ã°ã‚Œã‚‹ this.#evtMng.escapeHint();\t// Hintã”ã¨destroyã•ã‚Œã‚‹ã®ã‚’å›é¿\n\t\tfor (const b of this.#cntBtn.removeChildren()) b.destroy();\n\t}\n\toverride readonly record = ()=> {return {...super.record(),\n\t\tenabled\t: this.enabled,\n\n\t\tr_cssText\t: this.#htmRb.style.cssText,\n\t\tr_align\t\t: this.#r_align,\n\n\t\t// ãƒãƒƒã‚¯\n\t\tb_do\t: this.#b_do === undefined\n\t\t\t\t\t? undefined\n\t\t\t\t\t: this.#b_do instanceof Sprite ?'Sprite' :'Graphics',\n\t\tb_pic\t: this.#b_pic,\n\t\tb_color\t: this.#b_color,\n\t\tb_alpha\t: this.#b_alpha,\n\t\tb_alpha_isfixed\t: this.#b_alpha_isfixed,\n\n\t\tffs\t\t: this.#ffs,\n\t\ttxs\t\t: this.#txs.record(),\n\t\tstrNoFFS: this.#strNoFFS,\n\n\t\tbtns\t: this.#cntBtn.children.map(b=> b.name),\n\t}};\n\toverride playback(hLay: T_RP_layTxt, aPrm: Promise<void>[]): void {\n\t\tsuper.playback(hLay, aPrm);\n\n\t\tthis.enabled\t= hLay.enabled;\n\n\t\tthis.#htmRb.style.cssText = hLay.r_cssText;\n\t\tthis.#r_align\t= hLay.r_align;\n\t\tthis.cvsResize();\n\n\t\tthis.#setFfs(hLay);\n\t\tthis.#txs.playback(hLay.txs);\n\t\t// æ–‡å­—èƒŒæ™¯ã‚µã‚¤ã‚ºã¯ TxtStage ã‚’å‚ç…§ã™ã‚‹ã®ã§ã“ã®é †ã§\n\t\tthis.#b_alpha\t\t\t= hLay.b_alpha;\n\t\tthis.#b_alpha_isfixed\t= hLay.b_alpha_isfixed;\n\n\t\taPrm.push(\n\t\t\tnew Promise<void>(re=> {\n\t\t\t\tconst h: HArg = hLay.b_do\n\t\t\t\t\t? hLay.b_do === 'Sprite'\n\t\t\t\t\t\t? {b_pic: hLay.b_pic}\n\t\t\t\t\t\t: {b_color: hLay.b_color}\n\t\t\t\t\t: {b_pic: ''};\n\t\t\t\th.b_alpha = hLay.b_alpha;\n\t\t\t\th.b_alpha_isfixed = hLay.b_alpha_isfixed;\n\t\t\t\tif (! this.#drawBack(h, isStop=> {if (isStop) re()})) re();\n\t\t\t}),\n\t\t\t...hLay.btns.map(b=> this.addButton(<HArg>JSON.parse(b.replaceAll('\\'', '\"')))).flat(),\n\t\t);\n\t}\n\n\tget cssText() {return this.#txs.cssText}\n\tset cssText(ct: string) {this.#txs.cssText = ct}\n\n\toverride snapshot(rnd: Renderer, re: ()=> void) {\n\t\trnd.render(this.ctn, {clear: false});\n\t\tthis.#txs.snapshot(rnd, re);\n\t}\n\toverride snapshot_end() {this.#txs.snapshot_end()}\n\n\toverride makeDesignCast(gdc: IMakeDesignCast) {\n\t\tif (! this.ctn.visible) return;\n\t\tthis.#txs.makeDesignCast(gdc);\n\t}\n\toverride makeDesignCastChildren(gdc: IMakeDesignCast) {\n\t\tif (! this.ctn.visible) return;\n\t\tfor (const b of this.#cntBtn.children) b.makeDesignCast(gdc);\n\t}\n\n\toverride showDesignCast() {this.#txs.showDesignCast()}\n\toverride showDesignCastChildren() {\n\t\tfor (const b of this.#cntBtn.children) b.showDesignCast();\n\t}\n\n\toverride dump(): string {\n\t\tthis.#putCh('', 'gotxtï½œ');\t// ãƒãƒƒãƒ•ã‚¡ã®æ–‡å­—ã‚’å°å­—ã—ã¦ã—ã¾ã†\n\n\t\treturn super.dump() +`, \"enabled\":\"${this.enabled}\", ${this.#txs.dump()\n\t\t}, \"b_pic\":\"${this.#b_pic}\", \"b_color\":\"${this.#b_color\n\t\t}\", \"b_alpha\":${this.#b_alpha}, \"b_alpha_isfixed\":\"${this.#b_alpha_isfixed\n\t\t}\", \"width\":${this.#txs.getWidth}, \"height\":${this.#txs.getHeight\n\t\t}, \"pixi_obj\":[${\n\t\t\tthis.ctn.children.map(e=> `{\"class\":\"${\n\t\t\t\te instanceof Sprite ?'Sprite' :\n\t\t\t\t\te instanceof Graphics ?'Graphics' :\n\t\t\t\t\t\te instanceof Container ?'Container' :'?'\n\t\t\t}\", \"name\":\"${e.name}\", \"alpha\":${e.alpha}, \"x\":${e.x}, \"y\":${e.y}, \"visible\":\"${e.visible}\"}`).join(',')\n\t\t}], \"button\":[${\n\t\t\tthis.#cntBtn.children.map(b=> b.children[0]?.name ?? '{}').join(',')\n\t\t}]`;\n\t}\n\n}\n","/* eslint-disable @typescript-eslint/restrict-template-expressions */\n/* ***** BEGIN LICENSE BLOCK *****\n\tCopyright (c) 2018-2025 Famibee (famibee.blog38.fc2.com)\n\n\tThis software is released under the MIT License.\n\thttp://opensource.org/licenses/mit-license.php\n** ***** END LICENSE BLOCK ***** */\n\nimport {CmnLib, type IEvtMng, argChk_Boolean, argChk_Num} from './CmnLib';\nimport {CmnTween} from './CmnTween';\nimport type {IHTag, HArg} from './Grammar';\nimport type {IVariable, IMain, IGetFrm} from './CmnInterface';\nimport type {SysBase} from './SysBase';\nimport type {Config} from './Config';\nimport {SEARCH_PATH_ARG_EXT} from './ConfigBase';\nimport {Reading} from './Reading';\n\nimport {type Application, Loader, LoaderResource} from 'pixi.js';\n\n\nexport class FrameMng implements IGetFrm {\n\tstatic\t#cfg\t: Config;\n\tstatic\t#sys\t: SysBase;\n\tstatic\t#main\t: IMain;\n\tstatic\tinit(cfg: Config, sys: SysBase, main: IMain): void {\n\t\tFrameMng.#cfg = cfg;\n\t\tFrameMng.#sys = sys;\n\t\tFrameMng.#main = main;\n\t}\n\n\tconstructor(hTag: IHTag, private readonly appPixi: Application, private readonly val: IVariable) {\n\t\t//\tHTMLãƒ•ãƒ¬ãƒ¼ãƒ \n\t\thTag.add_frame\t\t= o=> this.#add_frame(o);\t// ãƒ•ãƒ¬ãƒ¼ãƒ è¿½åŠ \n\t\thTag.let_frame\t\t= o=> this.#let_frame(o);\t// ãƒ•ãƒ¬ãƒ¼ãƒ å¤‰æ•°ã‚’å–å¾—\n\t\thTag.set_frame\t\t= o=> this.#set_frame(o);\t// ãƒ•ãƒ¬ãƒ¼ãƒ å¤‰æ•°ã«è¨­å®š\n\t\thTag.frame\t\t\t= o=> this.#frame(o);\t\t// ãƒ•ãƒ¬ãƒ¼ãƒ ã«è¨­å®š\n\t\thTag.tsy_frame\t\t= o=> this.#tsy_frame(o);\t// ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’ãƒˆã‚¥ã‚¤ãƒ¼ãƒ³é–‹å§‹\n\t}\n\n\t#evtMng\t: IEvtMng;\n\tsetEvtMng(evtMng: IEvtMng) {this.#evtMng = evtMng}\n\n\t// eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n\t#hIfrm\t: {[id: string]: HTMLIFrameElement} = Object.create(null);\n\tdestroy() {\n\t\t// eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n\t\tfor (const f of Object.values(this.#hIfrm)) f.parentElement!.removeChild(f);\n\t\t// eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n\t\tthis.#hIfrm = Object.create(null);\n\t}\n\n\thideAllFrame() {\t// ï¼ˆè¡¨ç¤ºãƒ»éè¡¨ç¤ºã‚’ä¿å­˜ã—ã¤ã¤ï¼‰ã™ã¹ã¦éè¡¨ç¤ºã«\n\t\tfor (const [id, {style}] of Object.entries(this.#hIfrm)) {\n\t\t\tthis.#hIfrmVisibleBk[id] = style.display !== 'none';\n\t\t\tstyle.display = 'none';\n\t\t}\n\t}\n\t// eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n\t#hIfrmVisibleBk: {[id: string]: boolean} = Object.create(null);\n\trestoreAllFrame() {\t// ä¿å­˜ã—ã¦ã„ãŸè¡¨ç¤ºãƒ»éè¡¨ç¤ºã‚’å›å¾©\n\t\tfor (const [id, v] of Object.entries(this.#hIfrmVisibleBk)) {\n\t\t\tconst f = this.#hIfrm[id];\n\t\t\tif (f) f.style.display = v ?'inline' :'none';\n\t\t}\n\t\t// eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n\t\tthis.#hIfrmVisibleBk = Object.create(null);\n\t}\n\n\t//\tHTMLãƒ•ãƒ¬ãƒ¼ãƒ \n\t// ãƒ•ãƒ¬ãƒ¼ãƒ è¿½åŠ \n\t#add_frame(hArg: HArg) {\n\t\tconst {id, src, alpha: a=1, scale_x: sx=1, scale_y: sy=1, rotate: r=0,} = hArg;\n\t\tif (! id) throw 'idã¯å¿…é ˆã§ã™';\n\t\tif (! src) throw 'srcã¯å¿…é ˆã§ã™';\n\t\tconst vn = 'const.sn.frm.'+ id;\n\t\tif (this.val.getVal(`tmp:${vn}`)) throw `frameã€${id}ã€‘ã¯ã™ã§ã«ã‚ã‚Šã¾ã™`;\n\n\t\tconst v = argChk_Boolean(hArg, 'visible', true);\n\t\tconst b_color = hArg.b_color ?` background-color: ${hArg.b_color};` :'';\n\t\tconst rct = this.#rect(hArg);\n\t\t// ã€sandbox=\"allow-scripts allow-same-origin\"ã€‘ã¯å¿…è¦ãªã®ã«è­¦å‘ŠãŒå‡ºã‚‹ã®ã§å‰Šé™¤\n\t\tFrameMng.#main.cvs.insertAdjacentHTML('beforebegin', `<iframe id=\"${id}\" style=\"opacity: ${a}; ${b_color} position: absolute; left:${\n\t\t\tFrameMng.#sys.ofsLeft4elm +rct.x *FrameMng.#sys.cvsScale\n\t\t}px; top: ${\n\t\t\tFrameMng.#sys.ofsTop4elm +rct.y *FrameMng.#sys.cvsScale\n\t\t}px; z-index: 1; border: 0px; overflow: hidden; display: ${\n\t\t\tv ?'inline' :'none'\n\t\t}; transform: scale(${sx}, ${sy}) rotate(${r}deg);\" width=\"${\n\t\t\trct.width *FrameMng.#sys.cvsScale\n\t\t}\" height=\"${\n\t\t\trct.height *FrameMng.#sys.cvsScale\n\t\t}\"></iframe>`);\n\n\t\tconst RPN_ADD_FRAME = Reading.procID +`add_frame id:${id}`;\n\t\tReading.beginProc(RPN_ADD_FRAME);\n\t\tconst url = FrameMng.#cfg.searchPath(src, SEARCH_PATH_ARG_EXT.HTML);\n\t\tconst ld = (new Loader)\n\t\t.add({name: src, url, xhrType: LoaderResource.XHR_RESPONSE_TYPE.TEXT});\n\t\tif (FrameMng.#sys.arg.crypto) ld.use(\n\t\t\t// eslint-disable-next-line @typescript-eslint/no-unsafe-argument\n\t\t\t(res, next)=> void FrameMng.#sys.dec(res.extension, res.data)\n\t\t\t.then(r=> {\n\t\t\t\tres.data = r;\n\t\t\t\tnext();\n\t\t\t})\n\t\t\t.catch((e: unknown)=> {\n\t\t\t\tFrameMng.#main.errScript(`[add_frame]Html ãƒ­ãƒ¼ãƒ‰å¤±æ•—ã§ã™ src:${res.name} ${e}`, false);\n\t\t\t\tnext();\n\t\t\t})\n\t\t);\n\t\tld.load((_ldr, hRes)=> {\n\t\t\tconst f = <HTMLIFrameElement>document.getElementById(id);\n\t\t\tthis.#hIfrm[id] = f;\n\t\t\tthis.#hDisabled[id] = false;\n\n\t\t\tconst iLastSep = url.lastIndexOf('/') +1;\n\t\t\tconst path_parent = url.slice(0, iLastSep);\n\t\t\tconst path_pa_pa = path_parent.slice(0, iLastSep);\n\t\t\tf.srcdoc = String(hRes[src]?.data)\t// .src ã¯ãµã‚Šãƒ¼ã‚€ã§å•é¡Œç™ºç”Ÿ\n\t\t\t.replace('sn_repRes();', '')\t// ã“ã‚Œã¯ã„ãšã‚Œã‚„ã‚ã‚‹\n\t\t\t.replaceAll(\n\t\t\t\t/\\s(?:src|href)=([\"'])(\\S+?)\\1/g,\t// ã€\\sã€‘ãŒå¤§äº‹ã€data-srcå¼¾ã\n\t\t\t\t(m, br: string, v: string)=> v.startsWith('../')\n\t\t\t\t? path_pa_pa + m.slice(3)\n\t\t\t\t: m.replace('./', '')\t// ã€Œ./ã€ã¯ç„¡è¦–\n\t\t\t\t\t.replace(br, br + path_parent)\n\t\t\t);\n\n\t\t\tif (f.srcdoc.includes('true/*WEBP*/;')) f.srcdoc = f.srcdoc.replaceAll(\n\t\t\t\t/data-src=\"(.+?\\.)(?:jpe?g|png)/g,\n\t\t\t\t(_, p1: string)=> `data-src=\"${p1}webp`\n\t\t\t);\n\n\t\t\tf.onload = ()=> {\t// ä¸€åº¦å¤‰æ•°ã«å…¥ã‚Œã¦ã“ã“ã§è¨­å®šã™ã‚‹ã®ã¯Firefoxå¯¾å¿œã€‚ifrm.onloadãŒäºŒåº¦å‘¼ã°ã‚Œã‚‹ï¼\n\t\t\t\tReading.endProc(RPN_ADD_FRAME);\n\n\t\t\t\t// çµ„ã¿è¾¼ã¿å¤‰æ•°\n\t\t\t\tthis.val.setVal_Nochk('tmp', vn, true);\n\t\t\t\tthis.val.setVal_Nochk('tmp', vn +'.alpha', a);\n\t\t\t\tthis.val.setVal_Nochk('tmp', vn +'.x', rct.x);\n\t\t\t\tthis.val.setVal_Nochk('tmp', vn +'.y', rct.y);\n\t\t\t\tthis.val.setVal_Nochk('tmp', vn +'.scale_x', sx);\n\t\t\t\tthis.val.setVal_Nochk('tmp', vn +'.scale_y', sy);\n\t\t\t\tthis.val.setVal_Nochk('tmp', vn +'.rotate', r);\n\t\t\t\tthis.val.setVal_Nochk('tmp', vn +'.width', rct.width);\n\t\t\t\tthis.val.setVal_Nochk('tmp', vn +'.height', rct.height);\n\t\t\t\tthis.val.setVal_Nochk('tmp', vn +'.visible', v);\n\n\t\t\t\t// eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n\t\t\t\tconst win = f.contentWindow!;\n\t\t\t\tthis.#evtMng.resvFlameEvent(<HTMLBodyElement>win.document.body);\n\t\t\t\t// sn_repRes()ã‚’ã‚³ãƒ¼ãƒ«ã€‚å¼•æ•°ã¯ç”»åƒãƒ­ãƒ¼ãƒ‰å‡¦ç†å·®ã—æ›¿ãˆãƒ¡ã‚½ãƒƒãƒ‰\n\t\t\t\t// eslint-disable-next-line @typescript-eslint/no-unsafe-call, @typescript-eslint/no-unsafe-member-access, @typescript-eslint/no-explicit-any\n\t\t\t\t(<any>win).sn_repRes?.((i: HTMLImageElement)=> FrameMng.#loadPic2Img(i.dataset.src ?? '', i));\n\t\t\t};\n\t\t});\n\t\treturn true;\n\t}\n\t#hDisabled\t: {[id: string]: boolean}\t= {};\n\t// eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n\tgetFrmDisabled(id: string): boolean {return this.#hDisabled[id]!}\n\t#rect(hArg: HArg): DOMRect {\n\t\tconst a = {...hArg};\n\t\tconst re = FrameMng.#sys.resolution;\n\t\treturn new DOMRect(\n\t\t\targChk_Num(a, 'x', 0) *re,\n\t\t\targChk_Num(a, 'y', 0) *re,\n\t\t\targChk_Num(a, 'width', CmnLib.stageW) *re,\n\t\t\targChk_Num(a, 'height', CmnLib.stageH) *re,\n\t\t);\n\t}\n\n\tstatic\t#loadPic2Img(src: string, img: HTMLImageElement, onload?: (img2: HTMLImageElement)=> void) {\n\t\tconst oUrl = this.#hEncImgOUrl[src];\n\t\tif (oUrl) {\n\t\t\timg.src = oUrl;\n\t\t\tif (onload) img.onload = ()=> onload(img);\n\t\t\treturn;\n\t\t}\n\n\t\tconst aImg = this.#hARetImg[src];\n\t\tif (aImg) {aImg.push(img); return}\t// load çµ‚äº†å‰ã®é§†ã‘è¾¼ã¿å¯¾å¿œ\n\t\tthis.#hARetImg[src] = [img];\n\n\t\tconst [srcNoPrm='', Prm=''] = src.split('?');\n\t\tconst path = FrameMng.#cfg.searchPath(srcNoPrm, SEARCH_PATH_ARG_EXT.SP_GSM);\n\t\tconst ld2 = (new Loader)\n\t\t.add({name: src, url: path, xhrType: LoaderResource.XHR_RESPONSE_TYPE.BUFFER,});\n\n\t\t// === vite-electron ç”¨ã‚³ãƒ¼ãƒ‰ ===\n\t\tif (FrameMng.#sys.use4ViteElectron(src, path, ld2, FrameMng.#main)) { /* empty */ }\n\t\telse\n\t\tif (FrameMng.#sys.arg.crypto && path.endsWith('.bin')) ld2.use((res, next)=> {\n\t\t\tif (res.extension !== 'bin') {next(); return}\n\n\t\t\t// eslint-disable-next-line @typescript-eslint/no-unsafe-argument\n\t\t\tvoid FrameMng.#sys.decAB(res.data)\n\t\t\t.then(r=> {\n\t\t\t\tres.data = r;\n\t\t\t\tif (r instanceof HTMLImageElement) res.type = LoaderResource.TYPE.IMAGE;\n\t\t\t\tnext();\n\t\t\t})\n\t\t\t.catch((e: unknown)=> {\n\t\t\t\tFrameMng.#main.errScript(`FrameMng loadPic ãƒ­ãƒ¼ãƒ‰å¤±æ•—ã§ã™ fn:${res.name} ${e}`, false)\n\t\t\t\tnext();\n\t\t\t});\n\t\t});\n\t\tld2.load((_ldr, hRes)=> {\n\t\t\tfor (const [s2, {data: {src}}] of Object.entries(hRes)) {\n\t\t\t\t// eslint-disable-next-line @typescript-eslint/restrict-plus-operands\n\t\t\t\tconst u2 = this.#hEncImgOUrl[s2] = src + (\n\t\t\t\t\t// eslint-disable-next-line @typescript-eslint/no-unsafe-call, @typescript-eslint/no-unsafe-member-access\n\t\t\t\t\tsrc.startsWith('blob:') || src.startsWith('data:')\n\t\t\t\t\t?'' :Prm ? '?'+ Prm: ''\n\t\t\t\t);\n\t\t\t\tconst ri = this.#hARetImg[s2];\n\t\t\t\tif (ri) for (const i of ri) {\n\t\t\t\t\ti.src = u2;\n\t\t\t\t\tif (onload) i.onload = ()=> onload(i);\n\t\t\t\t}\n\t\t\t\t// eslint-disable-next-line @typescript-eslint/no-dynamic-delete\n\t\t\t\tdelete this.#hARetImg[s2];\n\t\t\t//\tURL.revokeObjectURL(u2);// ç”»é¢é·ç§»ã§æ¯å›å†ç”Ÿæˆã™ã‚‹ã®ã§\n\t\t\t}\n\t\t});\n\t}\n\tstatic\t#hARetImg\t\t: {[src: string]: HTMLImageElement[]}\t= {};\n\tstatic\t#hEncImgOUrl\t: {[src: string]: string}\t\t\t\t= {};\n\n\n\tcvsResize() {\t// NOTE: ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚ºã¯ã©ã†å¤‰æ›´ã™ã¹ãã‹\n\t\tfor (const [id, f] of Object.entries(this.#hIfrm)) {\n\t\t\tconst vn = 'const.sn.frm.'+ id;\n\t\t\tconst x = Number(this.val.getVal(vn +'.x'));\n\t\t\tconst y = Number(this.val.getVal(vn +'.y'));\n\t\t\tconst w = Number(this.val.getVal(vn +'.width'));\n\t\t\tconst h = Number(this.val.getVal(vn +'.height'));\n\t\t\tf.style.left = `${FrameMng.#sys.ofsLeft4elm +x *FrameMng.#sys.cvsScale}px`;\n\t\t\tf.style.top  = `${FrameMng.#sys.ofsTop4elm  +y *FrameMng.#sys.cvsScale}px`;\n\t\t\tf.width = String(w *FrameMng.#sys.cvsScale);\n\t\t\tf.height = String(h *FrameMng.#sys.cvsScale);\n\t\t}\n\t}\n\n\t// ãƒ•ãƒ¬ãƒ¼ãƒ å¤‰æ•°ã‚’å–å¾—\n\t#let_frame(hArg: HArg) {\n\t\tconst {id, var_name} = hArg;\n\t\tif (! id) throw 'idã¯å¿…é ˆã§ã™';\n\t\tconst f = <HTMLIFrameElement | null>document.getElementById(id);\n\t\tif (! f) throw `idã€${id}ã€‘ã¯ãƒ•ãƒ¬ãƒ¼ãƒ ã§ã¯ã‚ã‚Šã¾ã›ã‚“`;\n\t\tconst vn = 'const.sn.frm.'+ id;\n\t\tif (! this.val.getVal(`tmp:${vn}`)) throw `frameã€${id}ã€‘ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“`;\n\t\tif (! var_name) throw 'var_nameã¯å¿…é ˆã§ã™';\n\n\t\t// eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n\t\tconst win = f.contentWindow!;\n\t\tif (! Object.hasOwn(win, var_name)) throw `frameã€${id}ã€‘ã«å¤‰æ•°/é–¢æ•°ã€${var_name}ã€‘ãŒã‚ã‚Šã¾ã›ã‚“ã€‚å¤‰æ•°ã¯ varä»˜ãã«ã—ã¦ä¸‹ã•ã„`;\n\n\t\t// eslint-disable-next-line @typescript-eslint/no-unsafe-assignment, @typescript-eslint/no-explicit-any, @typescript-eslint/no-unsafe-member-access\n\t\tconst v = (<any>win)[var_name];\n\t\t// varå¤‰æ•° / é–¢æ•°å®Ÿè¡Œã®æˆ»ã‚Šå€¤ -> çµ„ã¿è¾¼ã¿å¤‰æ•°\n\t\tthis.val.setVal_Nochk(\n\t\t\t'tmp',\n\t\t\tvn +'.'+ var_name,\n\t\t\t// eslint-disable-next-line @typescript-eslint/no-unsafe-argument, @typescript-eslint/no-unsafe-call\n\t\t\targChk_Boolean(hArg, 'function', false) ?v() :v\n\t\t);\n\n\t\treturn false;\n\t}\n\n\t// ãƒ•ãƒ¬ãƒ¼ãƒ å¤‰æ•°ã«è¨­å®š\n\t#set_frame(hArg: HArg) {\n\t\tconst {id, var_name, text} = hArg;\n\t\tif (! id) throw 'idã¯å¿…é ˆã§ã™';\n\t\tconst f = <HTMLIFrameElement | null>document.getElementById(id);\n\t\tif (! f) throw `idã€${id}ã€‘ã¯ãƒ•ãƒ¬ãƒ¼ãƒ ã§ã¯ã‚ã‚Šã¾ã›ã‚“`;\n\t\tconst vn = 'const.sn.frm.'+ id;\n\t\tif (! this.val.getVal(`tmp:${vn}`)) throw `frameã€${id}ã€‘ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“`;\n\t\tif (! var_name) throw 'var_nameã¯å¿…é ˆã§ã™';\n\t\tif (! text) throw 'textã¯å¿…é ˆã§ã™';\n\n\t\t// -> çµ„ã¿è¾¼ã¿å¤‰æ•°\n\t\tthis.val.setVal_Nochk('tmp', vn +'.'+ var_name, text);\n\n\t\t// -> varå¤‰æ•°ã«è¨­å®š\n\t\t// eslint-disable-next-line @typescript-eslint/no-explicit-any, @typescript-eslint/no-non-null-assertion\n\t\tconst win: any = f.contentWindow!;\n\t\t// eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n\t\twin[var_name] = text;\n\n\t\treturn false;\n\t}\n\n\t// ãƒ•ãƒ¬ãƒ¼ãƒ ã«è¨­å®š\n\t#zIdx = 1;\n\t#frame(hArg: HArg) {\n\t\tconst {id} = hArg;\n\t\tif (! id) throw 'idã¯å¿…é ˆã§ã™';\n\t\tconst f = <HTMLIFrameElement | null>document.getElementById(id);\n\t\tif (! f) throw `idã€${id}ã€‘ã¯ãƒ•ãƒ¬ãƒ¼ãƒ ã§ã¯ã‚ã‚Šã¾ã›ã‚“`;\n\t\tconst vn = 'const.sn.frm.'+ id;\n\t\tif (! this.val.getVal('tmp:'+ vn)) throw `frameã€${id}ã€‘ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“`;\n\n\t\tconst s = f.style;\n\t\tif (argChk_Boolean(hArg, 'float', false)) s.zIndex = `${++this.#zIdx}`;\n\t\telse if ('index' in hArg) s.zIndex = `${argChk_Num(hArg, 'index', 0)}`;\n\t\telse if (hArg.dive) s.zIndex = `-${++this.#zIdx}`;\n\n\t\tif ('alpha' in hArg) {\n\t\t\tconst a = s.opacity = String(hArg.alpha);\n\t\t\tthis.val.setVal_Nochk('tmp', vn +'.alpha', a);\n\t\t}\n\t\tconst rct = this.#rect(hArg);\n\t\tif ('x' in hArg || 'y' in hArg) {\n\t\t\ts.left = `${FrameMng.#sys.ofsLeft4elm +rct.x *FrameMng.#sys.cvsScale}px`;\n\t\t\ts.top  = `${FrameMng.#sys.ofsTop4elm  +rct.y *FrameMng.#sys.cvsScale}px`;\n\t\t\tthis.val.setVal_Nochk('tmp', vn +'.x', rct.x);\n\t\t\tthis.val.setVal_Nochk('tmp', vn +'.y', rct.y);\n\t\t}\n\t\tif ('scale_x' in hArg || 'scale_y' in hArg || 'rotate' in hArg) {\n\t\t\tconst sx = argChk_Num(hArg, 'scale_x', 1);\n\t\t\tconst sy = argChk_Num(hArg, 'scale_y', 1);\n\t\t\tconst r = argChk_Num(hArg, 'rotate', 0);\n\t\t\ts.transform = `scale(${sx}, ${sy}) rotate(${r}deg)`;\n\t\t\tthis.val.setVal_Nochk('tmp', vn +'.scale_x', sx);\n\t\t\tthis.val.setVal_Nochk('tmp', vn +'.scale_y', sy);\n\t\t\tthis.val.setVal_Nochk('tmp', vn +'.rotate', r);\n\t\t}\n\t\tif ('width' in hArg) {\n\t\t\tf.width = String(rct.width *FrameMng.#sys.cvsScale);\n\t\t\tthis.val.setVal_Nochk('tmp', vn +'.width', rct.width);\n\t\t}\n\t\tif ('height' in hArg) {\n\t\t\tf.height = String(rct.height *FrameMng.#sys.cvsScale);\n\t\t\tthis.val.setVal_Nochk('tmp', vn +'.height', rct.height);\n\t\t}\n\t\tif ('visible' in hArg) {\n\t\t\tconst v = argChk_Boolean(hArg, 'visible', true);\n\t\t\ts.display = v ?'inline' :'none';\n\t\t\tthis.val.setVal_Nochk('tmp', vn +'.visible', v);\n\t\t}\n\t\t// eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n\t\tif ('b_color' in hArg) s.backgroundColor = hArg.b_color!;\n\t\tif ('disabled' in hArg) {\n\t\t\tconst d = this.#hDisabled[id] = argChk_Boolean(hArg, 'disabled', true);\n\t\t\t// eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n\t\t\tconst b = f.contentDocument!.body;\n\t\t\tfor (const e of [\n\t\t\t\t...Array.from(b.getElementsByTagName('input')),\n\t\t\t\t...Array.from(b.getElementsByTagName('select')),\n\t\t\t]) e.disabled = d;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\t// ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’ãƒˆã‚¥ã‚¤ãƒ¼ãƒ³é–‹å§‹\n\t#tsy_frame(hArg: HArg) {\n\t\tconst {id, alpha, x, y, scale_x, scale_y, rotate, width, height} = hArg;\n\t\tif (! id) throw 'idã¯å¿…é ˆã§ã™';\n\t\tconst f = <HTMLIFrameElement | null>document.getElementById(id);\n\t\tif (! f) throw `idã€${id}ã€‘ã¯ãƒ•ãƒ¬ãƒ¼ãƒ ã§ã¯ã‚ã‚Šã¾ã›ã‚“`;\n\t\tconst vn = 'const.sn.frm.'+ id;\n\t\tif (! this.val.getVal(`tmp:${vn}`, 0)) throw `frameã€${id}ã€‘ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“`;\n\n\t\tconst hNow: {[val_name: string]: number} = {};\n\t\tif (alpha) hNow.a = Number(f.style.opacity);\n\t\tif (x || y || scale_x || scale_y || rotate) {\n\t\t\thNow.x = Number(this.val.getVal(`tmp:${vn}.x`));\n\t\t\thNow.y = Number(this.val.getVal(`tmp:${vn}.y`));\n\t\t\thNow.sx = Number(this.val.getVal(`tmp:${vn}.scale_x`));\n\t\t\thNow.sy = Number(this.val.getVal(`tmp:${vn}.scale_y`));\n\t\t\thNow.r = Number(this.val.getVal(`tmp:${vn}.rotate`));\n\t\t}\n\t\tif (width) hNow.w = Number(this.val.getVal(`tmp:${vn}.width`));\n\t\tif (height) hNow.h = Number(this.val.getVal(`tmp:${vn}.height`));\n\t\tconst hArg2 = CmnTween.cnvTweenArg(hArg, hNow);\n\n\t\tconst hTo: {[val_name: string]: number} = {};\n\t\tlet fncA = ()=> { /* empty */ };\n\t\tif (alpha) {\n\t\t\thTo.a = argChk_Num(hArg2, 'alpha', 0);\n\t\t\tfncA = ()=> {\n\t\t\t\tf.style.opacity = String(hNow.a);\n\t\t\t\tthis.val.setVal_Nochk('tmp', 'alpha', hNow.a);\n\t\t\t};\n\t\t}\n\t\tlet fncXYSR = ()=> { /* empty */ };\n\t\tconst rct = this.#rect(hArg2);\n\t\tif (x || y || scale_x || scale_y || rotate) {\n\t\t\thTo.x = rct.x;\n\t\t\thTo.y = rct.y;\n\t\t\thTo.sx = argChk_Num(hArg2, 'scale_x', 1);\n\t\t\thTo.sy = argChk_Num(hArg2, 'scale_y', 1);\n\t\t\thTo.r = argChk_Num(hArg2, 'rotate', 0);\n\t\t\tfncXYSR = ()=> {\n\t\t\t\tf.style.left = `${\n\t\t\t\t\t// eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n\t\t\t\t\tFrameMng.#sys.ofsLeft4elm +hNow.x! *FrameMng.#sys.cvsScale\n\t\t\t\t} px`;\n\t\t\t\tf.style.top  = `${\n\t\t\t\t\t// eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n\t\t\t\t\tFrameMng.#sys.ofsTop4elm  +hNow.y! *FrameMng.#sys.cvsScale\n\t\t\t\t} px`;\n\t\t\t\tf.style.transform = `scale(${hNow.sx}, ${hNow.sy}) rotate(${hNow.r}deg)`;\n\t\t\t\tthis.val.setVal_Nochk('tmp', vn +'.x', hNow.x);\n\t\t\t\tthis.val.setVal_Nochk('tmp', vn +'.y', hNow.y);\n\t\t\t\tthis.val.setVal_Nochk('tmp', vn +'.scale_x', hNow.sx);\n\t\t\t\tthis.val.setVal_Nochk('tmp', vn +'.scale_y', hNow.sy);\n\t\t\t\tthis.val.setVal_Nochk('tmp', vn +'.rotate', hNow.r);\n\t\t\t};\n\t\t}\n\t\tlet fncW = ()=> { /* empty */ };\n\t\tif (width) {\n\t\t\thTo.w = rct.width;\n\t\t\tfncW = ()=> {\n\t\t\t\t// eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n\t\t\t\tf.width = `${hNow.w! *FrameMng.#sys.cvsScale} px`;\n\t\t\t\tthis.val.setVal_Nochk('tmp', vn +'.width', hNow.w);\n\t\t\t};\n\t\t}\n\t\tlet fncH = ()=> { /* empty */ };\n\t\tif (height) {\n\t\t\thTo.h = rct.height;\n\t\t\tfncH = ()=> {\n\t\t\t\t// eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n\t\t\t\tf.height = `${hNow.h! *FrameMng.#sys.cvsScale} px`;\n\t\t\t\tthis.val.setVal_Nochk('tmp', vn +'.height', hNow.h);\n\t\t\t};\n\t\t}\n\n\t\tthis.appPixi.stage.interactive = false;\n\t\tCmnTween.tween(`frm\\n${id}`, hArg, hNow, CmnTween.cnvTweenArg(hArg, hNow), ()=> {\n\t\t\tfncA(); fncXYSR(); fncW(); fncH();\n\t\t}, ()=> {this.appPixi.stage.interactive = true}, ()=> { /* empty */ });\n\n\t\treturn false;\n\t}\n\n}\n","/* ***** BEGIN LICENSE BLOCK *****\n\tCopyright (c) 2025-2025 Famibee (famibee.blog38.fc2.com)\n\n\tThis software is released under the MIT License.\n\thttp://opensource.org/licenses/mit-license.php\n** ***** END LICENSE BLOCK ***** */\n\nimport type {HArg, IHTag} from './Grammar';\nimport type {IVariable} from './CmnInterface';\nimport type {T_CFG} from './ConfigBase';\n\n\nexport type T_LOG = {\n\trecText\t\t: (txt: string)=> void;\n\tpagebreak: ()=> void;\n};\n\ntype T_LOG_DATA = HArg & {\n\ttext\t: string;\t// å±¥æ­´æ–‡å­—åˆ—\n}\n\n\n// ãƒ­ã‚°ç®¡ç†\n//\tãƒ»è¦æ±‚ä»•æ§˜\n//\t\t[ch][rec_ch][rec_r][reset_rec] ã§å±¥æ­´ã‚’è¨˜éŒ²ãƒ»æ“ä½œã—ã€\n//\t\tå¤‰æ•° ğŸ¦€const.sn.log.json ã‚’å–å¾—ã—ãŸã¨ãã«ã„ã„æ„Ÿã˜ã®å€¤ã‚’è¿”ã™ã€‚\nexport class Log implements T_LOG {\n\t#LastLog\t: T_LOG_DATA\t= {text: ''};\t// ğŸŒ¾\n\t#aLog\t\t: T_LOG_DATA[]\t= [];\t\t\t// ğŸš\n\n\n\tconstructor(private readonly oCfg: T_CFG, private readonly hTag: IHTag, private readonly val: IVariable) {\n\t\thTag.rec_ch\t\t\t= o=> this.#rec_ch(o);\t\t// å±¥æ­´æ›¸ãè¾¼ã¿\n\t\thTag.rec_r\t\t\t= o=> this.#rec_r(o);\t\t// å±¥æ­´æ”¹è¡Œ\n\t\thTag.reset_rec\t\t= o=> this.#reset_rec(o);\t// å±¥æ­´ãƒªã‚»ãƒƒãƒˆ\n\n\t\t// å±¥æ­´ JSON ãƒ†ã‚­ã‚¹ãƒˆ\n\t\t// ã€å†…éƒ¨å¤‰æ•°ã€‘ï¼ˆã–ã£ãã‚Šã¨ï¼‰ğŸ¦€ = ğŸšthis.#aLog + ğŸŒ¾this.#LastLog\n\t\tval.defTmp('const.sn.log.json', ()=> {\n\t\t\t// HTMLé€£çµã‚’ä¸€ã¤ã«ã¾ã¨ã‚ã‚‹ï¼ˆå§‹ç«¯çµ‚ç«¯ã®ã‚¿ã‚°ã®ã¿ã«ã™ã‚‹ï¼‰\n\t\t\t//\ttextè¿½åŠ æ™‚ã§ã¯ãªãã€å€¤ã‚’å‚ç…§ã•ã‚Œã‚‹ã“ã®ã¨ãã¾ã§é…ã‚‰ã›ã¦å‡¦ç†\n\t\t\tthis.#LastLog.text =\t// ğŸŒ¾\n\t\t\tthis.#LastLog.text\n\t\t\t.replaceAll('</span><span class=\\'sn_ch\\'>', '');\n\n\t\t\tconst o = [...this.#aLog, this.#LastLog];\t// ğŸš + ğŸŒ¾\n\t\t\treturn JSON.stringify(o);\t// ğŸ¦€\n\t\t});\n\t\tthis.recText('');\n\t}\n\n\t// [ch] ã‹ã‚‰ã‚³ãƒ¼ãƒ«ã•ã‚Œã‚‹\n\t//\t[ch]\t\t// æ–‡å­—ã‚’è¿½åŠ ã™ã‚‹\n\t\t// recText(text: string) ã‚³ãƒ¼ãƒ«\n\t\t// \tğŸŒ¾this.#LastLog\t\t= {text};\t// ç½®æ›ã§ã‚ˆã„\n\t\t// \tğŸŠsave:const.sn.sLog = ğŸ¦€const.sn.log.json\t// ã“ã‚Œã‚’èµ·å‹•ã—ãŸã„\n\trecText(text: string) {\n\t\tthis.#LastLog.text = text;\t\t// ğŸŒ¾ text ã¯ç½®æ›ã§ã‚ˆã„\n\t\tthis.val.setVal_Nochk('save', 'const.sn.sLog',\t// ğŸŠ ãƒªãƒ—ãƒ¬ã‚¤æ™‚ã®å›å¾©ç”¨\n\t\t\tString(this.val.getVal('const.sn.log.json'))\t// ã“ã‚Œã‚’èµ·å‹•ã—ãŸã„\n\t\t);\n\t}\n\n\t//MARK: å±¥æ­´æ›¸ãè¾¼ã¿\n\t//\tğŸŒ¾this.#LastLog = {...hArg, text: ğŸŒ¾this.#LastLog.text};\n\t#rec_ch(hArg: HArg) {\n\t\tthis.#LastLog = {...hArg, text: this.#LastLog.text};\n\t\tif (! hArg.text) {\n\t\t\tthis.val.setVal_Nochk('save', 'const.sn.sLog',// ğŸŠ ãƒªãƒ—ãƒ¬ã‚¤æ™‚ã®å›å¾©ç”¨\n\t\t\t\tString(this.val.getVal('const.sn.log.json'))// ã“ã‚Œã‚’èµ·å‹•ã—ãŸã„\n\t\t\t);\n\t\t\treturn false;\n\t\t}\n\n\t\thArg.record = true;\n\t\thArg.style ??= '';\n\t\thArg.style += 'display: none;';\t// gotxtå†…ã§å‰Šé™¤ã—å±¥æ­´ã«è¡¨ç¤º\n\t\thArg.wait = 0;\n\t\treturn this.hTag.ch(hArg);\t// ã“ã®å…ˆã¯ text, style, r_style ä»¥å¤–ç ´æ£„ã•ã‚Œã¦ã—ã¾ã†ã®ã§æ³¨æ„\n\t}\n\n\t//MARK: å±¥æ­´æ”¹è¡Œ\n\t#rec_r(hArg: HArg) {return this.#rec_ch({...hArg, text: '[r]'})}\n\n\t//MARK: å±¥æ­´ãƒªã‚»ãƒƒãƒˆ\n\t//\tä»¥ä¸‹ã‚’ã‚¯ãƒªã‚¢ã€‚text ã§ç½®ãæ›ãˆå€¤ã‚’è¨­å®šã§ãã‚‹\n\t//\tğŸŒ¾this.#LastLog\t\t= {text: hArg.text ?? ''};\n\t//\tğŸšthis.#aLog\t\t= []\n\t//\tğŸŠsave:const.sn.sLog= hArg.text ?[{text:\"${hArg.text}\"}] : []\n\t#reset_rec(hArg: HArg) {\n\t\tthis.#aLog = [];\n\t\thArg.text ??= '';\n\t\tthis.#LastLog = {text: hArg.text};\t\t// ğŸŒ¾\n\t\tthis.val.setVal_Nochk('save', 'const.sn.sLog', JSON.stringify([this.#LastLog]));\t// ğŸŠ ãƒªãƒ—ãƒ¬ã‚¤æ™‚ã®å›å¾©ç”¨\n\n\t\treturn false;\n\t}\n\n\t//MARK: å±¥æ­´æ”¹ãƒšãƒ¼ã‚¸\n\tpagebreak() {\n\t\tthis.#LastLog.text =\t// ğŸŒ¾\n\t\tthis.#LastLog.text\n\t\t.replaceAll('</span><span class=\\'sn_ch\\'>', '');\n\n\t\tif (! this.#LastLog.text) return;\t//\tğŸŒ¾this.#LastLog\n\n\t\tif (this.#aLog.push(this.#LastLog) > this.oCfg.log.max_len) this.#aLog = this.#aLog.slice(-this.oCfg.log.max_len);\n\t\tthis.#LastLog = {text: ''};\t\t// ğŸŒ¾\n\t}\n\n\t//MARK: å±¥æ­´å›å¾©\n\t// save:const.sn.sLog ã‹ã‚‰ã®å¾©å¸°\n\tplayback() {\n\t\tthis.#aLog = <T_LOG_DATA[]>JSON.parse(String(this.val.getVal('save:const.sn.sLog')));\t\t// ğŸšthis.#aLog\t= ğŸŠ ãƒªãƒ—ãƒ¬ã‚¤æ™‚ã®å›å¾©ç”¨\n\t\tthis.#LastLog = {text: ''};\t\t// ğŸŒ¾\n\t}\n\n}\n","/* eslint-disable @typescript-eslint/no-non-null-assertion */\n/* ***** BEGIN LICENSE BLOCK *****\n\tCopyright (c) 2018-2025 Famibee (famibee.blog38.fc2.com)\n\n\tThis software is released under the MIT License.\n\thttp://opensource.org/licenses/mit-license.php\n** ***** END LICENSE BLOCK ***** */\n\nimport {CmnLib, getDateStr, uint, type IEvtMng, argChk_Boolean, argChk_Num, addStyle, argChk_Color, parseColor} from './CmnLib';\nimport {CmnTween, TMP_TSY_NM, TW_INT_TRANS} from './CmnTween';\nimport type {IHTag, HArg} from './Grammar';\nimport type {IVariable, IMain, HIPage, IGetFrm, IPropParser} from './CmnInterface';\nimport {Pages} from './Pages';\nimport {Layer} from './Layer';\nimport {GrpLayer} from './GrpLayer';\nimport {SpritesMng} from './SpritesMng';\nimport {type T_cmdTxt_JSON, TxtLayer} from './TxtLayer';\nimport {RubySpliter} from './RubySpliter';\nimport {TxtStage} from './TxtStage';\nimport {PROTOCOL_DL, PROTOCOL_USERDATA, type Config} from './Config';\nimport type {ScriptIterator} from './ScriptIterator';\nimport type {SysBase} from './SysBase';\nimport {FrameMng} from './FrameMng';\nimport {Button} from './Button';\nimport type {SoundMng} from './SoundMng';\nimport {DesignCast} from './DesignCast';\nimport {EventListenerCtn} from './EventListenerCtn';\nimport {Reading} from './Reading';\nimport {Log} from './Log';\n\nimport {Container, type Application, Graphics, Filter, RenderTexture, Sprite, autoDetectRenderer, Texture} from 'pixi.js';\n\n\nexport type IMakeDesignCast = (idc: DesignCast)=> void;\n\nexport type HPage = {[ln: string]: Pages};\n\nfunction cnvSArg(o: T_cmdTxt_JSON) {\n\t\t// ã‚ã–ã¨ä½¿ã†å´ã§ <T_cmdTxt_JSON> ã•ã›ã‚‹ã€‚ãã£ã¡ã§ä¸å…·åˆã‚’è¦‹ã¤ã‘ã¦ã‚‚ã‚‰ã†\n\treturn encodeURIComponent(JSON.stringify(o));\n}\n\n\nexport class LayerMng implements IGetFrm {\n\treadonly\t#stage\t: Container;\n\t\t\t\t#fore\t= new Container;\n\t\t\t\t#back\t= new Container;\n\n\treadonly\t#frmMng\t\t: FrameMng;\n\treadonly\t#bg_color\t: number;\n\n\treadonly\t#log;\n\n\treadonly\t#elc\t\t= new EventListenerCtn;\n\n\t//MARK: ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿\n\tconstructor(private readonly cfg: Config, private readonly hTag: IHTag, private readonly appPixi: Application, private readonly val: IVariable, private readonly main: IMain, private readonly scrItr: ScriptIterator, private readonly sys: SysBase, sndMng: SoundMng, prpPrs: IPropParser) {\n\t\t// ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ã‚„å›è»¢ãƒ»å…¨ç”»é¢åˆ‡ã‚Šæ›¿ãˆãƒ»DevTools è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆã®å¯¾å¿œ\n\t\tconst fncResizeLay = ()=> {\n\t\t\tsys.cvsResize();\n\t\t\tthis.cvsResizeDesign();\n\t\t\tif (this.#modeLnSub) for (const ln of this.#aLayName) {\n\t\t\t\tthis.#hPages[ln]!.fore.cvsResizeChildren();\n\t\t\t}\n\t\t\telse for (const ln of this.#aLayName) {\n\t\t\t\tthis.#hPages[ln]!.fore.cvsResize();\n\t\t\t}\n\n\t\t\tthis.#frmMng.cvsResize();\n\t\t\tthis.#evtMng.cvsResize();\n\t\t};\n\t\tif (CmnLib.isMobile) {\n\t\t\tthis.#elc.add(globalThis, 'orientationchange', fncResizeLay, {passive: true});\n\t\t}\n\t\telse {\n\t\t\tlet tid: NodeJS.Timeout | undefined = undefined;\n\t\t\tthis.#elc.add(globalThis, 'resize', ()=> {\n\t\t\t\tif (tid) return;\n\t\t\t\ttid = setTimeout(()=> {tid = undefined; fncResizeLay()}, 1000 /60 *10);\t// clearTimeout()ä¸è¦ã¨åˆ¤æ–­\n\t\t\t}, {passive: true});\n\t\t}\n\t\tsys.cvsResize();\n\n\t\tthis.#log = new Log(this.cfg.oCfg, hTag, val);\n\t\tTxtLayer.init(cfg, hTag, val, this.#log, me=> this.#hPages[me.layname]!.fore === me, appPixi);\n\t\tGrpLayer.init(main, cfg, appPixi, sys, sndMng, val);\n\t\tFrameMng.init(cfg, sys, main);\n\t\tButton.init(cfg);\n\n\t\tthis.#frmMng = new FrameMng(hTag, appPixi, val);\n\t\tsys.hFactoryCls.grp = ()=> new GrpLayer;\n\t\tsys.hFactoryCls.txt = ()=> new TxtLayer;\n\n\t\t//\tã‚·ã‚¹ãƒ†ãƒ \n\t\thTag.loadplugin\t\t= o=> this.#loadplugin(o);\t// ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®èª­ã¿è¾¼ã¿\n\t\t//hTag.set_focus\t// EventMng.tsã§å®šç¾©\t \t// ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ç§»å‹•\n\t\thTag.snapshot\t\t= o=> this.#snapshot(o);\t// ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆ\n\t\tthis.#snapshot4proc = this.sys.isApp\n\t\t\t? (hArg, url, width, height, RPN_SNAPSHOT)=> this.#snapshot4app(hArg, url, width, height, RPN_SNAPSHOT)\n\t\t\t: (hArg, url, width, height, RPN_SNAPSHOT)=> this.#snapshot4web(hArg, url, width, height, RPN_SNAPSHOT);\n\n\t\t//\tãƒ¬ã‚¤ãƒ¤å…±é€š\n\t\thTag.add_lay\t\t= o=> this.#add_lay(o);\t\t// ãƒ¬ã‚¤ãƒ¤ã‚’è¿½åŠ ã™ã‚‹\n\t\thTag.clear_lay\t\t= o=> this.#clear_lay(o);\t// ãƒ¬ã‚¤ãƒ¤è¨­å®šã®æ¶ˆå»\n\t\thTag.finish_trans\t= ()=> false;\t\t\t\t// ãƒˆãƒ©ãƒ³ã‚¹å¼·åˆ¶çµ‚äº†\n\t\thTag.lay\t\t\t= o=> this.#lay(o);\t\t\t// ãƒ¬ã‚¤ãƒ¤è¨­å®š\n\t\thTag.trans\t\t\t= o=> this.#trans(o);\t\t// ãƒšãƒ¼ã‚¸è£è¡¨ã‚’äº¤æ›\n\t\thTag.wt\t\t\t\t= o=> CmnTween.wt(o);\t\t// ãƒˆãƒ©ãƒ³ã‚¹çµ‚äº†å¾…ã¡\n\n\t\thTag.quake\t\t\t= o=> this.#quake(o);\t\t// ç”»é¢ã‚’æºã‚‰ã™\n\t\thTag.stop_quake\t\t= hTag.finish_trans;\t\t// ç”»é¢æºã‚‰ã—ä¸­æ–­\n\t\thTag.wq\t\t\t\t= hTag.wt;\t\t\t\t\t// ç”»é¢æºã‚‰ã—çµ‚äº†å¾…ã¡\n\n\t\thTag.pause_tsy\t\t= o=> CmnTween.pause_tsy(o);\t// ä¸€æ™‚åœæ­¢\n\t\thTag.resume_tsy\t\t= o=> CmnTween.resume_tsy(o);\t// ä¸€æ™‚åœæ­¢å†é–‹\n\t\thTag.stop_tsy\t\t= o=> CmnTween.stop_tsy(o);\t// ãƒˆã‚¥ã‚¤ãƒ¼ãƒ³ä¸­æ–­\n\t\thTag.tsy\t\t\t= o=> this.#tsy(o);\t\t\t// ãƒˆã‚¥ã‚¤ãƒ¼ãƒ³é–‹å§‹\n\t\thTag.wait_tsy\t\t= o=> CmnTween.wait_tsy(o);\t// ãƒˆã‚¥ã‚¤ãƒ¼ãƒ³çµ‚äº†å¾…ã¡\n\n\t\thTag.add_filter\t\t= o=> this.#add_filter(o);\t// ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼è¿½åŠ \n\t\thTag.clear_filter\t= o=> this.#clear_filter(o);// ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼å…¨å‰Šé™¤\n\t\thTag.enable_filter\t= o=> this.#enable_filter(o);// ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼å€‹åˆ¥åˆ‡æ›¿\n\n\t\t//\tæ–‡å­—ãƒ»æ–‡å­—ãƒ¬ã‚¤ãƒ¤\n\t//\thTag.auto_pager\t\t= o=> this.auto_pager(o);\t// è‡ªå‹•æ”¹ãƒšãƒ¼ã‚¸ã®è¨­å®š\n\t\t//hTag.autowc\t\t// TxtLayer.ts ã§å®šç¾©\t\t// æ–‡å­—ã”ã¨ã®ã‚¦ã‚§ã‚¤ãƒˆ\n\t\thTag.ch\t\t\t\t= o=> this.#ch(o);\t\t\t// æ–‡å­—ã‚’è¿½åŠ ã™ã‚‹\n\t\t//hTag.ch_in_style\t// TxtLayer.ts ã§å®šç¾©\t\t// æ–‡å­—å‡ºç¾æ–‡å­—å‡ºç¾æ¼”å‡º\n\t\t//hTag.ch_out_style\t// TxtLayer.ts ã§å®šç¾©\t\t// æ–‡å­—æ¶ˆå»æ–‡å­—å‡ºç¾æ¼”å‡º\n\t\thTag.clear_text\t\t= o=> this.#clear_text(o);\t// æ–‡å­—æ¶ˆå»\n\t\thTag.current\t\t= o=> this.#current(o);\t\t// ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæ–‡å­—ãƒ¬ã‚¤ãƒ¤è¨­å®š\n\t\thTag.endlink\t\t= o=> this.#endlink(o);\t\t// ãƒã‚¤ãƒ‘ãƒ¼ãƒªãƒ³ã‚¯ã®çµ‚äº†\n\t\thTag.er\t\t\t\t= o=> this.#er(o);\t\t\t// ãƒšãƒ¼ã‚¸ä¸¡é¢ã®æ–‡å­—æ¶ˆå»\n\t\thTag.graph\t\t\t= o=> this.#graph(o);\t\t// ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ç”»åƒè¡¨ç¤º\n\t\thTag.link\t\t\t= o=> this.#link(o);\t\t// ãƒã‚¤ãƒ‘ãƒ¼ãƒªãƒ³ã‚¯\n\t\thTag.r\t\t\t\t= o=> this.#r(o);\t\t\t// æ”¹è¡Œ\n\t\t// hTag.rec_ch\t\t// Log.ts ã§å®šç¾©\t\t\t// å±¥æ­´æ›¸ãè¾¼ã¿\n\t\t// hTag.rec_r\t\t// Log.ts ã§å®šç¾©\t\t\t// å±¥æ­´æ”¹è¡Œ\n\t\t// hTag.reset_rec\t// Log.ts ã§å®šç¾©\t\t\t// å±¥æ­´ãƒªã‚»ãƒƒãƒˆ\n\t\t//hTag.ruby\t\t\t= o=> this.ruby(o);\t\t\t// ç›´å‰ä¸€æ–‡å­—ã®ãƒ«ãƒ“ï¼ˆå»ƒæ­¢\n\t\t\t// ã‚¿ã‚°ã§ã¯ç„¡ãã€ã€Œï½œï¼ ã€Šã€‹ã€ã¨ã„ã†ã‚¹ã‚¯ãƒªãƒ—ãƒˆæ›¸ãæ›ãˆã§è‰¯ã„\n\t\thTag.ruby2\t\t\t= o=> this.#ruby2(o);\t\t// æ–‡å­—åˆ—ã¨è¤‡æ•°ãƒ«ãƒ“ã®è¿½åŠ \n\t\thTag.span\t\t\t= o=> this.#span(o);\t\t// ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚¹ã‚¿ã‚¤ãƒ«è¨­å®š\n\t\thTag.tcy\t\t\t= o=> this.#tcy(o);\t\t\t// ç¸¦ä¸­æ¨ªã‚’è¡¨ç¤ºã™ã‚‹\n\n\t\t//\tç”»åƒãƒ»ç”»åƒãƒ¬ã‚¤ãƒ¤\n\t\thTag.add_face\t\t= o=> SpritesMng.add_face(o);\t// å·®åˆ†åç§°ã®å®šç¾©\n\n\t\t//\tãƒ ãƒ¼ãƒ“ãƒ¼ãƒ¬ã‚¤ãƒ¤\n\t\thTag.wv\t\t\t\t= o=> SpritesMng.wv(o);\t\t// ãƒ ãƒ¼ãƒ“ãƒ¼å†ç”Ÿçµ‚äº†å¾…ã¡\n\n\t\t//\tãƒ‡ãƒãƒƒã‚°ãƒ»ãã®ä»–\n\t\thTag.dump_lay\t\t= o=> this.#dump_lay(o);\t// ãƒ¬ã‚¤ãƒ¤ã®ãƒ€ãƒ³ãƒ—\n\n\t\t//\tã‚¤ãƒ™ãƒ³ãƒˆ\n\t\thTag.enable_event\t= o=> this.#enable_event(o);// ã‚¤ãƒ™ãƒ³ãƒˆæœ‰ç„¡ã®åˆ‡æ›¿\n\n\t\t//\tãƒ©ãƒ™ãƒ«ãƒ»ã‚¸ãƒ£ãƒ³ãƒ—\n\t\thTag.button\t\t\t= o=> this.#button(o);\t\t// ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º\n\n\n\t\tif (cfg.existsBreakline) this.breakLine = (hArg: HArg)=> {\n\t\t\tdelete hArg.visible;\n\t\t\thArg.id = 'break';\n\t\t\thArg.pic= 'breakline';\n\t\t\tthis.#cmdTxt('grpï½œ'+ cnvSArg(<T_cmdTxt_JSON>hArg));\n\t\t};\n\t\tif (cfg.existsBreakpage) this.breakPage = (hArg: HArg)=> {\n\t\t\tdelete hArg.visible;\n\t\t\thArg.id = 'break';\n\t\t\thArg.pic= 'breakpage';\n\t\t\tthis.#cmdTxt('grpï½œ'+ cnvSArg(<T_cmdTxt_JSON>hArg));\n\t\t};\n\n\t\tthis.#bg_color = parseColor(String(cfg.oCfg.init.bg_color));\n\t\tconst grp = new Graphics;\n\t\tgrp\n\t\t.beginFill(this.#bg_color)\t// ã‚¤ãƒ™ãƒ³ãƒˆã‚’å—ã‘å–ã‚‹ãŸã‚ã«ã‚‚å¡—ã‚‹\n\t\t.lineStyle(0, this.#bg_color)\n\t\t.drawRect(0, 0, CmnLib.stageW, CmnLib.stageH)\n\t\t.endFill();\n\t\tthis.#fore.addChild(grp.clone());\n\t\tthis.#back.addChild(grp);\n\t\tthis.#back.visible = false;\n\t\tthis.#fore.name = 'page:A';\t// 4tst\n\t\tthis.#back.name = 'page:B';\t// 4tst\n\n\t\tthis.#stage = appPixi.stage;\n\t\tthis.#stage.addChild(this.#back);\n\t\tthis.#stage.addChild(this.#fore);\n\t\tthis.#stage.addChild(this.#spTransBack);\n\t\tthis.#stage.addChild(this.#spTransFore);\n\t\tthis.#stage.name = 'stage';\t// 4tst\n/*\n\t\tconsole.group('new DispMng info');\n\t\tconsole.info(appPixi.renderer);\n\t\tconsole.info('utils.isMobile():'+ utils.isMobile.any);\n\t\t\t\t// https://github.com/kaimallea/isMobile\n\t\tconsole.info('utils.isWebGLSupported():'+ utils.isWebGLSupported());\n\t\tconsole.info('w:%O: h:%O:', CmnLib.stageW, CmnLib.stageH);\n\t\tconsole.groupEnd();\n*/\n\t\t// eslint-disable-next-line @typescript-eslint/no-explicit-any\n\t\tconst fncTxt_b_alpha = (_name: string, val: any)=> {\n\t\t\tthis.#foreachRedrawTxtLayBack(Number(val))\n\t\t};\n\t\tfncTxt_b_alpha('', val.getVal('sys:TextLayer.Back.Alpha', 1));\n\t\tval.defValTrg('sys:TextLayer.Back.Alpha', fncTxt_b_alpha);\n\n\t\t// eslint-disable-next-line @typescript-eslint/no-explicit-any, @typescript-eslint/no-unsafe-assignment\n\t\tconst fncBtnFont = (_name: string, val: any)=> {Button.fontFamily = val};\n\t\tfncBtnFont('', val.getVal('tmp:sn.button.fontFamily', Button.fontFamily));\n\t\tval.defValTrg('tmp:sn.button.fontFamily', fncBtnFont);\n\n\t\tval.defTmp('const.sn.last_page_text', ()=> this.currentTxtlayFore?.pageText ?? '');\n\t\tval.defTmp('const.sn.last_page_plain_text', ()=> this.currentTxtlayFore?.pagePlainText ?? '');\n\t\tif (CmnLib.isDbg) {\n\t\t\tDesignCast.init(appPixi, sys, scrItr, prpPrs, cfg, this.#hPages);\n\t\t\tthis.cvsResizeDesign = ()=> DesignCast.cvsResizeDesign();\n\t\t\tsys.addHook((type, o)=> {\n\t\t\t\tif (! this.#hProcDbgRes[type]?.(type, o)) return;\n\t\t\t\t// eslint-disable-next-line @typescript-eslint/no-dynamic-delete\n\t\t\t\tdelete this.#hProcDbgRes[type];\n\t\t\t});\n\t\t}\n\t}\n\tprivate\tcvsResizeDesign() { /* empty */ }\n\n\n\treadonly\t#hProcDbgRes\n\t// eslint-disable-next-line @typescript-eslint/no-explicit-any\n\t: {[type: string]: (type: string, o: any)=> boolean}\t= {\n\t\tattach\t\t: _=> {DesignCast.leaveMode();\treturn false},\n\t\tcontinue\t: _=> {DesignCast.leaveMode();\treturn false},\n\t\tdisconnect\t: _=> {DesignCast.leaveMode();\treturn false},\n\t\t_enterDesign: _=> {\n\t\t\tDesignCast.enterMode();\n\t\t\tfor (const ln of this.#aLayName) {\n\t\t\t\tconst lay = this.#hPages[ln]!.fore;\n\t\t\t\tlay.makeDesignCastChildren(gdc=> gdc.make());\n\t\t\t\tlay.makeDesignCast(gdc=> gdc.make());\n\t\t\t}\n\n\t\t\tthis.#selectNode(this.#curTxtlay);\treturn false;\n\t\t//\tthis.selectNode('mes/ãƒœã‚¿ãƒ³');\treturn false;\t// Testç”¨\n\t\t//\tthis.selectNode(this.firstGrplay);\treturn false;\n\t\t\t\t// åˆ¶ä½œä¸­ã¯æ™®é€šç”»åƒãƒ¬ã‚¤ãƒ¤ã‚’ã„ã˜ã‚‹ã®ãŒä¸»ãªã®ã§ã€ã“ã‚ŒãŒã„ã„\n\t\t},\n\t\t_replaceToken: (_, o)=> {DesignCast.replaceToken(o); return false},\n\t\t// eslint-disable-next-line @typescript-eslint/no-unsafe-argument, @typescript-eslint/no-unsafe-member-access\n\t\t_selectNode\t: (_, o)=> {this.#selectNode(o.node); return false},\n\t}\n\t#modeLn\t\t= '';\n\t#modeLnSub\t= '';\n\t#selectNode(node: string) {\n\t\t[this.#modeLn='', this.#modeLnSub=''] = node.split('/');\n\t\tconst pages = this.#hPages[this.#modeLn];\n\t\tif (! pages) return;\n\n\t\tDesignCast.allHide();\n\t\tif (this.#modeLnSub) pages.fore.showDesignCastChildren();\n\t\telse pages.fore.showDesignCast();\n\t}\n\n\tgetFrmDisabled = (id: string)=> this.#frmMng.getFrmDisabled(id);\n\n\t#grpCover : Graphics | undefined = undefined;\n\tcover(visible: boolean, bg_color = 0x0) {\n\t\tif (this.#grpCover) {\n\t\t\tthis.#stage.removeChild(this.#grpCover);\n\t\t\tthis.#grpCover.destroy();\n\t\t\tthis.#grpCover = undefined;\n\t\t}\n\t\tif (visible) this.#stage.addChild(\n\t\t\t(this.#grpCover = new Graphics)\n\t\t\t.beginFill(bg_color)\n\t\t\t.lineStyle(0, bg_color)\n\t\t\t.drawRect(0, 0, CmnLib.stageW, CmnLib.stageH)\n\t\t\t.endFill()\n\t\t);\n\t}\n\n\t#evtMng\t: IEvtMng;\n\tsetEvtMng(evtMng: IEvtMng) {\n\t\tthis.#evtMng = evtMng;\n\t\tthis.#frmMng.setEvtMng(evtMng);\n\t\tSpritesMng.setEvtMng(evtMng);\n\t\tCmnTween.init(evtMng, this.appPixi);\n\t}\n\n\tdestroy() {\n\t\tfor (const p of Object.values(this.#hPages)) p.destroy();\n\n\t\tthis.#elc.clear();\n\t\tGrpLayer.destroy();\n\t\tRubySpliter.destroy();\n\t\tTxtStage.destroy();\n\t\tTxtLayer.destroy();\n\n\t\tthis.#frmMng.destroy();\n\n\t\tCmnTween.destroy();\n\t\tLayerMng.#msecChWait = 10;\n\t}\n\n\n\t// æ—¢å­˜ã®å…¨æ–‡å­—ãƒ¬ã‚¤ãƒ¤ã®å®Ÿéš›ã®ãƒãƒƒã‚¯ä¸é€æ˜åº¦ã€ã‚’å†è¨ˆç®—\n\t#foreachRedrawTxtLayBack(g_alpha: number) {\n\t\tfor (const ln of this.#aLayName) {\n\t\t\tconst {fore, back} = this.#hPages[ln]!;\n\t\t\tif (! (fore instanceof TxtLayer)) continue;\n\t\t\tfore.chgBackAlpha(g_alpha);\n\t\t\t(<TxtLayer>back).chgBackAlpha(g_alpha);\n\t\t}\n\t}\n\n\n\t#cmdTxt = (cmd: string, tl = this.currentTxtlayForeNeedErr, _record = true)=> tl.tagCh('ï½œ&emsp;ã€Š'+ cmd +'ã€‹');\n\tgoTxt = ()=> { /* empty */ };\n\tget needGoTxt() {return this.currentTxtlayFore?.needGoTxt ?? false;}\n\tbreakLine = (_hArg: HArg)=> { /* empty */ };\n\tbreakPage = (_hArg: HArg)=> { /* empty */ };\n\tclearBreak() {\n\t\tif (! this.currentTxtlayFore) return;\n\n\t\tthis.clearBreak = ()=> this.#cmdTxt('delï½œbreak');\n\t\tthis.clearBreak();\n\t}\n\n\tclickTxtLay(): boolean {\t// true: æ–‡å­—å‡ºç¾ä¸­ã ã£ãŸã®ã§ã€åœæ­¢ã™ã‚‹\n\t\tif (! this.currentTxtlayFore) return false;\n\n\t\treturn this.#aLayName\n\t\t.map(ln=> this.#hPages[ln]!.fore)\n\t\t.some(f=> f instanceof TxtLayer && f.click());\n\t}\n\n\n//\t//\tã‚·ã‚¹ãƒ†ãƒ \n\t//MARK: ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆ\n\t#snapshot(hArg: HArg) {\n\t\tconst dt = getDateStr('-', '_', '', '_');\n\t\tconst fn0 = hArg.fn\n\t\t? hArg.fn.startsWith(PROTOCOL_USERDATA)\n\t\t\t? hArg.fn\n\t\t\t: `${PROTOCOL_DL + hArg.fn + dt}.png`\n\t\t: `${PROTOCOL_DL}snapshot${dt}.png`;\n\t\tconst url = this.cfg.searchPath(fn0);\n\t\tconst width = argChk_Num(hArg, 'width', CmnLib.stageW);\n\t\tconst height= argChk_Num(hArg, 'height', CmnLib.stageH);\n\t\treturn this.#snapshot4proc(hArg, url, width, height, `snapshot dt:${dt}`);\n\t}\n\t#snapshot4proc :(hArg: HArg, url: string, width: number, height: number, RPN_SNAPSHOT: string)=> boolean = ()=> false;\n\t#snapshot4app({layer}: HArg, url: string, width: number, height: number, RPN_SNAPSHOT: string): boolean {\n\t\tthis.#frmMng.hideAllFrame();\n\t\tReading.beginProc(RPN_SNAPSHOT);\n\t\tif (! layer) {\n\t\t\tthis.sys.capturePage(url, width, height, ()=> {\n\t\t\t\tthis.#frmMng.restoreAllFrame();\n\t\t\t\tReading.endProc(RPN_SNAPSHOT);\n\t\t\t});\n\t\t\treturn true;\n\t\t}\n\n\t\t// ä¸€æ™‚çš„ã«éè¡¨ç¤ºã«ã—ã¦ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆ\n\t\tconst aBk = this.#aLayName\n\t\t.map(ln=> {\n\t\t\tconst {ctn} = this.#hPages[ln]!.fore;\n\t\t\tconst ret: [Sprite, boolean] = [ctn, ctn.visible];\n\t\t\tctn.visible = false;\n\t\t\treturn ret;\n\t\t});\n\t\tfor (const ln of this.#getLayers(layer)) this.#hPages[ln]!.fore.ctn.visible = true;\n\n\t\tthis.sys.capturePage(url, width, height, ()=> {\n\t\t\tfor (const [sp, v] of aBk) sp.visible = v;\n\t\t\tthis.#frmMng.restoreAllFrame();\n\t\t\tReading.endProc(RPN_SNAPSHOT);\n\t\t});\n\t\treturn true;\n\t}\n\t#snapshot4web(hArg: HArg, url: string, width: number, height: number, RPN_SNAPSHOT: string): boolean {\n\t\tReading.beginProc(RPN_SNAPSHOT);\n\t\tconst b_color = argChk_Color(hArg, 'b_color', this.#bg_color);\n\t\tconst rnd = autoDetectRenderer({\n\t\t\twidth,\n\t\t\theight,\n\t\t\tbackgroundAlpha: b_color > 0x1000000 && url.endsWith('.png') ?0 :1,\n\t\t\tantialias: argChk_Boolean(hArg, 'smoothing', false),\n\t\t\tpreserveDrawingBuffer: true,\n\t\t\tbackgroundColor: b_color & 0xFFFFFF,\n\t\t\tautoDensity: true,\n\t\t});\n\t\tconst pg = hArg.page !== 'back' ?'fore' :'back';\n\t\tconst {layer} = hArg;\n\t\tvoid Promise.allSettled(\n\t\t\tthis.#getLayers(layer).map(ln=> new Promise<void>(\n\t\t\t\tre=> this.#hPages[ln]![pg].snapshot(rnd, re)\n\t\t\t))\n\t\t).then(async ()=> {\n\t\t\tconst renTx = RenderTexture.create({width: rnd.width, height: rnd.height});\t// ã¯ã¿å‡ºã—å¯¾ç­–\n\t\t\trnd.render(this.#stage, {renderTexture: renTx});\n\t\t\tawait this.sys.savePic(\n\t\t\t\turl,\n\t\t\t\t// eslint-disable-next-line @typescript-eslint/no-unsafe-argument, @typescript-eslint/no-unsafe-call, @typescript-eslint/no-unsafe-member-access\n\t\t\t\trnd.plugins.extract.base64(renTx),\n\t\t\t);\n\t\t\trenTx.destroy();\n\n\t\t\tfor (const ln of this.#getLayers(layer)) this.#hPages[ln]![pg].snapshot_end();\n\t\t\trnd.destroy(true);\n\n\t\t\tReading.endProc(RPN_SNAPSHOT);\n\t\t});\n\t\treturn true;\n\t}\n\n\t//MARK: ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®èª­ã¿è¾¼ã¿\n\t#loadplugin(hArg: HArg) {\n\t\tconst {fn} = hArg;\n\t\tif (! fn) throw 'fnã¯å¿…é ˆã§ã™';\n\t\tif (! fn.endsWith('.css')) throw 'ã‚µãƒãƒ¼ãƒˆã•ã‚Œãªã„æ‹¡å¼µå­ã§ã™';\n\n\t\tconst join = argChk_Boolean(hArg, 'join', true);\n\t\tconst RPN_LOADPLUGIN = Reading.procID +`loadplugin fn:${fn}`;\n\t\tif (join) Reading.beginProc(RPN_LOADPLUGIN);\n\t\t(async ()=> {\n\t\t\tconst res = await fetch(fn);\n\t\t\tif (! res.ok) throw new Error('Network response was not ok.');\n\n\t\t\taddStyle(await res.text());\n\t\t\tif (join) Reading.endProc(RPN_LOADPLUGIN);\n\t\t})();\n\n\t\treturn join;\n\t}\n\n\n//\t//\tãƒ¬ã‚¤ãƒ¤å…±é€š\n\t//MARK: ãƒ¬ã‚¤ãƒ¤ã‚’è¿½åŠ ã™ã‚‹\n\t#add_lay(hArg: HArg) {\n\t\tconst {layer, class: cls} = hArg;\n\t\tif (! layer) throw 'layerã¯å¿…é ˆã§ã™';\n\t\tif (layer.includes(',')) throw 'layeråã«ã€Œ,ã€ã¯ä½¿ãˆã¾ã›ã‚“';\n\t\tif (layer in this.#hPages) throw `layerã€${layer}ã€‘ã¯ã™ã§ã«ã‚ã‚Šã¾ã™`;\n\t\tif (! cls) throw 'clsã¯å¿…é ˆã§ã™';\n\n\t\tconst ret = {isWait: false}\n\t\tthis.#hPages[layer] = new Pages(layer, cls, this.#fore, this.#back, hArg, this.sys, this.val, ret);\n\t\tthis.#aLayName.push(layer);\n\t\tswitch (cls) {\n\t\tcase 'txt':\n\t\t\tif (! this.#curTxtlay) {\n\t\t\t\tthis.#chkTxtLay = ()=> { /* empty */ };\n\t\t\t\tthis.#getTxtLayer = o=> this.#$getTxtLayer(o);\n\t\t\t\tthis.#current = o=> this.#$current(o);\n\t\t\t\tthis.hTag.current({layer});\t// hPagesæ›´æ–°å¾Œã§ãªã„ã¨å‘¼ã¹ãªã„\n\t\t\t\tthis.goTxt = ()=> {\n\t\t\t\t\tif (this.#evtMng.isSkipping) LayerMng.#msecChWait = 0;\n\t\t\t\t\telse this.setNormalChWait();\n\t\t\t\t\tfor (const ln of this.#aLayName) {\n\t\t\t\t\t\tconst f = this.#hPages[ln]!.fore;\n\t\t\t\t\t\tif (f instanceof TxtLayer) this.#cmdTxt('gotxtï½œ', f, false);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.val.setVal_Nochk('save', 'const.sn.layer.'+ layer +'.enabled', true);\n\t\t\tbreak;\n\n\t\tcase 'grp':\n\t\t\tif (this.#firstGrplay) break;\n\t\t\tthis.#firstGrplay = layer;\n\t\t\tbreak;\n\t\t}\n\n\t\tthis.scrItr.recodeDesign(hArg);\t// hArg[':id_tag'] ã¯ new Pages å†…ã§è¨­å®š\n\n\t\treturn ret.isWait;\n\t}\n\t#hPages\t\t: HPage\t\t= { /* empty */ };\t// ã—ãŠã‚ŠLoadæ™‚å†èª­è¾¼\n\t#aLayName\t: string[]\t= [];\t// æœ€é©åŒ–ç”¨ãƒ»é‡ãªã‚Šé †ã¤ãå…¨ãƒ¬ã‚¤ãƒ¤å\n\t#curTxtlay\t\t= '';\n\t#firstGrplay\t= '';\n\n\t#lay(hArg: HArg): boolean {\n\t\t// Trans\n\t\tconst ln = this.#argChk_layer(hArg);\n\t\tconst pg = this.#hPages[ln]!;\n\t\tconst back = pg.back.ctn;\n\t\tconst fore = pg.fore.ctn;\n\t\tif (argChk_Boolean(hArg, 'float', false)) {\n\t\t\tthis.#back.setChildIndex(back, this.#back.children.length -1);\n\t\t\tthis.#fore.setChildIndex(fore, this.#fore.children.length -1);\n\t\t\tthis.#rebuildLayerRankInfo();\n\t\t}\n\t\telse if (hArg.index) {\n\t\t\tif (argChk_Num(hArg, 'index', 0)) {\n\t\t\t\tthis.#back.setChildIndex(back, hArg.index);\n\t\t\t\tthis.#fore.setChildIndex(fore, hArg.index);\n\t\t\t\tthis.#rebuildLayerRankInfo();\n\t\t\t}\n\t\t}\n\t\telse if (hArg.dive) {\n\t\t\tconst {dive} = hArg;\n\t\t\tlet idx_dive = 0;\n\t\t\tif (ln === dive) throw '[lay] å±æ€§ layerã¨diveãŒåŒã˜ã€'+ dive +'ã€‘ã§ã™';\n\n\t\t\tconst pg_dive = this.#hPages[dive];\n\t\t\tif (! pg_dive) throw '[lay] å±æ€§ diveã€'+ dive +'ã€‘ãŒä¸æ­£ã§ã™ã€‚ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒã‚ã‚Šã¾ã›ã‚“';\n\t\t\tconst back_dive = pg_dive.back;\n\t\t\tconst fore_dive = pg_dive.fore;\n\t\t\tconst idx_back_dive = this.#back.getChildIndex(back_dive.ctn);\n\t\t\tconst idx_fore_dive = this.#fore.getChildIndex(fore_dive.ctn);\n\t\t\tidx_dive = idx_back_dive < idx_fore_dive ?idx_back_dive :idx_fore_dive;\n\t\t\tif (idx_dive > this.#back.getChildIndex(back)) --idx_dive;\t//è‡ªåˆ†ãŒç„¡ããªã£ã¦ä¸‹ãŒã‚‹åˆ†ä¸‹ã’ã‚‹\n\n\t\t\tthis.#fore.setChildIndex(fore, idx_dive);\n\t\t\tthis.#back.setChildIndex(back, idx_dive);\n\t\t\tthis.#rebuildLayerRankInfo();\n\t\t}\n\n\t\thArg[':id_tag'] = pg.fore.name.slice(0, -7);\n\t\tthis.scrItr.recodeDesign(hArg);\t// å¿…ãš[':id_tag'] ã‚’è¨­å®šã™ã‚‹ã“ã¨\n\n\t\treturn pg.lay(hArg);\n\t}\n\t#rebuildLayerRankInfo() {this.#aLayName = this.#sortLayers()}\n\n\t//MARK: ãƒ¬ã‚¤ãƒ¤è¨­å®šã®æ¶ˆå»\n\t#clear_lay(hArg: HArg) {\n\t\tthis.#foreachLayers(hArg, layer=> {\n\t\t\t//if (name === this.strTxtlay && hArg.page !== 'back') this.recText('', true);\n\t\t\t\t// æ”¹ãƒšãƒ¼ã‚¸\n\t\t\tconst pg = this.#hPages[this.#argChk_layer({layer})]!;\n\t\t\tif (hArg.page === 'both') {\t// page=both ã§ä¸¡é¢å‰Šé™¤\n\t\t\t\tpg.fore.clearLay(hArg);\n\t\t\t\tpg.back.clearLay(hArg);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tpg.getPage(hArg).clearLay(hArg);\n\t\t});\n\n\t\treturn false;\n\t}\n\n\t//===================================================\n\t//MARK: WebGL ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ GLSL\n\tstatic\treadonly\t#srcRuleTransFragment = /* glsl */`\nprecision mediump float;\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\n\nuniform sampler2D rule;\nuniform float vague;\nuniform float tick;\n\nuniform vec4 inputPixel;\nuniform highp vec4 outputFrame;\nvec2 getUV(vec2 coord) {\n\treturn coord * inputPixel.xy / outputFrame.zw;\n}\n\nvoid main() {\n\tvec4 fg = texture2D(uSampler, vTextureCoord);\n\tvec4 ru = texture2D(rule, getUV(vTextureCoord));\n\n\tfloat v = ru.r - tick;\n\tgl_FragColor = abs(v) < vague\n\t\t? vec4(fg.rgb, 1) *fg.a *(0.5 +v /vague *0.5)\n\t\t: 0.0 <= v ? fg : vec4(0);\n}`;\n/*\n\tæœ«å°¾ãŒèª­ã¿ã¥ã‚‰ã„ãŒã€ä»¥ä¸‹ã®ifæ–‡ã‚’æ¶ˆã—ã¦ä¸‰é …æ¼”ç®—å­ã«ã—ã¦ã„ã‚‹ã€‚\n\n\tif (abs(v) < vague) {\n\t\tfloat f_a = fg.a *(0.5 +v /vague *0.5);\n\t\tgl_FragColor.rgb = fg.rgb *f_a;\n\t\tgl_FragColor.a = f_a;\n\t\treturn;\n\t}\n\tgl_FragColor = v >= 0.0 ? fg : vec4(0);\n\n\t\tâ˜…GLSL : don't use \"if\"ï½œNobu note.com/nobuhirosaijo/n/n606a3f5d8e89\n\t\t\t> ifæ–‡ã¯ã‚ã¾ã‚Šä½¿ã‚ãªã„æ–¹ãŒã„ã„ã‚‰ã—ã„ (å‡¦ç†è² è·ãŒé«˜ã„)\n*/\n\n\n\t#rtTransBack = RenderTexture.create({\n\t\twidth\t: CmnLib.stageW,\n\t\theight\t: CmnLib.stageH,\n\t});\n\t#spTransBack = new Sprite(this.#rtTransBack);\n\n\t#rtTransFore = RenderTexture.create({\n\t\twidth\t: CmnLib.stageW,\n\t\theight\t: CmnLib.stageH,\n\t});\n\t#spTransFore = new Sprite(this.#rtTransFore);\n\n\n\t//MARK: ãƒšãƒ¼ã‚¸è£è¡¨ã‚’äº¤æ›\n\t#trans(hArg: HArg) {\n\t\tconst {layer} = hArg;\n\t\tconst sDoTrans = new Set<string>;\n\t\tconst aLayFore = this.#getLayers(layer).map(ln=> {\n\t\t\tsDoTrans.add(ln);\n\t\t\treturn this.#hPages[ln]!.fore;\n\t\t});\n\n\t\tconst comp = ()=> {\n\t\t\t[this.#fore, this.#back] = [this.#back, this.#fore];\n\t\t\tconst aPrm: Promise<void>[] = [];\n\t\t\tfor (const [ln, pg] of Object.entries(this.#hPages)) {\n\t\t\t\tif (sDoTrans.has(ln)) {pg.transPage(aPrm); continue}\n\n\t\t\t\t// transã—ãªã„ãŸã‚ã«äº¤æ›ã™ã‚‹\n\t\t\t\tconst {fore: {ctn: f}, back: {ctn: b}} = pg;\n\t\t\t\tconst idx = this.#fore.getChildIndex(b);\n\t\t\t\tthis.#fore.removeChild(b);\n\t\t\t\tthis.#back.removeChild(f);\n\t\t\t\tthis.#fore.addChildAt(f, idx);\n\t\t\t\tthis.#back.addChildAt(b, idx);\n\t\t\t}\n\t\t\tvoid Promise.allSettled(aPrm).then(()=> {\n\t\t\t\tthis.#fore.visible = true;\n\t\t\t\tthis.#back.visible = false;\t// å†ã³éè¡¨ç¤ºã®è£æ–¹ã«ï¼ˆç›´å‰ã¾ã§foreã ã£ãŸï¼‰\n\t\t\t\tthis.#spTransBack.visible = false;\n\t\t\t\tthis.#spTransFore.visible = false;\n\n\t\t\t\tReading.notifyEndProc(TMP_TSY_NM + TW_INT_TRANS);\n\t\t\t});\n\t\t};\n\t\t// hArg[':id'] = pg.fore.name.slice(0, -7);\n\t\t// this.scrItr.getDesignInfo(hArg);\t// å¿…ãš[':id'] ã‚’è¨­å®šã™ã‚‹ã“ã¨\n\t\tthis.#spTransFore.filters = [];\n\t\tthis.#spTransFore.alpha = 1;\n\n\t\t// ä¸€ç¬åˆ‡ã‚Šæ›¿ãˆ\n\t\tconst time = argChk_Num(hArg, 'time', 0);\n\t\tif (time === 0 || this.#evtMng.isSkipping) {\n\t\t\tReading.beginProc(TMP_TSY_NM + TW_INT_TRANS, ()=> { /* empty */ });\n\t\t\tqueueMicrotask(()=> comp());\t// ä¸‹ã§æ­¢ã‚ã¦ã‹ã‚‰ã«ã—ãŸã„\n\t\t\treturn true;\n\t\t}\n\n\n\t\tconst aBackTransAfter: Sprite[] = [];\n\t\tconst aBack = this.#aLayName.map(ln=> {\n\t\t\tconst {fore, back} = this.#hPages[ln]!;\n\t\t\tconst lay = sDoTrans.has(ln) ?back :fore;\n\t\t\tif (lay.ctn.visible) aBackTransAfter.push(lay.ctn);\n\t\t\treturn lay;\n\t\t});\n\t\tconst {ticker, renderer} = this.appPixi;\n\t\trenderer.render(this.#back, {renderTexture: this.#rtTransBack});\t// clear: true\n\n\t\tlet fncRenderBack = ()=> {\n\t\t\tfor (const ctn of aBackTransAfter) renderer.render(\n\t\t\t\tctn,\n\t\t\t\t{renderTexture: this.#rtTransBack, clear: false}\n\t\t\t);\n\t\t};\n\t\tif (! aBack.some(lay=> lay.containMovement)) {\n\t\t\tconst oldFnc = fncRenderBack;\t// å‹•ããŒãªã„ãªã‚‰æœ€åˆã«ä¸€åº¦\n\t\t\tfncRenderBack = ()=> {fncRenderBack = ()=> { /* empty */ }; oldFnc()};\n\t\t}\n\n\t\tconst render = ()=> renderer.render(this.#fore, {renderTexture: this.#rtTransFore});\t// clear: true\n\t\trender();\n\t\tlet fncRenderFore = ()=> {\n\t\t\tthis.#fore.visible = true;\n\t\t\trender();\n\t\t\tthis.#fore.visible = false;\n\t\t};\n\t\tif (! aLayFore.some(lay=> lay.containMovement)) {\n\t\t\tconst oldFnc = fncRenderFore;\t// å‹•ããŒãªã„ãªã‚‰æœ€åˆã«ä¸€åº¦\n\t\t\tfncRenderFore = ()=> {fncRenderFore = ()=> { /* empty */ }; oldFnc()};\n\t\t}\n\t\tconst fncRender = ()=> {\n\t\t\tfncRenderBack();\n\t\t\tthis.#spTransBack.visible = true;\n\n\t\t\tfncRenderFore();\n\t\t\tthis.#spTransFore.visible = true;\n\t\t};\n\n\n\t\t// ã‚¯ãƒ­ã‚¹ãƒ•ã‚§ãƒ¼ãƒ‰\n\t\tconst {glsl, rule} = hArg;\n\t\tconst comp2 = ()=> {ticker.remove(fncRender); comp()};\n\t\tif (! glsl && ! rule) {\n\t\t\tCmnTween.tween(TW_INT_TRANS, hArg, this.#spTransFore, {alpha: 0}, ()=> { /* empty */ }, comp2, ()=> { /* empty */ });\n\t\t\tticker.add(fncRender);\n\t\t\treturn false;\n\t\t}\n\n\t\t// Filterä½¿ç”¨ç³»ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’ glsl å±æ€§ã§ä¸Šæ›¸ãå¯èƒ½ï¼‰\n\t\tconst uniforms = {\n\t\t\trule\t: Texture.EMPTY,\n\t\t\tvague\t: argChk_Num(hArg, 'vague', 0.04),\n\t\t\ttick\t: 0.0,\n\t\t};\n\t\tthis.#spTransFore.filters = [new Filter(\n\t\t\tundefined,\n\t\t\tglsl ?? LayerMng.#srcRuleTransFragment,\n\t\t\tuniforms,\n\t\t)];\n\t\tconst tw = CmnTween.tween(TW_INT_TRANS, hArg, uniforms, {tick: 1}, ()=> { /* empty */ }, comp2, ()=> { /* empty */ }, ! rule);\n\t\tif (! rule) {\n\t\t\tticker.add(fncRender);\n\t\t\treturn false;\n\t\t}\n\n\t\t// ãƒ«ãƒ¼ãƒ«ç”»åƒã‚ã‚Š\n\t\tconst sm = new SpritesMng(rule, undefined, sp=> {\n\t\t\tuniforms.rule = sp.texture;\n\t\t\tsp.destroy();\n\n\t\t\ttw.start();\n\t\t\tticker.add(fncRender);\n\t\t}, isStop=> {if (isStop) this.main.resume()});\n\t\treturn sm.ret;\n\t}\n\n\t#getLayers(layer = ''): string[] {return layer ?layer.split(',') :this.#aLayName}\n\t#foreachLayers(hArg: HArg, fnc: (ln: string, $pg: Pages)=> void): readonly string[] {\n\t\tconst aLn = this.#getLayers(hArg.layer);\n\t\tfor (const ln of aLn) {\n\t\t\tconst pg = this.#hPages[ln];\n\t\t\tif (! pg) throw `å­˜åœ¨ã—ãªã„layerã€${ln}ã€‘ã§ã™`;\n\n\t\t\tfnc(ln, pg);\n\t\t}\n\n\t\treturn aLn;\n\t}\n\t#sortLayers(layers = ''): string[] {\n\t\treturn this.#getLayers(layers)\n\t\t.sort((a, b)=> {\n\t\t\tconst ai = this.#fore.getChildIndex(this.#hPages[a]!.fore.ctn);\n\t\t\tconst bi = this.#fore.getChildIndex(this.#hPages[b]!.fore.ctn);\n\t\t\tif (ai < bi) return -1;\n\t\t\tif (ai > bi) return 1;\n\t\t\treturn 0;\n\t\t});\n\t}\n\n\tsetAllStyle2TxtLay(style: string) {\n\t\tfor (const ln of this.#aLayName) {\n\t\t\tconst l = this.#hPages[ln]!.fore;\n\t\t\tif (l instanceof TxtLayer) l.lay({style});\t// å¿…è¦æœ€å°é™è¨­å®šãªã®ã§\n\t\t\t//\t... l.cssText = style;\n\t\t}\n\t}\n\n\t//MARK: ç”»é¢ã‚’æºã‚‰ã™\n\t#quake(hArg: HArg) {\n\t\tif (argChk_Num(hArg, 'time', NaN) === 0) return false;\n\n\t\tconst aLayCtn = this.#getLayers(hArg.layer)\n\t\t.map(ln=> this.#hPages[ln]!.fore.ctn);\n\t\tconst {renderer, ticker} = this.appPixi;\n\t\tthis.#rtTransFore.resize(CmnLib.stageW, CmnLib.stageH);\n\t\tconst fncRender = ()=> {\n\t\t\tthis.#fore.visible = true;\n\t\t\tfor (const c of aLayCtn) renderer.render(\n\t\t\t\tc, {renderTexture: this.#rtTransFore, clear: false}\n\t\t\t);\n\t\t\tthis.#fore.visible = false;\n\t\t};\n\t\tthis.#spTransFore.visible = true;\n\t\tthis.#spTransFore.alpha = 1;\n\n\t\tconst h = uint(argChk_Num(hArg, 'hmax', 10));\n\t\tconst v = uint(argChk_Num(hArg, 'vmax', 10));\n\t\tconst fncH = h === 0\n\t\t\t? ()=> { /* empty */ }\n\t\t\t: ()=> {this.#spTransFore.x = Math.round(Math.random()* h*2) -h};\n\t\tconst fncV = v === 0\n\t\t\t? ()=> { /* empty */ }\n\t\t\t: ()=> {this.#spTransFore.y = Math.round(Math.random()* v*2) -v};\n\t\tthis.#spTransFore.filters = [];\n\n\t\tCmnTween.tween(TW_INT_TRANS, hArg, this.#spTransFore, {x: 0, y: 0}, ()=> {fncH(); fncV()}, ()=> {\n\t\t\tticker.remove(fncRender);\n\t\t\t\t// transãªã—ã§ã‚‚add()ã—ã¦ãªãã¦ã‚‚èµ°ã‚‹ãŒã€æ§‹ã‚ãªã„ã£ã½ã„ã€‚\n\t\t\tthis.#fore.visible = true;\n\t\t\tthis.#spTransFore.visible = false;\n\t\t\tthis.#spTransFore.x = 0;\t// å¿…é ˆã€onUpdate ã¯ toã®å€¤ã«ã—ã¦ãã‚Œãªã„\n\t\t\tthis.#spTransFore.y = 0;\n\t\t}, ()=> { /* empty */ });\n\t\tticker.add(fncRender);\n\n\t\treturn false;\n\t}\n\n\n\t//MARK: ãƒˆã‚¥ã‚¤ãƒ¼ãƒ³é–‹å§‹\n\t#tsy(hArg: HArg) {\n\t\tconst {layer, render, name} = hArg;\n\t\tif (! layer) throw 'layerã¯å¿…é ˆã§ã™';\n\n\t\tconst pg = this.#hPages[this.#argChk_layer(hArg)]!;\n\t\tconst lay = pg.fore;\n\n\t\tlet finishBlendLayer = ()=> { /* empty */ };\n\t\tif (render && ! this.#evtMng.isSkipping) {\n\t\t\tlay.renderStart();\n\t\t\tfinishBlendLayer = ()=> lay.renderEnd();\n\t\t}\n\n\t\tconst hTo = CmnTween.cnvTweenArg(hArg, lay);\n\t\tconst arrive = argChk_Boolean(hArg, 'arrive', false);\n\t\tconst backlay = argChk_Boolean(hArg, 'backlay', false);\n\t\tconst spBack = pg.back.ctn;\t// fore, back ãŒå¤‰ã‚ã‚‹æã‚Œã§å¤–ã¸\n\t\tCmnTween.tween(name ?? layer, hArg, lay, CmnTween.cnvTweenArg(hArg, lay), ()=> { /* empty */ }, finishBlendLayer, ()=> {\n\t\t\tif (arrive) Object.assign(lay, hTo);\n\t\t\t// eslint-disable-next-line @typescript-eslint/no-unsafe-assignment, @typescript-eslint/no-unsafe-member-access, @typescript-eslint/no-explicit-any\n\t\t\tif (backlay) for (const nm of Object.keys(CmnTween.hMemberCnt)) (<any>spBack)[nm] = (<any>lay)[nm];\n\t\t});\n//\t\thArg[':id'] = pg.fore.name.slice(0, -7);\n//\t\tthis.scrItr.getDesignInfo(hArg);\t// å¿…ãš[':id'] ã‚’è¨­å®šã™ã‚‹ã“ã¨\n\n\t\tif ('filter' in hArg) {\n\t\t\tlay.ctn.filters = [Layer.bldFilters(hArg)];\n\t\t\tlay.aFltHArg = [hArg];\n\t\t}\n\n\t\treturn false;\n\t}\n\n\n\t//MARK: ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼è¿½åŠ \n\t#add_filter(hArg: HArg) {\n\t\tthis.#foreachLayers(hArg, layer=> {\n\t\t\tconst pg = this.#hPages[this.#argChk_layer({layer})]!;\n\t\t\tif (hArg.page === 'both') {\t// page=both ã§ä¸¡é¢ã«\n\t\t\t\tthis.#add_filter2(pg.fore, hArg);\n\t\t\t\tthis.#add_filter2(pg.back, hArg);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst l = pg.getPage(hArg);\n\t\t\tthis.#add_filter2(l, hArg);\n\t\t});\n\n\t\treturn false;\n\t}\n\t#add_filter2(l: Layer, hArg: HArg) {\n\t\tconst s = l.ctn;\n\t\ts.filters ??= [];\n\t\ts.filters = [...s.filters, Layer.bldFilters(hArg)];\n\t\tl.aFltHArg.push(hArg);\n\t}\n\n\t//MARK: ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼å…¨å‰Šé™¤\n\t#clear_filter(hArg: HArg) {\n\t\tthis.#foreachLayers(hArg, layer=> {\n\t\t\tconst pg = this.#hPages[this.#argChk_layer({layer})]!;\n\t\t\tif (hArg.page === 'both') {\t// page=both ã§ä¸¡é¢ã«\n\t\t\t\tconst f = pg.fore;\n\t\t\t\tconst b = pg.back;\n\t\t\t\tf.ctn.filters = null;\n\t\t\t\tb.ctn.filters = null;\n\t\t\t\tf.aFltHArg = [];\n\t\t\t\tb.aFltHArg = [];\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst l = pg.getPage(hArg);\n\t\t\tl.ctn.filters = null;\n\t\t\tl.aFltHArg = [];\n\t\t});\n\n\t\treturn false;\n\t}\n\n\t//MARK: ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼å€‹åˆ¥åˆ‡æ›¿\n\t#enable_filter(hArg: HArg) {\n\t\tthis.#foreachLayers(hArg, layer=> {\n\t\t\tconst pg = this.#hPages[this.#argChk_layer({layer})]!;\n\t\t\tif (hArg.page === 'both') {\t// page=both ã§ä¸¡é¢ã«\n\t\t\t\tthis.#enable_filter2(pg.fore, hArg);\n\t\t\t\tthis.#enable_filter2(pg.back, hArg);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst l = pg.getPage(hArg);\n\t\t\tthis.#enable_filter2(l, hArg);\n\t\t});\n\n\t\treturn false;\n\t}\n\t#enable_filter2(l: Layer, hArg: HArg) {\n\t\tconst s = l.ctn;\n\t\tif (! s.filters) throw 'ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãŒã‚ã‚Šã¾ã›ã‚“';\n\n\t\tconst i = uint(argChk_Num(hArg, 'index', 0));\n\t\tconst len = s.filters.length;\n\t\tif (len <= i) throw `ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã®å€‹æ•°ï¼ˆ${String(len)}ï¼‰ã‚’è¶Šãˆã¦ã„ã¾ã™`;\n\n\t\tl.aFltHArg[i]!.enabled =\n\t\ts.filters[i]!.enabled = argChk_Boolean(hArg, 'enabled', true);\n\t}\n\n\n//\t// æ–‡å­—ãƒ»æ–‡å­—ãƒ¬ã‚¤ãƒ¤\n\tstatic\t\t#msecChWait\t\t= 10;\n\tstatic get\tmsecChWait() {return LayerMng.#msecChWait}\n\t//MARK: æ–‡å­—ã‚’è¿½åŠ ã™ã‚‹\n\t#ch(hArg: HArg) {\n\t\tconst {text} = hArg;\n\t\tif (! text) throw 'textã¯å¿…é ˆã§ã™';\n\n\t\tconst tl = this.#getTxtLayer(hArg);\n\t\tdelete hArg.text;\t// [graph]æ™‚ã€æ¬¡è¡ŒãŒãƒ«ãƒ“æ–‡æ³•ã§ãƒˆãƒ©ãƒ–ã£ãŸã®ã§\n\t\tthis.setNormalChWait();\n\t\tif (this.#evtMng.isSkipping) hArg.wait = 0;\n\t\telse if ('wait' in hArg) argChk_Num(hArg, 'wait', NaN);\n\n\t\tthis.#cmdTxt('addï½œ'+ cnvSArg(<T_cmdTxt_JSON>hArg), tl);\n\t\t\t// [ch style]ç”¨\n\n\t\tconst record = argChk_Boolean(hArg, 'record', true);\n\t\tconst doRecLog = this.val.doRecLog();\n\t\tif (! record) this.val.setVal_Nochk('save', 'sn.doRecLog', record);\n\t\ttl.tagCh(text.replaceAll('[r]', '\\n'));\n\t\tthis.val.setVal_Nochk('save', 'sn.doRecLog', doRecLog);\n\n\t\tthis.#cmdTxt('add_closeï½œ', tl);\t// [ch style]ç”¨\n\n\t\treturn false;\n\t}\n\n\t#getTxtLayer = (_hArg: HArg): TxtLayer=> {this.#chkTxtLay(); throw 0};\n\t#$getTxtLayer(hArg: HArg): TxtLayer {\n\t\tconst ln = this.#argChk_layer(hArg, this.#curTxtlay);\n\t\tconst pg = this.#hPages[ln]!;\n\t\tconst lay = pg.getPage(hArg);\n\t\tif (! (lay instanceof TxtLayer)) throw ln +'ã¯TxtLayerã§ã¯ã‚ã‚Šã¾ã›ã‚“';\n\n\t\treturn lay;\n\t}\n\tsetNormalChWait(): void {LayerMng.#msecChWait = this.scrItr.normalWait}\n\n\n\t//MARK: æ“ä½œå¯¾è±¡ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ¬ã‚¤ãƒ¤ã®æŒ‡å®š\n\t#current = (_hArg: HArg): boolean=> {this.#chkTxtLay(); throw 0};\n\t#$current(hArg: HArg) {\n\t\tconst {layer} = hArg;\n\t\tif (! layer) throw '[current] layerã¯å¿…é ˆã§ã™';\n\n\t\tconst lay = this.#hPages[layer];\n\t\tif (! lay || ! (lay.getPage(hArg) instanceof TxtLayer)) throw `${layer}ã¯TxtLayerã§ã¯ã‚ã‚Šã¾ã›ã‚“`;\n\t\tthis.#pgTxtlay = lay;\n\n\t\tthis.#log.pagebreak();\t// ã‚«ãƒ¬ãƒ³ãƒˆå¤‰æ›´å‰ã«ç¾åœ¨ã®å±¥æ­´ã‚’ä¿å­˜\n\t\tthis.#curTxtlay = layer;\n\t\tthis.val.setVal_Nochk('save', 'const.sn.mesLayer', layer);\n\t\tfor (const ln of this.#aLayName) {\n\t\t\tconst {fore, back} = this.#hPages[ln]!;\n\t\t\tif (! (fore instanceof TxtLayer)) continue;\n\t\t\tfore.isCur = (<TxtLayer>back).isCur = ln === layer;\n\t\t}\n\n\t\treturn false;\n\t}\n\tget currentTxtlayForeNeedErr(): TxtLayer {\n\t\tthis.#chkTxtLay();\n\t\treturn this.currentTxtlayFore!;\n\t}\n\tget currentTxtlayFore(): TxtLayer | null {\n\t\tif (! this.#pgTxtlay) return null;\n\n\t\treturn <TxtLayer>this.#pgTxtlay.fore;\n\t}\n\t#pgTxtlay\t: Pages | undefined\t= undefined;\t// ã‚«ãƒ¬ãƒ³ãƒˆãƒ†ã‚­ã‚¹ãƒˆãƒ¬ã‚¤ãƒ¤\n\t#chkTxtLay\t: ()=> void\t= ()=> {throw 'æ–‡å­—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒã‚ã‚Šã¾ã›ã‚“ã€‚æ–‡å­—è¡¨ç¤ºã‚„æ“ä½œã™ã‚‹å‰ã«ã€[add_lay layer=ï¼ˆãƒ¬ã‚¤ãƒ¤åï¼‰ class=txt]ã§æ–‡å­—ãƒ¬ã‚¤ãƒ¤ã‚’è¿½åŠ ã—ã¦ä¸‹ã•ã„'};\n\n\t#argChk_layer(hArg: HArg, def = ''): string {\n\t\tconst ln = hArg.layer ?? def;\n\t\tif (ln.includes(',')) throw 'layeråã«ã€Œ,ã€ã¯ä½¿ãˆã¾ã›ã‚“';\n\t\tif (! (ln in this.#hPages)) throw 'å±æ€§ layerã€'+ ln +'ã€‘ãŒä¸æ­£ã§ã™ã€‚ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒã‚ã‚Šã¾ã›ã‚“';\n\n\t\thArg.layer = ln;\n\t\treturn ln;\n\t}\n\n\n\trecPagebreak() {this.#log.pagebreak()}\n\n\n\t//MARK: æ–‡å­—æ¶ˆå»\n\t#clear_text(hArg: HArg) {\n\t\tconst tf = this.#getTxtLayer(hArg);\n\t\tif (hArg.layer === this.#curTxtlay && hArg.page === 'fore') this.#log.pagebreak();\t// æ”¹ãƒšãƒ¼ã‚¸ã€ã‚¯ãƒªã‚¢å‰ã«\n\t\ttf.clearText();\n\t\treturn false;\n\t}\n\n\n\t//MARK: ãƒã‚¤ãƒ‘ãƒ¼ãƒªãƒ³ã‚¯ã®çµ‚äº†\n\t#endlink(hArg: HArg) {this.#cmdTxt('endlinkï½œ', this.#getTxtLayer(hArg)); return false}\n\n\t//MARK: ãƒšãƒ¼ã‚¸ä¸¡é¢ã®æ–‡å­—æ¶ˆå»\n\t#er(hArg: HArg) {\n\t\tif (argChk_Boolean(hArg, 'rec_page_break', true)) this.#log.pagebreak();\t// æ”¹ãƒšãƒ¼ã‚¸ã€ã‚¯ãƒªã‚¢å‰ã«\n\n\t\tif (this.#pgTxtlay) {\n\t\t\tthis.#pgTxtlay.fore.clearLay(hArg);\n\t\t\tthis.#pgTxtlay.back.clearLay(hArg);\n\t\t}\n\n\t\treturn false;\n\t}\n\n\t//MARK: ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ç”»åƒè¡¨ç¤º\n\t#graph(hArg: HArg) {\n\t\tif (! hArg.pic) throw '[graph] picã¯å¿…é ˆã§ã™';\n\n\t\tthis.#cmdTxt('grpï½œ'+ cnvSArg(<T_cmdTxt_JSON>hArg), this.#getTxtLayer(hArg));\n\t\treturn false;\n\t}\n\n\t//MARK: ãƒã‚¤ãƒ‘ãƒ¼ãƒªãƒ³ã‚¯\n\t#link(hArg: HArg) {\n\t\tif (! hArg.fn && ! hArg.label && ! hArg.url) throw 'fn,label,url ã„ãšã‚Œã‹ã¯å¿…é ˆã§ã™';\n\t\thArg.fn ??= this.scrItr.scriptFn;\t// ã“ã“ã§æŒ‡å®šã™ã‚‹å¿…è¦ãŒã‚ã‚‹\n\n\t\thArg.style ??= 'background-color: rgba(255,0,0,0.5);';\n\t\thArg.style_hover ??= 'background-color: rgba(255,0,0,0.9);';\n\t\thArg.style_clicked ??= hArg.style;\n\t\tthis.#cmdTxt('linkï½œ'+ cnvSArg(<T_cmdTxt_JSON>hArg), this.#getTxtLayer(hArg));\n\t\treturn false;\n\t}\n\n\t//MARK: æ”¹è¡Œ\n\t#r(hArg: HArg) {return this.#ch({...hArg, text: '\\n'})}\n\n\t//MARK: æ–‡å­—åˆ—ã¨è¤‡æ•°ãƒ«ãƒ“ã®è¿½åŠ \n\t#ruby2(hArg: HArg) {\n\t\tconst {t, r} = hArg;\n\t\tif (! t) throw '[ruby2] tã¯å¿…é ˆã§ã™';\n\t\tif (! r) throw '[ruby2] rã¯å¿…é ˆã§ã™';\n\n\t\thArg.text = 'ï½œ'+ encodeURIComponent(t) +'ã€Š'+ encodeURIComponent(r) +'ã€‹';\n\t\tdelete hArg.t;\n\t\tdelete hArg.r;\n\t\treturn this.#ch(hArg);\n\t}\n\n\n\t//MARK: ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚¹ã‚¿ã‚¤ãƒ«è¨­å®š\n\t#span(hArg: HArg) {\n\t\tthis.#cmdTxt('spanï½œ'+ cnvSArg(<T_cmdTxt_JSON>hArg), this.#getTxtLayer(hArg));\n\t\treturn false;\n\t}\n\n\t//MARK: tcyç¸¦ä¸­æ¨ªã‚’è¡¨ç¤ºã™ã‚‹\n\t#tcy(hArg: HArg) {\n\t\tif (! hArg.t) throw '[tcy] tã¯å¿…é ˆã§ã™';\n\n\t\tthis.#cmdTxt('tcyï½œ'+ cnvSArg(<T_cmdTxt_JSON>hArg), this.#getTxtLayer(hArg));\n\t\treturn false;\n\t}\n\n\n\t//MARK: ãƒ¬ã‚¤ãƒ¤ã®ãƒ€ãƒ³ãƒ—\n\t#dump_lay({layer}: HArg) {\n\t\tconsole.group('ğŸ¥Ÿ [dump_lay]');\n\t\tfor (const ln of this.#getLayers(layer)) {\n\t\t\tconst {fore, back} = this.#hPages[ln]!;\n\t\t\ttry {\n\t\t\t\tconsole.info(`%c${fore.name.slice(0, -7)} %o`, `color:#${CmnLib.isDarkMode ?'49F' :'05A'};`,\n\t\t\t\tJSON.parse(`{\"back\":{${back.dump()}}, \"fore\":{${fore.dump()}}}`));\n\t\t\t} catch (e) {\n\t\t\t\tconsole.error('dump_lay err:%o', e);\n\t\t\t\tconsole.error(`   back:${back.dump()}`);\n\t\t\t\tconsole.error(`   fore:${fore.dump()}`);\n\t\t\t}\n\t\t}\n\t\tconsole.groupEnd();\n\n\t\treturn false;\n\t}\n\n\n\t//MARK: ã‚¤ãƒ™ãƒ³ãƒˆæœ‰ç„¡ã®åˆ‡æ›¿\n\t#enable_event(hArg: HArg) {\n\t\tconst ln = this.#argChk_layer(hArg, this.#curTxtlay);\n\t\tconst v = argChk_Boolean(hArg, 'enabled', true);\n\t\tthis.#getTxtLayer(hArg).enabled = v;\n\t\tthis.val.setVal_Nochk('save', 'const.sn.layer.'+ ln +'.enabled', v);\n\n\t\treturn false;\n\t}\n\n\n\t//MARK: ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º\n\t#button(hArg: HArg) {\n\t\tPages.argChk_page(hArg, 'back');\t// ãƒã‚§ãƒƒã‚¯ã—ãŸã„ã¨ã„ã†ã‚ˆã‚Šãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚’backã«\n\t\thArg.fn ??= this.scrItr.scriptFn;\t// ã“ã“ã§æŒ‡å®šã™ã‚‹å¿…è¦ãŒã‚ã‚‹\n\t\t\t// fnçœç•¥æ™‚ã€ç”»åƒãƒœã‚¿ãƒ³ã¯ãƒ­ãƒ¼ãƒ‰å¾Œã¨ã„ã†å¾Œã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ scrItr.scriptFn ã‚’\n\t\t\t// å‚ç…§ã—ã¦ã—ã¾ã†ã®ã§\n\t\tvoid this.#getTxtLayer(hArg).addButton(hArg);\t// hArg[':id_tag'] ã‚‚è¨­å®š\n\n\t\tthis.scrItr.recodeDesign(hArg);\t// å¿…ãš[':id_tag'] ã‚’è¨­å®šã™ã‚‹ã“ã¨\n\n\t\treturn false;\n\t}\n\n\n\t// eslint-disable-next-line @typescript-eslint/no-explicit-any\n\trecord(): any {\n\t\t// eslint-disable-next-line @typescript-eslint/no-explicit-any\n\t\tconst o: any = {};\n\t\tfor (const ln of this.#aLayName) {\n\t\t\tconst pg = this.#hPages[ln]!;\n\t\t\t// eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n\t\t\to[ln] = {\n\t\t\t\tcls: pg.cls,\n\t\t\t\tfore: pg.fore.record(),\n\t\t\t\tback: pg.back.record(),\n\t\t\t};\n\t\t}\n\t\treturn o;\n\t}\n\tplayback($hPages: HIPage): Promise<void>[] {\n\t\t// ã“ã‚Œã‚’å…ˆã«ã€‚save:const.sn.sLog ãŒã‚¯ãƒªã‚¢ã•ã‚Œã¦ã—ã¾ã†\n\t\tthis.#log.playback();\n\n\t\tconst aPrm: Promise<void>[] = [];\n\t\tconst aSort: {ln: string, idx: number}[] = [];\n\t\tfor (const [ln, {fore, fore: {idx}, back, cls}] of Object.entries($hPages)) {\t// å¼•æ•°ã§è¨€åŠã®ç„¡ã„ãƒ¬ã‚¤ãƒ¤ã¯ãã®ã¾ã¾ã€‚ç‰¹ã«å‰Šé™¤ã—ãªã„\n\t\t\taSort.push({ln, idx});\n\t\t\tconst ps = this.#hPages[ln] ??= new Pages(ln, cls, this.#fore, this.#back, {}, this.sys, this.val, {isWait: false});\n\t\t\tps.fore.playback(fore, aPrm);\n\t\t\tps.back.playback(back, aPrm);\n\t\t}\n\n\t\tconst len = this.#fore.children.length;\n\t\taPrm.push(new Promise(re=> {\t// è‹¥ã„é †ã«setChildIndex()\n\t\t\tfor (const {ln, idx} of aSort.sort(({idx: a}, {idx: b})=> a === b ?0 :a < b ?-1 :1)) {\n\t\t\t\tconst pg = this.#hPages[ln];\n\t\t\t\tif (! pg) continue;\n\n\t\t\t\tconst i = len > idx ?idx :len -1;\n\t\t\t\tconst {fore, back} = pg;\n\t\t\t\tthis.#fore.setChildIndex(fore.ctn, i);\n\t\t\t\tthis.#back.setChildIndex(back.ctn, i);\n\t\t\t}\n\t\t\tre();\n\t\t}));\n\t\treturn aPrm;\n\t}\n\n}\n"],"names":["Pages","layname","cls","fore","back","hArg","sys","val","ret","fncF","f","b","nm","argChk_Boolean","#pg","valnm","hash","def","v","aPrm","DesignCast","bg_col","isLay","_appPixi","_sys","_scrItr","_prpPrs","_cfg","_hPages","_hPrm","_idcCh","_v","_o","GrpLayDesignCast","_ctn","_gl","_sp","SpritesMng","csvFn","ctn","fncFirstComp","fncAllComp","#addChild","sp","#aSp","#csv2Sprites","isStop","#cfg","#val","#sys","#main","cfg","main","sndMng","#cachePicMov","r","res","next","#dec2cachePicMov","#cacheAniSpr","#dec2cacheAniSpr","fnc","vol","#glbVol","#movVol","#hFn2hve","#evtMng","evtMng","#hFace","#hFn2ResAniSpr","csv","addChild","needLoad","Sprite","utils.TextureCache","Loader","aComp","ldr","fn0","dx","dy","blendmode","fn","BLEND_MODES","url","SEARCH_PATH_ARG_EXT","xt","LoaderResource","comp1","fncLoaded","_","hRes","#mkSprite","str","aiv","e","mes","_r","type","name","data","hve","#charmVideoElm","#sortAFrameName","aFn","a_base_name","d1","d2","is","ie","a","int","Texture","DebugMng","spritesheet","meta","frames","getFn","res2","next2","r2","_hRes","baseTexture","aFr","x","y","w","h","Rectangle","ras","asp","AnimatedSprite","RPN_WV","stop","Reading","argChk_Num","Layer","GrpLayer","#elc","EventListenerCtn","#appPixi","appPixi","#idc","CmnLib","#setIdcSp","#csvFn","#sBkFn","#sBkFace","RPN_GRP_LAY","#laySub","resolve","face","inFn","inFace","#sps","#width","#height","#spTsy","#rtTsy","fncRenderFore","oldFnc","#fncRender","RenderTexture","s","c","i","hLay","re","_isStop","gdc","defè¡Œé ­ç¦å‰‡","defè¡Œæœ«ç¦å‰‡","defåˆ†å‰²ç¦æ­¢","defã¶ã‚‰ä¸‹ã’","defRegè¡Œé ­ç¦å‰‡","defRegè¡Œæœ«ç¦å‰‡","defRegåˆ†å‰²ç¦æ­¢","defRegã¶ã‚‰ä¸‹ã’","Hyphenation","#sè¡Œé ­ç¦å‰‡","#sè¡Œæœ«ç¦å‰‡","#såˆ†å‰²ç¦æ­¢","#sã¶ã‚‰ä¸‹ã’","#regè¡Œé ­ç¦å‰‡","#regè¡Œæœ«ç¦å‰‡","#regåˆ†å‰²ç¦æ­¢","#regã¶ã‚‰ä¸‹ã’","#chkç¦å‰‡ã®ç«¶åˆ_ã¶ã‚‰è¡Œæœ«","#chkç¦å‰‡ã®ç«¶åˆ_ã¶ã‚‰åˆ†ç¦","lenè¡Œæœ«ç¦å‰‡","lenã¶ã‚‰ä¸‹ã’","lenåˆ†å‰²ç¦æ­¢","to","#genKinsoku","sè¡Œé ­ç¦å‰‡","sè¡Œæœ«ç¦å‰‡","såˆ†å‰²ç¦æ­¢","sã¶ã‚‰ä¸‹ã’","o","htmTxt","cnvRect","tategaki","begin","bkHtm","len","fncFirstChk","#getChRects","sl_xy","elm","rect","ch","xy","p_i","#i2pi","p_elm","p_rect","p_ch","sty","rs","oldI","cont","ins","elm2","pal","br","ppal","rng","pos","end","ii","pp_i","pp_ch","j","p_j","last_ch","head_ch","ppp_i","ppp_ch","htm2tx","infTL","padTx4x","padTx4y","hidden","util","extension","parseExtension","mimes","dataAsUrl","isDataUrl","resolveUrl","getAndEncode","arrayLike","WOFF","JPEG","inliner","newInliner","fontFaces","newFontFaces","embedFonts","node","cssText","styleNode","baseUrl","doc","base","request","done","timeout","fail","encoder","content","message","URL_REGEX","inlineAll","shouldProcess","readUrls","result","match","inline","get","dataUrl","urlAsRegex","nothingToInline","urls","string","resolveAll","readAll","webFonts","webFont","cssStrings","getCssRules","selectWebFontRules","rules","newWebFont","cssRules","rule","styleSheets","sheet","webFontRule","cln","img","canvas","TxtStage","Container","canFocus","#htmTxt","#cntTxt","#grpDbgMasume","fncMasumeLog","width","height","#fncMasume","cr","RPN_COMP_CHIN","htm","ln","#scrItr","id","scrItr","#hChInStyle","#hChOutStyle","Graphics","#hWarnStyle","#hyph","#infTL","key","#lay_sub","#left","#lenHtmTxt","aSpan","#clearText","#lh_half","fs","#isTategaki","#padTx4x","#padTx4y","lh","cvsScale","#aGoTxt","instant","#goTxt_Proc","#aRect","#SPAN_LAST","#cntBreak","bcr","sx","sy","ox","oy","ease","CmnTween","#fi_easing","dataset","parentElement","arg","add","cis","cnt","#spWork","eCh","aLnk","st_normal","st_hover","st_clicked","st_r_normal","st_r_hover","st_r_clicked","nlRt","st_bk","fncStyle","st","st_r","chs","#fncEndChIn","lastElm","rct","Tween","#aSpTw","wasChInIng","#REG_NG_CHSTYLE_NAME_CHR","#spsBreak","#fo_easing","n","old","sum_wait","cos","#ch_filter","ct","#sss","rnd","tx","_gdc","aStyle","Button","#o","uint","#rctBtnTxt","#hover","#clicked","#loaded_pic","style","TextStyle","mesErrJSON","txt","Text","text","#loaded_b_pic","#procMasume4txt","style_hover","style_clicked","_me","_txt","#procMasume4pic","_w3","_h","me","w3","_text","w_3","txNormal","txClicked","txHover","normal","TxtLayer","#isPageFore","#log","hTag","log","isPageFore","doRec","#autowc","#ch_in_style","#ch_out_style","initStyle","addStyle","#doAutoWc","#hAutoWc","#b_color","#b_alpha","#b_alpha_isfixed","#b_do","#b_pic","#txs","#rbSpl","RubySpliter","#htmRb","#hWarnR_Style","#cntBtn","#putCh","#rec","#setFfs","#r_align","#ruby_pd","l","#mkStyle_r_align","#mkStyle_r_align4ff","#set_ch_in","#set_ch_out","RPN_TXT_LAY","#drawBack","in_style","#$ch_in_style","#ch_in_join","out_style","#$ch_out_style","fncComp","alpha","argChk_Color","g_alpha","#strNoFFS","#regNoFFS","#ffs","#fncFFSStyle","_ch","rb","r_align","add_sty","ev","#needGoTxt","iruby","ruby","a_ruby","add_htm","a0","a1_","a1","#firstCh","#tagCh_sub","#popSpan","#aSpan","#cumDelay","wait","cl","#o2domArg","#pushSpan","r_style","lnk","#stkASpan","t","#page_text","#page_plain_text","#mergePushSpan","curpos","ht","isAddWait","argWait","LayerMng","stk","btn","FrameMng","#add_frame","#let_frame","#set_frame","#frame","#tsy_frame","#hIfrm","#hIfrmVisibleBk","src","vn","b_color","#rect","RPN_ADD_FRAME","ld","_ldr","#hDisabled","iLastSep","path_parent","path_pa_pa","m","p1","win","#loadPic2Img","onload","oUrl","#hEncImgOUrl","aImg","#hARetImg","srcNoPrm","Prm","path","ld2","s2","u2","ri","var_name","#zIdx","d","scale_x","scale_y","rotate","hNow","hArg2","fncA","fncXYSR","fncW","fncH","Log","oCfg","#rec_ch","#rec_r","#reset_rec","#LastLog","#aLog","cnvSArg","prpPrs","fncResizeLay","#modeLnSub","#aLayName","#hPages","#frmMng","tid","#loadplugin","#snapshot","#snapshot4proc","RPN_SNAPSHOT","#snapshot4app","#snapshot4web","#add_lay","#clear_lay","#lay","#trans","#quake","#tsy","#add_filter","#clear_filter","#enable_filter","#ch","#clear_text","#current","#endlink","#er","#graph","#link","#r","#ruby2","#span","#tcy","#dump_lay","#enable_event","#button","#cmdTxt","#bg_color","parseColor","grp","#fore","#back","#stage","#spTransBack","#spTransFore","fncTxt_b_alpha","_name","#foreachRedrawTxtLayBack","fncBtnFont","#hProcDbgRes","lay","#selectNode","#curTxtlay","#modeLn","pages","#grpCover","visible","bg_color","p","#msecChWait","cmd","tl","_record","_hArg","dt","getDateStr","PROTOCOL_USERDATA","PROTOCOL_DL","layer","aBk","#getLayers","autoDetectRenderer","pg","renTx","join","RPN_LOADPLUGIN","#chkTxtLay","#getTxtLayer","#$getTxtLayer","#$current","#firstGrplay","#argChk_layer","#rebuildLayerRankInfo","dive","idx_dive","pg_dive","back_dive","fore_dive","idx_back_dive","idx_fore_dive","#sortLayers","#foreachLayers","#srcRuleTransFragment","#rtTransBack","#rtTransFore","sDoTrans","aLayFore","comp","idx","TMP_TSY_NM","TW_INT_TRANS","aBackTransAfter","aBack","ticker","renderer","fncRenderBack","render","fncRender","glsl","comp2","uniforms","Filter","tw","aLn","layers","ai","bi","aLayCtn","fncV","finishBlendLayer","hTo","arrive","backlay","spBack","#add_filter2","#enable_filter2","record","doRecLog","#pgTxtlay","tf","$hPages","aSort","ps"],"mappings":"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"}