{"version":3,"file":"Main.js","sources":["../src/sn/Config.ts","../src/sn/AnalyzeTagArg.ts","../src/sn/Grammar.ts","../src/sn/Main.ts"],"sourcesContent":["/* ***** BEGIN LICENSE BLOCK *****\n\tCopyright (c) 2018-2025 Famibee (famibee.blog38.fc2.com)\n\n\tThis software is released under the MIT License.\n\thttp://opensource.org/licenses/mit-license.php\n** ***** END LICENSE BLOCK ***** */\n\nimport {CmnLib} from './CmnLib';\nimport type {SysBase} from './SysBase';\nimport {ConfigBase, SEARCH_PATH_ARG_EXT, type T_CFG_RAW} from './ConfigBase';\n\nexport const PROTOCOL_USERDATA\t= 'userdata:/';\nexport const PROTOCOL_DL\t\t= 'downloads:/';\n\n\nexport class Config extends ConfigBase {\n\tstatic\tasync\tgenerate(sys: SysBase) {\n\t\tconst c = new Config(sys);\n\t\tconst fn = sys.arg.cur +'prj.json';\n\t\tconst res = await sys.fetch(fn);\n\t\tif (! res.ok) throw Error(res.statusText);\n\n\t\tconst dec = await sys.dec(fn, await res.text());\n\t\tawait c.load(<T_CFG_RAW>JSON.parse(dec));\n\t\treturn c;\n\t}\n\n\tprotected\tconstructor(override readonly sys: SysBase) {super(sys)}\n\n\tprotected\toverride\tasync load(oCfg: T_CFG_RAW) {\n\t\toCfg.window ??= {width: 300, height: 300};\n\t\tCmnLib.stageW = oCfg.window.width;\n\t\tCmnLib.stageH = oCfg.window.height;\n\t\tCmnLib.debugLog = oCfg.debug.debugLog;\n\t\tawait CmnLib.init();\n\n\t\treturn super.load(oCfg);\n\t}\n\n\toverride\tsearchPath(fn: string, extptn: SEARCH_PATH_ARG_EXT = SEARCH_PATH_ARG_EXT.DEFAULT): string {\n\t\tif (fn.startsWith(PROTOCOL_DL)) {\n\t\t\treturn this.sys.path_downloads + fn.slice(11);\n\t\t}\n\t\tif (fn.startsWith(PROTOCOL_USERDATA)) {\n\t\t\treturn this.sys.path_userdata + 'storage/'+ fn.slice(10);\n\t\t}\n\n\t\treturn super.searchPath(fn, extptn);\n\t}\n\n}\n","/* ***** BEGIN LICENSE BLOCK *****\n\tCopyright (c) 2018-2025 Famibee (famibee.blog38.fc2.com)\n\n\tThis software is released under the MIT License.\n\thttp://opensource.org/licenses/mit-license.php\n** ***** END LICENSE BLOCK ***** */\n\nexport type PRM = {\n\tval\t\t: string;\n\tdef?\t: string;\n}\nexport type HPRM = {\n\t[key: string]: PRM,\n}\n\nexport type PRM_RANGE = {\n\tk_ln\t: number;\n\tk_ch\t: number;\n\tv_ln\t: number;\n\tv_ch\t: number;\n\tv_len\t: number;\n}\n\nexport function idx2LnCol(sSn: string, idx: number, lenNm = 0, ln = 0, ch = 0): {ln: number; ch: number;} {\n\tconst sBefore = sSn.slice(0, idx);\n\tconst a = sBefore.split('\\n');\n\tconst len = a.length;\n\treturn {\n\t\tln\t: ln +len -1,\n\t\tch\t: len < 2 ?ch +1+lenNm +idx :a.at(-1)?.length ?? 0,\n\t};\n}\n\n\nexport class AnalyzeTagArg {\n\t// 87 match 2725 step(0.5ms) PCRE2 https://regex101.com/r/aeN57J/1\n\t/*\n;[^\\n]*\n|\t(?<key>[^\\s=\"'#|;]+)\n\t(?: \\s | ;[^\\n]*\\n)*\n\t=\n\t(?: \\s | ;[^\\n]*\\n)*\n\t(?:\t(?<val> [^\\s\"'#|;]+)\n\t|\t([\"'#]) (?<val2>.*?) \\3 )\n\t(?: \\|\n\t\t(?: (?<def> [^\\s\"'#;]+)\n\t|\t([\"'#]) (?<def2>.*?) \\6 ) )?\n|\t(?<literal>[^\\s;]+)\n\t*/\n\treadonly\t#REG_TAGARG\t= /;[^\\n]*|(?<key>[^\\s=\"'#|;]+)(?:\\s|;[^\\n]*\\n)*=(?:\\s|;[^\\n]*\\n)*(?:(?<val>[^\\s\"'#|;]+)|([\"'#])(?<val2>.*?)\\3)(?:\\|(?:(?<def>[^\\s\"'#;]+)|([\"'#])(?<def2>.*?)\\6))?|(?<literal>[^\\s;]+)/g;\n\n\t// „ÄêÂ±ûÊÄß = ÂÄ§ | ÁúÅÁï•ÂÄ§„Äë„ÅÆÂàÜÊûê\n\tparse(args: string): void {\n\t\tthis.#hPrm = {};\n\t\tthis.#isKomeParam = false;\n\t\tfor (const {groups} of args.matchAll(this.#REG_TAGARG)) {\n\t\t\t// eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n\t\t\tconst {key, val, val2, def, def2, literal} = groups!;\n\t\t\tif (key) this.#hPrm[key] = {\n\t\t\t\tval: val ?? val2 ?? '',\n\t\t\t\tdef: def ?? def2\n\t\t\t};\n\t\t\telse if (literal) {\n\t\t\t\tif (literal === '*') this.#isKomeParam = true;\n\t\t\t\telse this.#hPrm[literal] = {val: '1'};\n\t\t\t}\n\t\t}\n\t}\n\n\t// Â±ûÊÄß„Å®ÂÄ§„ÅÆ‰ΩçÁΩÆ„Çí„Åæ„Å®„ÇÅ„Å¶Ëøî„Åô\n\tparseinDetail(token: string, lenNm: number, ln: number, ch: number): {[key: string]: PRM_RANGE} {\n\t\tconst hRng: {[key: string]: PRM_RANGE} = {};\n\n\t\tconst sSn = token.slice(1+lenNm, -1);\n\t\tfor (const {groups, index, 0: z} of sSn.matchAll(this.#REG_TAGARG)) {\n\t\t\tif (! index) continue;\n\t\t\t// eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n\t\t\tconst {key, val, val2='', literal} = groups!;\n\t\t\tif (literal) {\n\t\t\t\tif (literal.endsWith('=')) {\n\t\t\t\t\tconst lenVnm = literal.length -1;\n\t\t\t\t\tconst {ch: k_ch} = idx2LnCol(sSn, index +lenVnm, lenNm, ln, ch);\n\t\t\t\t\thRng[literal.slice(0, -1)] = {\n\t\t\t\t\t\tk_ln: ln,\n\t\t\t\t\t\tk_ch: k_ch -lenVnm,\n\t\t\t\t\t\tv_ln: ln,\n\t\t\t\t\t\tv_ch: k_ch +1,\n\t\t\t\t\t//\tv_ch: ch +1+lenNm +literal.length +1,\n\t\t\t\t\t\tv_len: 0,\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif (! key) continue;\n\n\t\t\tconst {ln: k_ln, ch: k_ch} = idx2LnCol(sSn, index, lenNm, ln, ch);\n\t\t\tconst {ln: v_ln, ch: v_ch} = idx2LnCol(sSn, index +z.lastIndexOf(val ?? val2) -(val ?0 :1), lenNm, ln, ch);\n\t\t\thRng[key] = {k_ln, k_ch, v_ln, v_ch, v_len: val ?val.length :val2.length +2};\n\t\t}\n\n\t\treturn hRng;\n\t}\n\n\t#hPrm: HPRM\t= {};\n\tget hPrm() {return this.#hPrm}\n\n\t#isKomeParam\t= false;\n\tget isKomeParam() {return this.#isKomeParam}\n\n}\n","/* eslint-disable @typescript-eslint/no-non-null-assertion */\n/* ***** BEGIN LICENSE BLOCK *****\n\tCopyright (c) 2019-2025 Famibee (famibee.blog38.fc2.com)\n\n\tThis software is released under the MIT License.\n\thttp://opensource.org/licenses/mit-license.php\n** ***** END LICENSE BLOCK ***** */\n\nimport {AnalyzeTagArg} from './AnalyzeTagArg';\nimport {getFn} from './CmnLib';\nimport {type T_Config, SEARCH_PATH_ARG_EXT} from './ConfigBase';\n\n\nexport type TArg = {\n\t':„Çø„Ç∞Âêç'?\t: string;\n\tcanskip?\t: boolean;\n\n\tlayer?\t: string;\t// „É¨„Ç§„É§Á≥ª\n\tclass?\t: string;\n\tindex?\t: number;\n\tdive?\t: string;\n\tpage?\t: string;\n\talpha?\t: number;\n\tpivot_x?: number;\n\tpivot_y?: number;\n\trotation?\t: number;\n\tscale_x?: number;\n\tscale_y?: number;\n\tvisible?: boolean;\n\tblendmode?\t: string;\n\n\tleft?\t: number;\n\ttop?\t: number;\n\twidth?\t: number;\n\theight?\t: number;\n\tpl?\t\t: number;\n\tpr?\t\t: number;\n\tpt?\t\t: number;\n\tpb?\t\t: number;\n\n\trotate?\t: number;\n\tin_style?\t: string;\n\tout_style?\t: string;\n\tffs?\t: string;\n\tnoffs?\t: string;\n\tkinsoku_sol?\t: string;\n\tkinsoku_eol?\t: string;\n\tkinsoku_dns?\t: string;\n\tkinsoku_bura?\t: string;\n\tbura?\t: boolean;\n\tbreak_fixed?\t\t: boolean;\n\tbreak_fixed_left?\t: number;\n\tbreak_fixed_top?\t: number;\n\n\ttime?\t: number;\n\trule?\t: string;\n\tglsl?\t: string;\n\trender?\t: boolean;\n\n\tpos?\t: string;\n\ttext?\t: string;\n\twait?\t: number;\n\trecord?\t: boolean;\n\tpic?\t: string;\n\tenabled?: boolean;\n\thint?\t\t: string;\n\thint_style?\t: string;\n\thint_opt?\t: string;\n\tclickse?\t: string;\n\tenterse?\t: string;\n\tleavese?\t: string;\n\tclicksebuf?\t: string;\n\tentersebuf?\t: string;\n\tleavesebuf?\t: string;\n\tonenter?\t: string;\n\tonleave?\t: string;\n\n\tt?\t: string;\n\tr?\t: string;\n\texp?\t: string;\n\tchar?\t: string;\n\tsesame?\t: string;\n\tcast?\t: string;\n\tval?\t: string;\n\tflags?\t: string;\n\treg?\t: string;\n\tlen?\t: string;\n\turl?\t: string;\n\tformat?\t: string;\n\tchain?\t: string;\n\tpath?\t: string;\n\n\tfn?\t\t: string;\n\tface?\t: string;\n\tlabel?\t: string;\n\tcall?\t: boolean;\n\tglobal?\t: boolean;\n\tname?\t: string;\n\tclear_local_event?\t: boolean;\n\n\tstyle?\t\t\t: string;\n\tstyle_hover?\t: string;\n\tstyle_clicked?\t: string;\n\tr_style?\t\t: string;\n\tr_style_hover?\t: string;\n\tr_style_clicked?: string;\n\tr_align?\t: string;\n\n\tb_width?\t: string;\n\tb_height?\t: string;\n\tb_color?\t: string;\n\tb_alpha?\t: number;\n\tb_alpha_isfixed?\t: boolean;\n\tb_pic?\t\t: string;\n\tback_clear?\t: string;\n\n\tmax_col?\t: string;\n\tmax_row?\t: string;\n\tbura_col?\t: string;\n\tchk_overrow?\t: string;\n\n\tdx?\t: number;\n\tdy?\t: number;\n\n\tkey?\t: string;\n\ttype?\t: string;\t// 3D„É¨„Ç§„É§„Åß‰ΩøÁî®\n\tcamera_target?\t: string;\n\n\targ?\t: TArg;\n\tfnc?\t: ()=> void;\n\n\tfilter?\t: string;\n\tmatrix?\t: string;\n\tclear_filter?\t: boolean;\n\tenable_filter?\t: boolean;\n\n\tease?\t: string;\n\n\tcentering?\t:boolean;\n\tx?\t\t: number | string;\n\ty?\t\t: number | string;\n\n\tid?\t\t\t: string;\n\tsrc?\t\t: string;\n\tvar_name?\t: string;\n\tset_fnc?\t: string;\n\tbreak_fnc?\t: string;\n\n\tfrom?\t: number;\n\tto?\t\t: number | string;\n\tplace?\t: number;\n\tadd?\t: string;\n\tdel?\t: string;\n\n\tbuf?\t: string;\t// Èü≥Á≥ª\n\tbuf2?\t: string;\n\tloop?\t: boolean;\n\tvolume?\t: number;\n\tret_ms?\t: number;\n\tend_ms?\t: number;\n\tjoin?\t: boolean;\n\tdo_rec?\t: boolean;\n\tpan?\t: number;\n\tstop?\t: boolean;\n\n\tclear?\t: boolean;\n\n\t// „Éá„Ç∂„Ç§„É≥„É¢„Éº„Éâ\n\t':id_dc'?\t: string;\n\t':id_tag'?\t: string;\n\t':path'?\t: string;\n\t':ln'?\t\t: number;\n\t':col_s'?\t: number;\n\t':col_e'?\t: number;\n\t':idx_tkn'?\t: number;\n\t':token'?\t: string;\n\t':redraw'?\t: boolean;\n\tdesign_unit?: boolean;\t// „Éá„Ç∂„Ç§„É≥„É¢„Éº„Éâ„Åß„Åì„ÅÆ„Éû„ÇØ„É≠„Å∏„ÅÆÂºïÊï∞Â§âÊõ¥„Å®„Åô„Çã„ÅãÔºàÂÜÖÈÉ®„Çí„Çµ„Éº„ÉÅ„Åï„Åõ„Å™„ÅÑÔºâ\n\n//\tstepin?\t\t: boolean;\t\t// Êã°ÂºµÊ©üËÉΩ„ÅÆ„Åø‰ΩøÁî®ÔºöfalseÊåáÂÆö„Åß„Çπ„ÉÜ„ÉÉ„Éó„Ç§„É≥„Åó„Å™„ÅÑ\n//\tnowarn_unused?\t: boolean;\t// Êã°ÂºµÊ©üËÉΩ„ÅÆ„Åø‰ΩøÁî®ÔºöÊú™‰ΩøÁî®Ë≠¶Âëä„ÇíÂá∫„Åï„Å™„ÅÑ\n}\nexport type TTag = (hArg: TArg) => boolean;\nexport type T_HTag = {\n// Â§âÊï∞Êìç‰Ωú\n\tclearsysvar\t\t\t: TTag;\t// „Ç∑„Çπ„ÉÜ„É†Â§âÊï∞„ÅÆÂÖ®Ê∂àÂéª\n\tclearvar\t\t\t: TTag;\t// „Ç≤„Éº„É†Â§âÊï∞„ÅÆÂÖ®Ê∂àÂéª\n\tlet_abs\t\t\t\t: TTag;\t// Áµ∂ÂØæÂÄ§\n\tlet_char_at\t\t\t: TTag;\t// ÊñáÂ≠óÂàó„Åã„Çâ‰∏ÄÂ≠óÂèñ„Çä„Å†„Åó\n\tlet_index_of\t\t: TTag;\t// ÊñáÂ≠óÂàó„ÅßÊ§úÁ¥¢\n\tlet_length\t\t\t: TTag;\t// ÊñáÂ≠óÂàó„ÅÆÈï∑„Åï\n\tlet_ml\t\t\t\t: TTag;\t// „Ç§„É≥„É©„Ç§„É≥„ÉÜ„Ç≠„Çπ„Éà‰ª£ÂÖ•\n\tlet_replace\t\t\t: TTag;\t// Ê≠£Ë¶èË°®Áèæ„ÅßÁΩÆÊèõ\n\tlet_round\t\t\t: TTag;\t// ÂõõÊç®‰∫îÂÖ•\n\tlet_search\t\t\t: TTag;\t// Ê≠£Ë¶èË°®Áèæ„ÅßÊ§úÁ¥¢\n\tlet_substr\t\t\t: TTag;\t// ÊñáÂ≠óÂàó„Åã„ÇâÊäú„Åç„Å†„Åó\n\tlet\t\t\t\t\t: TTag;\t// Â§âÊï∞‰ª£ÂÖ•„ÉªÊºîÁÆó\n\n// „É¨„Ç§„É§ÂÖ±ÈÄö\n\tadd_lay\t\t\t\t: TTag;\t// „É¨„Ç§„É§„ÇíËøΩÂä†„Åô„Çã\n\tclear_lay\t\t\t: TTag;\t// „É¨„Ç§„É§Ë®≠ÂÆö„ÅÆÊ∂àÂéª\n\tfinish_trans\t\t: TTag;\t// „Éà„É©„É≥„ÇπÂº∑Âà∂ÁµÇ‰∫Ü\n\tlay\t\t\t\t\t: TTag;\t// „É¨„Ç§„É§Ë®≠ÂÆö\n\ttrans\t\t\t\t: TTag;\t// „Éö„Éº„Ç∏Ë£èË°®„Çí‰∫§Êèõ\n\twt\t\t\t\t\t: TTag;\t// „Éà„É©„É≥„ÇπÁµÇ‰∫ÜÂæÖ„Å°\n\tadd_filter\t\t\t: TTag;\t// „Éï„Ç£„É´„Çø„ÉºËøΩÂä†\n\tclear_filter\t\t: TTag;\t// „Éï„Ç£„É´„Çø„ÉºÂÖ®ÂâäÈô§\n\tenable_filter\t\t: TTag;\t// „Éï„Ç£„É´„Çø„ÉºÂÄãÂà•ÂàáÊõø\n\n// „Éà„Ç•„Ç§„Éº„É≥„Ç¢„Éã„É°\n\tpause_tsy\t\t\t: TTag;\t// ‰∏ÄÊôÇÂÅúÊ≠¢\n\tresume_tsy\t\t\t: TTag;\t// ‰∏ÄÊôÇÂÅúÊ≠¢ÂÜçÈñã\n\tstop_tsy\t\t\t: TTag;\t// „Éà„Ç•„Ç§„Éº„É≥‰∏≠Êñ≠\n\ttsy\t\t\t\t\t: TTag;\t// „Éà„Ç•„Ç§„Éº„É≥ÈñãÂßã\n\twait_tsy\t\t\t: TTag;\t// „Éà„Ç•„Ç§„Éº„É≥ÁµÇ‰∫ÜÂæÖ„Å°\n\n// ÊñáÂ≠ó„ÉªÊñáÂ≠ó„É¨„Ç§„É§\n\tautowc\t\t\t\t: TTag;\t// ÊñáÂ≠ó„Åî„Å®„ÅÆ„Ç¶„Çß„Ç§„Éà\n\tch\t\t\t\t\t: TTag;\t// ÊñáÂ≠ó„ÇíËøΩÂä†„Åô„Çã\n\tch_in_style\t\t\t: TTag;\t// ÊñáÂ≠óÂá∫ÁèæÊºîÂá∫ÂÆöÁæ©\n\tch_out_style\t\t: TTag;\t// ÊñáÂ≠óÊ∂àÂéªÊºîÂá∫ÂÆöÁæ©\n\tclear_text\t\t\t: TTag;\t// ÊñáÂ≠óÊ∂àÂéª\n\tcurrent\t\t\t\t: TTag;\t// „Éá„Éï„Ç©„É´„ÉàÊñáÂ≠ó„É¨„Ç§„É§Ë®≠ÂÆö\n\tendlet_ml\t\t\t: TTag;\t// „Ç§„É≥„É©„Ç§„É≥„ÉÜ„Ç≠„Çπ„Éà‰ª£ÂÖ•„ÅÆÁµÇÁ´Ø\n\tendlink\t\t\t\t: TTag;\t// „Éè„Ç§„Éë„Éº„É™„É≥„ÇØ„ÅÆÁµÇ‰∫Ü\n\ter\t\t\t\t\t: TTag;\t// „Éö„Éº„Ç∏‰∏°Èù¢„ÅÆÊñáÂ≠óÊ∂àÂéª\n\tgraph\t\t\t\t: TTag;\t// „Ç§„É≥„É©„Ç§„É≥ÁîªÂÉèË°®Á§∫\n\tlink\t\t\t\t: TTag;\t// „Éè„Ç§„Éë„Éº„É™„É≥„ÇØ\n\tr\t\t\t\t\t: TTag;\t// ÊîπË°å\n\trec_ch\t\t\t\t: TTag;\t// Â±•Ê≠¥Êõ∏„ÅçËæº„Åø\n\trec_r\t\t\t\t: TTag;\t// Â±•Ê≠¥ÊîπË°å\n\treset_rec\t\t\t: TTag;\t// Â±•Ê≠¥„É™„Çª„ÉÉ„Éà\n\truby2\t\t\t\t: TTag;\t// ÊñáÂ≠óÂàó„Å®Ë§áÊï∞„É´„Éì„ÅÆËøΩÂä†\n\tset_focus\t\t\t: TTag;\t// „Éï„Ç©„Éº„Ç´„ÇπÁßªÂãï\n\tspan\t\t\t\t: TTag;\t// „Ç§„É≥„É©„Ç§„É≥„Çπ„Çø„Ç§„É´Ë®≠ÂÆö\n\ttcy\t\t\t\t\t: TTag;\t// Á∏¶‰∏≠Ê®™„ÇíË°®Á§∫„Åô„Çã\n\n// ÁîªÂÉè„ÉªÁîªÂÉè„É¨„Ç§„É§\n\tadd_face\t\t\t: TTag;\t// Â∑ÆÂàÜÂêçÁß∞„ÅÆÂÆöÁæ©\n\twv\t\t\t\t\t: TTag;\t// ÂãïÁîªÂÜçÁîüÁµÇ‰∫ÜÂæÖ„Å°\n\n// HTML„Éï„É¨„Éº„É†\n\tadd_frame\t\t\t: TTag;\t// „Éï„É¨„Éº„É†ËøΩÂä†\n\tframe\t\t\t\t: TTag;\t// „Éï„É¨„Éº„É†„Å´Ë®≠ÂÆö\n\tlet_frame\t\t\t: TTag;\t// „Éï„É¨„Éº„É†Â§âÊï∞„ÇíÂèñÂæó\n\tset_frame\t\t\t: TTag;\t// „Éï„É¨„Éº„É†Â§âÊï∞„Å´Ë®≠ÂÆö\n\ttsy_frame\t\t\t: TTag;\t// „Éï„É¨„Éº„É†„Çí„Éà„Ç•„Ç§„Éº„É≥ÈñãÂßã\n\n// „Ç§„Éô„É≥„Éà\n\tclear_event\t\t\t: TTag;\t// „Ç§„Éô„É≥„Éà„ÇíÂÖ®Ê∂àÂéª\n\tenable_event\t\t: TTag;\t// „Ç§„Éô„É≥„ÉàÊúâÁÑ°„ÅÆÂàáÊõø\n\tevent\t\t\t\t: TTag;\t// „Ç§„Éô„É≥„Éà„Çí‰∫àÁ¥Ñ\n\tl\t\t\t\t\t: TTag;\t// Ë°åÊú´„ÇØ„É™„ÉÉ„ÇØÂæÖ„Å°\n\tp\t\t\t\t\t: TTag;\t// Êîπ„Éö„Éº„Ç∏„ÇØ„É™„ÉÉ„ÇØÂæÖ„Å°\n\ts\t\t\t\t\t: TTag;\t// ÂÅúÊ≠¢„Åô„Çã\n\tset_cancel_skip\t\t: TTag;\t// „Çπ„Ç≠„ÉÉ„Éó‰∏≠Êñ≠‰∫àÁ¥Ñ\n\twait\t\t\t\t: TTag;\t// „Ç¶„Çß„Ç§„Éà„ÇíÂÖ•„Çå„Çã\n\twaitclick\t\t\t: TTag;\t// „ÇØ„É™„ÉÉ„ÇØ„ÇíÂæÖ„Å§\n\n// Ôº¢ÔºßÔº≠„ÉªÂäπÊûúÈü≥\n\tfadebgm\t\t\t\t: TTag;\t// BGM„ÅÆ„Éï„Çß„Éº„Éâ\n\tfadeoutbgm\t\t\t: TTag;\t// BGM„ÅÆ„Éï„Çß„Éº„Éâ„Ç¢„Ç¶„Éà\n\tfadeoutse\t\t\t: TTag;\t// ÂäπÊûúÈü≥„ÅÆ„Éï„Çß„Éº„Éâ„Ç¢„Ç¶„Éà\n\tfadese\t\t\t\t: TTag;\t// ÂäπÊûúÈü≥„ÅÆ„Éï„Çß„Éº„Éâ\n\tplaybgm\t\t\t\t: TTag;\t// BGM „ÅÆÊºîÂ•è\n\tplayse\t\t\t\t: TTag;\t// ÂäπÊûúÈü≥„ÅÆÂÜçÁîü\n\tstop_allse\t\t\t: TTag;\t// ÂÖ®ÂäπÊûúÈü≥ÂÜçÁîü„ÅÆÂÅúÊ≠¢\n\tstopbgm\t\t\t\t: TTag;\t// BGM ÊºîÂ•è„ÅÆÂÅúÊ≠¢\n\tstopfadese\t\t\t: TTag;\t// Èü≥Â£∞„Éï„Çß„Éº„Éâ„ÅÆÂÅúÊ≠¢\n\tstopse\t\t\t\t: TTag;\t// ÂäπÊûúÈü≥ÂÜçÁîü„ÅÆÂÅúÊ≠¢\n\tvolume\t\t\t\t: TTag;\t// BGM„ÇÑÂäπÊûúÈü≥„ÅÆÈü≥Èáè„ÇíÊåáÂÆö\n\twb\t\t\t\t\t: TTag;\t// BGM „Éï„Çß„Éº„Éâ„ÅÆÁµÇ‰∫ÜÂæÖ„Å°\n\twf\t\t\t\t\t: TTag;\t// ÂäπÊûúÈü≥„Éï„Çß„Éº„Éâ„ÅÆÁµÇ‰∫ÜÂæÖ„Å°\n\twl\t\t\t\t\t: TTag;\t// BGM ÂÜçÁîü„ÅÆÁµÇ‰∫ÜÂæÖ„Å°\n\tws\t\t\t\t\t: TTag;\t// ÂäπÊûúÈü≥ÂÜçÁîü„ÅÆÁµÇ‰∫ÜÂæÖ„Å°\n\txchgbuf\t\t\t\t: TTag;\t\t// „Çµ„Ç¶„É≥„Éâ„Éê„ÉÉ„Éï„Ç°„ÅÆ‰∫§Êèõ\n\n// Êù°‰ª∂ÂàÜÂ≤ê\n\telse\t\t\t\t: TTag;\t// „Åù„ÅÆ‰ªñif„Éñ„É≠„ÉÉ„ÇØÈñãÂßã\n\telsif\t\t\t\t: TTag;\t// Âà•Êù°‰ª∂„ÅÆif„Éñ„É≠„ÉÉ„ÇØÈñãÂßã\n\tendif\t\t\t\t: TTag;\t// if„Éñ„É≠„ÉÉ„ÇØ„ÅÆÁµÇÁ´Ø\n\tif\t\t\t\t\t: TTag;\t// if„Éñ„É≠„ÉÉ„ÇØ„ÅÆÈñãÂßã\n\n// „É©„Éô„É´„Éª„Ç∏„É£„É≥„Éó\n\tbutton\t\t\t\t: TTag;\t// „Éú„Çø„É≥„ÇíË°®Á§∫\n\tcall\t\t\t\t: TTag;\t// „Çµ„Éñ„É´„Éº„ÉÅ„É≥„Ç≥„Éº„É´\n\tjump\t\t\t\t: TTag;\t// „Ç∑„Éä„É™„Ç™„Ç∏„É£„É≥„Éó\n\tpage\t\t\t\t: TTag;\t// „Éö„Éº„Ç∏ÁßªÂãï\n\tpop_stack\t\t\t: TTag;\t// „Ç≥„Éº„É´„Çπ„Çø„ÉÉ„ÇØÁ†¥Ê£Ñ\n\treturn\t\t\t\t: TTag;\t// „Çµ„Éñ„É´„Éº„ÉÅ„É≥„Åã„ÇâÊàª„Çã\n\n// „Éû„ÇØ„É≠\n\tbracket2macro\t\t: TTag;\t// Êã¨Âºß„Éû„ÇØ„É≠„ÅÆÂÆöÁæ©\n\tchar2macro\t\t\t: TTag;\t// ‰∏ÄÊñáÂ≠ó„Éû„ÇØ„É≠„ÅÆÂÆöÁæ©\n\tendmacro\t\t\t: TTag;\t// „Éû„ÇØ„É≠ÂÆöÁæ©„ÅÆÁµÇ‰∫Ü\n\tmacro\t\t\t\t: TTag;\t// „Éû„ÇØ„É≠ÂÆöÁæ©„ÅÆÈñãÂßã\n\n// „Åó„Åä„Çä\n\tcopybookmark\t\t: TTag;\t// „Åó„Åä„Çä„ÅÆË§áÂÜô\n\terasebookmark\t\t: TTag;\t// „Åó„Åä„Çä„ÅÆÊ∂àÂéª\n\tload\t\t\t\t: TTag;\t// „Åó„Åä„Çä„ÅÆË™≠Ëæº\n\trecord_place\t\t: TTag;\t// „Çª„Éº„Éñ„Éù„Ç§„É≥„ÉàÊåáÂÆö\n\treload_script\t\t: TTag;\t// „Çπ„ÇØ„É™„Éó„ÉàÂÜçË™≠Ëæº\n\tsave\t\t\t\t: TTag;\t// „Åó„Åä„Çä„ÅÆ‰øùÂ≠ò\n\n// ÁîªÈù¢Êè∫„Çâ„Åó\n\tquake\t\t\t\t: TTag;\t// ÁîªÈù¢„ÇíÊè∫„Çâ„Åô\n\tstop_quake\t\t\t: TTag;\t// ÁîªÈù¢Êè∫„Çâ„Åó‰∏≠Êñ≠\n\twq\t\t\t\t\t: TTag;\t// ÁîªÈù¢Êè∫„Çâ„ÅóÁµÇ‰∫ÜÂæÖ„Å°\n\n// „Ç∑„Çπ„ÉÜ„É†\n\tclose\t\t\t\t: TTag;\t// „Ç¢„Éó„É™„ÅÆÁµÇ‰∫Ü\n\texport\t\t\t\t: TTag;\t// „Éó„É¨„Ç§„Éá„Éº„Çø„Çí„Ç®„ÇØ„Çπ„Éù„Éº„Éà\n\timport\t\t\t\t: TTag;\t// „Éó„É¨„Ç§„Éá„Éº„Çø„Çí„Ç§„É≥„Éù„Éº„Éà\n\tloadplugin\t\t\t: TTag;\t// „Éó„É©„Ç∞„Ç§„É≥„ÅÆË™≠„ÅøËæº„Åø\n\tnavigate_to\t\t\t: TTag;\t// ÔºµÔº≤Ôº¨„ÇíÈñã„Åè\n\tsnapshot\t\t\t: TTag;\t// „Çπ„Éä„ÉÉ„Éó„Ç∑„Éß„ÉÉ„Éà\n\ttitle\t\t\t\t: TTag;\t// „Çø„Ç§„Éà„É´ÊåáÂÆö\n\ttoggle_full_screen\t: TTag;\t// ÂÖ®ÁîªÈù¢Áä∂ÊÖãÂàáÊõø\n\tupdate_check\t\t: TTag;\t// Êõ¥Êñ∞„ÉÅ„Çß„ÉÉ„ÇØÊ©üËÉΩ\n\twindow\t\t\t\t: TTag;\t// „Ç¢„Éó„É™„Ç¶„Ç§„É≥„Éâ„Ç¶Ë®≠ÂÆö\n\n// „Éá„Éê„ÉÉ„Ç∞„Éª„Åù„ÅÆ‰ªñ\n\tdump_lay\t\t\t: TTag;\t// „É¨„Ç§„É§„ÅÆ„ÉÄ„É≥„Éó\n\tdump_script\t\t\t: TTag;\t// Â§ñÈÉ®„Å∏„Çπ„ÇØ„É™„Éó„Éà„ÇíË°®Á§∫\n\tdump_stack\t\t\t: TTag;\t// „Çπ„Çø„ÉÉ„ÇØ„ÅÆ„ÉÄ„É≥„Éó\n\tdump_val\t\t\t: TTag;\t// Â§âÊï∞„ÅÆ„ÉÄ„É≥„Éó\n\tlog\t\t\t\t\t: TTag;\t// „É≠„Ç∞Âá∫Âäõ\n\ttrace\t\t\t\t: TTag;\t// „Éá„Éê„ÉÉ„Ç∞Ë°®Á§∫„Å∏Âá∫Âäõ\n}\n\n\nexport type Script = {\n\taToken\t: string[];\t\t// „Éà„Éº„ÇØ„É≥Áæ§\n\tlen\t\t: number;\t\t// „Éà„Éº„ÇØ„É≥Êï∞\n\taLNum\t: number[];\t\t// „Éà„Éº„ÇØ„É≥„ÅÆË°åÁï™Âè∑\n};\n\n\nexport const\tREG_TAG\t= /(?<name>[^\\s;\\]]+)/;\t// testÁî®„Å´export\nexport function\ttagToken2Name_Args(token: string): [name: string, args: string] {\n\tconst e = REG_TAG.exec(token.slice(1, -1));\n\tconst g = e?.groups;\n\tif (! g) throw `„Çø„Ç∞Ë®òËø∞„Äê${token}„ÄëÁï∞Â∏∏„Åß„Åô(„Çø„Ç∞Ëß£Êûê)`;\n\n\tconst nm = g.name!;\n\treturn [nm, token.slice(1 +nm.length, -1)];\n}\nexport function\ttagToken2Name(token: string): string {\n\tconst e = REG_TAG.exec(token.slice(1));\n\tconst g = e?.groups;\n\tif (! g) throw `„Çø„Ç∞Ë®òËø∞„Äê${token}„ÄëÁï∞Â∏∏„Åß„Åô(„Çø„Ç∞Ëß£Êûê)`;\n\n\treturn g.name!;\n}\n\nexport function\tsplitAmpersand(token: string): {\n\t\tname: string;\n\t\ttext: string;\n\t\tcast: string | undefined;\n} {\t// „ÉÜ„Çπ„ÉàÁî®„Å´public\n\tconst equa = token.replaceAll('==', 'Ôºù').replaceAll('!=', '‚â†').split('=');\n\t\t// != „ÇíÂºæ„Åë„Å™„ÅÑ„ÅÆ„Åß‰∏≠ÈÄîÂçäÁ´Ø„Åß„ÅØ„ÅÇ„Çã\n\tconst cnt_equa = equa.length;\n\tif (cnt_equa < 2 || cnt_equa > 3) throw '„Äå&Ë®àÁÆó„ÄçÊõ∏Âºè„Åß„ÅØ„Äå=„ÄçÊåáÂÆö„Åå‰∏Ä„Å§„Åã‰∫å„Å§ÂøÖË¶Å„Åß„Åô';\n\n\tconst [e0, e1, e2] = equa;\n\tif (e1!.startsWith('&')) throw '„Äå&Ë®àÁÆó„ÄçÊõ∏Âºè„Åß„ÅØ„Äå&„ÄçÊåáÂÆö„Åå‰∏çË¶Å„Åß„Åô';\n\treturn {\n\t\tname: e0!.replaceAll('Ôºù', '==').replaceAll('‚â†', '!='),\n\t\ttext: e1!.replaceAll('Ôºù', '==').replaceAll('‚â†', '!='),\n\t\tcast: cnt_equa === 3 ?e2!.trim() :undefined\n\t};\n}\n\n\nexport class Grammar {\n\tconstructor(private readonly cfg: T_Config) {this.setEscape('')}\n\n\t#REG_TOKEN\t: RegExp;\n\tsetEscape(ce: string) {\n\t\tif (this.#hC2M && ce in this.#hC2M) throw '[„Ç®„Çπ„Ç±„Éº„ÉóÊñáÂ≠ó] char„Äê'+ ce +'„Äë„ÅåÁôªÈå≤Ê∏à„Åø„ÅÆÊã¨Âºß„Éû„ÇØ„É≠„Åæ„Åü„ÅØ‰∏ÄÊñáÂ≠ó„Éû„ÇØ„É≠„Åß„Åô';\n\n\t\t// 1083 matches (14577 step, 9.9ms) https://regex101.com/r/dP0tAY/1\n\t\t/*\n\\\\\\S |\n \\n+\n| \\t+\n|\t\\[let_ml \\s+ [^\\]]+ ]\n\t.+? (?=\\[endlet_ml [\\]\\s])\n| \\[ (?: [^\"'#;\\]]+\n\t| ([\"'#]).*?\\1\n\t| ;[^\\n]* ) *? ]\n| ;[^\\n]*\n| &[^&\\n]+&\n| &&?(?: [^\"'#;\\n&]+ | ([\"'#]).*?\\2 )+\n| ^\\*[^\\s\\[&;\\\\]+\n| [^\\n\\t\\[;\\\\]+\n\t\t*/\n/*\n\t[^\"'#;\\]]++\n\t| ([\"'\\#]).*?\\1\n\t\t\t++ „Å´„Åó„Åü„ÅÑ„Å®„Åì„Çç„Å†„Åå„ÄÅjs„ÅØÊú™„Çµ„Éù„Éº„Éà„Çâ„Åó„ÅÑÔºà2022/10/16Ôºâ\n*/\n\t\t// (new RegExp(\"~\")) „ÅÆÂ†¥Âêà„ÅØ„ÄÅ„Éê„ÉÉ„ÇØ„Çπ„É©„ÉÉ„Ç∑„É•„ÅØÔºí„Å§ÂøÖË¶Å\n\t\t\t// https://qiita.com/ue5963/items/bd8e32ac9e6b12aa7fab\n\t\tthis.#REG_TOKEN = new RegExp(\n\t\t(ce\t?`\\\\${ce}\\\\S|` :'')+\t// „Ç®„Çπ„Ç±„Éº„Éó„Ç∑„Éº„Ç±„É≥„Çπ\n\t\t'\\\\n+'+\t\t\t\t// ÊîπË°å\n\t\t'|\\\\t+'+\t\t\t// „Çø„ÉñÊñáÂ≠ó\n\t\t'|\\\\[let_ml\\\\s+[^\\\\]]+\\\\]'+\n\t\t\t'.+?'+\t\t\t// [let_ml]„Äú[endlet_ml]Èñì„ÅÆ„ÉÜ„Ç≠„Çπ„Éà\n\t\t'(?=\\\\[endlet_ml[\\\\]\\\\s])'+\n\t\t'|\\\\[(?:'+\n\t\t\t'[^\"\\'#;\\\\]]+|'+\t// „Çø„Ç∞\n\t\t\t'([\"\\'#]).*?\\\\1' +\n\t\t\t\t// . „ÅØ (?:\\\\${ ce??'\\\\' }.|[^\\\\1]) „Åß„Å™„Åè„Å¶„Çà„Åï„Åí\n\t\t'|;[^\\\\n]*)*?]'+\n\t\t'|;[^\\\\n]*'+\t\t// „Ç≥„É°„É≥„Éà\n\t\t'|&[^&\\\\n]+&'+\t\t// ÔºÜË°®Á§∫ÔºÜ\n\t\t'|&&?(?:[^\"\\'#;\\\\n&]+|([\"\\'#]).*?\\\\2)+'+\t// ÔºÜ‰ª£ÂÖ•\n\t\t'|^\\\\*[^\\\\s\\\\[&;\\\\\\\\]+'+\t// „É©„Éô„É´\n\t\t`|[^\\\\n\\\\t\\\\[;${ce ?`\\\\${ce}` :''}]+`,\t\t// Êú¨Êñá\n\t\t'gs');\n\t\tthis.#REG_CANTC2M = new RegExp(`[\\\\w\\\\s;[\\\\]*=&ÔΩú„Ää„Äã${ce ?`\\\\${ce}` :''}]`);\n\t\tthis.#REG_TOKEN_NOTXT = new RegExp(`[\\\\n\\\\t;\\\\[*&${ce ?`\\\\${ce}` :''}]`);\n\t}\n\n\n\t// Êã¨Âºß„Éû„ÇØ„É≠„ÅÆÂÆöÁæ©\n\tbracket2macro(hArg: TArg, hTag: T_HTag, scr: Script, start_idx: number) {\n\t\tconst {name, text} = hArg;\n\t\tif (! name) throw '[bracket2macro] name„ÅØÂøÖÈ†à„Åß„Åô';\n\t\tif (! text) throw '[bracket2macro] text„ÅØÂøÖÈ†à„Åß„Åô';\n\t\tconst op = text.at(0);\n\t\tif (! op) throw '[bracket2macro] text„ÅØÂøÖÈ†à„Åß„Åô';\n\t\tif (text.length !== 2) throw '[bracket2macro] text„ÅØÊã¨Âºß„ÅÆÂâçÂæå„ÇíÁ§∫„Åô‰∫åÊñáÂ≠ó„ÇíÊåáÂÆö„Åó„Å¶„Åè„Å†„Åï„ÅÑ';\n\t\tif (! (name in hTag)) throw `[bracket2macro] Êú™ÂÆöÁæ©„ÅÆ„Çø„Ç∞Âèà„ÅØ„Éû„ÇØ„É≠[${name}]„Åß„Åô`;\n\n\t\tthis.#hC2M ??= {};\n\t\tconst cl = text.charAt(1);\n\t\tif (op in this.#hC2M) throw '[bracket2macro] text„Äê'+ op +'„Äë„ÅåÁôªÈå≤Ê∏à„Åø„ÅÆÊã¨Âºß„Éû„ÇØ„É≠„Åæ„Åü„ÅØ‰∏ÄÊñáÂ≠ó„Éû„ÇØ„É≠„Åß„Åô';\n\t\tif (cl in this.#hC2M) throw '[bracket2macro] text„Äê'+ cl +'„Äë„ÅåÁôªÈå≤Ê∏à„Åø„ÅÆÊã¨Âºß„Éû„ÇØ„É≠„Åæ„Åü„ÅØ‰∏ÄÊñáÂ≠ó„Éû„ÇØ„É≠„Åß„Åô';\n\t\tif (this.#REG_CANTC2M.test(op)) throw '[bracket2macro] text„Äê'+ op +'„Äë„ÅØÊã¨Âºß„Éû„ÇØ„É≠„Å´‰ΩøÁî®„Åß„Åç„Å™„ÅÑÊñáÂ≠ó„Åß„Åô';\n\t\tif (this.#REG_CANTC2M.test(cl)) throw '[bracket2macro] text„Äê'+ cl +'„Äë„ÅØÊã¨Âºß„Éû„ÇØ„É≠„Å´‰ΩøÁî®„Åß„Åç„Å™„ÅÑÊñáÂ≠ó„Åß„Åô';\n\n\t\tthis.#hC2M[cl] = '0';\t// „ÉÅ„Çß„ÉÉ„ÇØÁî®„ÉÄ„Éü„Éº\n\t\tthis.#hC2M[op] = `[${name} text=`;\n\n\t\tthis.addC2M(`\\\\${op}[^\\\\${cl}]*\\\\${cl}`, `\\\\${op}\\\\${cl}`);\n\n\t\tthis.#replaceScr_C2M(scr, start_idx);\n\t}\n\t// ‰∏ÄÊñáÂ≠ó„Éû„ÇØ„É≠„ÅÆÂÆöÁæ©\n\tchar2macro(hArg: TArg, hTag: T_HTag, scr: Script, start_idx: number) {\n\t\tconst {char, name} = hArg;\n\t\tif (! char) throw '[char2macro] char„ÅØÂøÖÈ†à„Åß„Åô';\n\t\tthis.#hC2M ??= {};\n\t\tif (char in this.#hC2M) throw '[char2macro] char„Äê'+ char +'„Äë„ÅåÁôªÈå≤Ê∏à„Åø„ÅÆÊã¨Âºß„Éû„ÇØ„É≠„Åæ„Åü„ÅØ‰∏ÄÊñáÂ≠ó„Éû„ÇØ„É≠„Åß„Åô';\n\t\tif (this.#REG_CANTC2M.test(char)) throw '[char2macro] char„Äê'+ char +'„Äë„ÅØ‰∏ÄÊñáÂ≠ó„Éû„ÇØ„É≠„Å´‰ΩøÁî®„Åß„Åç„Å™„ÅÑÊñáÂ≠ó„Åß„Åô';\n\n\t\tif (! name) throw '[char2macro] name„ÅØÂøÖÈ†à„Åß„Åô';\n\t\tif (! (name in hTag)) throw `[char2macro] Êú™ÂÆöÁæ©„ÅÆ„Çø„Ç∞Âèà„ÅØ„Éû„ÇØ„É≠[${name}]„Åß„Åô`;\n\n\t\tthis.#hC2M[char] = `[${name}]`;\n\n\t\tthis.addC2M(`\\\\${char}`, `\\\\${char}`);\n\n\t\tthis.#replaceScr_C2M(scr, start_idx);\n\t}\n\t#REG_CANTC2M\t: RegExp;\n\t#REGC2M\t\t\t= new RegExp('');\n\t#regStrC2M\t\t= '';\n\t#regStrC2M4not\t= '';\n\taddC2M(a: string, b: string) {\n\t\tthis.#regStrC2M += `${a}|`;\n\t\tthis.#regStrC2M4not += b;\n\t\tthis.#REGC2M = new RegExp(\n\t\t\t`(${this.#regStrC2M}[^${this.#regStrC2M4not}]+)`, 'g');\n\t}\n\n\n\tresolveScript(txt: string): Script {\n\t\tconst a: string[] = txt\n\t\t.replaceAll(/\\r\\n?/g, '\\n')\n\t\t.match(this.#REG_TOKEN)\n\t\t?.flatMap(tkn=> {\n\t\t\tif (! this.testTagLetml(tkn)) return tkn;\n\n\t\t\tconst r = /^([^\\]]+?])(.*)$/s.exec(tkn);\n\t\t\tif (! r) return tkn;\n\t\t\tconst [, a, b] = r;\n\t\t\treturn [a!, b!];\n\t\t}) ?? [];\n\n\t\tconst scr = {aToken: a, len: a.length, aLNum: []};\n\t\tthis.#replaceScr_C2M(scr);\n\n\t\tthis.#replaceScript_Wildcard(scr);\n\n\t\treturn scr;\n\t}\n\n\n\treadonly #REG_WILDCARD\t= /^\\[(call|loadplugin)\\s/;\n\treadonly #REG_WILDCARD2\t= /\\bfn\\s*=\\s*[^\\s\\]]+/;\n\t#replaceScript_Wildcard(scr: Script) {\n\t\tfor (let i=scr.len -1; i>=0; --i) {\n\t\t\tconst token = scr.aToken[i]!;\n\t\t\tif (! this.#REG_WILDCARD.test(token)) continue;\n\n\t\t\tconst [tag_name, args] = tagToken2Name_Args(token);\n\t\t\tthis.#alzTagArg.parse(args);\n\n\t\t\tconst p_fn = this.#alzTagArg.hPrm.fn;\n\t\t\tif (! p_fn) continue;\n\t\t\tconst {val: fn} = p_fn;\n\t\t\tif (! fn.endsWith('*')) continue;\n\n\t\t\tscr.aToken.splice(i, 1, '\\t', '; '+ token);\n\t\t\tscr.aLNum.splice(i, 1, NaN, NaN);\n\n\t\t\tconst ext = tag_name === 'loadplugin'\n\t\t\t\t? SEARCH_PATH_ARG_EXT.CSS\n\t\t\t\t: SEARCH_PATH_ARG_EXT.SN;\n\t\t\tconst a = this.cfg.matchPath('^'+ fn.slice(0, -1) +'.*', ext);\n\t\t\tfor (const v of a) {\n\t\t\t\tconst nt = token.replace(\n\t\t\t\t\tthis.#REG_WILDCARD2,\n\t\t\t\t\t'fn='+ decodeURIComponent(getFn(v[ext]!))\n\t\t\t\t);\n\t\t\t\t//console.log('\\t='+ nt +'=');\n\t\t\t\tscr.aToken.splice(i, 0, nt);\n\t\t\t\tscr.aLNum.splice(i, 0, NaN);\n\t\t\t}\n\t\t}\n\t\tscr.len = scr.aToken.length;\n\t}\n\t\treadonly\t#alzTagArg\t= new AnalyzeTagArg;\n\n\n\ttestTagLetml(tkn: string): boolean {return /^\\[let_ml\\s/.test(tkn)}\n\ttestTagEndLetml(tkn: string): boolean {return /^\\[endlet_ml\\s*]/.test(tkn)}\n\n\n\t#hC2M\t: {[char: string]: string} | undefined = undefined;\n\t#REG_TOKEN_NOTXT\t: RegExp;\n\t#replaceScr_C2M(scr: Script, start_idx = 0): void {\n\t\tif (! this.#hC2M) return;\n\n\t\tfor (let i=scr.len- 1; i >= start_idx; --i) {\n\t\t\tconst token = scr.aToken[i]!;\n\t\t\tif (this.testNoTxt(token.at(0) ?? '\\n')) continue;\n\t\t\t\t// ÁúÅÁï•ÊôÇ„ÅØ #REG_TOKEN_NOTXT „Å´Âºï„Å£„Åã„Åã„Çã \\n „Å´\n\n\t\t\tconst lnum = scr.aLNum[i]!;\n\t\t\tconst a = token.match(this.#REGC2M);\n\t\t\tif (! a) continue;\n\t\t\tlet del = 1;\n\t\t\tfor (let j=a.length -1; j>=0; --j) {\n\t\t\t\tlet ch = a[j]!;\n\t\t\t\tconst macro = this.#hC2M[ch.at(0) ?? ' '];\n\t\t\t\t\t// ÁúÅÁï•ÊôÇ„ÅØ #REG_CANTC2M „Å´Âºï„Å£„Åã„Åã„Çã ' ' „Å´\n\t\t\t\tif (macro) {\n\t\t\t\t\tch = macro +(macro.endsWith(']')\n\t\t\t\t\t\t? ''\n\t\t\t\t\t\t: `'${ch.slice(1, -1)}']`);\n\t\t\t\t\t// ÊñáÂ≠óÂàó„ÅØÂçäËßíÁ©∫ÁôΩ„ÇíÊÑèË≠ò„Åó„Å¶''„ÅßÂõ≤„ÇÄ„Åå„ÄÅ„ÅÑ„Åö„ÇåÂ§â„Åà„Åü„ÅÑÂ†¥Âêà„Åå„ÅÇ„ÇãÔºü\n\t\t\t\t}\n\t\t\t\tscr.aToken.splice(i, del, ch);\n\n\t\t\t\tscr.aLNum.splice(i, del, lnum);\n\t\t\t\tdel = 0;\n\t\t\t}\n\t\t}\n\t\tscr.len = scr.aToken.length;\n\t}\n\ttestNoTxt(ch: string): boolean {return this.#REG_TOKEN_NOTXT.test(ch)}\t//4tst\n\n}\n","/* ***** BEGIN LICENSE BLOCK *****\n\tCopyright (c) 2018-2025 Famibee (famibee.blog38.fc2.com)\n\n\tThis software is released under the MIT License.\n\thttp://opensource.org/licenses/mit-license.php\n** ***** END LICENSE BLOCK ***** */\n\nimport {CmnLib, argChk_Boolean, parseColor} from './CmnLib';\nimport type {T_HTag, TArg} from './Grammar';\nimport type {T_Main, Scope, T_VAL_BSNU, T_VAL_DATA} from './CmnInterface';\nimport type {SysBase} from './SysBase';\nimport {DebugMng} from './DebugMng';\nimport {Config} from './Config';\nimport {splitAmpersand, tagToken2Name_Args} from './Grammar';\nimport type {ScriptIterator} from './ScriptIterator';\nimport type {LayerMng} from './LayerMng';\nimport type {EventMng} from './EventMng';\n\nimport {type IApplicationOptions, Application, utils} from 'pixi.js';\n\n\nconst\tSN_ID\t= 'skynovel';\n\nexport class Main implements T_Main {\n\tstatic\tasync generate(sys: SysBase): Promise<Main> {\n\t\tutils.skipHello();\n\n\t\tconst m = new Main(sys);\n\t\tawait m.#init()\n\t\t.catch((e: unknown)=> console.error('Main.generate err e:%o', e));\n\n\t\treturn m;\n\t}\n\n\n\tcvs\t\t\t: HTMLCanvasElement;\n\n\t// eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n\t#hTag\t\t: T_HTag\t\t= Object.create(null);\t// „Çø„Ç∞Âá¶ÁêÜËæûÊõ∏\n\n\t#scrItr\t\t: ScriptIterator;\n\t#layMng\t\t: LayerMng;\n\t#evtMng\t\t: EventMng;\n\n\t#aDest\t\t: (()=> void)[]\t\t= [];\n\n\n\tprivate constructor(private readonly sys: SysBase) {}\n\n\tasync #init() {\n\t\tconst cfg = await Config.generate(this.sys);\n\t\tthis.sys.setMain(this, cfg);\n\n\t\tconst hApp: IApplicationOptions = {\n\t\t\twidth\t\t\t: cfg.oCfg.window.width,\n\t\t\theight\t\t\t: cfg.oCfg.window.height,\n\t\t\tbackgroundColor\t: parseColor(String(cfg.oCfg.init.bg_color)),\n\t\t\t\t// „Åì„ÅÆString()„ÅØÂæåÊñπ‰∫íÊèõÊÄß„ÅÆ„Åü„ÇÅÂøÖÈ†à\n\t\t\tresolution\t\t: globalThis.devicePixelRatio,\n\t\t};\n\n\t\tconst cvs = <HTMLCanvasElement | null>document.getElementById(SN_ID);\n\t\tif (cvs) {\n\t\t\tconst clone_cvs = <HTMLCanvasElement>cvs.cloneNode(true);\n\t\t\tclone_cvs.id = SN_ID;\n\t\t\thApp.view = cvs;\n\t\t\t// eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n\t\t\tconst p = cvs.parentNode!;\n\t\t\tthis.#aDest.unshift(()=> p.appendChild(clone_cvs));\n\t\t}\n\t\telse {\t// Ëá™ÂãïÁöÑ„Å´‰Ωú„Å£„Å¶„Åè„Çå„Çã„Åå„ÄÅ„Å©„ÅÜ„ÇÇ appendChild „Å´ÈÅÖÂª∂„Åå„ÅÇ„Çã„ÅÆ„Åß\n\t\t\tconst c = document.createElement('canvas');\n\t\t\tc.id = SN_ID;\n\t\t\thApp.view = c;\n\t\t\tdocument.body.appendChild(c);\n\t\t\tthis.#aDest.unshift(()=> document.body.removeChild(c));\n\t\t}\n\n\t\tconst app = new Application(hApp);\n\t\tthis.#aDest.unshift(()=> {\n\t\t\tutils.clearTextureCache();\n\t\t\tthis.sys.destroy();\n\t\t\tapp.destroy(false);\t// remove canvas from DOM „ÅåÈùûÂêåÊúü„Å™„ÅÆ„Åß„Ç¶„ÉÅ„Åå„ÇÑ„Çã\n\t\t});\n\n\t\tthis.cvs = app.view;\n\t\tthis.cvs.id = SN_ID +'_act';\n\t\tif (! cvs) document.body.appendChild(this.cvs);\n\n\n\t\tconst cc = document.createElement('canvas').getContext('2d');\n\t\tif (! cc) throw '#init cc err';\n\t\tCmnLib.cc4ColorName = cc;\n\n\t\tconst [{Variable}, {PropParser}, {SoundMng}, {ScriptIterator}, {LayerMng}, {EventMng}, {Button}] = await Promise.all([\n\t\t\timport('./Variable'),\n\t\t\timport('./PropParser'),\n\t\t\timport('./SoundMng'),\n\t\t\timport('./ScriptIterator'),\n\t\t\timport('./LayerMng'),\n\t\t\timport('./EventMng'),\n\t\t\timport('./Button'),\n\t\t]);\n\n\t\tButton.init(cfg);\n\n\t\t// Â§âÊï∞\n\t\tconst val = new Variable(this.sys, cfg, this.#hTag);\n\t\tconst prpPrs = new PropParser(val, cfg.oCfg.init.escape);\n\t\tthis.#setVal_Nochk = (scope, nm, v, autocast)=> val.setVal_Nochk(scope, nm, v, autocast);\n\t\tthis.#getValAmpersand = v=> prpPrs.getValAmpersand(v);\n\t\tthis.#parse = s=> prpPrs.parse(s);\n\n\t\t// „Ç∑„Çπ„ÉÜ„É†\n\t\tawait Promise.allSettled(this.sys.init(this.#hTag, app, val));\t// Â§âÊï∞Ê∫ñÂÇôÂÆå‰∫Ü\n\n\t\t// Ôº¢ÔºßÔº≠„ÉªÂäπÊûúÈü≥\n\t\tconst sndMng = new SoundMng(cfg, this.#hTag, val, this, this.sys);\n\t\tthis.#aDest.unshift(()=> sndMng.destroy());\n\n\t\t// Êù°‰ª∂ÂàÜÂ≤ê„ÄÅ„É©„Éô„É´„Éª„Ç∏„É£„É≥„Éó„ÄÅ„Éû„ÇØ„É≠„ÄÅ„Åó„Åä„Çä\n\t\tthis.#scrItr = new ScriptIterator(cfg, this.#hTag, this, val, prpPrs, sndMng, this.sys);\n\t\tthis.#aDest.unshift(()=> this.#scrItr.destroy());\n\n\t\t// „Éá„Éê„ÉÉ„Ç∞„Éª„Åù„ÅÆ‰ªñ\n\t\tconst dbgMng = new DebugMng(this.sys, this.#hTag, this.#scrItr);\n\t\tthis.#aDest.unshift(()=> dbgMng.destroy());\n\t\tthis.errScript = (mes: string, isThrow = true)=> {\n\t\t\tthis.stop();\n\t\t\tDebugMng.myTrace(mes);\n\t\t\tif (CmnLib.debugLog) console.log('üçú SKYNovel err!');\n\t\t\tif (isThrow) throw mes;\n\t\t}\n\n\t\t// „É¨„Ç§„É§ÂÖ±ÈÄö„ÄÅÊñáÂ≠ó„É¨„Ç§„É§„ÄÅÁîªÂÉè„É¨„Ç§„É§\n\t\tthis.#layMng = new LayerMng(cfg, this.#hTag, app, val, this, this.#scrItr, this.sys, sndMng, prpPrs);\n\t\tthis.#aDest.unshift(()=> this.#layMng.destroy());\n\n\t\t// „Ç§„Éô„É≥„Éà\n\t\tthis.#evtMng = new EventMng(cfg, this.#hTag, app, this, this.#layMng, val, sndMng, this.#scrItr, this.sys);\n\t\tthis.#aDest.unshift(()=> this.#evtMng.destroy());\n\n\t\tthis.#aDest.unshift(()=> {\n\t\t\tthis.stop();\n\t\t\tthis.#isLoop = false;\n\n\t\t\tconst fncDummy = ()=> true;\n\t\t\tfor (const key in this.#hTag) this.#hTag[<keyof T_HTag>key] = fncDummy;\n\t\t});\n\t}\n\n\n\tdestroy() {\n\t\tthis.resume = this.destroy = ()=> { /* empty */ };\t// destroy()ÈÄ£ÊâìÂØæÁ≠ñ\n\n\t\tthis.cvs.parentElement?.removeChild(this.cvs);\n\t\t\t// Ôºà„ÇÆ„É£„É©„É™„Éº„ÅßÔºâdocument.body „ÅØ„Ç®„É©„Éº„Å´„Å™„Çã\n\t\tfor (const f of this.#aDest) f();\n\t\tthis.#aDest = [];\n\t}\n\n\n\terrScript = (_mes: string, _isThrow = true)=> { /* empty */ }\n\n\n\tresumeByJumpOrCall(hArg: TArg) {\n\t\tif (hArg.url) {\n\t\t\tthis.#hTag.navigate_to(hArg);\n\t\t\tthis.#scrItr.jumpJustBefore();\n\t\t\treturn;\n\t\t}\n\n\t\t// eslint-disable-next-line @typescript-eslint/no-base-to-string\n\t\tthis.#setVal_Nochk('tmp', 'sn.eventArg', String(hArg.arg ?? ''));\n\t\tthis.#setVal_Nochk('tmp', 'sn.eventLabel', hArg.label ?? '');\n// console.log(`üìú %cresumeByJumpOrCall:%o`, 'color:#3B0;', hArg);\n\t\tif (argChk_Boolean(hArg, 'call', false)) {\n\t\t\tthis.#scrItr.subIdxToken();\t// „Äå„Ç≥„Éº„É´ÂÖÉ„ÅÆÊ¨°„Äç„Å´ÈÄ≤„ÇÅ„Åö„ÄÅ„Äå„Ç≥„Éº„É´ÂÖÉ„Äç„Å´Êàª„Åô\n\t\t\tif (this.#hTag.call(hArg)) return;\n\t\t}\n\t\telse {\n\t\t\tthis.#hTag.clear_event({});\n\t\t\tif (this.#hTag.jump(hArg)) return;\n\t\t}\n\t\tthis.resume();\n\t}\n\t\t#setVal_Nochk = (_scope: Scope, _nm: string, _val: T_VAL_BSNU, _autocast = false)=> { /* empty */ }\n\n\tresume() {\n// console.log(`üìúüü¢ resume!`);\n\t\t// „Çπ„ÇØ„É™„Éó„Éà„ÅåÂãï„Åè„Å®„Åç„ÄÅ„Éñ„É¨„Ç§„ÇØ„Éû„Éº„ÇØ„Å™„Å©Ê∂àÂéª\n\t\tthis.#layMng.clearBreak();\n\t\tthis.#scrItr.noticeBreak(false);\n\t\tthis.#evtMng.hideHint();\n\n\t\tqueueMicrotask(()=> {void this.#main()});\n\t}\n\treadonly stop = ()=> {\n// console.log(`üìúüî¥ stop!`);\n\t\tthis.#scrItr.noticeBreak(true);\n\t};\n\n\tsetLoop(isLoop: boolean, mes = '') {\n\t\t///console.log('setLoop:'+ (isLoop ?'resume!' :'stop!') +' mes:'+ mes);\n\t\t// eslint-disable-next-line no-cond-assign\n\t\tif (this.#isLoop = isLoop) this.resume(); else this.stop();\n\t\tthis.sys.setTitleInfo(mes ?` -- ${mes}‰∏≠` :'');\n\t}\n\t// oxlint-disable-next-line no-unused-private-class-members\n\t#isLoop = true;\n\n\t//MARK: „É°„Ç§„É≥Âá¶ÁêÜÔºà„Ç∑„Éä„É™„Ç™Ëß£ÊûêÔºâ\n\tasync #main() {\n\t\tlet errHd = '';\n\t\ttry {\n\t\t\twhile (this.#isLoop) {\n\t\t\t\tlet token = this.#scrItr.nextToken();\n\t\t\t\tif (! token) return;\t// ÂàùÊúüÂåñÂâç„Å´ÁµÇ‰∫Ü„Åó„ÅüÂ†¥ÂêàÂêë„Åë\n\n\t\t\t\tconst uc = token.charCodeAt(0);\t// TokenTopUnicode\n\t\t\t\t// \\t „Çø„Éñ\n\t\t\t\tif (uc === 9) continue;\n\t\t\t\t// \\n ÊîπË°å\n\t\t\t\tif (uc === 10) {this.#scrItr.addLineNum(token.length); continue}\n\t\t\t\t// [ „Çø„Ç∞ÈñãÂßã\n\t\t\t\tif (uc === 91) {\n\t\t\t\t\terrHd = '„Çø„Ç∞ÈñãÂßã';\n\t\t\t\t\tif (this.#scrItr.isBreak(token)) return;\n\n\t\t\t\t\tconst [tag_name, args] = tagToken2Name_Args(token);\n\t\t\t\t\terrHd = `[${tag_name}]‰æãÂ§ñ`;\n\n\t\t\t\t\tconst cl = (token.match(/\\n/g) ?? []).length;\n\t\t\t\t\tif (cl > 0) this.#scrItr.addLineNum(cl);\n\t\t\t\t\tif (await this.#scrItr.„Çø„Ç∞Ëß£Êûê(\n\t\t\t\t\t\t<keyof T_HTag>tag_name, args\n\t\t\t\t\t)) {this.stop(); return}\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\t// & Â§âÊï∞Êìç‰Ωú„ÉªÂ§âÊï∞Ë°®Á§∫\n\t\t\t\t// anÊôÇ‰ª£„ÉªÁÄ¨Êà∏ÊÑõÁæÖ„Åï„Çì„Çà„Çä https://famibee.blog.fc2.com/blog-entry-245.html\n\t\t\t\tif (uc === 38) {\n\t\t\t\t\tif (! token.endsWith('&')) {\n\t\t\t\t\t\terrHd = 'Â§âÊï∞Ë®àÁÆó';\n\t\t\t\t\t\tif (this.#scrItr.isBreak(token)) return;\n\t\t\t\t\t\tconst o = splitAmpersand(token.slice(1));\n\t\t\t\t\t\to.name = this.#getValAmpersand(o.name);\n\t\t\t\t\t\to.text = String(this.#parse(o.text));\n\t\t\t\t\t\tthis.#hTag.let(o);\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\terrHd = 'Â§âÊï∞Êìç‰Ωú';\n\t\t\t\t\tif (token.charAt(1) === '&') throw new Error('„Äå&Ë°®Á§∫&„ÄçÊõ∏Âºè„Åß„ÅØ„Äå&„ÄçÊåáÂÆö„Åå‰∏çË¶Å„Åß„Åô');\n\t\t\t\t\ttoken = String(this.#parse( token.slice(1, -1) ));\n\t\t\t\t\t\t// -> ÊñáÂ≠óË°®Á§∫ „Å∏\n\t\t\t\t}\n\t\t\t\t// ; „Ç≥„É°„É≥„Éà\n\t\t\t\telse if (uc === 59) continue;\n\t\t\t\t// * „É©„Éô„É´\n\t\t\t\telse if (uc === 42 && token.length > 1) continue;\n\n\t\t\t\t// ÊñáÂ≠óË°®Á§∫\n\t\t\t\terrHd = 'ÊñáÂ≠óË°®Á§∫';\n\t\t\t\tthis.#layMng.setNormalChWait();\n\t\t\t\tconst tl = this.#layMng.currentTxtlayForeNeedErr;\n\t\t\t\ttl.tagCh(token);\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tthis.errScript(`${errHd} ${\n\t\t\t\te instanceof Error ?`mes=${e.message}(${e.name})` :String(e)\n\t\t\t}`, false);\n\t\t}\n\t}\n\t\t#getValAmpersand\t= (_v: string)=> '';\n\t\t#parse\t\t\t\t: (_s: string)=> T_VAL_DATA;\n\n}\n"],"names":["PROTOCOL_USERDATA","PROTOCOL_DL","Config","ConfigBase","sys","c","fn","res","dec","oCfg","CmnLib","extptn","SEARCH_PATH_ARG_EXT","idx2LnCol","sSn","idx","lenNm","ln","ch","len","AnalyzeTagArg","#REG_TAGARG","args","#hPrm","#isKomeParam","groups","key","val","val2","def","def2","literal","token","hRng","index","z","lenVnm","k_ch","k_ln","v_ln","v_ch","REG_TAG","tagToken2Name_Args","g","nm","tagToken2Name","splitAmpersand","equa","cnt_equa","e0","e1","e2","Grammar","cfg","#REG_TOKEN","ce","#hC2M","#REG_CANTC2M","#REG_TOKEN_NOTXT","hArg","hTag","scr","start_idx","name","text","op","cl","#replaceScr_C2M","char","#REGC2M","#regStrC2M","#regStrC2M4not","a","b","txt","tkn","r","#replaceScript_Wildcard","#REG_WILDCARD","#REG_WILDCARD2","i","tag_name","#alzTagArg","p_fn","ext","v","nt","getFn","lnum","del","j","macro","SN_ID","Main","utils.skipHello","m","#init","e","#hTag","#scrItr","#layMng","#evtMng","#aDest","hApp","parseColor","cvs","clone_cvs","p","app","Application","utils.clearTextureCache","cc","Variable","PropParser","SoundMng","ScriptIterator","LayerMng","EventMng","Button","prpPrs","#setVal_Nochk","scope","autocast","#getValAmpersand","#parse","s","sndMng","dbgMng","DebugMng","mes","isThrow","#isLoop","fncDummy","f","_mes","_isThrow","argChk_Boolean","_scope","_nm","_val","_autocast","#main","isLoop","errHd","uc","o","_v"],"mappings":"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"}