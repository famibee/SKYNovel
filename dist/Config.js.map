{"version":3,"file":"Config.js","names":["sys: SysBase"],"sources":["../src/sn/Config.ts"],"sourcesContent":["/* ***** BEGIN LICENSE BLOCK *****\n\tCopyright (c) 2018-2025 Famibee (famibee.blog38.fc2.com)\n\n\tThis software is released under the MIT License.\n\thttp://opensource.org/licenses/mit-license.php\n** ***** END LICENSE BLOCK ***** */\n\nimport {CmnLib} from './CmnLib';\nimport type {SysBase} from './SysBase';\nimport {ConfigBase, SEARCH_PATH_ARG_EXT, type T_CFG_RAW} from './ConfigBase';\n\nexport const PROTOCOL_USERDATA\t= 'userdata:/';\nexport const PROTOCOL_DL\t\t= 'downloads:/';\n\n\nexport class Config extends ConfigBase {\n\tstatic\tasync\tgenerate(sys: SysBase) {\n\t\tconst c = new Config(sys);\n\t\tconst fn = sys.arg.cur +'prj.json';\n\t\tconst res = await sys.fetch(fn);\n\t\tif (! res.ok) throw Error(res.statusText);\n\n\t\tconst dec = await sys.dec(fn, await res.text());\n\t\tawait c.load(<T_CFG_RAW>JSON.parse(dec));\n\t\treturn c;\n\t}\n\n\tprotected\tconstructor(override readonly sys: SysBase) {super(sys)}\n\n\tprotected\toverride\tasync load(oCfg: T_CFG_RAW) {\n\t\toCfg.window ??= {width: 300, height: 300};\n\t\tCmnLib.stageW = oCfg.window.width;\n\t\tCmnLib.stageH = oCfg.window.height;\n\t\tCmnLib.debugLog = oCfg.debug.debugLog;\n\t\tawait CmnLib.init();\n\n\t\treturn super.load(oCfg);\n\t}\n\n\toverride\tsearchPath(fn: string, extptn: SEARCH_PATH_ARG_EXT = SEARCH_PATH_ARG_EXT.DEFAULT): string {\n\t\tif (fn.startsWith(PROTOCOL_DL)) {\n\t\t\treturn this.sys.path_downloads + fn.slice(11);\n\t\t}\n\t\tif (fn.startsWith(PROTOCOL_USERDATA)) {\n\t\t\treturn this.sys.path_userdata + 'storage/'+ fn.slice(10);\n\t\t}\n\n\t\treturn super.searchPath(fn, extptn);\n\t}\n\n}\n"],"mappings":";;AAWA,MAAa,oBAAoB,cACpB,cAAe;AAG5B,IAAa,SAAb,MAAa,UAAe,WAAW;CACtC,aAAa,SAAS,GAAc;EACnC,IAAM,IAAI,IAAI,EAAO,EAAI,EACnB,IAAK,EAAI,IAAI,MAAK,YAClB,IAAM,MAAM,EAAI,MAAM,EAAG;AAC/B,MAAI,CAAE,EAAI,GAAI,OAAM,MAAM,EAAI,WAAW;EAEzC,IAAM,IAAM,MAAM,EAAI,IAAI,GAAI,MAAM,EAAI,MAAM,CAAC;AAE/C,SADA,MAAM,EAAE,KAAgB,KAAK,MAAM,EAAI,CAAC,EACjC;;CAGR,YAAsB,GAAgC;AAAd,EAAe,MAAM,EAAI,EAAzB,KAAA,MAAA;;CAExC,MAAyB,KAAK,GAAiB;AAO9C,SANA,EAAK,WAAW;GAAC,OAAO;GAAK,QAAQ;GAAI,EACzC,OAAO,SAAS,EAAK,OAAO,OAC5B,OAAO,SAAS,EAAK,OAAO,QAC5B,OAAO,WAAW,EAAK,MAAM,UAC7B,MAAM,OAAO,MAAM,EAEZ,MAAM,KAAK,EAAK;;CAGxB,WAAoB,GAAY,IAA8B,oBAAoB,SAAiB;AAQlG,SAPI,EAAG,WAAA,cAAuB,GACtB,KAAK,IAAI,iBAAiB,EAAG,MAAM,GAAG,GAE1C,EAAG,WAAA,aAA6B,GAC5B,KAAK,IAAI,gBAAgB,aAAY,EAAG,MAAM,GAAG,GAGlD,MAAM,WAAW,GAAI,EAAO"}