{"version":3,"file":"Reading.js","sources":["../node_modules/@tweenjs/tween.js/dist/tween.esm.js","../src/sn/CmnTween.ts","../src/sn/SpritesMng.ts","../src/sn/Hyphenation.ts","../src/sn/CallStack.ts","../src/sn/RubySpliter.ts","../node_modules/@pixi/sound/dist/pixi-sound.esm.mjs","../src/sn/SndBuf.ts","../src/sn/ScriptIterator.ts","../src/sn/TxtStage.ts","../src/sn/Button.ts","../src/sn/Pages.ts","../src/sn/DesignCast.ts","../src/sn/GrpLayer.ts","../src/sn/FrameMng.ts","../src/sn/LayerMng.ts","../src/sn/TxtLayer.ts","../src/sn/FocusMng.ts","../node_modules/@popperjs/core/lib/enums.js","../node_modules/@popperjs/core/lib/dom-utils/getNodeName.js","../node_modules/@popperjs/core/lib/dom-utils/getWindow.js","../node_modules/@popperjs/core/lib/dom-utils/instanceOf.js","../node_modules/@popperjs/core/lib/modifiers/applyStyles.js","../node_modules/@popperjs/core/lib/utils/getBasePlacement.js","../node_modules/@popperjs/core/lib/utils/math.js","../node_modules/@popperjs/core/lib/utils/userAgent.js","../node_modules/@popperjs/core/lib/dom-utils/isLayoutViewport.js","../node_modules/@popperjs/core/lib/dom-utils/getBoundingClientRect.js","../node_modules/@popperjs/core/lib/dom-utils/getLayoutRect.js","../node_modules/@popperjs/core/lib/dom-utils/contains.js","../node_modules/@popperjs/core/lib/dom-utils/getComputedStyle.js","../node_modules/@popperjs/core/lib/dom-utils/isTableElement.js","../node_modules/@popperjs/core/lib/dom-utils/getDocumentElement.js","../node_modules/@popperjs/core/lib/dom-utils/getParentNode.js","../node_modules/@popperjs/core/lib/dom-utils/getOffsetParent.js","../node_modules/@popperjs/core/lib/utils/getMainAxisFromPlacement.js","../node_modules/@popperjs/core/lib/utils/within.js","../node_modules/@popperjs/core/lib/utils/getFreshSideObject.js","../node_modules/@popperjs/core/lib/utils/mergePaddingObject.js","../node_modules/@popperjs/core/lib/utils/expandToHashMap.js","../node_modules/@popperjs/core/lib/modifiers/arrow.js","../node_modules/@popperjs/core/lib/utils/getVariation.js","../node_modules/@popperjs/core/lib/modifiers/computeStyles.js","../node_modules/@popperjs/core/lib/modifiers/eventListeners.js","../node_modules/@popperjs/core/lib/utils/getOppositePlacement.js","../node_modules/@popperjs/core/lib/utils/getOppositeVariationPlacement.js","../node_modules/@popperjs/core/lib/dom-utils/getWindowScroll.js","../node_modules/@popperjs/core/lib/dom-utils/getWindowScrollBarX.js","../node_modules/@popperjs/core/lib/dom-utils/getViewportRect.js","../node_modules/@popperjs/core/lib/dom-utils/getDocumentRect.js","../node_modules/@popperjs/core/lib/dom-utils/isScrollParent.js","../node_modules/@popperjs/core/lib/dom-utils/getScrollParent.js","../node_modules/@popperjs/core/lib/dom-utils/listScrollParents.js","../node_modules/@popperjs/core/lib/utils/rectToClientRect.js","../node_modules/@popperjs/core/lib/dom-utils/getClippingRect.js","../node_modules/@popperjs/core/lib/utils/computeOffsets.js","../node_modules/@popperjs/core/lib/utils/detectOverflow.js","../node_modules/@popperjs/core/lib/utils/computeAutoPlacement.js","../node_modules/@popperjs/core/lib/modifiers/flip.js","../node_modules/@popperjs/core/lib/modifiers/hide.js","../node_modules/@popperjs/core/lib/modifiers/offset.js","../node_modules/@popperjs/core/lib/modifiers/popperOffsets.js","../node_modules/@popperjs/core/lib/utils/getAltAxis.js","../node_modules/@popperjs/core/lib/modifiers/preventOverflow.js","../node_modules/@popperjs/core/lib/dom-utils/getHTMLElementScroll.js","../node_modules/@popperjs/core/lib/dom-utils/getNodeScroll.js","../node_modules/@popperjs/core/lib/dom-utils/getCompositeRect.js","../node_modules/@popperjs/core/lib/utils/orderModifiers.js","../node_modules/@popperjs/core/lib/utils/debounce.js","../node_modules/@popperjs/core/lib/utils/mergeByName.js","../node_modules/@popperjs/core/lib/createPopper.js","../node_modules/@popperjs/core/lib/popper.js","../src/sn/EventMng.ts","../src/sn/Reading.ts"],"sourcesContent":["/**\n * The Ease class provides a collection of easing functions for use with tween.js.\n */\nvar Easing = Object.freeze({\n    Linear: Object.freeze({\n        None: function (amount) {\n            return amount;\n        },\n        In: function (amount) {\n            return amount;\n        },\n        Out: function (amount) {\n            return amount;\n        },\n        InOut: function (amount) {\n            return amount;\n        },\n    }),\n    Quadratic: Object.freeze({\n        In: function (amount) {\n            return amount * amount;\n        },\n        Out: function (amount) {\n            return amount * (2 - amount);\n        },\n        InOut: function (amount) {\n            if ((amount *= 2) < 1) {\n                return 0.5 * amount * amount;\n            }\n            return -0.5 * (--amount * (amount - 2) - 1);\n        },\n    }),\n    Cubic: Object.freeze({\n        In: function (amount) {\n            return amount * amount * amount;\n        },\n        Out: function (amount) {\n            return --amount * amount * amount + 1;\n        },\n        InOut: function (amount) {\n            if ((amount *= 2) < 1) {\n                return 0.5 * amount * amount * amount;\n            }\n            return 0.5 * ((amount -= 2) * amount * amount + 2);\n        },\n    }),\n    Quartic: Object.freeze({\n        In: function (amount) {\n            return amount * amount * amount * amount;\n        },\n        Out: function (amount) {\n            return 1 - --amount * amount * amount * amount;\n        },\n        InOut: function (amount) {\n            if ((amount *= 2) < 1) {\n                return 0.5 * amount * amount * amount * amount;\n            }\n            return -0.5 * ((amount -= 2) * amount * amount * amount - 2);\n        },\n    }),\n    Quintic: Object.freeze({\n        In: function (amount) {\n            return amount * amount * amount * amount * amount;\n        },\n        Out: function (amount) {\n            return --amount * amount * amount * amount * amount + 1;\n        },\n        InOut: function (amount) {\n            if ((amount *= 2) < 1) {\n                return 0.5 * amount * amount * amount * amount * amount;\n            }\n            return 0.5 * ((amount -= 2) * amount * amount * amount * amount + 2);\n        },\n    }),\n    Sinusoidal: Object.freeze({\n        In: function (amount) {\n            return 1 - Math.sin(((1.0 - amount) * Math.PI) / 2);\n        },\n        Out: function (amount) {\n            return Math.sin((amount * Math.PI) / 2);\n        },\n        InOut: function (amount) {\n            return 0.5 * (1 - Math.sin(Math.PI * (0.5 - amount)));\n        },\n    }),\n    Exponential: Object.freeze({\n        In: function (amount) {\n            return amount === 0 ? 0 : Math.pow(1024, amount - 1);\n        },\n        Out: function (amount) {\n            return amount === 1 ? 1 : 1 - Math.pow(2, -10 * amount);\n        },\n        InOut: function (amount) {\n            if (amount === 0) {\n                return 0;\n            }\n            if (amount === 1) {\n                return 1;\n            }\n            if ((amount *= 2) < 1) {\n                return 0.5 * Math.pow(1024, amount - 1);\n            }\n            return 0.5 * (-Math.pow(2, -10 * (amount - 1)) + 2);\n        },\n    }),\n    Circular: Object.freeze({\n        In: function (amount) {\n            return 1 - Math.sqrt(1 - amount * amount);\n        },\n        Out: function (amount) {\n            return Math.sqrt(1 - --amount * amount);\n        },\n        InOut: function (amount) {\n            if ((amount *= 2) < 1) {\n                return -0.5 * (Math.sqrt(1 - amount * amount) - 1);\n            }\n            return 0.5 * (Math.sqrt(1 - (amount -= 2) * amount) + 1);\n        },\n    }),\n    Elastic: Object.freeze({\n        In: function (amount) {\n            if (amount === 0) {\n                return 0;\n            }\n            if (amount === 1) {\n                return 1;\n            }\n            return -Math.pow(2, 10 * (amount - 1)) * Math.sin((amount - 1.1) * 5 * Math.PI);\n        },\n        Out: function (amount) {\n            if (amount === 0) {\n                return 0;\n            }\n            if (amount === 1) {\n                return 1;\n            }\n            return Math.pow(2, -10 * amount) * Math.sin((amount - 0.1) * 5 * Math.PI) + 1;\n        },\n        InOut: function (amount) {\n            if (amount === 0) {\n                return 0;\n            }\n            if (amount === 1) {\n                return 1;\n            }\n            amount *= 2;\n            if (amount < 1) {\n                return -0.5 * Math.pow(2, 10 * (amount - 1)) * Math.sin((amount - 1.1) * 5 * Math.PI);\n            }\n            return 0.5 * Math.pow(2, -10 * (amount - 1)) * Math.sin((amount - 1.1) * 5 * Math.PI) + 1;\n        },\n    }),\n    Back: Object.freeze({\n        In: function (amount) {\n            var s = 1.70158;\n            return amount === 1 ? 1 : amount * amount * ((s + 1) * amount - s);\n        },\n        Out: function (amount) {\n            var s = 1.70158;\n            return amount === 0 ? 0 : --amount * amount * ((s + 1) * amount + s) + 1;\n        },\n        InOut: function (amount) {\n            var s = 1.70158 * 1.525;\n            if ((amount *= 2) < 1) {\n                return 0.5 * (amount * amount * ((s + 1) * amount - s));\n            }\n            return 0.5 * ((amount -= 2) * amount * ((s + 1) * amount + s) + 2);\n        },\n    }),\n    Bounce: Object.freeze({\n        In: function (amount) {\n            return 1 - Easing.Bounce.Out(1 - amount);\n        },\n        Out: function (amount) {\n            if (amount < 1 / 2.75) {\n                return 7.5625 * amount * amount;\n            }\n            else if (amount < 2 / 2.75) {\n                return 7.5625 * (amount -= 1.5 / 2.75) * amount + 0.75;\n            }\n            else if (amount < 2.5 / 2.75) {\n                return 7.5625 * (amount -= 2.25 / 2.75) * amount + 0.9375;\n            }\n            else {\n                return 7.5625 * (amount -= 2.625 / 2.75) * amount + 0.984375;\n            }\n        },\n        InOut: function (amount) {\n            if (amount < 0.5) {\n                return Easing.Bounce.In(amount * 2) * 0.5;\n            }\n            return Easing.Bounce.Out(amount * 2 - 1) * 0.5 + 0.5;\n        },\n    }),\n    generatePow: function (power) {\n        if (power === void 0) { power = 4; }\n        power = power < Number.EPSILON ? Number.EPSILON : power;\n        power = power > 10000 ? 10000 : power;\n        return {\n            In: function (amount) {\n                return Math.pow(amount, power);\n            },\n            Out: function (amount) {\n                return 1 - Math.pow((1 - amount), power);\n            },\n            InOut: function (amount) {\n                if (amount < 0.5) {\n                    return Math.pow((amount * 2), power) / 2;\n                }\n                return (1 - Math.pow((2 - amount * 2), power)) / 2 + 0.5;\n            },\n        };\n    },\n});\n\nvar now = function () { return performance.now(); };\n\n/**\n * Controlling groups of tweens\n *\n * Using the TWEEN singleton to manage your tweens can cause issues in large apps with many components.\n * In these cases, you may want to create your own smaller groups of tween\n */\nvar Group = /** @class */ (function () {\n    function Group() {\n        this._tweens = {};\n        this._tweensAddedDuringUpdate = {};\n    }\n    Group.prototype.getAll = function () {\n        var _this = this;\n        return Object.keys(this._tweens).map(function (tweenId) {\n            return _this._tweens[tweenId];\n        });\n    };\n    Group.prototype.removeAll = function () {\n        this._tweens = {};\n    };\n    Group.prototype.add = function (tween) {\n        this._tweens[tween.getId()] = tween;\n        this._tweensAddedDuringUpdate[tween.getId()] = tween;\n    };\n    Group.prototype.remove = function (tween) {\n        delete this._tweens[tween.getId()];\n        delete this._tweensAddedDuringUpdate[tween.getId()];\n    };\n    Group.prototype.update = function (time, preserve) {\n        if (time === void 0) { time = now(); }\n        if (preserve === void 0) { preserve = false; }\n        var tweenIds = Object.keys(this._tweens);\n        if (tweenIds.length === 0) {\n            return false;\n        }\n        // Tweens are updated in \"batches\". If you add a new tween during an\n        // update, then the new tween will be updated in the next batch.\n        // If you remove a tween during an update, it may or may not be updated.\n        // However, if the removed tween was added during the current batch,\n        // then it will not be updated.\n        while (tweenIds.length > 0) {\n            this._tweensAddedDuringUpdate = {};\n            for (var i = 0; i < tweenIds.length; i++) {\n                var tween = this._tweens[tweenIds[i]];\n                var autoStart = !preserve;\n                if (tween && tween.update(time, autoStart) === false && !preserve) {\n                    delete this._tweens[tweenIds[i]];\n                }\n            }\n            tweenIds = Object.keys(this._tweensAddedDuringUpdate);\n        }\n        return true;\n    };\n    return Group;\n}());\n\n/**\n *\n */\nvar Interpolation = {\n    Linear: function (v, k) {\n        var m = v.length - 1;\n        var f = m * k;\n        var i = Math.floor(f);\n        var fn = Interpolation.Utils.Linear;\n        if (k < 0) {\n            return fn(v[0], v[1], f);\n        }\n        if (k > 1) {\n            return fn(v[m], v[m - 1], m - f);\n        }\n        return fn(v[i], v[i + 1 > m ? m : i + 1], f - i);\n    },\n    Bezier: function (v, k) {\n        var b = 0;\n        var n = v.length - 1;\n        var pw = Math.pow;\n        var bn = Interpolation.Utils.Bernstein;\n        for (var i = 0; i <= n; i++) {\n            b += pw(1 - k, n - i) * pw(k, i) * v[i] * bn(n, i);\n        }\n        return b;\n    },\n    CatmullRom: function (v, k) {\n        var m = v.length - 1;\n        var f = m * k;\n        var i = Math.floor(f);\n        var fn = Interpolation.Utils.CatmullRom;\n        if (v[0] === v[m]) {\n            if (k < 0) {\n                i = Math.floor((f = m * (1 + k)));\n            }\n            return fn(v[(i - 1 + m) % m], v[i], v[(i + 1) % m], v[(i + 2) % m], f - i);\n        }\n        else {\n            if (k < 0) {\n                return v[0] - (fn(v[0], v[0], v[1], v[1], -f) - v[0]);\n            }\n            if (k > 1) {\n                return v[m] - (fn(v[m], v[m], v[m - 1], v[m - 1], f - m) - v[m]);\n            }\n            return fn(v[i ? i - 1 : 0], v[i], v[m < i + 1 ? m : i + 1], v[m < i + 2 ? m : i + 2], f - i);\n        }\n    },\n    Utils: {\n        Linear: function (p0, p1, t) {\n            return (p1 - p0) * t + p0;\n        },\n        Bernstein: function (n, i) {\n            var fc = Interpolation.Utils.Factorial;\n            return fc(n) / fc(i) / fc(n - i);\n        },\n        Factorial: (function () {\n            var a = [1];\n            return function (n) {\n                var s = 1;\n                if (a[n]) {\n                    return a[n];\n                }\n                for (var i = n; i > 1; i--) {\n                    s *= i;\n                }\n                a[n] = s;\n                return s;\n            };\n        })(),\n        CatmullRom: function (p0, p1, p2, p3, t) {\n            var v0 = (p2 - p0) * 0.5;\n            var v1 = (p3 - p1) * 0.5;\n            var t2 = t * t;\n            var t3 = t * t2;\n            return (2 * p1 - 2 * p2 + v0 + v1) * t3 + (-3 * p1 + 3 * p2 - 2 * v0 - v1) * t2 + v0 * t + p1;\n        },\n    },\n};\n\n/**\n * Utils\n */\nvar Sequence = /** @class */ (function () {\n    function Sequence() {\n    }\n    Sequence.nextId = function () {\n        return Sequence._nextId++;\n    };\n    Sequence._nextId = 0;\n    return Sequence;\n}());\n\nvar mainGroup = new Group();\n\n/**\n * Tween.js - Licensed under the MIT license\n * https://github.com/tweenjs/tween.js\n * ----------------------------------------------\n *\n * See https://github.com/tweenjs/tween.js/graphs/contributors for the full list of contributors.\n * Thank you all, you're awesome!\n */\nvar Tween = /** @class */ (function () {\n    function Tween(_object, _group) {\n        if (_group === void 0) { _group = mainGroup; }\n        this._object = _object;\n        this._group = _group;\n        this._isPaused = false;\n        this._pauseStart = 0;\n        this._valuesStart = {};\n        this._valuesEnd = {};\n        this._valuesStartRepeat = {};\n        this._duration = 1000;\n        this._isDynamic = false;\n        this._initialRepeat = 0;\n        this._repeat = 0;\n        this._yoyo = false;\n        this._isPlaying = false;\n        this._reversed = false;\n        this._delayTime = 0;\n        this._startTime = 0;\n        this._easingFunction = Easing.Linear.None;\n        this._interpolationFunction = Interpolation.Linear;\n        // eslint-disable-next-line\n        this._chainedTweens = [];\n        this._onStartCallbackFired = false;\n        this._onEveryStartCallbackFired = false;\n        this._id = Sequence.nextId();\n        this._isChainStopped = false;\n        this._propertiesAreSetUp = false;\n        this._goToEnd = false;\n    }\n    Tween.prototype.getId = function () {\n        return this._id;\n    };\n    Tween.prototype.isPlaying = function () {\n        return this._isPlaying;\n    };\n    Tween.prototype.isPaused = function () {\n        return this._isPaused;\n    };\n    Tween.prototype.getDuration = function () {\n        return this._duration;\n    };\n    Tween.prototype.to = function (target, duration) {\n        if (duration === void 0) { duration = 1000; }\n        if (this._isPlaying)\n            throw new Error('Can not call Tween.to() while Tween is already started or paused. Stop the Tween first.');\n        this._valuesEnd = target;\n        this._propertiesAreSetUp = false;\n        this._duration = duration < 0 ? 0 : duration;\n        return this;\n    };\n    Tween.prototype.duration = function (duration) {\n        if (duration === void 0) { duration = 1000; }\n        this._duration = duration < 0 ? 0 : duration;\n        return this;\n    };\n    Tween.prototype.dynamic = function (dynamic) {\n        if (dynamic === void 0) { dynamic = false; }\n        this._isDynamic = dynamic;\n        return this;\n    };\n    Tween.prototype.start = function (time, overrideStartingValues) {\n        if (time === void 0) { time = now(); }\n        if (overrideStartingValues === void 0) { overrideStartingValues = false; }\n        if (this._isPlaying) {\n            return this;\n        }\n        // eslint-disable-next-line\n        this._group && this._group.add(this);\n        this._repeat = this._initialRepeat;\n        if (this._reversed) {\n            // If we were reversed (f.e. using the yoyo feature) then we need to\n            // flip the tween direction back to forward.\n            this._reversed = false;\n            for (var property in this._valuesStartRepeat) {\n                this._swapEndStartRepeatValues(property);\n                this._valuesStart[property] = this._valuesStartRepeat[property];\n            }\n        }\n        this._isPlaying = true;\n        this._isPaused = false;\n        this._onStartCallbackFired = false;\n        this._onEveryStartCallbackFired = false;\n        this._isChainStopped = false;\n        this._startTime = time;\n        this._startTime += this._delayTime;\n        if (!this._propertiesAreSetUp || overrideStartingValues) {\n            this._propertiesAreSetUp = true;\n            // If dynamic is not enabled, clone the end values instead of using the passed-in end values.\n            if (!this._isDynamic) {\n                var tmp = {};\n                for (var prop in this._valuesEnd)\n                    tmp[prop] = this._valuesEnd[prop];\n                this._valuesEnd = tmp;\n            }\n            this._setupProperties(this._object, this._valuesStart, this._valuesEnd, this._valuesStartRepeat, overrideStartingValues);\n        }\n        return this;\n    };\n    Tween.prototype.startFromCurrentValues = function (time) {\n        return this.start(time, true);\n    };\n    Tween.prototype._setupProperties = function (_object, _valuesStart, _valuesEnd, _valuesStartRepeat, overrideStartingValues) {\n        for (var property in _valuesEnd) {\n            var startValue = _object[property];\n            var startValueIsArray = Array.isArray(startValue);\n            var propType = startValueIsArray ? 'array' : typeof startValue;\n            var isInterpolationList = !startValueIsArray && Array.isArray(_valuesEnd[property]);\n            // If `to()` specifies a property that doesn't exist in the source object,\n            // we should not set that property in the object\n            if (propType === 'undefined' || propType === 'function') {\n                continue;\n            }\n            // Check if an Array was provided as property value\n            if (isInterpolationList) {\n                var endValues = _valuesEnd[property];\n                if (endValues.length === 0) {\n                    continue;\n                }\n                // Handle an array of relative values.\n                // Creates a local copy of the Array with the start value at the front\n                var temp = [startValue];\n                for (var i = 0, l = endValues.length; i < l; i += 1) {\n                    var value = this._handleRelativeValue(startValue, endValues[i]);\n                    if (isNaN(value)) {\n                        isInterpolationList = false;\n                        console.warn('Found invalid interpolation list. Skipping.');\n                        break;\n                    }\n                    temp.push(value);\n                }\n                if (isInterpolationList) {\n                    // if (_valuesStart[property] === undefined) { // handle end values only the first time. NOT NEEDED? setupProperties is now guarded by _propertiesAreSetUp.\n                    _valuesEnd[property] = temp;\n                    // }\n                }\n            }\n            // handle the deepness of the values\n            if ((propType === 'object' || startValueIsArray) && startValue && !isInterpolationList) {\n                _valuesStart[property] = startValueIsArray ? [] : {};\n                var nestedObject = startValue;\n                for (var prop in nestedObject) {\n                    _valuesStart[property][prop] = nestedObject[prop];\n                }\n                // TODO? repeat nested values? And yoyo? And array values?\n                _valuesStartRepeat[property] = startValueIsArray ? [] : {};\n                var endValues = _valuesEnd[property];\n                // If dynamic is not enabled, clone the end values instead of using the passed-in end values.\n                if (!this._isDynamic) {\n                    var tmp = {};\n                    for (var prop in endValues)\n                        tmp[prop] = endValues[prop];\n                    _valuesEnd[property] = endValues = tmp;\n                }\n                this._setupProperties(nestedObject, _valuesStart[property], endValues, _valuesStartRepeat[property], overrideStartingValues);\n            }\n            else {\n                // Save the starting value, but only once unless override is requested.\n                if (typeof _valuesStart[property] === 'undefined' || overrideStartingValues) {\n                    _valuesStart[property] = startValue;\n                }\n                if (!startValueIsArray) {\n                    // eslint-disable-next-line\n                    // @ts-ignore FIXME?\n                    _valuesStart[property] *= 1.0; // Ensures we're using numbers, not strings\n                }\n                if (isInterpolationList) {\n                    // eslint-disable-next-line\n                    // @ts-ignore FIXME?\n                    _valuesStartRepeat[property] = _valuesEnd[property].slice().reverse();\n                }\n                else {\n                    _valuesStartRepeat[property] = _valuesStart[property] || 0;\n                }\n            }\n        }\n    };\n    Tween.prototype.stop = function () {\n        if (!this._isChainStopped) {\n            this._isChainStopped = true;\n            this.stopChainedTweens();\n        }\n        if (!this._isPlaying) {\n            return this;\n        }\n        // eslint-disable-next-line\n        this._group && this._group.remove(this);\n        this._isPlaying = false;\n        this._isPaused = false;\n        if (this._onStopCallback) {\n            this._onStopCallback(this._object);\n        }\n        return this;\n    };\n    Tween.prototype.end = function () {\n        this._goToEnd = true;\n        this.update(Infinity);\n        return this;\n    };\n    Tween.prototype.pause = function (time) {\n        if (time === void 0) { time = now(); }\n        if (this._isPaused || !this._isPlaying) {\n            return this;\n        }\n        this._isPaused = true;\n        this._pauseStart = time;\n        // eslint-disable-next-line\n        this._group && this._group.remove(this);\n        return this;\n    };\n    Tween.prototype.resume = function (time) {\n        if (time === void 0) { time = now(); }\n        if (!this._isPaused || !this._isPlaying) {\n            return this;\n        }\n        this._isPaused = false;\n        this._startTime += time - this._pauseStart;\n        this._pauseStart = 0;\n        // eslint-disable-next-line\n        this._group && this._group.add(this);\n        return this;\n    };\n    Tween.prototype.stopChainedTweens = function () {\n        for (var i = 0, numChainedTweens = this._chainedTweens.length; i < numChainedTweens; i++) {\n            this._chainedTweens[i].stop();\n        }\n        return this;\n    };\n    Tween.prototype.group = function (group) {\n        if (group === void 0) { group = mainGroup; }\n        this._group = group;\n        return this;\n    };\n    Tween.prototype.delay = function (amount) {\n        if (amount === void 0) { amount = 0; }\n        this._delayTime = amount;\n        return this;\n    };\n    Tween.prototype.repeat = function (times) {\n        if (times === void 0) { times = 0; }\n        this._initialRepeat = times;\n        this._repeat = times;\n        return this;\n    };\n    Tween.prototype.repeatDelay = function (amount) {\n        this._repeatDelayTime = amount;\n        return this;\n    };\n    Tween.prototype.yoyo = function (yoyo) {\n        if (yoyo === void 0) { yoyo = false; }\n        this._yoyo = yoyo;\n        return this;\n    };\n    Tween.prototype.easing = function (easingFunction) {\n        if (easingFunction === void 0) { easingFunction = Easing.Linear.None; }\n        this._easingFunction = easingFunction;\n        return this;\n    };\n    Tween.prototype.interpolation = function (interpolationFunction) {\n        if (interpolationFunction === void 0) { interpolationFunction = Interpolation.Linear; }\n        this._interpolationFunction = interpolationFunction;\n        return this;\n    };\n    // eslint-disable-next-line\n    Tween.prototype.chain = function () {\n        var tweens = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            tweens[_i] = arguments[_i];\n        }\n        this._chainedTweens = tweens;\n        return this;\n    };\n    Tween.prototype.onStart = function (callback) {\n        this._onStartCallback = callback;\n        return this;\n    };\n    Tween.prototype.onEveryStart = function (callback) {\n        this._onEveryStartCallback = callback;\n        return this;\n    };\n    Tween.prototype.onUpdate = function (callback) {\n        this._onUpdateCallback = callback;\n        return this;\n    };\n    Tween.prototype.onRepeat = function (callback) {\n        this._onRepeatCallback = callback;\n        return this;\n    };\n    Tween.prototype.onComplete = function (callback) {\n        this._onCompleteCallback = callback;\n        return this;\n    };\n    Tween.prototype.onStop = function (callback) {\n        this._onStopCallback = callback;\n        return this;\n    };\n    /**\n     * @returns true if the tween is still playing after the update, false\n     * otherwise (calling update on a paused tween still returns true because\n     * it is still playing, just paused).\n     */\n    Tween.prototype.update = function (time, autoStart) {\n        var _this = this;\n        var _a;\n        if (time === void 0) { time = now(); }\n        if (autoStart === void 0) { autoStart = true; }\n        if (this._isPaused)\n            return true;\n        var property;\n        var endTime = this._startTime + this._duration;\n        if (!this._goToEnd && !this._isPlaying) {\n            if (time > endTime)\n                return false;\n            if (autoStart)\n                this.start(time, true);\n        }\n        this._goToEnd = false;\n        if (time < this._startTime) {\n            return true;\n        }\n        if (this._onStartCallbackFired === false) {\n            if (this._onStartCallback) {\n                this._onStartCallback(this._object);\n            }\n            this._onStartCallbackFired = true;\n        }\n        if (this._onEveryStartCallbackFired === false) {\n            if (this._onEveryStartCallback) {\n                this._onEveryStartCallback(this._object);\n            }\n            this._onEveryStartCallbackFired = true;\n        }\n        var elapsedTime = time - this._startTime;\n        var durationAndDelay = this._duration + ((_a = this._repeatDelayTime) !== null && _a !== void 0 ? _a : this._delayTime);\n        var totalTime = this._duration + this._repeat * durationAndDelay;\n        var calculateElapsedPortion = function () {\n            if (_this._duration === 0)\n                return 1;\n            if (elapsedTime > totalTime) {\n                return 1;\n            }\n            var timesRepeated = Math.trunc(elapsedTime / durationAndDelay);\n            var timeIntoCurrentRepeat = elapsedTime - timesRepeated * durationAndDelay;\n            // TODO use %?\n            // const timeIntoCurrentRepeat = elapsedTime % durationAndDelay\n            var portion = Math.min(timeIntoCurrentRepeat / _this._duration, 1);\n            if (portion === 0 && elapsedTime === _this._duration) {\n                return 1;\n            }\n            return portion;\n        };\n        var elapsed = calculateElapsedPortion();\n        var value = this._easingFunction(elapsed);\n        // properties transformations\n        this._updateProperties(this._object, this._valuesStart, this._valuesEnd, value);\n        if (this._onUpdateCallback) {\n            this._onUpdateCallback(this._object, elapsed);\n        }\n        if (this._duration === 0 || elapsedTime >= this._duration) {\n            if (this._repeat > 0) {\n                var completeCount = Math.min(Math.trunc((elapsedTime - this._duration) / durationAndDelay) + 1, this._repeat);\n                if (isFinite(this._repeat)) {\n                    this._repeat -= completeCount;\n                }\n                // Reassign starting values, restart by making startTime = now\n                for (property in this._valuesStartRepeat) {\n                    if (!this._yoyo && typeof this._valuesEnd[property] === 'string') {\n                        this._valuesStartRepeat[property] =\n                            // eslint-disable-next-line\n                            // @ts-ignore FIXME?\n                            this._valuesStartRepeat[property] + parseFloat(this._valuesEnd[property]);\n                    }\n                    if (this._yoyo) {\n                        this._swapEndStartRepeatValues(property);\n                    }\n                    this._valuesStart[property] = this._valuesStartRepeat[property];\n                }\n                if (this._yoyo) {\n                    this._reversed = !this._reversed;\n                }\n                this._startTime += durationAndDelay * completeCount;\n                if (this._onRepeatCallback) {\n                    this._onRepeatCallback(this._object);\n                }\n                this._onEveryStartCallbackFired = false;\n                return true;\n            }\n            else {\n                if (this._onCompleteCallback) {\n                    this._onCompleteCallback(this._object);\n                }\n                for (var i = 0, numChainedTweens = this._chainedTweens.length; i < numChainedTweens; i++) {\n                    // Make the chained tweens start exactly at the time they should,\n                    // even if the `update()` method was called way past the duration of the tween\n                    this._chainedTweens[i].start(this._startTime + this._duration, false);\n                }\n                this._isPlaying = false;\n                return false;\n            }\n        }\n        return true;\n    };\n    Tween.prototype._updateProperties = function (_object, _valuesStart, _valuesEnd, value) {\n        for (var property in _valuesEnd) {\n            // Don't update properties that do not exist in the source object\n            if (_valuesStart[property] === undefined) {\n                continue;\n            }\n            var start = _valuesStart[property] || 0;\n            var end = _valuesEnd[property];\n            var startIsArray = Array.isArray(_object[property]);\n            var endIsArray = Array.isArray(end);\n            var isInterpolationList = !startIsArray && endIsArray;\n            if (isInterpolationList) {\n                _object[property] = this._interpolationFunction(end, value);\n            }\n            else if (typeof end === 'object' && end) {\n                // eslint-disable-next-line\n                // @ts-ignore FIXME?\n                this._updateProperties(_object[property], start, end, value);\n            }\n            else {\n                // Parses relative end values with start as base (e.g.: +10, -3)\n                end = this._handleRelativeValue(start, end);\n                // Protect against non numeric properties.\n                if (typeof end === 'number') {\n                    // eslint-disable-next-line\n                    // @ts-ignore FIXME?\n                    _object[property] = start + (end - start) * value;\n                }\n            }\n        }\n    };\n    Tween.prototype._handleRelativeValue = function (start, end) {\n        if (typeof end !== 'string') {\n            return end;\n        }\n        if (end.charAt(0) === '+' || end.charAt(0) === '-') {\n            return start + parseFloat(end);\n        }\n        return parseFloat(end);\n    };\n    Tween.prototype._swapEndStartRepeatValues = function (property) {\n        var tmp = this._valuesStartRepeat[property];\n        var endValue = this._valuesEnd[property];\n        if (typeof endValue === 'string') {\n            this._valuesStartRepeat[property] = this._valuesStartRepeat[property] + parseFloat(endValue);\n        }\n        else {\n            this._valuesStartRepeat[property] = this._valuesEnd[property];\n        }\n        this._valuesEnd[property] = tmp;\n    };\n    return Tween;\n}());\n\nvar VERSION = '23.1.3';\n\n/**\n * Tween.js - Licensed under the MIT license\n * https://github.com/tweenjs/tween.js\n * ----------------------------------------------\n *\n * See https://github.com/tweenjs/tween.js/graphs/contributors for the full list of contributors.\n * Thank you all, you're awesome!\n */\nvar nextId = Sequence.nextId;\n/**\n * Controlling groups of tweens\n *\n * Using the TWEEN singleton to manage your tweens can cause issues in large apps with many components.\n * In these cases, you may want to create your own smaller groups of tweens.\n */\nvar TWEEN = mainGroup;\n// This is the best way to export things in a way that's compatible with both ES\n// Modules and CommonJS, without build hacks, and so as not to break the\n// existing API.\n// https://github.com/rollup/rollup/issues/1961#issuecomment-423037881\nvar getAll = TWEEN.getAll.bind(TWEEN);\nvar removeAll = TWEEN.removeAll.bind(TWEEN);\nvar add = TWEEN.add.bind(TWEEN);\nvar remove = TWEEN.remove.bind(TWEEN);\nvar update = TWEEN.update.bind(TWEEN);\nvar exports = {\n    Easing: Easing,\n    Group: Group,\n    Interpolation: Interpolation,\n    now: now,\n    Sequence: Sequence,\n    nextId: nextId,\n    Tween: Tween,\n    VERSION: VERSION,\n    getAll: getAll,\n    removeAll: removeAll,\n    add: add,\n    remove: remove,\n    update: update,\n};\n\nexport { Easing, Group, Interpolation, Sequence, Tween, VERSION, add, exports as default, getAll, nextId, now, remove, removeAll, update };\n","/* ***** BEGIN LICENSE BLOCK *****\n\tCopyright (c) 2019-2025 Famibee (famibee.blog38.fc2.com)\n\n\tThis software is released under the MIT License.\n\thttp://opensource.org/licenses/mit-license.php\n** ***** END LICENSE BLOCK ***** */\n\nimport {type IEvtMng, CmnLib, argChk_Boolean, argChk_Num} from './CmnLib';\nimport type {HArg} from './Grammar';\nimport {Reading} from './Reading';\n\nimport {Tween, Easing, removeAll, update} from '@tweenjs/tween.js'\nimport {Application} from 'pixi.js';\n\n\ninterface ITwInf {\n\ttw\t\t: Tween<any> | undefined;\n\tonEnd?\t: ()=> void;\n}\n\nexport const TW_INT_TRANS = 'trans\\n';\t// 改行でスクリプトから絶対指定できない値に\nexport const TMP_TSY_NM\t= 'tsy nm:';\n\n\nexport class CmnTween {\n\tstatic\t#hTwInf\t: {[tw_nm: string]: ITwInf}\t= {};\n\n\tstatic\t#evtMng\t: IEvtMng;\n\tstatic\t#appPixi: Application;\n\tstatic\tinit(evtMng: IEvtMng, appPixi: Application) {\n\t\tthis.#hTwInf = {};\n\t\tthis.#evtMng = evtMng;\n\t\tthis.#appPixi = appPixi;\n\n\t\tthis.#appPixi.ticker.add(this.#fncTicker);\t// TWEEN 更新\n\t}\n\tstatic\t#fncTicker = ()=> update();\n\tstatic\tdestroy() {\n\t\tthis.stopAllTw();\n\t\tthis.#appPixi.ticker.remove(this.#fncTicker);\n\t}\n\n\tstatic\tsetTwProp(tw: Tween<any>, hArg: HArg): Tween<any> {\n\t\tconst repeat = argChk_Num(hArg, 'repeat', 1);\n\t\treturn tw.delay(argChk_Num(hArg, 'delay', 0))\n\t\t.easing(this.ease(hArg.ease))\n\t\t.repeat(repeat > 0 ?repeat -1 :Infinity)\t// 一度リピート→計二回なので\n\t\t.yoyo(argChk_Boolean(hArg, 'yoyo', false));\n\t}\n\tstatic\treadonly #hEase: {[name: string]: (k: number)=> number}\t= {\n\t\t'Back.In'\t\t\t: k=> Easing.Back.In(k),\n\t\t'Back.InOut'\t\t: k=> Easing.Back.InOut(k),\n\t\t'Back.Out'\t\t\t: k=> Easing.Back.Out(k),\n\t\t'Bounce.In'\t\t\t: k=> Easing.Bounce.In(k),\n\t\t'Bounce.InOut'\t\t: k=> Easing.Bounce.InOut(k),\n\t\t'Bounce.Out'\t\t: k=> Easing.Bounce.Out(k),\n\t\t'Circular.In'\t\t: k=> Easing.Circular.In(k),\n\t\t'Circular.InOut'\t: k=> Easing.Circular.InOut(k),\n\t\t'Circular.Out'\t\t: k=> Easing.Circular.Out(k),\n\t\t'Cubic.In'\t\t\t: k=> Easing.Cubic.In(k),\n\t\t'Cubic.InOut'\t\t: k=> Easing.Cubic.InOut(k),\n\t\t'Cubic.Out'\t\t\t: k=> Easing.Cubic.Out(k),\n\t\t'Elastic.In'\t\t: k=> Easing.Elastic.In(k),\n\t\t'Elastic.InOut'\t\t: k=> Easing.Elastic.InOut(k),\n\t\t'Elastic.Out'\t\t: k=> Easing.Elastic.Out(k),\n\t\t'Exponential.In'\t: k=> Easing.Exponential.In(k),\n\t\t'Exponential.InOut'\t: k=> Easing.Exponential.InOut(k),\n\t\t'Exponential.Out'\t: k=> Easing.Exponential.Out(k),\n\t\t'Linear.None'\t\t: k=> Easing.Linear.None(k),\n\t\t'Quadratic.In'\t\t: k=> Easing.Quadratic.In(k),\n\t\t'Quadratic.InOut'\t: k=> Easing.Quadratic.InOut(k),\n\t\t'Quadratic.Out'\t\t: k=> Easing.Quadratic.Out(k),\n\t\t'Quartic.In'\t\t: k=> Easing.Quartic.In(k),\n\t\t'Quartic.InOut'\t\t: k=> Easing.Quartic.InOut(k),\n\t\t'Quartic.Out'\t\t: k=> Easing.Quartic.Out(k),\n\t\t'Quintic.In'\t\t: k=> Easing.Quintic.In(k),\n\t\t'Quintic.InOut'\t\t: k=> Easing.Quintic.InOut(k),\n\t\t'Quintic.Out'\t\t: k=> Easing.Quintic.Out(k),\n\t\t'Sinusoidal.In'\t\t: k=> Easing.Sinusoidal.In(k),\n\t\t'Sinusoidal.InOut'\t: k=> Easing.Sinusoidal.InOut(k),\n\t\t'Sinusoidal.Out'\t: k=> Easing.Sinusoidal.Out(k),\n\t};\n\tstatic\tease(nm: string | undefined): (k: number)=> number {\n\t\tif (! nm) return k=> Easing.Linear.None(k);\n\n\t\tconst es = this.#hEase[nm];\n\t\tif (! es) throw '異常なease指定です';\n\t\treturn es;\n\t}\n\n\tstatic readonly hMemberCnt\t= {\n\t\talpha\t\t: 0,\n\t\theight\t\t: 0,\n\t\trotation\t: 0,\t// rotationX〜Z、scaleZ、zは設定すると\n\t\tscale_x\t\t: 0,\t// 三次元方向の拡大縮小ルーチンが働き画像がぼやけるので\n\t\tscale_y\t\t: 0,\t// backlayで設定しない方針\n\t\tpivot_x\t\t: 0,\n\t\tpivot_y\t\t: 0,\n\t\twidth\t\t: 0,\n\t\tx\t\t\t: 0,\n\t\ty\t\t\t: 0,\n\t};\n\tstatic cnvTweenArg(hArg: HArg, lay: any): {} {\n\t\tconst hTo: any = {};\n\t\tfor (const nm of Object.keys(this.hMemberCnt)) {\n\t\t\tconst arg = (hArg as any)[nm];\n\t\t\tif (! arg) continue;\n\t\n\t\t\t// {x:500}\t\t\tX位置を500に\n\t\t\t// {x:'=500'}\t\t現在のX位置に+500加算した位置\n\t\t\t// {x:'=-500'}\t\t現在のX位置に-500加算した位置\n\t\t\t// {x:'250,500'}\t+250から＋500までの間でランダムな値をX位置に\n\t\t\t// {x:'=250,500'}\t+250から＋500までの間でランダムな値を現在のX位置に加算\n\t\t\tconst v = String(arg);\n\t\t\tconst hdeq = v.startsWith('=');\n\t\t\tconst vx = hdeq ?v.slice(1) :v;\n\t\t\tif (! vx) continue;\n\n\t\t\tconst [v0, v1] = vx.split(',');\n\t\t\tconst a0 = hTo[nm] = parseFloat(v0!);\n\n\t\t\tif (v1) hTo[nm] += Math.round(\n\t\t\t\tMath.random() * (parseFloat(v1) -a0 +1)\n\t\t\t);\n\t\t\tif (hdeq) hTo[nm] += parseFloat(lay[nm]);\t// 相対に\n\t\t}\n\t\treturn hTo;\n\t}\n\n\n\t// トゥイーン全停止\n\tstatic\tstopAllTw() {this.#hTwInf = {}; removeAll()}\n\n\n\tstatic\ttween(tw_nm: string, hArg: HArg, hNow: any, hTo: any, onUpdate: ()=> void, onComplete: ()=> void, onEnd: ()=> void, start = true): Tween<any> {\n\t\tconst time = this.#evtMng.isSkipping ?0 :argChk_Num(hArg, 'time', NaN);\n\t\tconst tw = new Tween(hNow)\n\t\t.to(hTo, time)\n\t\t.onUpdate(onUpdate);\n\t\tthis.setTwProp(tw, hArg);\n\t\tthis.#hTwInf[tw_nm] = {tw, onEnd};\n\n\t\tconst {path} = hArg;\n\t\tlet twLast = tw;\n\t\tif (path) {\n\t\t\tif (CmnLib.debugLog) console.group(`🍝 [${hArg[':タグ名']}] path=${path}= start(${hNow.x},${hNow.y},${hNow.alpha})`);\n\t\t\tfor (const {groups} of path.matchAll(this.#REG_TSY_PATH)) {\n\t\t\t\tconst {x, x2, y, y2, o, o2, json} = groups!;\n\t\t\t\tlet hArg2: any = {};\n\t\t\t\tif (json) try {hArg2 = JSON.parse(json)} catch (e) {\n\t\t\t\t\tconsole.error(`🍝 json=${json} `+ e);\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tif (x ?? x2) hArg2.x = x ?? x2;\n\t\t\t\tif (y ?? y2) hArg2.y = y ?? y2;\n\t\t\t\tif (o ?? o2) hArg2.alpha = o ?? o2;\n\n\t\t\t\tconst hTo2 = this.cnvTweenArg(hArg2, hNow);\n\t\t\t\tif (CmnLib.debugLog) console.info(`🍝 ${\n\t\t\t\t\tjson ?? `{x:${x} y:${y} o:${o}}`\n\t\t\t\t} => hTo:${JSON.stringify(hTo2)}`);\n\n\t\t\t\tconst twNew = new Tween(hNow)\n\t\t\t\t.to(hTo2, time);\n\t\t\t\tthis.setTwProp(twNew, hArg);\n\t\t\t\ttwLast.chain(twNew);\n\n\t\t\t\ttwLast = twNew;\n\t\t\t}\n\t\t\tif (CmnLib.debugLog) console.groupEnd();\n\t\t}\n\t\ttwLast.onComplete(()=> {\n\t\t\tconst ti = this.#hTwInf[tw_nm];\n\t\t\tif (! ti) return;\n\t\t\tdelete this.#hTwInf[tw_nm];\n\n\t\t\tti.tw = undefined;\n\t\t\ttw.stop();\n\t\t\tReading.notifyEndProc(TMP_TSY_NM + tw_nm);\n\t\t\tti.onEnd?.();\n\n\t\t\tonComplete();\n\t\t});\n\n\t\tconst {chain} = hArg;\n\t\tif (chain) {\t// 指定レイヤのアニメ終了に、このトゥイーンを続ける\n\t\t\tconst twFrom = this.#hTwInf[chain];\n\t\t\tif (! twFrom?.tw) throw `${chain}は存在しない・または終了したトゥイーンです`;\n\t\t\tdelete twFrom.onEnd;\n\t\t\ttwFrom.tw.chain(tw);\n\t\t}\n\t\telse if (start) tw.start();\n\n\t\treturn tw;\n\t}\n\t// 11 match 301 step (0.1ms) PCRE2 https://regex101.com/r/reinpq/1\n\t\t// List ${x}${x2}/${y}${y2}/${o}${o2}=${json}\\n\n/*\n\\(\\s*\n(?:\t(?<x>[-=\\d\\.]+)\t|\t(['\"])\t(?<x2>.*?)\t\\2\t)?\n(?:\n\t\\s*,\\s*\n\t(?:\t(?<y>[-=\\d\\.]+)\t|\t(['\"])\t(?<y2>.*?)\t\\5\t)?\n\t(?:\n\t\t\\s*,\\s*\n\t\t(?:\t(?<o>[-=\\d\\.]+)\t|\t(['\"])\t(?<o2>.*?)\t\\8\t)\n\n\t)?\n)?\n|\n(?<json>\\{[^{}]*})\n*/\n\tstatic\treadonly\t#REG_TSY_PATH\t= /\\(\\s*(?:(?<x>[-=\\d\\.]+)|(['\"])(?<x2>.*?)\\2)?(?:\\s*,\\s*(?:(?<y>[-=\\d\\.]+)|(['\"])(?<y2>.*?)\\5)?(?:\\s*,\\s*(?:(?<o>[-=\\d\\.]+)|(['\"])(?<o2>.*?)\\8))?)?|(?<json>\\{[^{}]*})/g;\n\n\t// トランス終了待ち\n\tstatic\twt(_hArg: HArg) {\n\t\tconst ti = this.#hTwInf[TW_INT_TRANS];\n\t\tif (! ti?.tw) return false;\n\n\t\tconst fnc = ()=> this.finish_trans();\n\t\tReading.beginProc(TMP_TSY_NM + TW_INT_TRANS, fnc, true, fnc);\n\t\treturn true;\n\t}\n\n\t// レイヤのトランジションの停止\n\tstatic\tfinish_trans(): boolean {this.#hTwInf[TW_INT_TRANS]?.tw?.stop().end(); return false}\t// stop()とend()は別\n\n\n\t// トゥイーン終了待ち\n\tstatic\twait_tsy(hArg: HArg) {\n\t\tconst tw_nm = this.#tw_nm(hArg);\n\t\tconst ti = this.#hTwInf[tw_nm];\n\t\tif (! ti?.tw) {\n\t\t\tconst {layer='', id, name} = hArg;\n\t\t\tif (argChk_Boolean(hArg, 'chk_exist_tw', false)) throw id\n\t\t\t? `フレームトゥイーン ${id} が見つかりません。`\n\t\t\t: `トゥイーン ${tw_nm} が見つかりません。(layer:${layer} name:${name})`;\n\n\t\t\treturn false;\n\t\t}\n\n\t\tconst fnc = ()=> ti.tw?.end();\t// stop()とend()は別\n\t\tReading.beginProc(TMP_TSY_NM + tw_nm, fnc, true, fnc);\n\t\treturn true;\n\t}\n\t\tstatic\t#tw_nm(hArg: HArg) {\n\t\t\tconst {layer='', id, name} = hArg;\n\t\t\tconst tw_nm = id ?`frm\\n${id}` :(name ?? layer);\n\t\t\tif (! tw_nm) throw 'トゥイーンが指定されていません';\n\n\t\t\treturn tw_nm;\n\t\t}\n\n\t// トゥイーン中断\n\tstatic\tstop_tsy(hArg: HArg) {\n\t\tconst tw_nm = this.#tw_nm(hArg);\n\t\tthis.#hTwInf[tw_nm]?.tw?.stop().end();\t// stop()とend()は別\n\t\treturn false;\n\t}\n\n\t// 一時停止\n\tstatic\tpause_tsy(hArg: HArg) {\n\t\tconst tw_nm = this.#tw_nm(hArg);\n\t\tthis.#hTwInf[tw_nm]?.tw?.pause();\n\t\treturn false;\n\t}\n\n\t// 一時停止再開\n\tstatic\tresume_tsy(hArg: HArg) {\n\t\tconst tw_nm = this.#tw_nm(hArg);\n\t\tthis.#hTwInf[tw_nm]?.tw?.resume();\n\t\treturn false;\n\t}\n\n}\n","/* ***** BEGIN LICENSE BLOCK *****\n\tCopyright (c) 2023-2025 Famibee (famibee.blog38.fc2.com)\n\n\tThis software is released under the MIT License.\n\thttp://opensource.org/licenses/mit-license.php\n** ***** END LICENSE BLOCK ***** */\n\nimport {Config} from './Config';\nimport {type IEvtMng, argChk_Boolean, argChk_Num, getFn, int} from './CmnLib';\nimport type {IMain, IVariable, SYS_DEC_RET} from './CmnInterface';\nimport {DebugMng} from './DebugMng';\nimport {SEARCH_PATH_ARG_EXT} from './ConfigBase';\nimport type {SysBase} from './SysBase';\nimport type {SoundMng} from './SoundMng';\nimport type {HArg} from './Grammar';\nimport {Layer} from './Layer';\nimport {Reading} from './Reading';\n\nimport {Sprite, Container, Texture, AnimatedSprite, LoaderResource, utils, Loader, Rectangle, BLEND_MODES} from 'pixi.js';\n\ntype IFncCompSpr = (sp: Sprite)=> void;\n\ninterface Iface {\n\tfn\t\t\t: string;\n\tdx\t\t\t: number;\n\tdy\t\t\t: number;\n\tblendmode\t: number;\n};\ninterface Ihface { [name: string]: Iface; };\n\ninterface IResAniSpr {\n\taTex\t: Texture[];\n\tmeta\t: {\n\t\tanimationSpeed? :number;\n\t};\n}\n\n\nexport class SpritesMng {\n\tstatic\t#cfg\t: Config;\n\tstatic\t#val\t: IVariable;\n\tstatic\t#sys\t: SysBase;\n\tstatic\t#main\t: IMain;\n\tstatic\tinit(cfg: Config, val: IVariable, sys: SysBase, main: IMain, sndMng: SoundMng) {\n\t\tSpritesMng.#cfg = cfg;\n\t\tSpritesMng.#val = val;\n\t\tSpritesMng.#sys = sys;\n\t\tSpritesMng.#main = main;\n\t\tif (sys.arg.crypto) {\n\t\t\tSpritesMng.#cachePicMov = SpritesMng.#dec2cachePicMov;\n\t\t\tSpritesMng.#cacheAniSpr = SpritesMng.#dec2cacheAniSpr;\n\t\t}\n\n\t\tconst fnc = ()=> {\n\t\t\tconst vol = SpritesMng.#glbVol * SpritesMng.#movVol;\n\t\t\tfor (const v of Object.values(SpritesMng.#hFn2hve)) v.volume = vol;\n\t\t};\n\t\tsndMng.setNoticeChgVolume(\n\t\t\tvol=> {SpritesMng.#glbVol = vol; fnc()},\n\t\t\tvol=> {SpritesMng.#movVol = vol; fnc()}\n\t\t);\n\t}\n\tstatic\t#movVol\t= 1;\n\tstatic\t#glbVol\t= 1;\n\n\tstatic\t#evtMng\t: IEvtMng;\n\tstatic\tsetEvtMng(evtMng: IEvtMng) {SpritesMng.#evtMng = evtMng}\n\n\n\tconstructor(readonly csvFn = '', readonly ctn?: Container, private fncFirstComp: IFncCompSpr = ()=> {}, private fncAllComp: (isStop: boolean)=> void = ()=> {}) {\n\t\tif (! csvFn) return;\n\n\t\tthis.#addChild = ctn ? sp=> {ctn.addChild(sp); this.#aSp.push(sp)} : ()=> {};\n\t\tthis.ret = SpritesMng.#csv2Sprites(\n\t\t\tcsvFn,\n\t\t\tsp=> this.fncFirstComp(sp),\t\t\t// 差し替え考慮\n\t\t\tisStop=> this.fncAllComp(isStop),\t// 差し替え考慮\n\t\t\tsp=> this.#addChild(sp)\t\t\t\t// 差し替え考慮\n\t\t);\n\t}\n\treadonly ret: boolean\t\t= false;\n\t#addChild\t: (sp: Sprite)=> void;\n\t#aSp\t\t: Container[]\t= [];\n\n\tdestroy() {\t\t// これをやるためのクラス、とすら云える\n\t\tthis.fncFirstComp\t= ()=> {};\n\t\tthis.fncAllComp\t\t= ()=> {};\n\t\tthis.#addChild\t\t= sp=> sp.destroy();\n\n\t\tfor (const sp of this.#aSp) {\n\t\t\tSpritesMng.stopVideo(sp.name);\n\t\t\tsp.parent?.removeChild(sp);\n\t\t\tsp.destroy();\n\t\t}\n\t\tthis.#aSp = [];\n\t}\n\n\tstatic\tdestroy() {\n\t\tSpritesMng.#hFace\t= {};\n\t\tSpritesMng.#hFn2ResAniSpr\t= {};\n\t\t//SpritesMng.#ldrHFn\t= {};\n\t\tSpritesMng.#hFn2hve\t= {};\n\t}\n\n\n\t//static #ldrHFn: {[fn: string]: 1} = {};\n\tstatic\t#csv2Sprites(csv: string, fncFirstComp: IFncCompSpr, fncAllComp: (isStop: boolean)=> void, addChild: (sp: Sprite)=> void): boolean {\n\t\tif (! csv) return false;\n\n\t\tlet needLoad = false;\n\t\tif (csv.startsWith('data:')) {\t// Data URI\n\t\t\tconst fnc = ()=> {\n\t\t\t\tconst sp = Sprite.from(csv);\n\t\t\t\taddChild(sp);\n\t\t\t\tfncFirstComp(sp);\n\t\t\t\tfncAllComp(needLoad);\n\t\t\t};\n\t\t\tif (csv in utils.TextureCache) fnc();\n\t\t\telse {needLoad = true; (new Loader).add(csv, csv).load(fnc)}\n\n\t\t\treturn needLoad;\n\t\t}\n\n\t\tconst aComp: {fn: string, fnc: IFncCompSpr}[] = [];\n\t\tconst ldr = new Loader;\n\t\tconst a = csv.split(',');\n\t\tconst len = a.length;\n\t\tfor (let i=0; i<len; ++i) {\n\t\t\tconst fn0 = a[i];\n\t\t\tif (! fn0) throw 'face属性に空要素が含まれます';\n\n\t\t\t// 差分絵を重ねる\n\t\t\tconst {dx, dy, blendmode, fn} = SpritesMng.#hFace[fn0] || {\n\t\t\t\tfn\t: fn0,\n\t\t\t\tdx\t: 0,\n\t\t\t\tdy\t: 0,\n\t\t\t\tblendmode\t: BLEND_MODES.NORMAL\n\t\t\t};\n\t\t\tconst fnc = (i === 0) ?fncFirstComp :(sp: Sprite)=> {\n\t\t\t\tif (sp.transform === null) return;\t// エラー予防\n\t\t\t\tsp.x = dx;\n\t\t\t\tsp.y = dy;\n\t\t\t\tsp.blendMode = blendmode;\n\t\t\t};\n\t\t\taComp.push({fn, fnc});\n\n\t\t\tif (fn in SpritesMng.#hFn2ResAniSpr) continue;\n\t\t\tif (fn in utils.TextureCache) continue;\n\t\t\t//if (fn in utils.BaseTextureCache) continue;\t\t// 警告に変化なし\n\t\t\tif (fn in Loader.shared.resources) continue;\n\t\t\t//if (fn in SpritesMng.#ldrHFn) {\n\t\t\t\t// ここに来るという中途半端な状態がある。お陰で警告が出てしまう\n\t\t\t\t// （警告を消そうとする）以下の試みは効かない。直前の if でそもそもここに来ない\n\t\t\t\t//\tTexture.removeFromCache(fn);\n\t\t\t\t//\tdelete utils.TextureCache[fn];\n\t\t\t\t//\tdelete Loader.shared.resources[fn];\n\t\t\t\t// continue;\t// これは厳禁、御法度。\n\t\t\t\t\t// 画像ボタンや文字ボタン背景で同じ画像を、間を置かずロードした場合に最初一つしか表示されなくなる。以下は確認用ギャラリー\n\t\t\t\t\t// http://localhost:8082/index.html?cur=ch_button\n\t\t\t//}\n\t\t\t//SpritesMng.#ldrHFn[fn] = 1;\n\n\t\t\tneedLoad = true;\n\t\t\tconst url = SpritesMng.#cfg.searchPath(fn, SEARCH_PATH_ARG_EXT.SP_GSM);\n\t\t\tconst xt = this.#sys.arg.crypto\n\t\t\t? {xhrType: (url.slice(-5) === '.json')\n\t\t\t\t? LoaderResource.XHR_RESPONSE_TYPE.TEXT\n\t\t\t\t: LoaderResource.XHR_RESPONSE_TYPE.BUFFER}\n\t\t\t: {};\n\t\t\tldr.add({...xt, name: fn, url});\n\t\t}\n\n\t\tconst fncLoaded = (_: any, hRes: {[fn: string]: LoaderResource})=> {\n\t\t\tfor (const {fn, fnc} of aComp) {\n\t\t\t\tconst sp = SpritesMng.#mkSprite(fn, hRes);\n\t\t\t\tsp.name = fn;\t// 4 Debug?\n\t\t\t\taddChild(sp);\n\t\t\t\tfnc(sp);\n\t\t\t}\n\t\t\tfncAllComp(needLoad);\n\t\t}\n\t\tif (needLoad) {\n\t\t\tldr.use(async (res, next)=> {\n\t\t\t\ttry {\n\t\t\t\t\tif (res.extension === 'json') {\n\t\t\t\t\t\tconst str = await this.#sys.dec('json', res.data);\n\t\t\t\t\t\tSpritesMng.#cacheAniSpr(str, res, next);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst aiv = await this.#sys.decAB(res.data);\n\t\t\t\t\tSpritesMng.#cachePicMov(aiv, res, next);\n\t\t\t\t} catch (e) {\n\t\t\t\t\tconst mes = `画像/動画ロード失敗です fn:${res.name} ${e}`;\n\t\t\t\t\tif (SpritesMng.#evtMng.isSkipping) console.warn(mes); else console.error('%c'+ mes, 'color:#FF3300;');\n\t\t\t\t}\n\t\t\t})\n\t\t\t.load(fncLoaded);\n\t\t}\n\t\telse queueMicrotask(()=> fncLoaded(0, {}));\n\n\t\treturn needLoad;\n\t}\n\tstatic\t#hFace\t\t\t: Ihface\t= {};\n\tstatic\t#hFn2ResAniSpr\t: {[fn: string]: IResAniSpr} = {};\n\n\n\tstatic #cachePicMov = (_r: SYS_DEC_RET, {type, name, data}: any, next: ()=> void)=> {\n\t\tswitch (type) {\n\t\t\tcase LoaderResource.TYPE.VIDEO:\n\t\t\t\tconst hve = data as HTMLVideoElement;\n\t\t\t\thve.volume = SpritesMng.#glbVol;\n\t\t\t\tSpritesMng.#hFn2hve[name] = SpritesMng.#charmVideoElm(hve);\n\t\t}\n\t\tnext();\n\t}\n\tstatic #sortAFrameName(aFn: string[]): string[] {\n\t\tconst a_base_name = /([^\\d]+)\\d+\\.(\\w+)/.exec(aFn[0] ?? '');\n\t\tif (! a_base_name) return [];\n\n\t\tconst is = a_base_name[1]!.length;\n\t\tconst ie = -a_base_name[2]!.length -1;\n\t\treturn aFn.sort((a, b)=> int(a.slice(is, ie)) > int(b.slice(is, ie)) ?1 :-1);\n\t}\n\n\tstatic async #dec2cachePicMov(r: SYS_DEC_RET, res: any, next: ()=> void) {\n\t\tres.data = r;\n\t\tif (res.extension !== 'bin') next();\n\n\t\tif (r instanceof HTMLImageElement) {\n\t\t\tres.texture = await Texture.fromLoader(r, res.url, res.name);\n\t\t\t//Texture.addToCache(Texture.from(r), res.name);\n\t\t\t// res.texture = Texture.from(r);\n\t\t\t\t// でも良いが、キャッシュ追加と、それでcsv2Sprites()内で使用するので\n\t\t\tres.type = LoaderResource.TYPE.IMAGE;\n//\t\t\tURL.revokeObjectURL(r.src);\t// TODO: キャッシュ破棄\n\t\t}\n\t\telse if (r instanceof HTMLVideoElement) {\n\t\t\tr.volume = SpritesMng.#glbVol;\n\t\t\tSpritesMng.#hFn2hve[res.name] = SpritesMng.#charmVideoElm(r);\n\n\t\t\tres.type = LoaderResource.TYPE.VIDEO;\n//\t\t\tURL.revokeObjectURL(r.src);\n\t\t}\n\t\tnext();\n\t}\n\tstatic #charmVideoElm(hve: HTMLVideoElement): HTMLVideoElement {\n\t\t// 【PixiJS】iOSとChromeでAutoPlay可能なビデオSpriteの設定 - Qiita https://qiita.com/masato_makino/items/8316e7743acac514e361\n\t\tif (SpritesMng.#val.getVal('const.sn.needClick2Play')) {\n\t\t\t// ブラウザ実行で、クリックされるまで音声再生が差し止められている状態か。なにかクリックされれば falseになる\n\t\t\tDebugMng.trace_beforeNew(`[lay系] ${DebugMng.strPos()}未クリック状態で動画を自動再生します。音声はミュートされます`, 'W');\n\t\t\thve.muted = true;\t// Chrome対応：自動再生を許可させるため。ないと再開時に DOMException\n\t\t}\n\t\thve.setAttribute('playsinline', '');\t// iOS対応\n\t\treturn hve;\n\t}\n\n\tstatic #cacheAniSpr = (_r: string, {type, spritesheet, name, data}: any, next: ()=> void)=> {\n\t\tswitch (type) {\n\t\t\tcase LoaderResource.TYPE.JSON:\t// switchは必須\n\t\t\t\tconst aFn: string[] = spritesheet._frameKeys;\n\t\t\t\tSpritesMng.#sortAFrameName(aFn);\n\t\t\t\tSpritesMng.#hFn2ResAniSpr[name] = {\n\t\t\t\t\taTex: aFn.map(fn=> Texture.from(fn)),\n\t\t\t\t\tmeta: data.meta,\n\t\t\t\t};\n\t\t}\n\t\tnext();\n\t}\n\n\tstatic #dec2cacheAniSpr(r: string, res: any, next: ()=> void) {\n\t\tconst {meta, frames} = res.data = JSON.parse(r);\n\t\tres.type = LoaderResource.TYPE.JSON;\n\t\tif (! meta?.image) {next(); return}\n\n\t\tconst fn = getFn(meta.image);\n\t\tconst url = SpritesMng.#cfg.searchPath(fn, SEARCH_PATH_ARG_EXT.SP_GSM);\n\t\t(new Loader)\n\t\t.use((res2, next2)=> {\n\t\t\tthis.#sys.decAB(res2.data)\n\t\t\t.then(r2=> {\n\t\t\t\tres2.data = r2;\n\t\t\t\tif (r2 instanceof HTMLImageElement) {\n\t\t\t\t\tres2.type = LoaderResource.TYPE.IMAGE;\n\t\t\t\t\tURL.revokeObjectURL(r2.src);\n\t\t\t\t}\n\t\t\t\tnext2();\n\t\t\t})\n\t\t\t.catch(e=> this.#main.errScript(`画像/動画ロード失敗です dec2res4Cripto fn:${res2.name} ${e}`, false));\n\t\t})\n\t\t.add({name: fn, url, xhrType: LoaderResource.XHR_RESPONSE_TYPE.BUFFER})\n\t\t.load((ldr, _hRes)=> {\n\t\t\tfor (const {data} of Object.values(ldr.resources)) {\n\t\t\t\tconst {baseTexture} = Texture.from(data);\n\t\t\t\tconst aFr = Object.values(<{[nm: string]: {\n\t\t\t\t\tframe: {x: number; y: number; w: number; h: number;}\n\t\t\t\t}}>frames);\n\t\t\t\tSpritesMng.#hFn2ResAniSpr[res.name] = {\n\t\t\t\t\taTex: aFr.map(({frame: {x, y, w, h}})=> new Texture(\n\t\t\t\t\t\tbaseTexture,\n\t\t\t\t\t\tnew Rectangle(x, y, w, h),\n\t\t\t\t\t)),\n\t\t\t\t\tmeta,\n\t\t\t\t};\n\t\t\t}\n\t\t\tnext();\n\t\t});\n\t}\n\n\t\tstatic\t#mkSprite(fn: string, hRes: {[fn: string]: LoaderResource}): Sprite {\n\t\t\tconst ras = SpritesMng.#hFn2ResAniSpr[fn];\n\t\t\tif (ras) {\n\t\t\t\tconst asp = new AnimatedSprite(ras.aTex);\n\t\t\t\tasp.animationSpeed = ras.meta.animationSpeed ?? 1.0;\n\t\t\t\tasp.play();\n\t\t\t\treturn asp;\n\t\t\t}\n\t\t\tif (fn in utils.TextureCache) return Sprite.from(fn);\n\t\t\tconst hve = SpritesMng.#hFn2hve[fn];\n\t\t\tif (hve) return Sprite.from(hve);\n\n\t\t\tconst r = hRes[fn];\n\t\t\treturn r ?new Sprite(r.texture) :new Sprite;\n\t\t}\n\tstatic\t#hFn2hve\t: {[fn: string]: HTMLVideoElement} = {};\n\tstatic\tgetHFn2VElm(fn: string) {return SpritesMng.#hFn2hve[fn]}\n\n\tstatic\twv(hArg: HArg): boolean {\n\t\t// 動画ファイル名指定でいいかなと。なぜなら「ループで再生しつつ」\n\t\t// 同ファイル名の別の動画の再生は待ちたい、なんて状況は普通は無いだろうと\n\t\tconst {fn} = hArg;\n\t\tif (! fn) throw 'fnは必須です';\n\t\tconst hve = SpritesMng.#hFn2hve[fn];\n\t\tif (! hve || hve.loop) return false;\n\n\t\tif (SpritesMng.#evtMng.isSkipping || hve.ended) {SpritesMng.stopVideo(fn); return false}\n\n\t\tconst RPN_WV = 'wv fn:'+ fn;\n\t\tconst stop = argChk_Boolean(hArg, 'stop', true);\n\t\tconst fnc = ()=> {if (stop) SpritesMng.stopVideo(fn)};\n\t\tReading.beginProc(RPN_WV, fnc, true, fnc);\n\t\thve.addEventListener('ended', ()=> Reading.notifyEndProc(RPN_WV), {once: true, passive: true});\n\n\t\treturn true;\n\t}\n\n\tstatic\tstopVideo(fn: string) {\n\t\tconst hve = SpritesMng.#hFn2hve[fn];\n\t\tif (! hve) return;\n\n\t\tdelete SpritesMng.#hFn2hve[fn];\n\t\thve.pause();\n\t\thve.currentTime = hve.duration;\n\t}\n\n\n\tstatic\tadd_face(hArg: HArg): boolean {\n\t\tconst {name} = hArg;\n\t\tif (! name) throw 'nameは必須です';\n\t\tif (name in SpritesMng.#hFace) throw '一つのname（'+ name +'）に対して同じ画像を複数割り当てられません';\n\n\t\tconst {fn = name} = hArg;\n\t\tSpritesMng.#hFace[name] = {\n\t\t\tfn,\n\t\t\tdx: argChk_Num(hArg, 'dx', 0),\n\t\t\tdy: argChk_Num(hArg, 'dy', 0),\n\t\t\tblendmode: Layer.getBlendmodeNum(hArg.blendmode || '')\n\t\t};\n\n\t\treturn false;\n\t}\n//\tstatic\tclearFace2Name(): void {SpritesMng.hFace = {}}\n\n}\n","/* ***** BEGIN LICENSE BLOCK *****\n\tCopyright (c) 2024-2025 Famibee (famibee.blog38.fc2.com)\n\n\tThis software is released under the MIT License.\n\thttp://opensource.org/licenses/mit-license.php\n** ***** END LICENSE BLOCK ***** */\n\nimport {argChk_Boolean, argChk_Num} from './CmnLib';\nimport type {HArg} from './Grammar';\n\nimport type {Rectangle} from 'pixi.js';\n\nexport interface IChRect {\n\tch\t\t: string;\n\trect\t: Rectangle;\n\telm\t\t: HTMLElement;\n}\n\nconst def行頭禁則\t= '、。，．）］｝〉」』】〕”〟ぁぃぅぇぉっゃゅょゎァィゥェォッャュョヮヵヶ！？!?‼⁉・ーゝゞヽヾ々';\nconst def行末禁則\t= '［（｛〈「『【〔“〝';\nconst def分割禁止\t= '─‥…';\nconst defぶら下げ\t= def行頭禁則;\n\nconst defReg行頭禁則\t= new RegExp(`[${def行頭禁則}]`);\nconst defReg行末禁則\t= new RegExp(`[${def行末禁則}]`);\nconst defReg分割禁止\t= new RegExp(`[${def分割禁止}]`);\nconst defRegぶら下げ\t= defReg行頭禁則;\n\n\nexport class Hyphenation {\n\t#s行頭禁則\t\t= def行頭禁則;\n\t#s行末禁則\t\t= def行末禁則;\n\t#s分割禁止\t\t= def分割禁止;\n\t#sぶら下げ\t\t= defぶら下げ;\n\tget 行頭禁則() {return this.#s行頭禁則}\n\tget 行末禁則() {return this.#s行末禁則}\n\tget 分割禁止() {return this.#s分割禁止}\n\tget ぶら下げ() {return this.#sぶら下げ}\n\n\t#reg行頭禁則\t= defReg行頭禁則;\n\t#reg行末禁則\t= defReg行末禁則;\n\t#reg分割禁止\t= defReg分割禁止;\n\t#regぶら下げ\t= defRegぶら下げ;\n\n\tbreak_fixed\t\t= false;\n\tbreak_fixed_left= 0;\n\tbreak_fixed_top\t= 0;\n\tbura\t\t\t= false;\n\tlay(hArg: HArg) {\n\t\tif (hArg.kinsoku_sol) {\n\t\t\tthis.#s行頭禁則 = hArg.kinsoku_sol;\n\t\t\tthis.#reg行頭禁則 = new RegExp(`[${this.#s行頭禁則}]`);\n\t\t}\n\t\tif (hArg.kinsoku_eol) {\n\t\t\tthis.#s行末禁則 = hArg.kinsoku_eol;\n\t\t\tthis.#chk禁則の競合_ぶら行末();\n\t\t\tthis.#reg行末禁則 = new RegExp(`[${this.#s行末禁則}]`);\n\t\t}\n\t\tif (hArg.kinsoku_dns) {\n\t\t\tthis.#s分割禁止 = hArg.kinsoku_dns;\n\t\t\tthis.#chk禁則の競合_ぶら分禁();\n\t\t\tthis.#reg分割禁止 = new RegExp(`[${this.#s分割禁止}]`);\n\t\t}\n\t\tif (hArg.kinsoku_bura) {\n\t\t\tthis.#sぶら下げ = hArg.kinsoku_bura;\n\t\t\tthis.#chk禁則の競合_ぶら行末();\n\t\t\tthis.#chk禁則の競合_ぶら分禁();\n\t\t\tthis.#regぶら下げ = new RegExp(`[${this.#sぶら下げ}]`);\n\t\t}\n\t\tif ('bura' in hArg) this.bura = argChk_Boolean(hArg, 'bura', false);\n\n\t\tthis.break_fixed\t\t= argChk_Boolean(hArg, 'break_fixed', this.break_fixed);\n\t\tthis.break_fixed_left\t= argChk_Num(hArg, 'break_fixed_left', this.break_fixed_left);\n\t\tthis.break_fixed_top\t= argChk_Num(hArg, 'break_fixed_top', this.break_fixed_top);\n\t}\n\t\t// 禁則の競合（ぶら下げ と 行末禁則 の両方に含まれる文字があってはならない）\n\t\t#chk禁則の競合_ぶら行末() {\n\t\t\t// 処理速度最適化で主従を変える。長い方をネイティブにやらせる\n\t\t\tconst len行末禁則 = this.#s行末禁則.length;\n\t\t\tconst lenぶら下げ = this.#sぶら下げ.length;\n\t\t\tif (len行末禁則 < lenぶら下げ) {\n\t\t\t\tfor (let i=0; i<len行末禁則; ++i) {\n\t\t\t\t\tconst c = this.#s行末禁則[i];\n\t\t\t\t\tif (this.#sぶら下げ.includes(c!)) throw `禁則の競合があります。文字 ${c} がぶら下げ と 行末禁則 の両方に含まれます`;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\tfor (let i=0; i<lenぶら下げ; ++i) {\n\t\t\t\t\tconst c = this.#sぶら下げ[i];\n\t\t\t\t\tif (this.#s行末禁則.includes(c!)) throw `禁則の競合があります。文字 ${c} がぶら下げ と 行末禁則 の両方に含まれます`;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t// 禁則の競合（ぶら下げ と 分割禁止 の両方に含まれる文字があってはならない）\n\t\t#chk禁則の競合_ぶら分禁() {\n\t\t\t// 処理速度最適化で主従を変える。長い方をネイティブにやらせる\n\t\t\tconst len分割禁止 = this.#s分割禁止.length;\n\t\t\tconst lenぶら下げ = this.#sぶら下げ.length;\n\t\t\tif (len分割禁止 < lenぶら下げ) {\n\t\t\t\tfor (let i=0; i<len分割禁止; ++i) {\n\t\t\t\t\tconst c = this.#s分割禁止[i];\n\t\t\t\t\tif (this.#sぶら下げ.includes(c!)) throw `禁則の競合があります。文字 ${c} がぶら下げ と 分割禁止 の両方に含まれます`;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\tfor (let i=0; i<lenぶら下げ; ++i) {\n\t\t\t\t\tconst c = this.#sぶら下げ[i];\n\t\t\t\t\tif (this.#s分割禁止.includes(c!)) throw `禁則の競合があります。文字 ${c} がぶら下げ と 分割禁止 の両方に含まれます`;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\treNew(to: Hyphenation) {\n\t\tto.#genKinsoku(this.#s行頭禁則, this.#s行末禁則, this.#s分割禁止, this.#sぶら下げ);\n\n\t\tto.break_fixed\t\t= this.break_fixed;\n\t\tto.break_fixed_left\t= this.break_fixed_left;\n\t\tto.break_fixed_top\t= this.break_fixed_top;\n\t\tto.bura\t\t\t\t= this.bura;\n\t}\n\t\t#genKinsoku(s行頭禁則: string, s行末禁則: string, s分割禁止: string, sぶら下げ: string) {\n\t\t\tif (this.#s行頭禁則\t!= s行頭禁則) {\n\t\t\t\tthis.#s行頭禁則\t= s行頭禁則;\n\t\t\t\tthis.#reg行頭禁則 = new RegExp(`[${s行頭禁則}]`);\n\t\t\t}\n\t\t\tif (this.#s行末禁則\t!= s行末禁則) {\n\t\t\t\tthis.#s行末禁則\t= s行末禁則;\n\t\t\t\tthis.#reg行末禁則 = new RegExp(`[${s行末禁則}]`);\n\t\t\t}\n\t\t\tif (this.#s分割禁止\t!= s分割禁止) {\n\t\t\t\tthis.#s分割禁止\t= s分割禁止;\n\t\t\t\tthis.#reg分割禁止 = new RegExp(`[${s分割禁止}]`);\n\t\t\t}\n\t\t\tif (this.#sぶら下げ\t!= sぶら下げ) {\n\t\t\t\tthis.#sぶら下げ\t= sぶら下げ;\n\t\t\t\tthis.#regぶら下げ = new RegExp(`[${sぶら下げ}]`);\n\t\t\t}\n\t\t}\n\trecord() {\n\t\tconst o: any = {\n\t\t\tbreak_fixed\t\t\t: this.break_fixed,\n\t\t\tbreak_fixed_left\t: this.break_fixed_left,\n\t\t\tbreak_fixed_top\t\t: this.break_fixed_top,\n\t\t\tbura\t\t\t\t: this.bura,\n\t\t};\n\t\tif (this.#s行頭禁則 === def行頭禁則) o.行頭禁則 = this.#s行頭禁則;\n\t\tif (this.#s行末禁則 === def行末禁則) o.行末禁則 = this.#s行末禁則;\n\t\tif (this.#s分割禁止 === def分割禁止) o.分割禁止 = this.#s分割禁止;\n\t\tif (this.#sぶら下げ === defぶら下げ) o.ぶら下げ = this.#sぶら下げ;\n\t\t\t// デフォルト値と同じならJSONで省略\n\t\treturn o;\n\t}\n\tplayback(hLay: any) {\n\t\tif (! hLay) return;\t\t// 途中追加なので\n\n\t\tthis.#genKinsoku(\n\t\t\thLay.行頭禁則 ?? def行頭禁則,\n\t\t\thLay.行末禁則 ?? def行末禁則,\n\t\t\thLay.分割禁止 ?? def分割禁止,\n\t\t\thLay.ぶら下げ ?? defぶら下げ,\n\t\t);\n\n\t\tthis.break_fixed\t\t= hLay.break_fixed;\n\t\tthis.break_fixed_left\t= hLay.break_fixed_left;\n\t\tthis.break_fixed_top\t= hLay.break_fixed_top;\n\t\tthis.bura\t\t\t\t= hLay.bura;\n\t}\n\n\thyph(htmTxt: HTMLSpanElement, cnvRect :(rng: Range, ch: string)=> Rectangle, tategaki: boolean, begin: number, bkHtm: string): [IChRect[], number] {\n\t\tlet a: IChRect[];\n\t\tlet len = 0;\n\t\tlet i = 2;\t\t// 本来 1 だがひと文字目の行頭禁則文字を無視したいので\n\t\tlet fncFirstChk = (len: number)=> {\n\t\t\tfncFirstChk = ()=> false;\n\n\t\t\tif (begin === len) {\t// 右クリック戻りなどで文字表示が崩れる件の対応\n\t\t\t\tif (begin > 0) htmTxt.innerHTML = bkHtm.replaceAll('class=\"sn_ch\"', 'class=\"sn_ch sn_ch_in_default\"');\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\treturn len < 2;\n\t\t};\n//console.log(`🎴禁則処理判定ループ begin:${begin}`);\n\t\tdo {\n\t\t\ta = this.#getChRects(htmTxt, cnvRect);\n\t\t\tlen = a.length;\n\t\t\tif (fncFirstChk(len)) break;\n\n\t\t\t// 禁則処理判定ループ\n\t\t\tlet sl_xy = -Infinity;\t// 前回のxy\n//console.log(`- len:${len} a_ch:${a.map((v, i)=> v.elm.tagName === 'RT' ?[] :[i, v.ch])}:`);\n\t\t\tfor (; i<len; ++i) {\n\t\t\t\tconst {elm, rect, ch} = a[i]!;\n\t\t\t\tif (elm.tagName === 'RT') continue;\t// ルビはスキップ\n\n\t\t\t\tconst xy = tategaki ?rect.y :rect.x;\n//if (sl_xy > 790)\n//console.log(`🎴 sl_xy:${sl_xy.toFixed(2)} xy:${xy.toFixed(2)} i:${i} ch:${ch}: rect:(${rect.left.toFixed(2)}, ${rect.top.toFixed(2)}, ${rect.width.toFixed(2)}, ${rect.height.toFixed(2)})`);\n\t\t\t\tif (sl_xy <= xy\t// 【 < 】では[tcy]二文字目を誤判定する\n\t\t\t\t// [r]による改行後は追い出し処理をしないように\n\t\t\t\t|| (elm.previousElementSibling?.tagName === 'SPAN'\n\t\t\t\t&&\telm.previousElementSibling?.innerHTML.includes('<br>'))\n\t\t\t\t// <span class=\"offrec\"> 〜 </span> 外し\n\t\t\t\t|| (elm.parentElement?.previousElementSibling?.tagName === 'SPAN'\n\t\t\t\t&&\telm.parentElement?.previousElementSibling?.innerHTML.includes('<br>'))) {\n\t\t\t\t\tsl_xy = xy;\n\t\t\t\t\tif (! this.break_fixed) {\n\t\t\t\t\t\tthis.break_fixed_left = rect.x;\n\t\t\t\t\t\tthis.break_fixed_top = rect.y;\n\t\t\t\t\t}\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n/*\n\t// [r]などの改行はこう。TxtLayer.#tagCh_sub()により <span> に入れられる\n\t<span class=​\"sn_ch\" style=​\"display:​ inline;​animation-delay:​ 10ms;​\">​\n\t\t<br>\n\t​</span>​\n\n\t// 上記が下記に囲まれている場合もある。previousElementSibling 使用時は注意\n\t<span class=\"offrec\"> 〜 </span>\n\n\n\t// 禁則処理による自動改行はこう\n\t<br>\n*/\n\n\t\t\t\tconst p_i = this.#i2pi(a, i);\n\t\t\t\tconst {elm: p_elm, rect: p_rect, ch: p_ch} = a[p_i]!;\n//console.log(`🎴 === 自動改行発生！ 前文字:${p_i}:${p_ch}:%o 今文字:${i}:${ch}:(${ch.charCodeAt(0).toString(16)})%o`, a[p_i].elm, a[i].elm);\n\t\t\t\tif (! this.break_fixed) {\n\t\t\t\t\tthis.break_fixed_left = p_rect.x;\n\t\t\t\t\tthis.break_fixed_top = p_rect.y;\n\t\t\t\t\tconst sty = globalThis.getComputedStyle(p_elm);\n\t\t\t\t\tconst rs = parseFloat(sty.fontSize);\n\t\t\t\t\tif (tategaki)\tthis.break_fixed_top += rs;\n\t\t\t\t\telse\t\t\tthis.break_fixed_left += rs;\n\t\t\t\t}\n\n\t\t\t\tsl_xy = -Infinity;\t// 自動改行発生！\n\t\t\t\tconst oldI = i;\n\t\t\t\tconst {cont, ins} = this.bura\n\t\t\t\t\t? this.hyph_alg_bura(a, p_i, p_ch, i)\n\t\t\t\t\t: this.hyph_alg(a, p_i, p_ch, i, ch);\n\t\t\t\ti = ins;\n//console.log(`🎴 === cont:${cont} ins:${i} :${a[i].ch}:%o の前に改行を挿入`, a[i].elm);\n\t\t\t\tif (cont) continue;\n\n\t\t\t\t// 改行挿入\n\t\t\t\tconst elm2 = a[i]!.elm;\n\t\t\t\tconst pal = elm2.parentElement!;\n\t\t\t\tconst br = document.createElement('br');\n\t\t\t\tif (pal.classList.contains('sn_tx')) pal.insertBefore(br, elm2); else {\n\t\t\t\t\tconst ppal = pal.parentElement!;\n\t\t\t\t\tif (ppal.classList.contains('sn_ch')) {\n\t\t\t\t\t\tppal.parentElement!.insertBefore(br, ppal);\n\t\t\t\t\t}\n\t\t\t\t\telse ppal.insertBefore(br, pal);\n\t\t\t\t}\n\n\t\t\t\ti += 2;\t// いま追加した<br>のぶんと、次へ行く +1\n\t\t\t\tif (i < oldI) i = oldI;\t// 永久ループ防御\n\t\t\t\tlen = -1;\t// doループ先頭に戻る\n\t\t\t\tbreak;\n\t\t\t}\n\t\t} while (len < 0);\n\n\t\treturn [a, len];\n\t}\n\t\t// 一つ前の要素を探す（ルビ対応）\n\t\t#i2pi(a: IChRect[], i: number): number {\n\t\t\tconst p_i = i -1;\n\t\t\tconst {elm} = a[p_i]!;\n\t\t\tif (elm.tagName !== 'RT') return p_i -(\n\t\t\t\telm.style.textCombineUpright === 'all'\n\t\t\t\t? Array.from(elm.textContent ?? '').length -1\n\t\t\t\t: 0\n\t\t\t);\n\n\t\t\treturn p_i -Array.from(elm.textContent ?? '').length;\n\t\t\t\t// サロゲートペア対策\n\t\t}\n\n\t#getChRects(elm: Node, cnvRect :(range: Range, ch: string)=> Rectangle): IChRect[] {\t// 注意）再帰関数\n\t\tconst ret: IChRect[] = [];\n\t\tif (elm.nodeType !== elm.TEXT_NODE) return Array.from(elm.childNodes).map(v=> this.#getChRects(v, cnvRect)).flat();\n\n\t\tconst rng = elm.ownerDocument!.createRange();\n\t\trng.selectNodeContents(elm);\n\t\tlet pos = 0;\n\t\tconst end = rng.endOffset;\n\t\t// できれば一文字ずつ「after-edge - baseline」を調べたいが、暫定手段を取る\n\t\t//const styles = globalThis.getComputedStyle(this.htmTxt);\n\t\t//console.log('lh:'+ styles.lineHeight +' fs:'+ styles.fontSize);\n\t\twhile (pos < end) {\n\t\t\trng.setStart(elm, pos);\n\t\t\trng.setEnd(elm, ++pos);\n\t\t\tconst ch = rng.toString();\n\t\t\tret.push({\n\t\t\t\tch,\n\t\t\t\trect: cnvRect(rng, ch),\n\t\t\t\telm\t: rng.startContainer.parentElement!,\n\t\t\t});\n\t\t}\n\t\trng.detach();\n\n\t\treturn ret;\n\t}\n\n\t/**\n\t * 抽象化した禁則処理アルゴリズム\n\t * @method hyph_alg\n\t * @param {IChRect[]} a - 文章の抽象化配列\n\t * @param {number} p_i - 処理要素の一つ前の添字\n\t * @param {string} p_ch - 処理要素の一つ前の文字\n\t * @param {number} i - 処理要素の添字\n\t * @param {string} ch - 処理要素の文字\n\t * @return {Object} result 戻り値\n\t * @return {boolean} result.cont - true: 呼び元で改行挿入せず continue\n\t * @return {number} result.ins - 手前に改行を挿入すべき要素の添字\n\t */\n\thyph_alg(\t// テスト用にpublic\n\t\ta\t: IChRect[],\n\t\tp_i\t: number,\n\t\tp_ch: string,\n\t\ti\t: number,\t// i >= 2\n\t\tch\t: string,\n\t): {cont: boolean, ins: number} {\n\t\t// 追い出し走査\n\t\tif (this.#reg行末禁則.test(p_ch)) {}\t// 一つ前\n\t\telse if (this.#reg行頭禁則.test(ch)) {\t//（現在地 -> 前方走査）\n\t\t\twhile ((i = this.#i2pi(a, i)) >= 0) {\n\t\t\t\tif (! this.#reg行頭禁則.test(a[i]!.ch)) break;// 行頭禁則はスキップ\n\t\t\t}\n\t\t}\n\t\telse if (p_ch === ch && this.#reg分割禁止.test(p_ch)) {}// 一つ前＆現在地\n\t\telse return {cont: true, ins: i +1};\t// 追い出しなし\n\n\t\t// 追い出しによる新行末二次判定（一つ前 -> 前方走査）\n\t\ti = p_i;\n\t\twhile ((i = this.#i2pi(a, i)) >= 0) {\n\t\t\tif (! this.#reg行末禁則.test(a[i]!.ch)) break;\t// 行末禁則はスキップ\n\t\t}\n\t\treturn {cont: false, ins: i +1};\n\t}\n\n\t/**\n\t * 抽象化した禁則処理アルゴリズム\n\t * @method hyph_alg\n\t * @param {IChRect[]} a - 文章の抽象化配列\n\t * @param {number} p_i - 処理要素の一つ前の添字\n\t * @param {string} p_ch - 処理要素の一つ前の文字\n\t * @param {number} i - 処理要素の添字\n\t * @return {Object} result 戻り値\n\t * @return {boolean} result.cont - true: 呼び元で改行挿入せず continue\n\t * @return {number} result.ins - 手前に改行を挿入すべき要素の添字\n\t */\n\thyph_alg_bura(\t// テスト用にpublic\n\t\ta\t: IChRect[],\n\t\tp_i\t: number,\n\t\tp_ch: string,\n\t\ti\t: number,\t// i >= 2\n\t): {cont: boolean, ins: number} {\n\t\tconst pp_i = this.#i2pi(a, p_i);\t// 改行後のルビで追い出し発生\n\t\tconst {ch: pp_ch} = a[pp_i]!;\n//console.log(`🎴 hyph_alg_bura pp:${pp_i}:${pp_ch}: p:${p_i}:${p_ch}: i:${i}:${a[i].ch}:`);\n\t\t// 改行前二個目に「ぶら下げ」がある\n\t\tif (this.#regぶら下げ.test(pp_ch) || this.#reg行頭禁則.test(pp_ch)) {\n\t\t\tlet j = p_i;\n\t\t\t// 改行前にも「ぶら下げ」がある\n\t\t\tif (this.#regぶら下げ.test(p_ch) || this.#reg行頭禁則.test(p_ch)) ++j;\n\n\t\t\t// ぶら下げ後……追い出し走査\n\t\t\tconst p_j = this.#i2pi(a, j);\t// pp_i ではない\n\t\t\tconst {ch: last_ch} = a[p_j]!;\t// 行末\n\t\t\tconst {ch: head_ch} = a[j]!;\t\t// 行頭\n\t\t\t// 分割禁止\n\t\t\tif (last_ch === head_ch && this.#reg分割禁止.test(head_ch)) return {cont: false, ins: p_j};\n\n\t\t\tif (! this.#reg行末禁則.test(last_ch)) return {cont: false, ins: j};\n\t\t\t// 行末禁則\n\t\t\tj = p_j;\n\t\t\tdo {\n\t\t\t\tif (! this.#reg行末禁則.test(a[j]!.ch)) break;\t// 行禁はスキップ\n\t\t\t} while ((j = this.#i2pi(a, j)) >= 0);\n\t\t\treturn {cont: false, ins: j +1};\t// 行末禁則\n\t\t}\n\n\t\t// 改行前二個目に「ぶら下げ」がない\n\t\tconst ppp_i = this.#i2pi(a, pp_i);\n\t\tif (i >= 3) {\n\t\t\tconst {ch: ppp_ch} = a[ppp_i]!;\n//console.log(`-- 改行前二個目に「ぶら下げ」がない ppp:${ppp_i}:${ppp_ch}: pp:${pp_i}:${pp_ch}: i:${i}`);\n\t\t\t// 改行前二個目に「分割禁止」\n\t\t\tif (this.#reg分割禁止.test(pp_ch)) {\t// 分割禁止\n//console.log(`   == 改行前二個目に「分割禁止」:${ppp_ch === pp_ch}`);\n\t\t\t\tif (ppp_ch === pp_ch) return {cont: false, ins: ppp_i};\n\t\t\t}\n\t\t\t// 改行前三個目に「行末禁則」\n\t\t\tif (this.#reg行末禁則.test(ppp_ch)) {\t// 行末禁則\n\t\t\t\tlet j = ppp_i;\n//console.log(`   == 改行前三個目に「行末禁則」 j:${j}:${a[j].ch}:`);\n\t\t\t\twhile ((j = this.#i2pi(a, j)) >= 0) {\n//console.log(`      -- ch:${a[j].ch}`);\n\t\t\t\t\tif (! this.#reg行末禁則.test(a[j]!.ch)) break;// 行禁はスキップ\n\t\t\t\t}\n//console.log(`   === j:${j +1}:${a[j +1].ch}: tn:${a[j +1].elm.parentElement?.tagName}`);\n\t\t\t\treturn {cont: false, ins: j +1};\t// 行末禁則\n\t\t\t}\n\t\t}\n\n\t\treturn {cont: false, ins: pp_i};\n\t}\n\n}\n","/* ***** BEGIN LICENSE BLOCK *****\n\tCopyright (c) 2018-2025 Famibee (famibee.blog38.fc2.com)\n\n\tThis software is released under the MIT License.\n\thttp://opensource.org/licenses/mit-license.php\n** ***** END LICENSE BLOCK ***** */\n\nimport type {IHEvt2Fnc, IValMp} from './CmnInterface';\n\nexport interface ICallStackArg {\n\t':resvToken'?\t: string;\t\t// call元のtoken\n\t':hEvt1Time'\t: IHEvt2Fnc;\t// call元のローカル予約イベント\n\t':hMp'\t\t\t: IValMp;\t\t// call元のmp:\n\t':タグ名'?\t\t: string;\n\t':lenIfStk'\t\t: number;\n}\n\nexport class CallStack {\n\tconstructor(readonly fn = '', readonly idx = 0, readonly csArg: ICallStackArg = {':hEvt1Time': {}, ':hMp': {}, ':lenIfStk': 1}) {}\n\n\treadonly\ttoString = ()=> `[fn:${this.fn}, idx:${this.idx}, csArg:${this.csArg}]`;\n\n}\n","/* ***** BEGIN LICENSE BLOCK *****\n\tCopyright (c) 2018-2025 Famibee (famibee.blog38.fc2.com)\n\n\tThis software is released under the MIT License.\n\thttp://opensource.org/licenses/mit-license.php\n** ***** END LICENSE BLOCK ***** */\n\nimport type {HArg} from './Grammar';\nimport type {IPutCh} from './CmnInterface';\n\nexport interface IAutoPage { (idx: number, str: string): void; }\n\nexport class RubySpliter {\n\tstatic\t#sesame\t\t= 'ヽ';\n\tstatic\tsetting(hArg: HArg) {if (hArg.sesame) RubySpliter.#sesame = hArg.sesame}\n\tstatic\tgetSesame() {return RubySpliter.#sesame}\n\n\tstatic\tdestroy() {RubySpliter.#sesame = 'ヽ'}\n\n\t#putCh\t: IPutCh\t= ()=> {};\n\tinit(putCh: IPutCh) {this.#putCh = putCh}\n\n/*\n\t\t★Unicodeで「漢字」の正規表現 – ものかの http://tama-san.com/kanji-regex/\n\t\t2E80..2FDF CJK部首補助＋康熙部首\n\t\t3005 々（漢字の踊り字）\n\t\t3007 〇（漢数字のゼロ）\n\t\t303B 〻（漢字の踊り字）\n\t\t3400..4DBF CJK統合漢字拡張A\n\t\t4E00..9FFF CJK統合漢字\n\t\tF900..FAFF CJK互換漢字\n\t\t20000..2FFFF CJK統合漢字拡張B〜F＋CJK互換漢字追加＋念のためU+2FFFFまで\n\n\t\t[\\x{2E80}-\\x{2FDF}々〇〻\\x{3400}-\\x{4DBF}\\x{4E00}-\\x{9FFF}\\x{F900}-\\x{FAFF}\\x{20000}-\\x{2FFFF}]\n\t\t[\\u2E80-\\u2FDF々〇〻\\u3400-\\u4DBF\\u4E00-\\u9FFF\\uF900-\\uFAFF\\u20000-\\u2FFFF]\n\t\t[⺀-⿟々〇〻㐀-䶿一-鿿豈-﫿\\u20000-\\u2FFFF]\t\t// 含まれない文字がある\n\t\t[⺀-⿟々〇〻㐀-鿿豈-﫿\\u20000-\\u2FFFF]\t\t\t// ヽ--30FD が変に引っかかる。多分\\u2000-\\u2FFF解釈\n\t\t\\\\u{20000}-\\\\u{2FFFF}\t// 五桁だとエラー\n\n\t\t【2022/10/03】ruby正規表現のUnicode プロパティ(とPOSIX文字クラス) - Qiita https://qiita.com/Takayuki_Nakano/items/8d38beaddb84b488d683\n\t\t\t> このHiraganaプロパティ、長音記号は含まれていません。\n\t\t\t> \\p{Han}…簡体字や繁体字、韓国語の漢字…ベトナム語の漢字にもマッチ\n\t\t\n\t\t・Unicode文字一覧表 - instant tools https://tools.m-bsys.com/ex/unicode_table.php\n*/\n\tstatic\t#REG_RUBY\t: RegExp;\n\tstatic\tsetEscape(ce: string) {\n\t\t// 830 match 11293 step(1.7ms) PCRE2 https://regex101.com/r/BBrQtC/1\n\t\t/*\n(?<txt4>\\\\\\S)\n|\t｜(?<str>[^《\\n]+)《(?<ruby>[^》\\n]+)》\n|\t(?: (?<kan>[⺀-⿟々〇〻㐀-鿿豈-﫿]+ [ぁ-ヿ]* | [^　｜《》\\n])\n\t\t《(?<kan_ruby>[^》\\n]+)》)\n|\t(?<txt>\n\t[\\xD800-\\xDBFF][\\xDC00-\\xDFFF]\n|\t[^｜《》]+?\n|\t.)\n\t\t*/\n\t\tRubySpliter.#REG_RUBY = new RegExp(\n\t\t\t`${ce ?`(?<ce>\\\\${ce}\\\\S)|` :''}`+\n\t\t\t`｜(?<str>[^《\\\\n]+)《(?<ruby>[^》\\\\n]+)》`+\n\t\t\t`|(?:(?<kan>[⺀-⿟々〇〻㐀-鿿豈-﫿]+[ぁ-ヿ]*|[^　｜《》\\\\n])`+\n\t\t\t`《(?<kan_ruby>[^》\\\\n]+)》)`+\n\t\t\t`|(?<txt>`+\n\t\t\t`[\\uD800-\\uDBFF][\\uDC00-\\uDFFF]`+\t// 上位 + 下位サロゲート\n\t\t\t`|[^｜《》]+?`+\t\t// 不要だが細切れにしないほうが後々効率で有利\n\t\t\t`|.)`,\n\t\t\t'gs'\n\t\t);\n\t}\n\n\tputTxt(text: string) {\n\t\tfor (const {groups} of text.matchAll(RubySpliter.#REG_RUBY)) {\n\t\t\tconst {ruby, kan_ruby, kan='', ce, txt='', str=''} = groups!;\n\t\t\tif (ruby) {this.putTxtRb(decodeURIComponent(str), ruby); continue}\n\n\t\t\tif (kan_ruby) {this.putTxtRb(kan, kan_ruby); continue}\n\t\t\tif (ce) {this.#putCh(ce.slice(1), ''); continue}\n\n\t\t\tfor (const v of Array.from(txt)) this.#putCh(v, '');\n\t\t\t\t// txt.split('')や [...txt] はサロゲートペアで問題\n\t\t}\n\t}\n\n\tputTxtRb(text: string, ruby: string) {\t// テスト用にpublic\n\t\t// 自動区切りを行わない（内部的 json文法）\n\t\tif (/^\\w+｜{\"/.test(ruby)) {this.#putCh(text, ruby); return}\n\n\t\tconst a: string[] = Array.from(text);\n\t\tconst len = a.length;\n\t\tif (/^\\*.?$/.test(ruby)) {\t// 傍点文法\n\t\t\tconst rb_ses = 'center｜'+ (ruby === '*' ?RubySpliter.#sesame :ruby.charAt(1));\n\t\t\tfor (let i=0; i<len; ++i) this.#putCh(a[i]!, rb_ses);\n\t\t\treturn;\n\t\t}\n\n\t\t// 自動区切りを行わない（単漢字など）\n\t\tif (len === 1 || ! ruby.includes(' ')) {\n\t\t\tthis.#putCh(text, decodeURIComponent(ruby));\n\t\t\treturn;\n\t\t}\n\n\t\t// 空白がある場合はユーザが区切りを指定しているものと見なす\n\t\tconst aR = ruby.split(' ');\n\t\tconst lenR = aR.length;\n\t\tconst len_max = (lenR > len) ?lenR :len;\n\t\tfor (let i=0; i<len_max; ++i) this.#putCh(\n\t\t\t(i < len) ? a[i]! : '',\n\t\t\t(i < lenR) ? decodeURIComponent(aR[i]!) : ''\n\t\t);\n\t}\n\n}\n","/*!\n * @pixi/sound - v4.4.1\n * https://github.com/pixijs/pixi-sound\n * Compiled Tue, 15 Aug 2023 19:22:13 UTC\n *\n * @pixi/sound is licensed under the MIT license.\n * http://www.opensource.org/licenses/mit-license\n */\nimport{LoaderResource as t,Loader as e}from\"@pixi/loaders\";import*as n from\"@pixi/core\";import{BaseTexture as o}from\"@pixi/core\";import{EventEmitter as i}from\"@pixi/utils\";import{Ticker as r}from\"@pixi/ticker\";var s;function u(){return s}var a=function(t,e){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function c(t,e){if(\"function\"!=typeof e&&null!==e)throw new TypeError(\"Class extends value \"+String(e)+\" is not a constructor or null\");function n(){this.constructor=t}a(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var l=function(){return(l=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},p=[\"mp3\",\"ogg\",\"oga\",\"opus\",\"mpeg\",\"wav\",\"m4a\",\"aiff\",\"wma\",\"mid\",\"caf\"],h={};function f(t){var e=l({m4a:\"audio/mp4\",oga:\"audio/ogg\",opus:'audio/ogg; codecs=\"opus\"',caf:'audio/x-caf; codecs=\"opus\"'},t||{}),n=document.createElement(\"audio\"),o={},i=/^no$/;p.forEach((function(t){var r=n.canPlayType(\"audio/\".concat(t)).replace(i,\"\"),s=e[t]?n.canPlayType(e[t]).replace(i,\"\"):\"\";o[t]=!!r||!!s})),Object.assign(h,o)}f();var d=/\\.(\\{([^\\}]+)\\})(\\?.*)?$/;function _(t){var e=d,n=\"string\"==typeof t?t:t.url;if(!e.test(n))return n;for(var o=e.exec(n),i=o[2].split(\",\"),r=i[i.length-1],s=0,u=i.length;s<u;s++){var a=i[s];if(h[a]){r=a;break}}var c=n.replace(o[1],r);if(\"string\"!=typeof t){var l=t;l.extension=r,l.url=c}return c}var y=p.filter((function(t){return h[t]})),m=function(){function e(){}return e.add=function(){e.setLegacy(u().useLegacy)},e.setLegacy=function(e){e?y.forEach((function(e){t.setExtensionXhrType(e,t.XHR_RESPONSE_TYPE.DEFAULT),t.setExtensionLoadType(e,t.LOAD_TYPE.AUDIO)})):y.forEach((function(e){t.setExtensionXhrType(e,t.XHR_RESPONSE_TYPE.BUFFER),t.setExtensionLoadType(e,t.LOAD_TYPE.XHR)}))},e.pre=function(t,e){_(t),e()},e.use=function(t,e){t.data&&y.indexOf(t.extension)>-1?t.sound=u().add(t.name,{loaded:e,preload:!0,url:t.url,source:t.data}):e()},e.extension=\"loader\",e}(),b=0,g=function(t){function e(e){var n=t.call(this)||this;return n.id=b++,n.init(e),n}return c(e,t),e.prototype.set=function(t,e){if(void 0===this[t])throw new Error(\"Property with name \".concat(t,\" does not exist.\"));switch(t){case\"speed\":this.speed=e;break;case\"volume\":this.volume=e;break;case\"paused\":this.paused=e;break;case\"loop\":this.loop=e;break;case\"muted\":this.muted=e}return this},Object.defineProperty(e.prototype,\"progress\",{get:function(){return this._source.currentTime/this._duration},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,\"paused\",{get:function(){return this._paused},set:function(t){this._paused=t,this.refreshPaused()},enumerable:!1,configurable:!0}),e.prototype._onPlay=function(){this._playing=!0},e.prototype._onPause=function(){this._playing=!1},e.prototype.init=function(t){this._playing=!1,this._duration=t.source.duration;var e=this._source=t.source.cloneNode(!1);e.src=t.parent.url,e.onplay=this._onPlay.bind(this),e.onpause=this._onPause.bind(this),t.context.on(\"refresh\",this.refresh,this),t.context.on(\"refreshPaused\",this.refreshPaused,this),this._media=t},e.prototype._internalStop=function(){this._source&&this._playing&&(this._source.onended=null,this._source.pause())},e.prototype.stop=function(){this._internalStop(),this._source&&this.emit(\"stop\")},Object.defineProperty(e.prototype,\"speed\",{get:function(){return this._speed},set:function(t){this._speed=t,this.refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,\"volume\",{get:function(){return this._volume},set:function(t){this._volume=t,this.refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,\"loop\",{get:function(){return this._loop},set:function(t){this._loop=t,this.refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,\"muted\",{get:function(){return this._muted},set:function(t){this._muted=t,this.refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,\"filters\",{get:function(){return null},set:function(t){},enumerable:!1,configurable:!0}),e.prototype.refresh=function(){var t=this._media.context,e=this._media.parent;this._source.loop=this._loop||e.loop;var n=t.volume*(t.muted?0:1),o=e.volume*(e.muted?0:1),i=this._volume*(this._muted?0:1);this._source.volume=i*n*o,this._source.playbackRate=this._speed*t.speed*e.speed},e.prototype.refreshPaused=function(){var t=this._media.context,e=this._media.parent,n=this._paused||e.paused||t.paused;n!==this._pausedReal&&(this._pausedReal=n,n?(this._internalStop(),this.emit(\"paused\")):(this.emit(\"resumed\"),this.play({start:this._source.currentTime,end:this._end,volume:this._volume,speed:this._speed,loop:this._loop})),this.emit(\"pause\",n))},e.prototype.play=function(t){var n=this,o=t.start,i=t.end,s=t.speed,u=t.loop,a=t.volume,c=t.muted;this._speed=s,this._volume=a,this._loop=!!u,this._muted=c,this.refresh(),this.loop&&null!==i&&(this.loop=!1),this._start=o,this._end=i||this._duration,this._start=Math.max(0,this._start-e.PADDING),this._end=Math.min(this._end+e.PADDING,this._duration),this._source.onloadedmetadata=function(){n._source&&(n._source.currentTime=o,n._source.onloadedmetadata=null,n.emit(\"progress\",o,n._duration),r.shared.add(n._onUpdate,n))},this._source.onended=this._onComplete.bind(this),this._source.play(),this.emit(\"start\")},e.prototype._onUpdate=function(){this.emit(\"progress\",this.progress,this._duration),this._source.currentTime>=this._end&&!this._source.loop&&this._onComplete()},e.prototype._onComplete=function(){r.shared.remove(this._onUpdate,this),this._internalStop(),this.emit(\"progress\",1,this._duration),this.emit(\"end\",this)},e.prototype.destroy=function(){r.shared.remove(this._onUpdate,this),this.removeAllListeners();var t=this._source;t&&(t.onended=null,t.onplay=null,t.onpause=null,this._internalStop()),this._source=null,this._speed=1,this._volume=1,this._loop=!1,this._end=null,this._start=0,this._duration=0,this._playing=!1,this._pausedReal=!1,this._paused=!1,this._muted=!1,this._media&&(this._media.context.off(\"refresh\",this.refresh,this),this._media.context.off(\"refreshPaused\",this.refreshPaused,this),this._media=null)},e.prototype.toString=function(){return\"[HTMLAudioInstance id=\".concat(this.id,\"]\")},e.PADDING=.1,e}(i),v=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return c(e,t),e.prototype.init=function(t){this.parent=t,this._source=t.options.source||new Audio,t.url&&(this._source.src=t.url)},e.prototype.create=function(){return new g(this)},Object.defineProperty(e.prototype,\"isPlayable\",{get:function(){return!!this._source&&4===this._source.readyState},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,\"duration\",{get:function(){return this._source.duration},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,\"context\",{get:function(){return this.parent.context},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,\"filters\",{get:function(){return null},set:function(t){},enumerable:!1,configurable:!0}),e.prototype.destroy=function(){this.removeAllListeners(),this.parent=null,this._source&&(this._source.src=\"\",this._source.load(),this._source=null)},Object.defineProperty(e.prototype,\"source\",{get:function(){return this._source},enumerable:!1,configurable:!0}),e.prototype.load=function(t){var e=this._source,n=this.parent;if(4!==e.readyState)if(n.url){e.src=n.url;var o=function(){s(),n.isLoaded=!0;var e=n.autoPlayStart();t&&t(null,n,e)},i=function(){s(),t&&t(new Error(\"Sound loading has been aborted\"))},r=function(){s();var n=\"Failed to load audio element (code: \".concat(e.error.code,\")\");t&&t(new Error(n))},s=function(){e.removeEventListener(\"canplaythrough\",o),e.removeEventListener(\"load\",o),e.removeEventListener(\"abort\",i),e.removeEventListener(\"error\",r)};e.addEventListener(\"canplaythrough\",o,!1),e.addEventListener(\"load\",o,!1),e.addEventListener(\"abort\",i,!1),e.addEventListener(\"error\",r,!1),e.load()}else t(new Error(\"sound.url or sound.source must be set\"));else{n.isLoaded=!0;var u=n.autoPlayStart();t&&setTimeout((function(){t(null,n,u)}),0)}},e}(i),P=function(){function t(t,e){this.parent=t,Object.assign(this,e),this.duration=this.end-this.start}return t.prototype.play=function(t){return this.parent.play({complete:t,speed:this.speed||this.parent.speed,end:this.end,start:this.start,loop:this.loop})},t.prototype.destroy=function(){this.parent=null},t}(),x=function(){function t(){}return t.setParamValue=function(t,e){if(t.setValueAtTime){var n=u().context;t.setValueAtTime(e,n.audioContext.currentTime)}else t.value=e;return e},t}(),O=0,j=function(t){function e(e){var n=t.call(this)||this;return n.id=O++,n._media=null,n._paused=!1,n._muted=!1,n._elapsed=0,n.init(e),n}return c(e,t),e.prototype.set=function(t,e){if(void 0===this[t])throw new Error(\"Property with name \".concat(t,\" does not exist.\"));switch(t){case\"speed\":this.speed=e;break;case\"volume\":this.volume=e;break;case\"muted\":this.muted=e;break;case\"loop\":this.loop=e;break;case\"paused\":this.paused=e}return this},e.prototype.stop=function(){this._source&&(this._internalStop(),this.emit(\"stop\"))},Object.defineProperty(e.prototype,\"speed\",{get:function(){return this._speed},set:function(t){this._speed=t,this.refresh(),this._update(!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,\"volume\",{get:function(){return this._volume},set:function(t){this._volume=t,this.refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,\"muted\",{get:function(){return this._muted},set:function(t){this._muted=t,this.refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,\"loop\",{get:function(){return this._loop},set:function(t){this._loop=t,this.refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,\"filters\",{get:function(){return this._filters},set:function(t){var e;this._filters&&(null===(e=this._filters)||void 0===e||e.filter((function(t){return t})).forEach((function(t){return t.disconnect()})),this._filters=null,this._source.connect(this._gain)),this._filters=(null==t?void 0:t.length)?t.slice(0):null,this.refresh()},enumerable:!1,configurable:!0}),e.prototype.refresh=function(){if(this._source){var t=this._media.context,e=this._media.parent;this._source.loop=this._loop||e.loop;var n=t.volume*(t.muted?0:1),o=e.volume*(e.muted?0:1),i=this._volume*(this._muted?0:1);x.setParamValue(this._gain.gain,i*o*n),x.setParamValue(this._source.playbackRate,this._speed*e.speed*t.speed),this.applyFilters()}},e.prototype.applyFilters=function(){var t;if(null===(t=this._filters)||void 0===t?void 0:t.length){this._source.disconnect();var e=this._source;this._filters.forEach((function(t){e.connect(t.destination),e=t})),e.connect(this._gain)}},e.prototype.refreshPaused=function(){var t=this._media.context,e=this._media.parent,n=this._paused||e.paused||t.paused;n!==this._pausedReal&&(this._pausedReal=n,n?(this._internalStop(),this.emit(\"paused\")):(this.emit(\"resumed\"),this.play({start:this._elapsed%this._duration,end:this._end,speed:this._speed,loop:this._loop,volume:this._volume})),this.emit(\"pause\",n))},e.prototype.play=function(t){var e=t.start,n=t.end,o=t.speed,i=t.loop,r=t.volume,s=t.muted,u=t.filters;this._paused=!1;var a=this._media.nodes.cloneBufferSource(),c=a.source,l=a.gain;this._source=c,this._gain=l,this._speed=o,this._volume=r,this._loop=!!i,this._muted=s,this._filters=u,this.refresh();var p=this._source.buffer.duration;this._duration=p,this._end=n,this._lastUpdate=this._now(),this._elapsed=e,this._source.onended=this._onComplete.bind(this),this._loop?(this._source.loopEnd=n,this._source.loopStart=e,this._source.start(0,e)):n?this._source.start(0,e,n-e):this._source.start(0,e),this.emit(\"start\"),this._update(!0),this.enableTicker(!0)},e.prototype.enableTicker=function(t){r.shared.remove(this._updateListener,this),t&&r.shared.add(this._updateListener,this)},Object.defineProperty(e.prototype,\"progress\",{get:function(){return this._progress},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,\"paused\",{get:function(){return this._paused},set:function(t){this._paused=t,this.refreshPaused()},enumerable:!1,configurable:!0}),e.prototype.destroy=function(){var t;this.removeAllListeners(),this._internalStop(),this._gain&&(this._gain.disconnect(),this._gain=null),this._media&&(this._media.context.events.off(\"refresh\",this.refresh,this),this._media.context.events.off(\"refreshPaused\",this.refreshPaused,this),this._media=null),null===(t=this._filters)||void 0===t||t.forEach((function(t){return t.disconnect()})),this._filters=null,this._end=null,this._speed=1,this._volume=1,this._loop=!1,this._elapsed=0,this._duration=0,this._paused=!1,this._muted=!1,this._pausedReal=!1},e.prototype.toString=function(){return\"[WebAudioInstance id=\".concat(this.id,\"]\")},e.prototype._now=function(){return this._media.context.audioContext.currentTime},e.prototype._updateListener=function(){this._update()},e.prototype._update=function(t){if(void 0===t&&(t=!1),this._source){var e=this._now(),n=e-this._lastUpdate;if(n>0||t){var o=this._source.playbackRate.value;this._elapsed+=n*o,this._lastUpdate=e;var i=this._duration,r=void 0;if(this._source.loopStart){var s=this._source.loopEnd-this._source.loopStart;r=(this._source.loopStart+this._elapsed%s)/i}else r=this._elapsed%i/i;this._progress=r,this.emit(\"progress\",this._progress,i)}}},e.prototype.init=function(t){this._media=t,t.context.events.on(\"refresh\",this.refresh,this),t.context.events.on(\"refreshPaused\",this.refreshPaused,this)},e.prototype._internalStop=function(){if(this._source){this.enableTicker(!1),this._source.onended=null,this._source.stop(0),this._source.disconnect();try{this._source.buffer=null}catch(t){}this._source=null}},e.prototype._onComplete=function(){if(this._source){this.enableTicker(!1),this._source.onended=null,this._source.disconnect();try{this._source.buffer=null}catch(t){}}this._source=null,this._progress=1,this.emit(\"progress\",1,this._duration),this.emit(\"end\",this)},e}(i),w=function(){function t(t,e){this._output=e,this._input=t}return Object.defineProperty(t.prototype,\"destination\",{get:function(){return this._input},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"filters\",{get:function(){return this._filters},set:function(t){var e=this;if(this._filters&&(this._filters.forEach((function(t){t&&t.disconnect()})),this._filters=null,this._input.connect(this._output)),t&&t.length){this._filters=t.slice(0),this._input.disconnect();var n=null;t.forEach((function(t){null===n?e._input.connect(t.destination):n.connect(t.destination),n=t})),n.connect(this._output)}},enumerable:!1,configurable:!0}),t.prototype.destroy=function(){this.filters=null,this._input=null,this._output=null},t}(),A=function(t){function e(e){var n=this,o=e.audioContext,i=o.createBufferSource(),r=o.createGain(),s=o.createAnalyser();return i.connect(s),s.connect(r),r.connect(e.destination),(n=t.call(this,s,r)||this).context=e,n.bufferSource=i,n.gain=r,n.analyser=s,n}return c(e,t),Object.defineProperty(e.prototype,\"script\",{get:function(){return this._script||(this._script=this.context.audioContext.createScriptProcessor(e.BUFFER_SIZE),this._script.connect(this.context.destination)),this._script},enumerable:!1,configurable:!0}),e.prototype.destroy=function(){t.prototype.destroy.call(this),this.bufferSource.disconnect(),this._script&&this._script.disconnect(),this.gain.disconnect(),this.analyser.disconnect(),this.bufferSource=null,this._script=null,this.gain=null,this.analyser=null,this.context=null},e.prototype.cloneBufferSource=function(){var t=this.bufferSource,e=this.context.audioContext.createBufferSource();e.buffer=t.buffer,x.setParamValue(e.playbackRate,t.playbackRate.value),e.loop=t.loop;var n=this.context.audioContext.createGain();return e.connect(n),n.connect(this.destination),{source:e,gain:n}},Object.defineProperty(e.prototype,\"bufferSize\",{get:function(){return this.script.bufferSize},enumerable:!1,configurable:!0}),e.BUFFER_SIZE=0,e}(w),F=function(){function t(){}return t.prototype.init=function(t){this.parent=t,this._nodes=new A(this.context),this._source=this._nodes.bufferSource,this.source=t.options.source},t.prototype.destroy=function(){this.parent=null,this._nodes.destroy(),this._nodes=null;try{this._source.buffer=null}catch(t){}this._source=null,this.source=null},t.prototype.create=function(){return new j(this)},Object.defineProperty(t.prototype,\"context\",{get:function(){return this.parent.context},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"isPlayable\",{get:function(){return!!this._source&&!!this._source.buffer},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"filters\",{get:function(){return this._nodes.filters},set:function(t){this._nodes.filters=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"duration\",{get:function(){return this._source.buffer.duration},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"buffer\",{get:function(){return this._source.buffer},set:function(t){this._source.buffer=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"nodes\",{get:function(){return this._nodes},enumerable:!1,configurable:!0}),t.prototype.load=function(t){this.source?this._decode(this.source,t):this.parent.url?this._loadUrl(t):t&&t(new Error(\"sound.url or sound.source must be set\"))},t.prototype._loadUrl=function(t){var e=this,n=new XMLHttpRequest,o=this.parent.url;n.open(\"GET\",o,!0),n.responseType=\"arraybuffer\",n.onload=function(){e.source=n.response,e._decode(n.response,t)},n.send()},t.prototype._decode=function(t,e){var n=this,o=function(t,o){if(t)e&&e(t);else{n.parent.isLoaded=!0,n.buffer=o;var i=n.parent.autoPlayStart();e&&e(null,n.parent,i)}};t instanceof AudioBuffer?o(null,t):this.parent.context.decode(t,o)},t}(),E=function(){function t(t,e){this.media=t,this.options=e,this._instances=[],this._sprites={},this.media.init(this);var n=e.complete;this._autoPlayOptions=n?{complete:n}:null,this.isLoaded=!1,this.isPlaying=!1,this.autoPlay=e.autoPlay,this.singleInstance=e.singleInstance,this.preload=e.preload||this.autoPlay,this.url=e.url,this.speed=e.speed,this.volume=e.volume,this.loop=e.loop,e.sprites&&this.addSprites(e.sprites),this.preload&&this._preload(e.loaded)}return t.from=function(e){var n={};return\"string\"==typeof e?n.url=e:e instanceof ArrayBuffer||e instanceof AudioBuffer||e instanceof HTMLAudioElement?n.source=e:n=e,(n=l({autoPlay:!1,singleInstance:!1,url:null,source:null,preload:!1,volume:1,speed:1,complete:null,loaded:null,loop:!1},n)).url&&(n.url=_(n.url)),Object.freeze(n),new t(u().useLegacy?new v:new F,n)},Object.defineProperty(t.prototype,\"context\",{get:function(){return u().context},enumerable:!1,configurable:!0}),t.prototype.pause=function(){return this.isPlaying=!1,this.paused=!0,this},t.prototype.resume=function(){return this.isPlaying=this._instances.length>0,this.paused=!1,this},Object.defineProperty(t.prototype,\"paused\",{get:function(){return this._paused},set:function(t){this._paused=t,this.refreshPaused()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"speed\",{get:function(){return this._speed},set:function(t){this._speed=t,this.refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"filters\",{get:function(){return this.media.filters},set:function(t){this.media.filters=t},enumerable:!1,configurable:!0}),t.prototype.addSprites=function(t,e){if(\"object\"==typeof t){var n={};for(var o in t)n[o]=this.addSprites(o,t[o]);return n}var i=new P(this,e);return this._sprites[t]=i,i},t.prototype.destroy=function(){this._removeInstances(),this.removeSprites(),this.media.destroy(),this.media=null,this._sprites=null,this._instances=null},t.prototype.removeSprites=function(t){if(t){var e=this._sprites[t];void 0!==e&&(e.destroy(),delete this._sprites[t])}else for(var n in this._sprites)this.removeSprites(n);return this},Object.defineProperty(t.prototype,\"isPlayable\",{get:function(){return this.isLoaded&&this.media&&this.media.isPlayable},enumerable:!1,configurable:!0}),t.prototype.stop=function(){if(!this.isPlayable)return this.autoPlay=!1,this._autoPlayOptions=null,this;this.isPlaying=!1;for(var t=this._instances.length-1;t>=0;t--)this._instances[t].stop();return this},t.prototype.play=function(t,e){var n,o=this;\"string\"==typeof t?n={sprite:r=t,loop:this.loop,complete:e}:\"function\"==typeof t?(n={}).complete=t:n=t;if((n=l({complete:null,loaded:null,sprite:null,end:null,start:0,volume:1,speed:1,muted:!1,loop:!1},n||{})).sprite){var i=n.sprite,r=this._sprites[i];n.start=r.start+(n.start||0),n.end=r.end,n.speed=r.speed||1,n.loop=r.loop||n.loop,delete n.sprite}if(n.offset&&(n.start=n.offset),!this.isLoaded)return new Promise((function(t,e){o.autoPlay=!0,o._autoPlayOptions=n,o._preload((function(o,i,r){o?e(o):(n.loaded&&n.loaded(o,i,r),t(r))}))}));(this.singleInstance||n.singleInstance)&&this._removeInstances();var s=this._createInstance();return this._instances.push(s),this.isPlaying=!0,s.once(\"end\",(function(){n.complete&&n.complete(o),o._onComplete(s)})),s.once(\"stop\",(function(){o._onComplete(s)})),s.play(n),s},t.prototype.refresh=function(){for(var t=this._instances.length,e=0;e<t;e++)this._instances[e].refresh()},t.prototype.refreshPaused=function(){for(var t=this._instances.length,e=0;e<t;e++)this._instances[e].refreshPaused()},Object.defineProperty(t.prototype,\"volume\",{get:function(){return this._volume},set:function(t){this._volume=t,this.refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"muted\",{get:function(){return this._muted},set:function(t){this._muted=t,this.refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"loop\",{get:function(){return this._loop},set:function(t){this._loop=t,this.refresh()},enumerable:!1,configurable:!0}),t.prototype._preload=function(t){this.media.load(t)},Object.defineProperty(t.prototype,\"instances\",{get:function(){return this._instances},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"sprites\",{get:function(){return this._sprites},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"duration\",{get:function(){return this.media.duration},enumerable:!1,configurable:!0}),t.prototype.autoPlayStart=function(){var t;return this.autoPlay&&(t=this.play(this._autoPlayOptions)),t},t.prototype._removeInstances=function(){for(var t=this._instances.length-1;t>=0;t--)this._poolInstance(this._instances[t]);this._instances.length=0},t.prototype._onComplete=function(t){if(this._instances){var e=this._instances.indexOf(t);e>-1&&this._instances.splice(e,1),this.isPlaying=this._instances.length>0}this._poolInstance(t)},t.prototype._createInstance=function(){if(t._pool.length>0){var e=t._pool.pop();return e.init(this.media),e}return this.media.create()},t.prototype._poolInstance=function(e){e.destroy(),t._pool.indexOf(e)<0&&t._pool.push(e)},t._pool=[],t}(),C=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.speed=1,e.muted=!1,e.volume=1,e.paused=!1,e}return c(e,t),e.prototype.refresh=function(){this.emit(\"refresh\")},e.prototype.refreshPaused=function(){this.emit(\"refreshPaused\")},Object.defineProperty(e.prototype,\"filters\",{get:function(){return null},set:function(t){},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,\"audioContext\",{get:function(){return null},enumerable:!1,configurable:!0}),e.prototype.toggleMute=function(){return this.muted=!this.muted,this.refresh(),this.muted},e.prototype.togglePause=function(){return this.paused=!this.paused,this.refreshPaused(),this.paused},e.prototype.destroy=function(){this.removeAllListeners()},e}(i),L=function(t){function e(){var n=t.call(this,null,null)||this;n.autoPause=!0;var o=window,r=new e.AudioContext,s=r.createDynamicsCompressor(),u=r.createAnalyser();return u.connect(s),s.connect(r.destination),n._input=u,n._output=r.destination,n._ctx=r,n._offlineCtx=new e.OfflineAudioContext(1,2,o.OfflineAudioContext?Math.max(8e3,Math.min(96e3,r.sampleRate)):44100),n.compressor=s,n.analyser=u,n.events=new i,n.volume=1,n.speed=1,n.muted=!1,n.paused=!1,n._locked=\"suspended\"===r.state&&(\"ontouchstart\"in globalThis||\"onclick\"in globalThis),n._locked&&(n._unlock(),n._unlock=n._unlock.bind(n),document.addEventListener(\"mousedown\",n._unlock,!0),document.addEventListener(\"touchstart\",n._unlock,!0),document.addEventListener(\"touchend\",n._unlock,!0)),n.onFocus=n.onFocus.bind(n),n.onBlur=n.onBlur.bind(n),globalThis.addEventListener(\"focus\",n.onFocus),globalThis.addEventListener(\"blur\",n.onBlur),n}return c(e,t),e.prototype.onFocus=function(){if(this.autoPause){var t=this._ctx.state;\"suspended\"!==t&&\"interrupted\"!==t&&this._locked||(this.paused=this._pausedOnBlur,this.refreshPaused())}},e.prototype.onBlur=function(){this.autoPause&&(this._locked||(this._pausedOnBlur=this._paused,this.paused=!0,this.refreshPaused()))},e.prototype._unlock=function(){this._locked&&(this.playEmptySound(),\"running\"===this._ctx.state&&(document.removeEventListener(\"mousedown\",this._unlock,!0),document.removeEventListener(\"touchend\",this._unlock,!0),document.removeEventListener(\"touchstart\",this._unlock,!0),this._locked=!1))},e.prototype.playEmptySound=function(){var t=this._ctx.createBufferSource();t.buffer=this._ctx.createBuffer(1,1,22050),t.connect(this._ctx.destination),t.start(0,0,0),\"suspended\"===t.context.state&&t.context.resume()},Object.defineProperty(e,\"AudioContext\",{get:function(){var t=window;return t.AudioContext||t.webkitAudioContext||null},enumerable:!1,configurable:!0}),Object.defineProperty(e,\"OfflineAudioContext\",{get:function(){var t=window;return t.OfflineAudioContext||t.webkitOfflineAudioContext||null},enumerable:!1,configurable:!0}),e.prototype.destroy=function(){t.prototype.destroy.call(this);var e=this._ctx;void 0!==e.close&&e.close(),globalThis.removeEventListener(\"focus\",this.onFocus),globalThis.removeEventListener(\"blur\",this.onBlur),this.events.removeAllListeners(),this.analyser.disconnect(),this.compressor.disconnect(),this.analyser=null,this.compressor=null,this.events=null,this._offlineCtx=null,this._ctx=null},Object.defineProperty(e.prototype,\"audioContext\",{get:function(){return this._ctx},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,\"offlineContext\",{get:function(){return this._offlineCtx},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,\"paused\",{get:function(){return this._paused},set:function(t){t&&\"running\"===this._ctx.state?this._ctx.suspend():t||\"suspended\"!==this._ctx.state||this._ctx.resume(),this._paused=t},enumerable:!1,configurable:!0}),e.prototype.refresh=function(){this.events.emit(\"refresh\")},e.prototype.refreshPaused=function(){this.events.emit(\"refreshPaused\")},e.prototype.toggleMute=function(){return this.muted=!this.muted,this.refresh(),this.muted},e.prototype.togglePause=function(){return this.paused=!this.paused,this.refreshPaused(),this._paused},e.prototype.decode=function(t,e){var n=function(t){e(new Error((null==t?void 0:t.message)||\"Unable to decode file\"))},o=this._offlineCtx.decodeAudioData(t,(function(t){e(null,t)}),n);o&&o.catch(n)},e}(w),S=function(){function t(){this.init()}return t.prototype.init=function(){return this.supported&&(this._webAudioContext=new L),this._htmlAudioContext=new C,this._sounds={},this.useLegacy=!this.supported,this},Object.defineProperty(t.prototype,\"context\",{get:function(){return this._context},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"filtersAll\",{get:function(){return this.useLegacy?[]:this._context.filters},set:function(t){this.useLegacy||(this._context.filters=t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"supported\",{get:function(){return null!==L.AudioContext},enumerable:!1,configurable:!0}),t.prototype.add=function(t,e){if(\"object\"==typeof t){var n={};for(var o in t){var i=this._getOptions(t[o],e);n[o]=this.add(o,i)}return n}if(e instanceof E)return this._sounds[t]=e,e;var r=this._getOptions(e),s=E.from(r);return this._sounds[t]=s,s},t.prototype._getOptions=function(t,e){var n;return n=\"string\"==typeof t?{url:t}:t instanceof ArrayBuffer||t instanceof AudioBuffer||t instanceof HTMLAudioElement?{source:t}:t,n=l(l({},n),e||{})},Object.defineProperty(t.prototype,\"useLegacy\",{get:function(){return this._useLegacy},set:function(t){m.setLegacy(t),this._useLegacy=t,this._context=!t&&this.supported?this._webAudioContext:this._htmlAudioContext},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"disableAutoPause\",{get:function(){return!this._webAudioContext.autoPause},set:function(t){this._webAudioContext.autoPause=!t},enumerable:!1,configurable:!0}),t.prototype.remove=function(t){return this.exists(t,!0),this._sounds[t].destroy(),delete this._sounds[t],this},Object.defineProperty(t.prototype,\"volumeAll\",{get:function(){return this._context.volume},set:function(t){this._context.volume=t,this._context.refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"speedAll\",{get:function(){return this._context.speed},set:function(t){this._context.speed=t,this._context.refresh()},enumerable:!1,configurable:!0}),t.prototype.togglePauseAll=function(){return this._context.togglePause()},t.prototype.pauseAll=function(){return this._context.paused=!0,this._context.refreshPaused(),this},t.prototype.resumeAll=function(){return this._context.paused=!1,this._context.refreshPaused(),this},t.prototype.toggleMuteAll=function(){return this._context.toggleMute()},t.prototype.muteAll=function(){return this._context.muted=!0,this._context.refresh(),this},t.prototype.unmuteAll=function(){return this._context.muted=!1,this._context.refresh(),this},t.prototype.removeAll=function(){for(var t in this._sounds)this._sounds[t].destroy(),delete this._sounds[t];return this},t.prototype.stopAll=function(){for(var t in this._sounds)this._sounds[t].stop();return this},t.prototype.exists=function(t,e){return void 0===e&&(e=!1),!!this._sounds[t]},t.prototype.find=function(t){return this.exists(t,!0),this._sounds[t]},t.prototype.play=function(t,e){return this.find(t).play(e)},t.prototype.stop=function(t){return this.find(t).stop()},t.prototype.pause=function(t){return this.find(t).pause()},t.prototype.resume=function(t){return this.find(t).resume()},t.prototype.volume=function(t,e){var n=this.find(t);return void 0!==e&&(n.volume=e),n.volume},t.prototype.speed=function(t,e){var n=this.find(t);return void 0!==e&&(n.speed=e),n.speed},t.prototype.duration=function(t){return this.find(t).duration},t.prototype.close=function(){return this.removeAll(),this._sounds=null,this._webAudioContext&&(this._webAudioContext.destroy(),this._webAudioContext=null),this._htmlAudioContext&&(this._htmlAudioContext.destroy(),this._htmlAudioContext=null),this._context=null,this},t}(),k={__proto__:null,HTMLAudioMedia:v,HTMLAudioInstance:g,HTMLAudioContext:C},M=function(){function t(t,e){this.init(t,e)}return t.prototype.init=function(t,e){this.destination=t,this.source=e||t},t.prototype.connect=function(t){this.source.connect(t)},t.prototype.disconnect=function(){this.source.disconnect()},t.prototype.destroy=function(){this.disconnect(),this.destination=null,this.source=null},t}(),T={__proto__:null,Filter:M,EqualizerFilter:function(t){function e(n,o,i,r,s,a,c,l,p,h){void 0===n&&(n=0),void 0===o&&(o=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===s&&(s=0),void 0===a&&(a=0),void 0===c&&(c=0),void 0===l&&(l=0),void 0===p&&(p=0),void 0===h&&(h=0);var f=this;if(!u().useLegacy){var d=[{f:e.F32,type:\"lowshelf\",gain:n},{f:e.F64,type:\"peaking\",gain:o},{f:e.F125,type:\"peaking\",gain:i},{f:e.F250,type:\"peaking\",gain:r},{f:e.F500,type:\"peaking\",gain:s},{f:e.F1K,type:\"peaking\",gain:a},{f:e.F2K,type:\"peaking\",gain:c},{f:e.F4K,type:\"peaking\",gain:l},{f:e.F8K,type:\"peaking\",gain:p},{f:e.F16K,type:\"highshelf\",gain:h}].map((function(t){var e=u().context.audioContext.createBiquadFilter();return e.type=t.type,x.setParamValue(e.Q,1),e.frequency.value=t.f,x.setParamValue(e.gain,t.gain),e}));(f=t.call(this,d[0],d[d.length-1])||this).bands=d,f.bandsMap={};for(var _=0;_<f.bands.length;_++){var y=f.bands[_];_>0&&f.bands[_-1].connect(y),f.bandsMap[y.frequency.value]=y}return f}f=t.call(this,null)||this}return c(e,t),e.prototype.setGain=function(t,e){if(void 0===e&&(e=0),!this.bandsMap[t])throw new Error(\"No band found for frequency \".concat(t));x.setParamValue(this.bandsMap[t].gain,e)},e.prototype.getGain=function(t){if(!this.bandsMap[t])throw new Error(\"No band found for frequency \".concat(t));return this.bandsMap[t].gain.value},Object.defineProperty(e.prototype,\"f32\",{get:function(){return this.getGain(e.F32)},set:function(t){this.setGain(e.F32,t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,\"f64\",{get:function(){return this.getGain(e.F64)},set:function(t){this.setGain(e.F64,t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,\"f125\",{get:function(){return this.getGain(e.F125)},set:function(t){this.setGain(e.F125,t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,\"f250\",{get:function(){return this.getGain(e.F250)},set:function(t){this.setGain(e.F250,t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,\"f500\",{get:function(){return this.getGain(e.F500)},set:function(t){this.setGain(e.F500,t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,\"f1k\",{get:function(){return this.getGain(e.F1K)},set:function(t){this.setGain(e.F1K,t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,\"f2k\",{get:function(){return this.getGain(e.F2K)},set:function(t){this.setGain(e.F2K,t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,\"f4k\",{get:function(){return this.getGain(e.F4K)},set:function(t){this.setGain(e.F4K,t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,\"f8k\",{get:function(){return this.getGain(e.F8K)},set:function(t){this.setGain(e.F8K,t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,\"f16k\",{get:function(){return this.getGain(e.F16K)},set:function(t){this.setGain(e.F16K,t)},enumerable:!1,configurable:!0}),e.prototype.reset=function(){this.bands.forEach((function(t){x.setParamValue(t.gain,0)}))},e.prototype.destroy=function(){this.bands.forEach((function(t){t.disconnect()})),this.bands=null,this.bandsMap=null},e.F32=32,e.F64=64,e.F125=125,e.F250=250,e.F500=500,e.F1K=1e3,e.F2K=2e3,e.F4K=4e3,e.F8K=8e3,e.F16K=16e3,e}(M),DistortionFilter:function(t){function e(e){void 0===e&&(e=0);var n=this;if(!u().useLegacy){var o=u().context.audioContext.createWaveShaper();return(n=t.call(this,o)||this)._distortion=o,n.amount=e,n}n=t.call(this,null)||this}return c(e,t),Object.defineProperty(e.prototype,\"amount\",{get:function(){return this._amount},set:function(t){this._amount=t;for(var e,n=1e3*t,o=44100,i=new Float32Array(o),r=Math.PI/180,s=0;s<o;++s)e=2*s/o-1,i[s]=(3+n)*e*20*r/(Math.PI+n*Math.abs(e));this._distortion.curve=i,this._distortion.oversample=\"4x\"},enumerable:!1,configurable:!0}),e.prototype.destroy=function(){this._distortion=null,t.prototype.destroy.call(this)},e}(M),StereoFilter:function(t){function e(e){void 0===e&&(e=0);var n=this;if(!u().useLegacy){var o,i,r,s=u().context.audioContext;return s.createStereoPanner?r=o=s.createStereoPanner():((i=s.createPanner()).panningModel=\"equalpower\",r=i),(n=t.call(this,r)||this)._stereo=o,n._panner=i,n.pan=e,n}n=t.call(this,null)||this}return c(e,t),Object.defineProperty(e.prototype,\"pan\",{get:function(){return this._pan},set:function(t){this._pan=t,this._stereo?x.setParamValue(this._stereo.pan,t):this._panner.setPosition(t,0,1-Math.abs(t))},enumerable:!1,configurable:!0}),e.prototype.destroy=function(){t.prototype.destroy.call(this),this._stereo=null,this._panner=null},e}(M),ReverbFilter:function(t){function e(e,n,o){void 0===e&&(e=3),void 0===n&&(n=2),void 0===o&&(o=!1);var i=this;if(!u().useLegacy)return(i=t.call(this,null)||this)._seconds=i._clamp(e,1,50),i._decay=i._clamp(n,0,100),i._reverse=o,i._rebuild(),i;i=t.call(this,null)||this}return c(e,t),e.prototype._clamp=function(t,e,n){return Math.min(n,Math.max(e,t))},Object.defineProperty(e.prototype,\"seconds\",{get:function(){return this._seconds},set:function(t){this._seconds=this._clamp(t,1,50),this._rebuild()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,\"decay\",{get:function(){return this._decay},set:function(t){this._decay=this._clamp(t,0,100),this._rebuild()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,\"reverse\",{get:function(){return this._reverse},set:function(t){this._reverse=t,this._rebuild()},enumerable:!1,configurable:!0}),e.prototype._rebuild=function(){for(var t,e=u().context.audioContext,n=e.sampleRate,o=n*this._seconds,i=e.createBuffer(2,o,n),r=i.getChannelData(0),s=i.getChannelData(1),a=0;a<o;a++)t=this._reverse?o-a:a,r[a]=(2*Math.random()-1)*Math.pow(1-t/o,this._decay),s[a]=(2*Math.random()-1)*Math.pow(1-t/o,this._decay);var c=u().context.audioContext.createConvolver();c.buffer=i,this.init(c)},e}(M),MonoFilter:function(t){function e(){var e=this;if(!u().useLegacy){var n=u().context.audioContext,o=n.createChannelSplitter(),i=n.createChannelMerger();return i.connect(o),(e=t.call(this,i,o)||this)._merger=i,e}e=t.call(this,null)||this}return c(e,t),e.prototype.destroy=function(){this._merger.disconnect(),this._merger=null,t.prototype.destroy.call(this)},e}(M),StreamFilter:function(t){function e(){var e=this;if(!u().useLegacy){var n=u().context.audioContext,o=n.createMediaStreamDestination(),i=n.createMediaStreamSource(o.stream);return(e=t.call(this,o,i)||this)._stream=o.stream,e}e=t.call(this,null)||this}return c(e,t),Object.defineProperty(e.prototype,\"stream\",{get:function(){return this._stream},enumerable:!1,configurable:!0}),e.prototype.destroy=function(){this._stream=null,t.prototype.destroy.call(this)},e}(M),TelephoneFilter:function(t){function e(){if(!u().useLegacy){var e=u().context.audioContext,n=e.createBiquadFilter(),o=e.createBiquadFilter(),i=e.createBiquadFilter(),r=e.createBiquadFilter();return n.type=\"lowpass\",x.setParamValue(n.frequency,2e3),o.type=\"lowpass\",x.setParamValue(o.frequency,2e3),i.type=\"highpass\",x.setParamValue(i.frequency,500),r.type=\"highpass\",x.setParamValue(r.frequency,500),n.connect(o),o.connect(i),i.connect(r),t.call(this,n,r)||this}t.call(this,null)}return c(e,t),e}(M)},B={__proto__:null,WebAudioMedia:F,WebAudioInstance:j,WebAudioNodes:A,WebAudioContext:L,WebAudioUtils:x},G=0;var I={__proto__:null,playOnce:function(t,e){var n=\"alias\".concat(G++);return u().add(n,{url:t,preload:!0,autoPlay:!0,loaded:function(t){t&&(u().remove(n),e&&e(t))},complete:function(){u().remove(n),e&&e(null)}}),n},get PLAY_ID(){return G},render:function(t,e){var n=document.createElement(\"canvas\");e=l({width:512,height:128,fill:\"black\"},e||{}),n.width=e.width,n.height=e.height;var i=o.from(n);if(!(t.media instanceof F))return i;var r=t.media,s=n.getContext(\"2d\");s.fillStyle=e.fill;for(var u=r.buffer.getChannelData(0),a=Math.ceil(u.length/e.width),c=e.height/2,p=0;p<e.width;p++){for(var h=1,f=-1,d=0;d<a;d++){var _=u[p*a+d];_<h&&(h=_),_>f&&(f=_)}s.fillRect(p,(1+h)*c,1,Math.max(1,(f-h)*c))}return i},resolveUrl:_,sineTone:function(t,e){void 0===t&&(t=200),void 0===e&&(e=1);var n=E.from({singleInstance:!0});if(!(n.media instanceof F))return n;for(var o=n.media,i=n.context.audioContext.createBuffer(1,48e3*e,48e3),r=i.getChannelData(0),s=0;s<r.length;s++){var u=t*(s/i.sampleRate)*Math.PI;r[s]=2*Math.sin(u)}return o.buffer=i,n.isLoaded=!0,n},validateFormats:f,supported:h,extensions:p},R=function(t){return s=t,t}(new S);\"extensions\"in n?n.extensions.add(m):e.registerPlugin(m);export{M as Filter,w as Filterable,E as Sound,S as SoundLibrary,m as SoundLoader,P as SoundSprite,T as filters,k as htmlaudio,R as sound,I as utils,B as webaudio};\n//# sourceMappingURL=pixi-sound.esm.mjs.map\n","/* ***** BEGIN LICENSE BLOCK *****\n\tCopyright (c) 2023-2025 Famibee (famibee.blog38.fc2.com)\n\n\tThis software is released under the MIT License.\n\thttp://opensource.org/licenses/mit-license.php\n** ***** END LICENSE BLOCK ***** */\n\nimport {type IEvtMng, argChk_Boolean, argChk_Num} from './CmnLib';\nimport type {IVariable, IMain} from './CmnInterface';\nimport {SEARCH_PATH_ARG_EXT} from './ConfigBase';\nimport type {Config} from './Config';\nimport type {SysBase} from './SysBase';\nimport type {HArg} from './Grammar';\nimport {CmnTween} from './CmnTween';\nimport {Reading} from './Reading';\n\nimport {Loader, LoaderResource} from 'pixi.js';\nimport {sound, Sound, Options, filters} from '@pixi/sound';\nimport {Tween, remove} from '@tweenjs/tween.js'\n\nclass SndInf {\n\tstatic\t #vol_mul_talking = 1;\n\n\tstt\t\t: ISndState;\n\tloop\t: boolean \t= false;\n\n\treadonly\t#proc_id;\n\tget procID() {return this.#proc_id}\n\n\tconstructor(\n\t\t\treadonly\tfn\t\t: string,\n\t\t\treadonly\tbuf\t\t: string,\n\t\t\treadonly\tstart_ms: number,\n\t\t\treadonly\tend_ms\t: number,\n\t\t\treadonly\tret_ms\t: number,\n\tprivate\treadonly\tvolume\t: number,\n\t\t\treadonly\tpan\t\t: number,\n\t\t\treadonly\tsnd\t\t: Sound,\n\t) {\n\t\tthis.stt = snd ?new SsPlaying(this) :new SsLoading;\n\t\tthis.#proc_id = Reading.procID;\n\t\tif (snd) this.addSnd(snd);\n\t}\n\taddSnd(snd: Sound) {\n\t\tthis.loop = snd.loop;\n\t//\tif (! this.loop) sound.add(this.fn, snd);\t// 手動キャッシュすると単発連打で無音に\n\n\t\tthis.stt.onLoad(this);\n\t\tif (this.pan !== 0) snd.filters = [new filters.StereoFilter(this.pan)];\n\n\t\tthis.setVol = vol=> snd.volume = vol;\n\t\tthis.tw = ()=> new Tween(snd);\n\t\tthis.onPlayEnd = ()=> {this.stt.onPlayEnd(this.buf); this.#onStop()};\n\t\tthis.stop = ()=> {snd.stop(); this.#onStop()};\n\t\tthis.destroy = ()=> snd.destroy();\n\n\t\tswitch (this.buf) {\t\t// セリフ再生中はBGM音量を絞る\n\t\t\tcase BUF_VOICE:\n\t\t\t\tconst v = Number(val.getVal('sys:sn.sound.BGM.vol_mul_talking') ?? 1);\t\t// 歴史的経緯で ??\n\t\t\t\tif (v === 1) break;\n\n\t\t\t\tSndInf.#vol_mul_talking = v;\n\t\t\t\tconst b = hSndBuf[BUF_BGM];\n\t\t\t\tif (b) b.setVol(this.volume * SndInf.#vol_mul_talking);\n\t\t\t\tbreak;\n\n\t\t\tcase BUF_BGM:\n\t\t\t\tsnd.volume = this.volume * SndInf.#vol_mul_talking;\n\t\t\t\tbreak;\n\t\t}\n\t}\n\t\t#onStop = ()=> {\n\t\t\tthis.#onStop = ()=> {};\n\t\t\tif (SndInf.#vol_mul_talking === 1 || this.buf !== BUF_VOICE) return;\n\n\t\t\t// ボリュームを戻す\n\t\t\tSndInf.#vol_mul_talking = 1;\n\t\t\tconst b = hSndBuf[BUF_BGM];\n\t\t\tif (b) b.setVol(this.volume * SndInf.#vol_mul_talking);\n\t\t}\n\n\tsetVol(_vol: number) {}\n\ttw(): Tween<Sound> | undefined {return undefined}\n\tonPlayEnd() {}\n\tstop() {}\n\tdestroy() {}\n}\n\n\nlet cfg\t: Config;\nlet val\t: IVariable;\nlet main: IMain;\nlet sys\t: SysBase;\nlet hSndBuf\t: HSndBuf;\n\nlet evtMng\t: IEvtMng;\n\nexport interface HSndBuf {[buf: string]: SndBuf}\nexport\tconst\tBUF_BGM\t\t= 'BGM';\nexport\tconst\tBUF_SE\t\t= 'SE';\n\t\tconst\tBUF_VOICE\t= 'VOICE';\n\n\nexport class SndBuf {\n\tstatic\t#hLP\t: {[buf: string]: string}\t= {};\n\tstatic\tinit($cfg: Config, $val: IVariable, $main: IMain, $sys: SysBase, $hSndBuf: HSndBuf) {\n\t\tSndBuf.#hLP = {};\n\t\tcfg\t= $cfg;\n\t\tval\t= $val;\n\t\tmain= $main;\n\t\tsys\t= $sys;\n\t\thSndBuf\t= $hSndBuf;\n\t}\n\tstatic\tsetEvtMng($evtMng: IEvtMng) {evtMng = $evtMng}\n\tstatic\tdelLoopPlay(buf: string): void {\n\t\tdelete SndBuf.#hLP[buf];\n\t\tconst vn = 'const.sn.sound.'+ buf +'.';\n\t\tval.setVal_Nochk('save', vn +'fn', '');\n\t\tval.setVal_Nochk('save', 'const.sn.loopPlaying', JSON.stringify(SndBuf.#hLP));\n\t\tval.flush();\n\t}\n\tstatic\tgetVol(hArg: HArg, def: number): number {\n\t\tconst vol = argChk_Num(hArg, 'volume', def);\n\t\tif (vol < 0) return 0;\n\t\tif (vol > 1) return 1;\n\t\treturn vol;\n\t}\n\tstatic\txchgbuf({buf: buf1 = BUF_SE, buf2 = BUF_SE}: HArg) {\n\t\tif (buf1 === buf2) throw `[xchgbuf] buf:${buf1} が同じ値です`;\n\n\t\tconst n1 = 'const.sn.sound.'+ buf1 +'.';\n\t\tconst v1 = Number(val.getVal('save:'+ n1 +'volume'));\n\t\tconst f1 = String(val.getVal('save:'+ n1 +'fn'));\n\t\tconst n2 = 'const.sn.sound.'+ buf2 +'.';\n\t\tconst v2 = Number(val.getVal('save:'+ n2 +'volume'));\n\t\tconst f2 = String(val.getVal('save:'+ n2 +'fn'));\n\t\tval.setVal_Nochk('save', n1 +'volume', v2);\n\t\tval.setVal_Nochk('save', n2 +'volume', v1);\n\t\tval.setVal_Nochk('save', n1 +'fn', f2);\n\t\tval.setVal_Nochk('save', n2 +'fn', f1);\n\n\t\tif (buf1 in SndBuf.#hLP !== buf2 in SndBuf.#hLP) {\t// 演算子の優先順位確認済\n\t\t\tif (buf1 in SndBuf.#hLP)\n\t\t\t\t\t{delete SndBuf.#hLP[buf1]; SndBuf.#hLP[buf2] = f1}\n\t\t\telse\t{delete SndBuf.#hLP[buf2]; SndBuf.#hLP[buf1] = f2}\n\t\t\tval.setVal_Nochk('save', 'const.sn.loopPlaying', JSON.stringify(SndBuf.#hLP));\n\t\t}\n\t\tval.flush();\n\t}\n\n\n\tstatic\treadonly\t#MAX_END_MS\t= 999000;\n\n\n\treadonly #si\t\t: SndInf;\n\treadonly needLoad;\n\n\n\tconstructor(\n\t\treadonly hArg\t: HArg,\n\t\treadonly buf\t: string,\n\t\treadonly fn\t\t: string,\n\t) {\n\t\tconst start_ms = argChk_Num(hArg, 'start_ms', 0);\n\t\tconst end_ms = argChk_Num(hArg, 'end_ms', SndBuf.#MAX_END_MS);\n\t\tconst ret_ms = argChk_Num(hArg, 'ret_ms', 0);\n\t\tconst pan = argChk_Num(hArg, 'pan', 0);\n\t\tconst speed = argChk_Num(hArg, 'speed', 1);\n\n\t\tif (start_ms < 0) throw `[playse] start_ms:${start_ms} が負の値です`;\n\t\tif (ret_ms < 0) throw `[playse] ret_ms:${ret_ms} が負の値です`;\n\t\tif (0 < end_ms) {\n\t\t\tif (end_ms <= start_ms) throw `[playse] start_ms:${start_ms} >= end_ms:${end_ms} は異常値です`;\n\t\t\tif (end_ms <= ret_ms) throw `[playse] ret_ms:${ret_ms} >= end_ms:${end_ms} は異常値です`;\n\t\t}\n\n\t\t// この辺で属性を増減したら、loadFromSaveObj()にも反映する\n\t\tconst vn = 'const.sn.sound.'+ buf +'.';\n\t\tval.setVal_Nochk('save', vn +'fn', fn);\n\t\tconst savevol = SndBuf.getVol(hArg, 1);\n\t\tval.setVal_Nochk('save', vn +'volume', savevol);// 目標音量（save:）\n\t\tconst volume = savevol * Number(val.getVal('sys:'+ vn +'volume', 1));\n\n\t\tconst loop = argChk_Boolean(hArg, 'loop', false);\n\t\tif (loop) {\n\t\t\tSndBuf.#hLP[buf] = fn;\n\t\t\tval.setVal_Nochk('save', 'const.sn.loopPlaying', JSON.stringify(SndBuf.#hLP));\n\t\t}\n\t\telse SndBuf.delLoopPlay(buf);\n\t\tval.setVal_Nochk('save', vn +'start_ms', start_ms);\n\t\tval.setVal_Nochk('save', vn +'end_ms', end_ms);\n\t\tval.setVal_Nochk('save', vn +'ret_ms', ret_ms);\n\t\tval.setVal_Nochk('tmp', vn +'playing', true);\n\t\tval.flush();\n\n\t\tconst snd = sound.find(fn);\t// キャッシュにあるか\n\t\tthis.#si = new SndInf(\n\t\t\tfn,\n\t\t\tbuf,\n\t\t\tstart_ms,\n\t\t\tend_ms,\n\t\t\tret_ms,\n\t\t\tvolume,\n\t\t\tpan,\n\t\t\tsnd,\n\t\t);\n\t\t// @pixi/sound用基本パラメータ\n\t\tconst o: Options = {\n\t\t\tloop,\n\t\t\tspeed,\n\t\t\tvolume,\n\t\t\tloaded\t: (e, s2)=> {\n\t\t\t\tif (this.#si.stt.isDestroy) return;\n\t\t\t\tif (e) {main.errScript(`ロード失敗です SndBuf fn:${fn} ${e}`, false); return}\n\t\t\t\tif (! s2) return;\n\n\t\t\t\tthis.#si.addSnd(s2);\n\t\t\t\tif (pan !== 0) s2.filters = [new filters.StereoFilter(pan)];\n\t\t\t//\tif (! o.loop) sound.add(fn, snd);\t// 手動キャッシュすると単発連打で無音に\n\t\t\t\thArg.fnc?.();\n\t\t\t},\n\t\t};\n\n\t\t// start_ms・end_ms機能→@pixi/sound準備\n\t\tlet sp_nm = '';\n\t\tif (0 < start_ms || end_ms < SndBuf.#MAX_END_MS) {\n\t\t\tsp_nm = `${fn};${start_ms};${end_ms};${ret_ms}`;\n\t\t\tconst os = (o.sprites ??= {})[sp_nm] = {\n\t\t\t\tstart\t: start_ms /1000,\n\t\t\t\tend\t\t: end_ms /1000,\n\t\t\t};\n\t\t\to.preload = true;\t\t// loaded発生用、トラブルの元なので使用を控えたい\n\t\t\tconst old = o.loaded!;\n\t\t\to.loaded = (e, s0)=> {\n\t\t\t\tif (this.#si.stt.isDestroy) return;\n\n\t\t\t\told(e, s0);\n\t\t\t\tconst s2 = s0!;\n\t\t\t\tconst d = s2.duration;\n\t\t\t\tif (os.end < 0) {\t// 負の値は末尾から\n\t\t\t\t\tos.end += d;\n\t\t\t\t\ts2.removeSprites(sp_nm);\n\t\t\t\t\ts2.addSprites(sp_nm, os);\n\t\t\t\t}\n\t\t\t\tif (os.end <= os.start) main.errScript(`[playse] end_ms:${end_ms}(${os.end *1000}) >= start_ms:${start_ms} は異常値です`);\n\t\t\t\tif (os.end *1000 <= ret_ms) main.errScript(`[playse] end_ms:${end_ms}(${os.end *1000}) <= ret_ms:${ret_ms} は異常値です`);\n\t\t\t\tif (d <= os.start) main.errScript(`[playse] 音声ファイル再生時間:${d *1000} <= start_ms:${start_ms} は異常値です`);\n\t\t\t\tif (end_ms !== SndBuf.#MAX_END_MS && d <= os.end) main.errScript(`[playse] 音声ファイル再生時間:${d *1000} <= end_ms:${end_ms} は異常値です`);\n\n\t\t\t\ts2.play(sp_nm, snd=> o.complete?.(snd));\n\t\t\t\t\t// 流れ的にはすぐ下の「ループなし/あり」を呼ぶ\n\t\t\t};\n\t\t}\n\t\telse o.autoPlay = true;\n\n\t\t// ループなし ... 再生完了イベント\n\t\tif (! loop) o.complete = ()=> {\n\t\t\tstop2var(this.#si, buf);\n\t\t\tthis.#si.onPlayEnd();\n\t\t};\n\t\t// ループあり ... ret_ms処理\n\t\telse if (ret_ms !== 0) {\n\t\t\to.loop = false;\t// 一周目はループなしとする\n\t\t\to.complete = async snd=> {\n\t\t\t\tconst d = snd.duration;\n\t\t\t\tconst start\t= ret_ms /1000;\n\t\t\t\tconst end\t= end_ms /1000;\n\t\t\t\tif (d <= start) main.errScript(`[playse] 音声ファイル再生時間:${d *1000} <=  ret_ms:${ret_ms} は異常値です`);\n\n\t\t\t\tawait snd.play({\t// 一周目はループなし、なのでキャッシュされてる\n\t\t\t\t\t...o,\n\t\t\t\t\tstart,\n\t\t\t\t\tend\t\t: (end < 0) ?end +d :end,// 負の値は末尾から\n\t\t\t\t//\tspeed,\t\t// 重複\n\t\t\t\t\tloop\t: true,\n\t\t\t\t//\tvolume,\t\t// 重複\n\t\t\t\t//-\tmuted?: boolean;\n\t\t\t\t\tfilters\t: pan !== 0 ?[new filters.StereoFilter(pan)] :[],\n\t\t\t\t//-\tcomplete?: CompleteCallback;\n\t\t\t\t//-\tloaded?: LoadedCallback;\n\t\t\t\t//-\tsingleInstance?: boolean;\n\t\t\t\t});\n\t\t\t\t//不要 this.#sb.snd = snd;\t// this.#sb.snd === snd (true)\n\t\t\t};\n\t\t}\n\n\t\tthis.#initVol();\n\t\tif (snd) {\n\t\t\tsnd.volume = volume;\t// 再生のたびに音量を戻す\n\t\t\tif (sp_nm) {\n\t\t\t\tthis.#playseSub(fn, o);\n\t\t\t\tif (pan !== 0) snd.filters = [new filters.StereoFilter(pan)];\n\t\t\t}\n\t\t\telse if (snd.isPlayable) {\n\t\t\t\tconst ab = snd.options.source;\n\t\t\t\tif (! (ab instanceof ArrayBuffer) || ab.byteLength === 0) {\n\t\t\t\t\tsnd.play(o);\n\t\t\t\t\tif (pan !== 0) snd.filters = [new filters.StereoFilter(pan)];\n\t\t\t\t}\n\t\t\t\telse this.#si.addSnd(Sound.from({\n\t\t\t\t\t...o,\n\t\t\t\t\turl\t\t: snd.options.url,\n\t\t\t\t\tsource\t: ab,\n\t\t\t\t}));\n\t\t\t}\n\t\t\tthis.needLoad = false;\n\t\t\treturn;\n\t\t}\n\n\t\tconst join = this.needLoad = argChk_Boolean(hArg, 'join', true);\n\t\tif (join) {\n\t\t\tconst RPN_LOADED = this.#si.procID +`loaded buf:${buf} fn:${fn}`;\n\t\t\tReading.beginProc(RPN_LOADED);\n\t\t\tconst old = o.loaded!;\n\t\t\to.loaded = (e, s2)=> {\n\t\t\t\told(e, s2);\n\t\t\t\tReading.endProc(RPN_LOADED);\n\t\t\t};\n\t\t}\n\t\tthis.#playseSub(fn, o);\n\t}\n\t#initVol = ()=> {\n\t\tsound.volumeAll = Number(val.getVal('sys:sn.sound.global_volume', 1));\n\t\tthis.#initVol = ()=> {};\n\t};\n\t#playseSub(fn: string, o: Options) {\n\t\tconst src = cfg.searchPath(fn, SEARCH_PATH_ARG_EXT.SOUND);\n\t\tif (! src.endsWith('.bin')) {o.url = src; Sound.from(o); return}\n\n\t\t(new Loader).add({name: fn, url: src, xhrType: LoaderResource.XHR_RESPONSE_TYPE.BUFFER,})\n\t\t.use(async (res, next)=> {\n\t\t\ttry {\n\t\t\t\tres.data = await sys.decAB(res.data);\n\t\t\t} catch (e) {\n\t\t\t\tmain.errScript(`Sound ロード失敗ですc fn:${res.name} ${e}`, false);\n\t\t\t}\n\t\t\tnext();\n\t\t})\n\t\t.load((_ldr, hRes)=> {\t// このあと o.loaded() もコールされる\n\t\t\to.source = hRes[fn]?.data;\n\t\t\tSound.from(o);\n\t\t});\n\t}\n\n\n\tsetVol(vol: number) {this.#si.setVol(vol)}\n\n\tws =(hArg: HArg)=> this.#si.stt.ws(this.#si, hArg);\n\tstopse({buf = BUF_SE}: HArg) {\n\t\tstop2var(this.#si, buf);\n\t\tthis.#si.stt.stopse(this.#si);\n\t}\n\n\tfade =(hArg: HArg)=> this.#si.stt.fade(this.#si, hArg);\n\twf =(hArg: HArg)=> this.#si.stt.wf(this.#si, hArg);\n\tstopfadese =(hArg: HArg)=> this.#si.stt.stopfadese(this.#si, hArg);\n\n}\n\n\n// =================================================\nfunction stop2var({loop}: SndInf, buf: string) {\n\tif (loop) {SndBuf.delLoopPlay(buf); return}\n\n\tconst vn = 'const.sn.sound.'+ buf +'.';\n\tval.setVal_Nochk('tmp', vn +'playing', false);\n\tval.flush();\n}\n\n// =================================================\n\n\ninterface ISndState {\n\tonLoad(si: SndInf)\t: void;\n\tstopse(si: SndInf)\t: void;\n\tws(si: SndInf, hArg: HArg): boolean;\n\tonPlayEnd(buf: string)\t: void;\n\tfade(si: SndInf, hArg: HArg): void;\n\twf(si: SndInf, hArg: HArg): boolean;\n\tcompFade(buf: string)\t: void;\n\tstopfadese(si: SndInf, hArg: HArg): void;\n\tisDestroy\t: boolean;\n}\n\nclass SsLoading implements ISndState {\n\tonLoad(si: SndInf)\t{si.stt = new SsPlaying(si)}\n\tstopse(si: SndInf)\t{si.stt = new SsStop(si, false)}\n\tws =()=> false;\n\tonPlayEnd() {}\t\t// ok\n\tfade() {}\t\t\t// ok\n\twf =()=> false;\t\t// ok\n\tcompFade() {}\t\t// ok\n\tstopfadese() {}\t\t// ok\n\treadonly\tisDestroy\t= false;\n}\n\nclass SsPlaying implements ISndState {\n\tconstructor(readonly si: SndInf) {}\n\tonLoad() {}\t\t\t// ok\n\tstopse(si: SndInf)\t{si.stt = new SsStop(si)}\n\tws(si: SndInf, hArg: HArg) {\n\t\tif (si.loop) return false;\n\n\t\tsi.stt = new SsWaitingStop(si);\n\t\tconst canskip = argChk_Boolean(hArg, 'canskip', false);\n\t\tconst stop = argChk_Boolean(hArg, 'stop', true);\n\t\tif (canskip && evtMng.isSkipping) {\n\t\t\tif (stop) si.stt.stopse(si); else si.stt.onPlayEnd = ()=> {};\n\t\t\treturn false;\n\t\t}\n\n\t\tconst {buf = BUF_SE} = hArg;\n\t\tconst fin = ()=> {\n\t\t\tstop2var(si, buf);\n\t\t\tsi.onPlayEnd();\t// まず一回やる\n\t\t\tif (stop) si.stt.stopse(si); else si.stt.onPlayEnd = ()=> {};\n\t\t\t\t// else後は SsWaitingStop か SsStop の想定\n\t\t};\n\t\tReading.beginProc(si.procID +'ws', fin, true, canskip ?fin :undefined);\n\t\treturn true;\n\t}\n\tonPlayEnd() {}\t\t// ok\n\tfade(si: SndInf, hArg: HArg) {\n\t\tconst {buf = BUF_SE} = hArg;\n\n\t\tconst vn = 'const.sn.sound.'+ buf +'.';\n\t\tconst bnV = vn +'volume';\n\t\tconst savevol = SndBuf.getVol(hArg, NaN);\n\t\tval.setVal_Nochk('save', bnV, savevol);\t// 目標音量（save:）\n\t\tconst vol = savevol * Number(val.getVal('sys:'+ bnV, 1))\n\t\tconst stop = argChk_Boolean(hArg, 'stop', (savevol === 0));\n\t\t\t// this.getVol() により savevol = hArg.volume\n\t\tif (stop) SndBuf.delLoopPlay(buf);\t// fade中reloadなど、できるだけ早く情報更新か\n\t\tval.flush();\n\n\t\tconst time = argChk_Num(hArg, 'time', NaN);\n\t\tconst delay = argChk_Num(hArg, 'delay', 0);\n\t\tif ((time === 0 && delay === 0) || evtMng.isSkipping) {\n\t\t\tsi.setVol(vol);\n\t\t\tsi.stt = stop ? new SsStop(si) : new SsPlaying(si);\n\t\t\treturn;\n\t\t}\n\n//console.log('fadese start from:%f to:%f', sb.snd.volume, vol);\n\t\tconst tw = si.tw();\n\t\tif (! tw) return;\n\t\tCmnTween.setTwProp(tw, hArg)\n\t\t.to({volume: vol}, time)\n\t\t.onComplete(()=> {\n\t\t\tremove(tw);\n\t\t\tsi.stt.compFade(buf);\n\t\t\tsi.stt = stop ? new SsStop(si) : new SsPlaying(si);\n\t\t})\n\t\t.start();\n\n\t\tsi.stt = new SsFade(tw, si);\n\t}\n\twf =()=> false;\t\t// ok\n\tcompFade() {}\t\t// ok\n\tstopfadese() {}\t\t// ok\n\treadonly\tisDestroy\t= false;\n}\n\nclass SsWaitingStop implements ISndState {\n\tconstructor(readonly si: SndInf) {}\n\tonLoad() {}\t\t\t// ok\n\tstopse(si: SndInf)\t{si.stt = new SsStop(si)}\n\tws =()=> false;\t\t// ok\n\tonPlayEnd()\t{Reading.notifyEndProc(this.si.procID +'ws')}\n\tfade() {}\t\t\t// ok\n\twf =()=> false;\t\t// ok\n\tcompFade() {}\t\t// ok\n\tstopfadese() {}\t\t// ok\n\treadonly\tisDestroy\t= false;\n}\n\nclass SsFade implements ISndState {\n\tconstructor(readonly tw: Tween<Sound>, private readonly si: SndInf) {}\n\tonLoad() {}\t\t\t// ok\n\tstopse(si: SndInf)\t{this.stopfadese(); si.stt = new SsStop(si)}\t// 順番厳守\n\tws =()=> false;\t\t// ok ?\n\tonPlayEnd() {}\t\t// ok\n\tfade() {}\t\t\t// ok\n\twf(si: SndInf, hArg: HArg) {\n\t\tsi.stt = new SsWaitingFade(si);\n\t\tconst canskip = argChk_Boolean(hArg, 'canskip', false);\n\t\tif (canskip && evtMng.isSkipping) {this.stopfadese(); return false}\n\n\t\tconst fin = ()=> this.stopfadese();\n\t\tReading.beginProc(si.procID +'wf', fin, true, canskip ?fin :undefined);\n\t\treturn true;\n\t}\n\tcompFade() {}\t\t// ok\n\tstopfadese =()=> this.si.stop();\n\treadonly\tisDestroy\t= false;\n}\n\nclass SsWaitingFade implements ISndState {\n\tconstructor(private readonly si: SndInf) {}\n\tonLoad() {}\t\t\t// ok\n\tstopse(si: SndInf)\t{this.stopfadese(); si.stt = new SsStop(si)}\n\tws =()=> false;\t\t// ok\n\tonPlayEnd() {}\t\t// ok\n\tfade() {}\t\t\t// ok\n\twf =()=> false;\t\t// ok\n\tcompFade() {Reading.notifyEndProc(this.si.procID +'wf')}\n\tstopfadese =()=> this.si.stop();\n\treadonly\tisDestroy\t= false;\n}\n\nclass SsStop implements ISndState {\n\tconstructor(readonly si: SndInf, readonly stop = true) {\n\t\tif (! stop) return;\n\n\t\tsi.stop();\n\t\tif (! si.loop) return;\t// destroy がないと再生が残るケースが。効果音だと破棄が激しいのでループモノ(BGM)だけにする\n\n\t\tsi.destroy();\n\t\tsi.destroy = ()=> {};\t// 再度コール時エラー対策\n\t}\n\tonLoad() {}\t\t\t// ok\n\tstopse() {}\t\t\t// ok\n\tws =()=> false;\t\t// ok\n\tonPlayEnd() {}\t\t// ok\n\tfade() {}\t\t\t// ok\n\twf =()=> false;\t\t// ok\n\tcompFade() {}\t\t// ok\n\tstopfadese() {}\t\t// ok\n\treadonly\tisDestroy\t= true;\n}\n","/* ***** BEGIN LICENSE BLOCK *****\n\tCopyright (c) 2018-2025 Famibee (famibee.blog38.fc2.com)\n\n\tThis software is released under the MIT License.\n\thttp://opensource.org/licenses/mit-license.php\n** ***** END LICENSE BLOCK ***** */\n\nimport {argChk_Boolean, getFn, CmnLib, argChk_Num} from './CmnLib';\nimport type {IHTag, HArg, Script, ITag} from './Grammar';\nimport type {IMain, IVariable, IMark, IPropParser} from './CmnInterface';\nimport type {Config} from './Config';\nimport {CallStack, type ICallStackArg} from './CallStack';\nimport {Grammar, tagToken2Name_Args, tagToken2Name} from './Grammar';\nimport {AnalyzeTagArg} from './AnalyzeTagArg';\nimport {RubySpliter} from './RubySpliter';\nimport type {EventMng} from './EventMng';\nimport type {LayerMng} from './LayerMng';\nimport {DebugMng} from './DebugMng';\nimport type {SoundMng} from './SoundMng';\nimport type {SysBase} from './SysBase';\nimport {SEARCH_PATH_ARG_EXT} from './ConfigBase';\nimport {CmnTween} from './CmnTween';\nimport {Reading, ReadingState} from './Reading';\nimport {BUF_BGM} from './SndBuf';\n\nimport {Loader} from 'pixi.js';\n\ninterface HScript {\n\t[fn: string]: Script;\n};\n\ninterface ISeek {\n\tidx\t\t: number;\n\tln\t\t: number;\n};\n\n\nconst enum BreakState {Running, Wait, Break, Breaking, Step, Stepping, StepOuting, StepOut};\n\nconst enum SndProcOnLoad {\n\tMINIMAL_STOP,\n\tNO_TOUCH,\n\tALL_STOP_AND_PLAY,\n};\n\nexport\tconst\tRPN_COMP_CHIN = 'compChIn';\n\n\nexport class ScriptIterator {\n\t#script\t\t: Script\t= {aToken: [''], len: 1, aLNum: [1]};\n\n\t#scriptFn\t= '';\n\tget scriptFn() {return this.#scriptFn}\n\t#idxToken\t= 0;\n\tget idxToken() {return this.#idxToken}\n\tsubIdxToken() {--this.#idxToken}\n\t#lineNum\t= 0;\n\tget lineNum() {return this.#lineNum}\n\treadonly addLineNum\t= (len: number)=> this.#lineNum += len;\n\tjumpJustBefore() {this.#jumpWork(this.#scriptFn, '', --this.#idxToken)}\n\t\t// 直前にジャンプ\n\n\n\t#aCallStk\t: CallStack[]\t= [];\t// FILOバッファ（push/pop）\n\n\treadonly\t#grm;\n\treadonly\t#alzTagArg\t= new AnalyzeTagArg;\n\n\n\t//MARK: コンストラクタ\n\tconstructor(private readonly cfg: Config, private readonly hTag: IHTag, private readonly main: IMain, private readonly val: IVariable, private readonly prpPrs: IPropParser, private readonly sndMng: SoundMng, private readonly sys: SysBase) {\n\t\t// 変数操作\n\t\thTag.let_ml\t\t= o=> this.#let_ml(o);\t// インラインテキスト代入\n\t\thTag.endlet_ml\t= ()=> false;\t\t\t// インラインテキスト代入終端\n\t\t\t// [if]ブロック内で【未定義のタグ[endlet_ml]です】エラーが発生する対策\n\n\t\t// デバッグ・その他\n\t\thTag.dump_stack\t= ()=> this.#dump_stack();\t// スタックのダンプ\n\t\thTag.dump_script= o=> this.#dump_script(o);\t// スクリプトのダンプ\n\n\t\t// 条件分岐\n\t\thTag['else']\t=\t\t\t\t\t\t\t// その他ifブロック開始\n\t\thTag.elsif\t\t=\t\t\t\t\t\t\t// 別条件のifブロック開始\n\t\thTag.endif\t\t= ()=> this.#endif();\t\t// ifブロックの終端\n\t\thTag['if']\t\t= o=> this.#if(o);\t\t\t// ifブロックの開始\n\n\t\t// ラベル・ジャンプ\n\t\t//hTag.button\t// LayerMng.ts内で定義\t\t// ボタンを表示\n\t\thTag.call\t\t= o=> this.#call(o);\t\t// サブルーチンコール\n\t\thTag.jump\t\t= o=> this.#jump(o);\t\t// シナリオジャンプ\n\t\t//hTag.page\t\t= // ReadState が担当に\t\t// ページ移動\n\t\thTag.pop_stack\t= o=> this.#pop_stack(o);\t// コールスタック破棄\n\t\thTag.return\t\t= o=> this.#return(o);\t\t// サブルーチンから戻る\n\n\t\t// マクロ\n\t\thTag.bracket2macro\t= o=> this.#bracket2macro(o);// 括弧マクロの定義\n\t\thTag.char2macro\t\t= o=> this.#char2macro(o);\t// 一文字マクロの定義\n\t\thTag.endmacro\t\t= o=> this.#return(o);\t\t// マクロ定義の終了\n\t\thTag.macro\t\t\t= o=> this.#macro(o);\t\t// マクロ定義の開始\n\n\t\t// しおり\n\t\t//hTag.copybookmark\t\t// Variable.ts内で定義\t// しおりの複写\n\t\t//hTag.erasebookmark\t// Variable.ts内で定義\t// しおりの消去\n\t\thTag.load\t\t\t= o=> this.#load(o);\t\t\t// しおりの読込\n\t\thTag.reload_script\t= o=> this.#reload_script(o);\t// スクリプト再読込\n\t\thTag.record_place\t= ()=> this.#record_place();\t// セーブポイント指定\n\t\thTag.save\t\t\t= o=> this.#save(o);\t\t\t// しおりの保存\n\n\n\t\tif (cfg.oCfg.debug.token) this.#dbgToken = token=> {if (token.trim() !== '') console.log(`🌱 トークン ${this.#scriptFn}:${this.#lineNum} (i:${this.#idxToken} cs:${this.#aCallStk.length}) %c【${token}】`, 'background-color:#350;')};\n\t\tif (cfg.oCfg.debug.tag) this.#procDebugtag = tag_name=> console.log(`🌲 タグ解析 ${this.#scriptFn}:${this.#lineNum} (i:${this.#idxToken} cs:${this.#aCallStk.length}) %c[${tag_name} %o]`, 'background-color:#30B;', this.#alzTagArg.hPrm);\n\n\t\tval.defTmp('const.sn.aIfStk.length', ()=> this.#aIfStk.length);\n\t\tval.defTmp('const.sn.vctCallStk.length', ()=> this.#aCallStk.length);\n\n\t\tthis.#grm = new Grammar(cfg);\n\t\t\n\t\tconst ce = cfg.oCfg.init.escape;\n\t\tthis.#grm.setEscape(ce);\n\t\tRubySpliter.setEscape(ce);\n\n\t\tif (CmnLib.isDbg) {\n\t\t\tsys.addHook((type, o)=> this.#hHook[type]?.(o));\n\t\t\tthis.isBreak = this.#isBreak_base;\n\n\t\t\tconst fnc = this.analyzeInit;\n\t\t\tthis.analyzeInit = ()=> {\n\t\t\t\tthis.analyzeInit = ()=> {};\n\t\t\t\tthis.sys.send2Dbg('hi', {});\n\t\t\t};\n\t\t\tthis.#hHook.auth = o=> {\n\t\t\t\tconst hLineBP = o.hBreakpoint.hFn2hLineBP;\n\t\t\t\tfor (const [fn, v] of Object.entries(hLineBP)) this.#regBreakPoint(fn, <any>v);\n\n\t\t\t\tScriptIterator.#hFuncBP = {};\n\t\t\t\tfor (const v of o.hBreakpoint.aFunc) {\n\t\t\t\t\tScriptIterator.#hFuncBP[v.name] = 1;\n\t\t\t\t}\n\n\t\t\t\tif (o.stopOnEntry) {\n\t\t\t\t\twhile (true) {\n\t\t\t\t\t\tlet tkn = this.nextToken();\n\t\t\t\t\t\tif (! tkn) break;\t// 初期化前に終了した場合向け\n\n\t\t\t\t\t\tconst uc = tkn.charCodeAt(0);\t// TokenTopUnicode\n\t\t\t\t\t\tif (uc === 91) break;\t// [ タグ開始\n\t\t\t\t\t\tif (uc === 38) break;\t// & 変数操作・変数表示\n\t\t\t\t\t\tif (uc === 42 && tkn.length === 1) break;\t// 単文字の *\n\t\t\t\t\t\tif (uc === 10) this.#lineNum += tkn.length;\t// \\n 改行\n\t\t\t\t\t}\n\t\t\t\t\tthis.sys.callHook('stopOnEntry', {});\n\t\t\t\t\tthis.analyzeInit = fnc;\n\t\t\t\t\tthis.analyzeInit();\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tthis.noticeWait = ()=> {\n\t\t\t\t\t\tthis.noticeWait = ()=> {};\n\t\t\t\t\t\tthis.sys.callHook('stopOnEntry', {});\t// sn全体へ通知\n\n//\t\t\t\t\t\tthis.sys.callHook('continue', {});\t// sn全体へ通知\n//\t\t\t\t\t\tthis.breakState = BreakState.breaking;\n\t\t\t\t\t};\n\n\t\t\t\t\tthis.analyzeInit = fnc;\n\t\t\t\t\tthis.analyzeInit();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse this.recodeDesign = ()=> {};\n\t}\n\tnoticeWait = ()=> {};\n\t#regBreakPoint(fn: string, o: {[ln: number]: any}) {\n\t\tScriptIterator.#hFn2hLineBP[this.#cnvSnPath4Dbg(fn)] = o;\n\t}\n\n\tdestroy() {this.isBreak = this.#record_place = ()=> false}\n\n\treadonly #hHook\t: {[type: string]: (o: any)=> void}\t= {\n\t\t//auth: // constructorで\n\t\t//launch:\t// ここでは冒頭停止に間に合わないのでanalyzeInit()で\n\t\tdisconnect: ()=> {\n\t\t\tScriptIterator.#hFn2hLineBP = {};\n\t\t\tScriptIterator.#hFuncBP = {};\n\t\t\tthis.isBreak = ()=> false;\n\n\t\t\tthis.#hHook.continue!({});\n\t\t\tthis.#breakState = BreakState.Running;\n\t\t},\n\t\trestart: ()=> this.isBreak = ()=> false,\n\n\t\t// ブレークポイント登録\n\t\tadd_break: o=> this.#regBreakPoint(o.fn, o.o),\n\t\tdata_break: o=> {\n\t\t\tif (this.#breakState !== BreakState.Running) return;\n\n\t\t\tthis.#breakState = BreakState.Wait;\n\t\t\tthis.main.setLoop(false, `変数 ${o.dataId}【${o.old_v}】→【${o.new_v}】データブレーク`);\n\t\t\tthis.sys.callHook('stopOnDataBreakpoint', {});\t// sn全体へ通知\n\t\t\tthis.sys.send2Dbg('stopOnDataBreakpoint', {});\n\t\t},\n\t\tset_func_break: o=> {\n\t\t\tScriptIterator.#hFuncBP = {};\n\t\t\tfor (const v of o.a) ScriptIterator.#hFuncBP[v.name] = 1;\n\t\t\tthis.sys.send2Dbg(o.ri, {});\n\t\t},\n\n\t\t// 情報問い合わせ系\n\t\tstack: o=> this.sys.send2Dbg(o.ri, {a: this.#aStack()}),\n\t\teval: o=> {this.sys.send2Dbg(o.ri, {v: this.prpPrs.parse(o.txt)})},\n\n\t\t// デバッガからの操作系\n\t\tcontinue: ()=> {\n\t\t\tif (this.#isIdxOverLast()) return;\n\n\t\t\tthis.#idxToken -= this.#idxDx4Dbg;\n\t\t\tthis.#breakState = BreakState.Breaking;\n\t\t\tthis.main.setLoop(true);\n\t\t\tthis.main.resume();\t// jumpループ後などで停止している場合があるので\n\t\t},\n\t\tstepover: o=> this.#go_stepover(o),\n\t\tstepin: ()=> {\n\t\t\tif (this.#isIdxOverLast()) return;\n\n\t\t\tconst tkn = this.#script.aToken[this.#idxToken -this.#idxDx4Dbg];\n\t\t\tthis.sys.callHook(`stopOnStep${this.#REGSTEPIN.test(tkn ?? '') ?'In' :''}`, {});\t// sn全体へ通知\n\n\t\t\tthis.#idxToken -= this.#idxDx4Dbg;\n\t\t\tthis.#breakState = this.#breakState === BreakState.Wait\n\t\t\t\t? BreakState.Step\n\t\t\t\t: BreakState.Stepping;\n\t\t\tthis.main.setLoop(true);\n\t\t\tthis.main.resume();\t// jumpループ後などで停止している場合があるので\n\t\t},\n\t\tstepout: o=> {\n\t\t\tif (this.#isIdxOverLast()) return;\n\n\t\t\tif (this.#aCallStk.length > 0) this.#go_stepout(true);\n\t\t\telse this.#go_stepover(o);\n\t\t},\n\t\tpause: ()=> {\n\t\t\tthis.#breakState = BreakState.Step;\n\t\t\tthis.main.setLoop(false, '一時停止');\n\t\t\tthis.sys.send2Dbg('stopOnStep', {});\n\t\t},\n\t\tstopOnEntry: ()=> {\n\t\t\tthis.#breakState = BreakState.Step;\n\t\t\tthis.main.setLoop(false, '一時停止');\n\t\t\tthis.sys.send2Dbg('stopOnEntry', {});\n\t\t},\n\t};\n\treadonly #cnvSnPath = (fn: string)=> this.cfg.searchPath(fn, SEARCH_PATH_ARG_EXT.SCRIPT);\n\tstatic\treadonly\t#REG4CODE_FN\t= /(.+)\\/crypto_prj\\/([^\\/]+)\\/[^\\.]+(\\.\\w+)/;\t// https://regex101.com/r/Km54EK/1 141 steps (~0ms)\n\treadonly #cnvSnPath4Dbg = (fn: string)=>\n\t\t(this.sys.pathBaseCnvSnPath4Dbg + this.#cnvSnPath(fn))\n\t\t.replace(ScriptIterator.#REG4CODE_FN, `$1/prj/$2/${this.#scriptFn}$3`);\n\tcnvPath4Dbg = (fn: string)=> this.sys.pathBaseCnvSnPath4Dbg + fn.replace('/crypto_prj/', '/prj/');\n\t#go_stepover(o: any) {\n\t\tif (this.#isIdxOverLast()) return;\n\n\t\tconst tkn = this.#script.aToken[this.#idxToken -this.#idxDx4Dbg];\n\t\tif (this.#REGSTEPIN.test(tkn ?? '')) this.#go_stepout(false);\n\t\telse {\n\t\t\tthis.sys.callHook('stopOnStep', {});\t// sn全体へ通知\n\t\t\tthis.#hHook.stepin!(o);\n\t\t}\n\t}\n\t#go_stepout(out: boolean) {\n\t\tthis.sys.callHook(`stopOnStep${out ?'Out' :''}`, {});\t// sn全体へ通知\n\t\tthis.#csDepth_macro_esc = this.#aCallStk.length -(out ?1 :0);\n\t\tthis.#idxToken -= this.#idxDx4Dbg;\n\t\tthis.#breakState = out ?BreakState.StepOut :BreakState.StepOuting;\n\t\tthis.main.setLoop(true);\n\t\tthis.main.resume();\t// jumpループ後などで停止している場合があるので\n\t}\n\t#csDepth_macro_esc\t= 0;\n\tget #idxDx4Dbg() {\n\t\treturn this.#breakState === BreakState.Break\n\t\t\t|| this.#breakState === BreakState.Step ?1 :0\n\t};\n\t#isIdxOverLast(): boolean {\n\t\tif (this.#idxToken < this.#script.len) return false;\n\t\tthis.sys.callHook('stopOnEntry', {});\t// sn全体へ通知\n\t\tthis.main.setLoop(false, 'スクリプト終端です isIdxOverLast');\n\t\treturn true;\n\t}\n\n\t// reload 再生成 Main に受け渡すため static\n\tstatic\t#hFn2hLineBP: {[fn: string]: {[ln: number]: any}} = {};\n\tstatic\t#hFuncBP: {[tag_name: string]: 1} = {};\n\t#breakState\t= BreakState.Running;\n\t\t// https://raw.githubusercontent.com/famibee/SKYNovel-vscode-extension/master/src/doc/BreakStateSMD.pu\n\tisBreak = (_token: string)=> false;\n\t#isBreak_base(token: string): boolean {\n\t\tswitch (this.#breakState) {\n\t\t\tcase BreakState.StepOuting:\tthis.#subHitCondition();\n\t\t\t\tthis.#breakState = BreakState.StepOut;\tbreak;\n\t\t\tcase BreakState.StepOut:\n\t\t\t\tif (this.#aCallStk.length !== this.#csDepth_macro_esc) break;\n\n\t\t\t\tthis.#breakState = BreakState.Step;\n\t\t\t\tthis.main.setLoop(false, 'ステップ実行');\n\t\t\t\tthis.sys.send2Dbg('stopOnStep', {});\n\t\t\t\treturn true;\t// タグを実行せず、直前停止\n\n\t\t\tcase BreakState.Stepping:\tthis.#subHitCondition();\n\t\t\t\tthis.#breakState = BreakState.Step;\tbreak;\n\t\t\tcase BreakState.Step:\t\tthis.#subHitCondition();\n\t\t\t\tthis.main.setLoop(false, 'ステップ実行');\n\t\t\t\tthis.sys.send2Dbg('stopOnStep', {});\n\t\t\t\treturn true;\t// タグを実行せず、直前停止\n\n\t\t\tcase BreakState.Breaking:\tthis.#subHitCondition();\n\t\t\t\tthis.#breakState = BreakState.Running;\tbreak;\n\n\t\t\tdefault:\n\t\t\t{\t// 関数ブレークポイント\n\t\t\t\tif (tagToken2Name(token) in ScriptIterator.#hFuncBP) {\n\t\t\t\t\tthis.#breakState = BreakState.Break;\n\t\t\t\t\tthis.main.setLoop(false, `関数 ${token} ブレーク`);\n\t\t\t\t\tthis.sys.callHook('stopOnBreakpoint', {});\t// sn全体へ通知\n\t\t\t\t\tthis.sys.send2Dbg('stopOnBreakpoint', {});\n\t\t\t\t\treturn true;\t// タグを実行せず、直前停止\n\t\t\t\t}\n\t\t\t}\n\t\t\t{\t// ブレークポイント\n\t\t\t\tconst bp = ScriptIterator.#hFn2hLineBP[this.#cnvSnPath4Dbg(this.#scriptFn)];\n\t\t\t\tif (! bp) break;\n\t\t\t\tconst o = bp[this.#lineNum];\n\t\t\t\tif (! o) break;\n//console.log(`fn:ScriptIterator.ts line:145 👺 【bs:${this.#breakState} idx:${this.#idxToken} ln:${this.#lineNum} tkn:${this.#script.aToken[this.#idxToken -1]}:】 o:%o`, o);\n\t\t\t\tif (o.condition) {if (! this.prpPrs.parse(o.condition)) break}\n\t\t\t\telse if (('hitCondition' in o) && --o.hitCondition > 0) break;\n\t\t\t\tconst isBreak = this.#breakState === BreakState.Running;\n\t\t\t\tthis.#breakState = BreakState.Break;\n\t\t\t\tthis.main.setLoop(false, isBreak ?(\n\t\t\t\t\t(o.condition ? '条件' :'ヒットカウント') +'ブレーク'\n\t\t\t\t\t) :'ステップ実行');\n\t\t\t\tconst type = isBreak ?'stopOnBreakpoint' :'stopOnStep';\n\t\t\t\tthis.sys.callHook(type, {});\t// sn全体へ通知\n\t\t\t\tthis.sys.send2Dbg(type, {});\n\t\t\t}\n\t\t\t\treturn true;\t// タグを実行せず、直前停止\n\t\t}\n\n\t\treturn false;\t// no break、タグを実行\n\t}\n\t#subHitCondition() {\t// step実行中でbreakしないがヒットカウントだけ減算\n\t\tconst o = ScriptIterator.#hFn2hLineBP[getFn(this.#scriptFn)]?.[this.#lineNum];\n\t\tif (o?.hitCondition) --o.hitCondition;\n\t}\n\n\t#aStack(): {fn: string, ln: number, col: number, nm: string, ma: string}[] {\n\t\tconst idx_n = this.#breakState === BreakState.Breaking ?1 :0;\n\t\tconst tkn0 = this.#script.aToken[this.#idxToken -1 +idx_n]!;\n\n\t\tconst fn0 = this.#cnvSnPath4Dbg(this.#scriptFn);\n\t\tconst tag_name0 = tagToken2Name(tkn0!);\n\t\tconst nm = tag_name0 ?`[${tag_name0}]` :tkn0;\n//console.log(`fn:ScriptIterator.ts aStack breakState:${this.#breakState} idx:${this.#idxToken -1} idx_n:${idx_n} tkn0:${tkn0}: fn0:${fn0} nm:${nm} tkn02:${this.#script.aToken[this.#idxToken -1]}: +tkn02:${this.#script.aToken[this.#idxToken]}:`);\n//console.log(`fn:ScriptIterator.ts     a:%o anum:%o`, this.script.aToken, this.script.aLNum);\n\t\tconst ma = this.val.getVal('mp:const.sn.macro') ?? '{}';\n\t\tif (this.#idxToken === 0) return [{fn: fn0, ln: 1, col: 1, nm, ma: ma,}];\n\n\t\tconst lc0 = this.#cnvIdx2lineCol(this.#script, this.#idxToken);// -1不要\n//console.log(`fn:ScriptIterator.ts     ln:${lc0.ln} col:${lc0.col_s} col2:${this.#script.aLNum[this.#idxToken -1]}`);\n\t\tconst a = [{fn: fn0, ln: lc0.ln, col: lc0.col_s +1, nm: nm, ma: ma}];\n\t\tconst len = this.#aCallStk.length;\n\t\tif (len === 0) return a;\n\n\t\tfor (let i=len -1; i>=0; --i) {\n\t\t\tconst cs = this.#aCallStk[i]!;\n\t\t\tconst st = this.#hScript[cs.fn];\n\t\t\tif (! st) continue;\n\t\t\tconst tkn = st.aToken[cs.idx -1];\n\t\t\tif (! tkn) continue;\n\t\t\tconst lc = this.#cnvIdx2lineCol(st, cs.idx);\t// -1不要\n\n\t\t\tconst tag_name = tagToken2Name(tkn);\n\t\t\ta.push({\n\t\t\t\tfn\t: this.#cnvSnPath4Dbg(cs.fn),\n\t\t\t\tln\t: lc.ln,\n\t\t\t\tcol\t: lc.col_s +1,\n\t\t\t\tnm\t: tag_name ?`[${tag_name}]` :tkn,\n\t\t\t\tma\t: cs.csArg[':hMp']['const.sn.macro'] ?? '{}',\n\t\t\t});\n\t\t}\n\n\t\treturn a;\n\t}\n\n\t// result = true : waitする  resume()で再開\n\t#procDebugtag\t= (_tag_name: string)=> {};\n\t//MARK: タグ解析\n\tasync\tタグ解析(tag_name: string, args: string): Promise<boolean> {\n\t\tconst tag_fnc = this.hTag[tag_name];\n\t\tif (! tag_fnc) throw `未定義のタグ【${tag_name}】です`;\n\n\t\tthis.#alzTagArg.parse(args);\n\t\tthis.#procDebugtag(tag_name);\n\n\t\tconst hPrm = this.#alzTagArg.hPrm;\n\t\tif (hPrm.cond) {\n\t\t\tconst cond = hPrm.cond.val;\n\t\t\tif (! cond || cond.startsWith('&')) throw '属性condは「&」が不要です';\n\t\t\tconst p = this.prpPrs.parse(cond);\n\t\t\tconst ps = String(p);\n\t\t\tif (ps === 'null' || ps === 'undefined') return false;\n\t\t\tif (! p) return false;\n\t\t}\n\n\t\tlet hArg: any = {};\n\t\tconst len = this.#aCallStk.length;\n\t\tconst csa: any = len === 0 ?{} :this.#aCallStk[len -1]!.csArg;\n\t\tif (this.#alzTagArg.isKomeParam) {\n\t\t\tif (len === 0) throw '属性「*」はマクロのみ有効です';\n\t\t\thArg = {...csa};\n\t\t}\n\t\thArg[':タグ名'] = tag_name;\n\t// #region タグ位置のコールスタック情報を埋め込むコード（デバッグ用）\n\t/*\t{\n\t\t\tconst lc0 = this.#cnvIdx2lineCol(this.#script, this.#idxToken);\n\t\t\tlet now = `存在位置 fn:${this.#scriptFn} line:${lc0.ln} col:${lc0.col_s +1}`;\n\t\t\thArg[':path'] = now;\n\t\t\tconst len = this.#aCallStk.length;\n\t\t\tif (len > 0) {\n\t\t\t\tfor (let i=len -1; i>=0; --i) {\n\t\t\t\t\tconst cs = this.#aCallStk[i];\n\t\t\t\t\tconst hMp = cs.csArg[':hMp'];\n\t\t\t\t\tconst from_macro_nm = hMp ?hMp[':タグ名'] :undefined;\n\t\t\t\t\tconst call_nm = cs.csArg[':タグ名'] ?? '';\n\t\t\t\t\tconst lc = this.#cnvIdx2lineCol(this.#hScript[cs.fn], cs.idx);\n\t\t\t\t\tnow += ` <- (${len -i}) fn:${cs.fn} line:${lc.ln\n\t\t\t\t\t\t} col:${lc.col_s +1\n\t\t\t\t\t\t}`+ (from_macro_nm ?'（['+ from_macro_nm +']マクロ内）' :' ')+\n\t\t\t\t\t\t`で [${call_nm} ...]をコール`;\n\t\t\t\t}\n\t\t\t}\n\t\t}*/\n\t// #endregion\n\t// #region タグ位置情報を埋め込むコード（デバッグ用）\n//\t\thArg[':path'] = this.#scriptFn;\n//\t\thArg[':ln'] = this.#lineNum;\n\t// #endregion\n\t\t// valやdefの値について。null はありえない。'null'や'undefined' はありえる。\n\t\t// 省略時以外で undefined はない。a=undefined と書いても 'undefined' になる\n\t\tfor (const [arg_nm, {val, def}] of Object.entries(hPrm)) {\n\t\t\tlet v = val;\n\t\t\tif (v?.startsWith('%')) {\n\t\t\t\tif (len === 0) throw '属性「%」はマクロ定義内でのみ使用できます（そのマクロの引数を示す簡略文法であるため）';\n\t\t\t\tconst mac = csa[v.slice(1)];\n\t\t\t\tif (mac) {hArg[arg_nm] = mac; continue}\n\n\t\t\t\tif (def === undefined || def === 'null') continue;\n\t\t\t\t\t// defの'null'指定。%変数が無い場合、タグやマクロに属性を渡さない\n\t\t\t\tv = def;\n\t\t\t}\n\n\t\t\tv = this.prpPrs.getValAmpersand(v ?? '');\n\t\t\tif (v !== 'undefined') {hArg[arg_nm] = v; continue}\n\n\t\t\tif (def === undefined) continue;\n\t\t\tv = this.prpPrs.getValAmpersand(def);\n\t\t\tif (v !== 'undefined') hArg[arg_nm] = v;\n\t\t\t\t// 存在しない値の場合、属性を渡さない\n\t\t}\n\n\t\t// 一部タグの処理直前に文字出現処理を終わらせる\n\t\tif (Reading.needGoTxt && this.#setTag2ChIn.has(tag_name)) {\n\t\t\tconst {promise, resolve} = Promise.withResolvers<void>();\n\t\t\tReading.beginProc(RPN_COMP_CHIN, resolve, false);\n\t\t\tReading.goTxt();\n\t\t\tthis.val.saveKidoku();\n\t\t\tawait promise;\n\t\t}\n\t\t// キー押しっぱなしスキップで処理せずスルーする\n\t\tconst fncBypass = this.#hTag2SkipBypass[tag_name];\n\t\tif (fncBypass\n\t\t\t&& argChk_Boolean(hArg, 'canskip', this.#hTag2CanSkip[tag_name] ?? true)\n\t\t\t&& this.#evtMng.isSkipping) return fncBypass(hPrm);\n\n\t\treturn tag_fnc(hArg);\n\t}\n\t\t// 文字出現演出を待つタグ\n\t\t//\tここで列挙せずタグ処理で文字表示を始めたい場合、goTxt()すること\n\t\treadonly\t#setTag2ChIn = new Set([\n\t\t// 変数操作\n\t\t\t// 'clearsysvar',\t// システム変数の全消去\n\t\t\t// 'clearvar',\t\t// ゲーム変数の全消去 \n\t\t\t// 'let_abs',\t\t// 絶対値\n\t\t\t// 'let_char_at',\t// 文字列から一字取りだし\n\t\t\t// 'let_index_of',\t// 文字列で検索\n\t\t\t// 'let_length',\t// 文字列の長さ\n\t\t\t// 'let_ml',\t\t// インラインテキスト代入\n\n\t\t\t// 'let_replace',\t// 正規表現で置換\n\t\t\t// 'let_round',\t\t// 四捨五入\n\t\t\t// 'let_search',\t// 正規表現で検索\n\t\t\t// 'let_substr',\t// 文字列から抜きだし\n\t\t\t// 'let',\t\t\t// 変数代入・演算\n\n\t\t// レイヤ共通\n\t\t\t// 'add_lay',\t\t// レイヤを追加する\n\t\t\t// 'clear_lay',\t// レイヤ設定の消去\n\t\t\t// 'finish_trans',\t// トランス強制終了\n\t\t\t// 'lay',\t// レイヤ設定\n\t\t\t'trans',\t// ページ裏表を交換\n\t\t\t'wt',\t// トランス終了待ち\n\t\t\t// 'add_filter',\t// フィルター追加\n\t\t\t// 'clear_filter',\t// フィルター全削除\n\t\t\t// 'enable_filter',// フィルター個別切替\n\n\t\t// トゥイーンアニメ\n\t\t\t// 'pause_tsy',\t// 一時停止\n\t\t\t// 'resume_tsy',\t// 一時停止再開\n\t\t\t// 'stop_tsy',\t// トゥイーン中断\n\t\t\t// 'tsy',\t\t// トゥイーン開始\n\t\t\t'wait_tsy',\t// トゥイーン終了待ち\n\n\t\t// 文字・文字レイヤ\n\t\t\t// 'autowc',\t// 文字ごとのウェイト\n\t\t\t// 'ch',\t\t// 文字を追加する\n\t\t\t// 'ch_in_style',\t// 文字出現演出定義\n\t\t\t// 'ch_out_style',\t// 文字消去演出定義\n\t\t\t// 'clear_text',\t// 文字消去\n\t\t\t// 'current',\t// デフォルト文字レイヤ設定\n\t\t\t// 'endlet_ml',\t// インラインテキスト代入の終端\n\t\t\t// 'endlink',\t// ハイパーリンクの終了\n\t\t\t// 'er',\t\t// ページ両面の文字消去\n\t\t\t// 'graph',\t\t// インライン画像表示\n\t\t\t// 'link',\t\t// ハイパーリンク\n\t\t\t// 'r',\t\t\t// 改行\n\t\t\t// 'rec_ch',\t// 履歴書き込み\n\t\t\t// 'rec_r',\t\t// 履歴改行\n\t\t\t// 'reset_rec',\t// 履歴リセット\n\t\t\t// 'ruby2',\t\t// 文字列と複数ルビの追加\n\t\t\t// 'set_focus',\t// フォーカス移動\n\t\t\t// 'span',\t\t// インラインスタイル設定\n\t\t\t// 'tcy',\t\t// 縦中横を表示する\n\n\t\t// 画像・画像レイヤ\n\t\t\t// 'add_face',\t// 差分名称の定義\n\t\t\t'wv',\t\t// 動画再生終了待ち\n\n\t\t// HTMLフレーム\n\t\t\t// 'add_frame',\t// フレーム追加\n\t\t\t// 'frame',\t// フレームに設定\n\t\t\t// 'let_frame',\t// フレーム変数を取得\n\t\t\t// 'set_frame',\t// フレーム変数に設定\n\t\t\t// 'tsy_frame',\t// フレームをトゥイーン開始\n\n\t\t// イベント\n\t\t\t// 'clear_event',\t// イベントを全消去\n\t\t\t// 'enable_event',\t// イベント有無の切替\n\t\t\t// 'event',\t// イベントを予約\n\t\t\t'l',\t// 行末クリック待ち\n\t\t\t'p',\t// 改ページクリック待ち\n\t\t\t's',\t// 停止する\n\t\t\t'wait',\t\t// ウェイトを入れる\n\t\t\t'waitclick',\t// クリックを待つ\n\n\t\t// ＢＧＭ・効果音\n\t\t\t// 'fadebgm',\t// BGMのフェード\n\t\t\t// 'fadeoutbgm',// BGMのフェードアウト\n\t\t\t// 'fadeoutse',\t// 効果音のフェードアウト\n\t\t\t// 'fadese',\t// 効果音のフェード\n\t\t\t// 'playbgm',\t// BGM の演奏\n\t\t\t// 'playse',\t// 効果音の再生\n\t\t\t// 'stop_allse',// 全効果音再生の停止\n\t\t\t// 'stopbgm',\t// BGM 演奏の停止\n\t\t\t// 'stopfadese',// 音声フェードの停止\n\t\t\t// 'stopse',\t// 効果音再生の停止\n\t\t\t// 'volume',\t// BGMや効果音の音量を指定\n\t\t\t'wb',\t// BGM フェードの終了待ち\n\t\t\t'wf',\t// 効果音フェードの終了待ち\n\t\t\t'wl',\t// BGM 再生の終了待ち\n\t\t\t'ws',\t// 効果音再生の終了待ち\n\t\t\t// 'xchgbuf',\t// サウンドバッファの交換\n\n\t\t// 条件分岐\n\t\t\t// 'else',\t// その他ifブロック開始\n\t\t\t// 'elsif',\t// 別条件のifブロック開始\n\t\t\t// 'endif',\t// ifブロックの終端\n\t\t\t// 'if',\t// ifブロックの開始\n\n\t\t// ラベル・ジャンプ\n\t\t\t// 'button',\t// ボタンを表示\n\t\t\t// 'call',\t\t// サブルーチンコール\n\t\t\t// 'jump',\t\t// シナリオジャンプ\n\t\t\t// 'page',\t\t// ページ移動\n\t\t\t// 'pop_stack',\t// コールスタック破棄\n\t\t\t// 'return',\t// サブルーチンから戻る\n\n\t\t// マクロ\n\t\t\t// 'bracket2macro',\t// 括弧マクロの定義\n\t\t\t// 'char2macro',\t// 一文字マクロの定義\n\t\t\t// 'endmacro',\t// マクロ定義の終了\n\t\t\t// 'macro',\t\t// マクロ定義の開始\n\n\t\t// しおり\n\t\t\t// 'copybookmark',\t// しおりの複写\n\t\t\t// 'erasebookmark',\t// しおりの消去\n\t\t\t// 'load',\t\t\t// しおりの読込\n\t\t\t// 'record_place',\t// セーブポイント指定\n\t\t\t// 'reload_script',\t// スクリプト再読込\n\t\t\t// 'save',\t\t\t// しおりの保存\n\n\t\t// 画面揺らし\n\t\t\t'quake',\t\t// 画面を揺らす\n\t\t\t// 'stop_quake',// 画面揺らし中断\n\t\t\t'wq',\t\t// 画面揺らし終了待ち\n\n\t\t// システム\n\t\t\t// 'close',\t\t// アプリの終了\n\t\t\t// 'export',\t// プレイデータをエクスポート\n\t\t\t// 'import',\t// プレイデータをインポート\n\t\t\t// 'loadplugin',\t// プラグインの読み込み\n\t\t\t// 'navigate_to',\t// ＵＲＬを開く\n\t\t\t// 'snapshot',\t\t// スナップショット\n\t\t\t// 'title',\t\t// タイトル指定\n\t\t\t// 'toggle_full_screen',\t// 全画面状態切替\n\t\t\t// 'update_check',\t// 更新チェック機能\n\t\t\t// 'window',\t// アプリウインドウ設定\n\n\t\t// デバッグ・その他\n\t\t\t// 'dump_lay',\t\t// レイヤのダンプ\n\t\t\t// 'dump_script',\t// 外部へスクリプトを表示\n\t\t\t// 'dump_stack',\t// スタックのダンプ\n\t\t\t// 'dump_val',\t\t// 変数のダンプ\n\t\t\t// 'log',\t\t// ログ出力\n\t\t\t// 'trace',\t\t// デバッグ表示へ出力\n\t\t]);\n\t\t// キー押しっぱなしスキップで処理せずスルーするタグ\n\t\treadonly\t#hTag2SkipBypass: {[tag_name: string]: ITag} = {\n\t\t\t'wt'\t\t: ()=> CmnTween.finish_trans(),\t// トランス終了待ち\n\t\t\t'wait_tsy'\t: o=> this.hTag.stop_tsy!(o),\t// トゥイーン終了待ち\n\t\t\t// 'wv',\t\t：タグ内部で処理\t// 動画再生終了待ち\n\t\t\t'wait'\t\t\t: ()=> false,\t\t// ウェイトを入れる\n\t\t\t// 'playbgm',\t：スルー不可\t\t// BGM の演奏\n\t\t\t// 'playse',\t：タグ内部で処理\t// 効果音の再生\n\t\t\t'wb'\t: ()=> this.hTag.stopfadese!({buf: BUF_BGM}),\n\t\t\t\t\t\t\t\t\t\t\t// BGM フェードの終了待ち\n\t\t\t// 'wf'\t\t：タグ内部で処理\t// 効果音フェードの終了待ち\n\t\t\t// 'ws'\t\t：タグ内部で処理\t// 効果音再生の終了待ち\n\t\t\t'wq'\t: ()=> this.hTag.stop_quake!({}),\t// 画面揺らし終了待ち\n\t\t\t// fade系\t：タグ内部で処理\n\t\t\t// 'ch'\t\t：タグ内部で処理\t// 文字を追加する\n\t\t\t// 'tsy'\t：タグ内部で処理\t// トゥイーン開始\n\t\t\t// 'trans'\t：タグ内部で処理\t// ページ裏表を交換\n\t\t\t'quake'\t\t: ()=> false,\t\t// 画面を揺らす\n\t\t};\n\t\t// タグ処理中にクリックなどで即終わらせられるタグ（canskip 属性がある）\n\t\treadonly\t#hTag2CanSkip: {[tag_name: string]: boolean} = {\n\t\t\t\t\t\t// デフォルト値\n\t\t\t'wt'\t\t: true ,\t// [wt]トランス終了待ち\n\t\t\t'wait_tsy'\t: true ,\t// [wait_tsy]トゥイーン終了待ち\n\t\t\t'wv'\t\t: true ,\t// [wv]動画再生終了待ち\n\t\t\t'wait'\t\t: true ,\t// [wait]ウェイトを入れる\n\t\t\t'playbgm'\t: false,\t// [playbgm]BGM の演奏\n\t\t\t'playse'\t: true ,\t// [playse]効果音の再生\n\t\t\t'wb'\t\t: false,\t// [wb]BGM フェードの終了待ち\n\t\t\t'wf'\t\t: false,\t// [wf]効果音フェードの終了待ち\n\t\t\t'ws'\t\t: false,\t// [ws]効果音再生の終了待ち\n\t\t\t'wq'\t\t: true ,\t// [wq]画面揺らし終了待ち\n\t\t};\n\n\n\t#evtMng\t: EventMng;\n\t#layMng\t: LayerMng;\n\tsetOtherObj(evtMng: EventMng, layMng: LayerMng): void {\n\t\tthis.#evtMng = evtMng;\n\t\tthis.#layMng = layMng;\n\t}\n\n\n\t//MARK: インラインテキスト代入\n\t#let_ml(hArg: HArg) {\n\t\tconst {name} = hArg;\n\t\tif (! name) throw 'nameは必須です';\n\n\t\tlet ml = '';\n\t\tconst len = this.#script.len;\n\t\tfor (; this.#idxToken<len; ++this.#idxToken) {\n\t\t\tml = this.#script.aToken[this.#idxToken]!;\n\t\t\tif (ml !== '') break;\n\t\t}\n\t\thArg.text = ml;\n\t\thArg.cast = 'str';\n\t\tthis.hTag['let']!(hArg);\n\t\tthis.#idxToken += 2;\n\t\tthis.#lineNum += (ml.match(/\\n/g) ?? []).length;\n\n\t\treturn false;\n\t}\n\n\n\t//MARK: スタックのダンプ\n\t#dump_stack() {\n\t\tif (this.#idxToken === 0) {\n\t\t\tconsole.group(`🥟 [dump_stack] スクリプト現在地 fn:${this.#scriptFn} line:${1} col:${0}`);\n\t\t\tconsole.groupEnd();\n\t\t\treturn false;\n\t\t}\n\n\t\tconst lc0 = this.#cnvIdx2lineCol(this.#script, this.#idxToken);\n\t\tconst now = `スクリプト現在地 fn:${this.#scriptFn} line:${lc0.ln} col:${lc0.col_s +1}`;\n\t\tconsole.group(`🥟 [dump_stack] ${now}`);\n\t\tconst len = this.#aCallStk.length;\n\t\tif (len > 0) {\n\t\t\tconsole.info(now);\n\t\t\tfor (let i=len -1; i>=0; --i) {\n\t\t\t\tconst cs = this.#aCallStk[i]!;\n\t\t\t\tconst hMp = cs.csArg[':hMp'];\n\t\t\t\tconst from_macro_nm = hMp ?hMp[':タグ名'] :undefined;\n\t\t\t\tconst call_nm = cs.csArg[':タグ名'] ?? '';\n\t\t\t\tconst lc = this.#cnvIdx2lineCol(this.#hScript[cs.fn]!, cs.idx);\n\t\t\t\tconsole.info(\n\t\t\t\t\t`${len -i}つ前のコール元 fn:${cs.fn} line:${lc.ln\n\t\t\t\t\t} col:${lc.col_s +1\n\t\t\t\t\t}`+ (from_macro_nm ?'（['+ from_macro_nm +']マクロ内）' :' ')+\n\t\t\t\t\t`で [${call_nm} ...]をコール`\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t\tconsole.groupEnd();\n\n\t\treturn false;\n\t}\n\t#cnvIdx2lineCol(st: Script, idx: number): {ln: number, col_s: number, col_e: number} {\n\t\tconst ret = {ln: 1, col_s: 0, col_e: 0};\n\t\tif (! st) return ret;\n\n\t\tlet i = idx -1;\n\t\tconst lN = ret.ln = st.aLNum[i]!;\n\t\twhile (st.aLNum[i] === lN) {\n\t\t\tif (! st.aToken[i]!.startsWith('\\n')) {\n\t\t\t\tconst len = st.aToken[i]!.length;\n//console.log(`fn:ScriptIterator.ts line:586 cnvIdx2lineCol tkn:${st.aToken[i]} len:${len} s:${ret.col_s} e:${ret.col_e}`);\n\t\t\t\tif (ret.col_e > 0) ret.col_s += len;\n\t\t\t\tret.col_e += len;\n\t\t\t}\n\t\t\tif (--i < 0) break;\n\t\t}\n\n\t\treturn ret;\n\t}\n\n\n\t//MARK: 外部へスクリプトを表示\n\t#dump_script(hArg: HArg) {\n\t\tconst {set_fnc, break_fnc} = hArg;\n\t\tif (! set_fnc) throw 'set_fncは必須です';\t// スクリプトを返すコールバック\n\n\t\tthis.#fncSet = (globalThis as any)[set_fnc];\n\t\tif (! this.#fncSet) {\n\t\t\tif (argChk_Boolean(hArg, 'need_err', true)) throw `HTML内に関数${set_fnc}が見つかりません`;\n\t\t\tthis.#fncSet = ()=> {};\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.noticeBreak = (goto: boolean)=> {\n\t\t\tif (this.#fnLastBreak !== this.#scriptFn) {\n\t\t\t\tthis.#fnLastBreak = this.#scriptFn;\n\t\t\t\tthis.#fncSet(\n\t\t\t\t\tthis.#hScrCache4Dump[this.#scriptFn] ??= this.#script.aToken.join('')\n\t\t\t\t);\n\t\t\t}\n\t\t\tthis.#fncBreak(this.#lineNum, goto);\n\t\t};\n\t\tthis.noticeBreak(true);\t// 一度目のthis.fncBreak()はスルー（まだ読んでないし）\n\n\t\tif (! break_fnc) return false;\t// Break通知コールバック\n\n\t\tthis.#fncBreak = (globalThis as any)[break_fnc];\n\t\tif (! this.#fncBreak) {\n\t\t\tif (argChk_Boolean(hArg, 'need_err', true)) throw `HTML内に関数${break_fnc}が見つかりません`;\n\t\t\tthis.#fncBreak = ()=> {};\n\t\t}\n\n\t\treturn false;\n\t}\n\t#fncSet: (txt: string)=> void = ()=> {};\n\t#fncBreak: (ln: number, goto: boolean)=> void = ()=> {};\n\t#fnLastBreak = '';\n\t#hScrCache4Dump: {[fn: string]: string;} = {};\n\tnoticeBreak = (_goto: boolean)=> {}\n\n\n\t#dumpErrLine = 5;\n\tdumpErrForeLine() {\n\t\tif (this.#idxToken === 0) {\n\t\t\tconsole.group(`🥟 Error line (from 0 rows before) fn:${this.#scriptFn}`);\n\t\t\tconsole.groupEnd();\n\t\t\treturn;\n\t\t}\n\n\t\tlet s = '';\n\t\tfor (let i=this.#idxToken -1; i>=0; --i) {\n\t\t\ts = this.#script.aToken[i] + s;\n\t\t\tif ((s.match(/\\n/g) ?? []).length >= this.#dumpErrLine) break;\n\t\t}\n\t\tconst a = s.split('\\n').slice(-this.#dumpErrLine);\n\t\tconst len = a.length;\n\t\tconsole.group(`🥟 Error line (from ${len} rows before) fn:${this.#scriptFn}`);\n\t\tconst ln_txt_width = String(this.#lineNum).length;\n\t\tconst lc = this.#cnvIdx2lineCol(this.#script, this.#idxToken);\n\t\tfor (let i=0; i<len; ++i) {\n\t\t\tconst ln = this.#lineNum -len +i +1;\n\t\t\tconst mes = `${String(ln).padStart(ln_txt_width, ' ')}: %c`;\n\t\t\tconst e = a[i]!;\n\t\t\tconst line = (e.length > 75) ?e.slice(0, 75) +'…' :e;\t// 長い場合は後略\n\t\t\tif (i === len -1) console.info(\n\t\t\t\tmes + line.slice(0, lc.col_s) +'%c'+ line.slice(lc.col_s),\n\t\t\t\t'color: black; background-color: skyblue;', 'color: black; background-color: pink;'\n\t\t\t)\n\t\t\telse console.info(mes + line, 'color: black; background-color: skyblue;');\n\t\t}\n\t\tconsole.groupEnd();\n\t\t//console.log('Linkの出力   : %o', 'file:///Volumes/MacHD2/_Famibee/SKYNovel/prj/mat/main.sn');\n\t}\n\n\n\t#aIfStk\t: number[]\t= [-1];\t// 先頭に積む FIFOバッファ（unshift / shift）\n\t//MARK: ifブロックの終端\n\t#endif() {\n\t\tconst t = this.#aIfStk[0];\n\t\tif (! t) throw `this.#aIfStk が異常です`;\n\t\tif (t === -1) throw 'ifブロック内ではありません';\n\n\t\tthis.#idxToken = t;\n\t\tthis.#aIfStk.shift();\t// 最初の要素を取り除く\n\n\t\treturn false;\n\t}\n\t//MARK: ifブロックの開始\n\t#if(hArg: HArg) {\n\t\t//console.log('if idxToken:'+ this.#idxToken);\n\t\tconst {exp} = hArg;\n\t\tif (! exp) throw 'expは必須です';\n\t\tif (exp.startsWith('&')) throw '属性expは「&」が不要です';\n\n\t\tlet cntDepth = 0;\t\t// if深度カウンター\n\t\tlet\tidxGo = this.prpPrs.parse(exp) ?this.#idxToken :-1;\n\t\tconst lnIf = this.#script.aLNum[this.#idxToken];\n\t\tlet zLn = this.#lineNum -(lnIf || 0);\t// ??ではなく。NaN は falsy\n\t\tconst len = this.#script.len;\n\t\tfor (; this.#idxToken<len; ++this.#idxToken) {\n\t\t\tconst ln = this.#script.aLNum[this.#idxToken];\n\t\t\tthis.#script.aLNum[this.#idxToken] = (ln || 0)+ zLn; // ??はNaN不可\n\t\t\tconst tkn = this.#script.aToken[this.#idxToken];\n\t\t\t//console.log(`[if]トークン ${this.#scriptFn}:${this.#lineNum} idx:${this.#idxToken} realLn:${this.#script.aLNum[this.#idxToken]} idxGo:${idxGo} cntDepth:${cntDepth} token<${tkn}>`);\n\t\t\tif (! tkn) continue;\n\n\t\t\tconst uc = tkn.charCodeAt(0);\t// TokenTopUnicode\n\t\t\tif (uc === 10) {this.#lineNum += tkn.length; continue}\t// \\n 改行\n\t\t\tif (uc !== 91) continue;\t// [ タグ開始以外\n\n\t\t\tconst [tag_name, args] = tagToken2Name_Args(tkn);\n\t\t\tif (! (tag_name in this.hTag)) throw `未定義のタグ[${tag_name}]です`;\n\t\t\tthis.#alzTagArg.parse(args);\n\n\t\t\tswitch (tag_name) {\n\t\t\tcase 'if':\t++cntDepth; break;\n\n\t\t\tcase 'elsif':\n\t\t\t\tif (cntDepth > 0) break;\n\t\t\t\tif (idxGo > -1) break;\n\n\t\t\t\tconst e = this.#alzTagArg.hPrm.exp?.val;\n\t\t\t\tif (! e) throw 'expは必須です';\n\t\t\t\tif (e.startsWith('&')) throw '属性expは「&」が不要です';\n\t\t\t\tif (this.prpPrs.parse(e)) idxGo = this.#idxToken +1;\n\t\t\t\tbreak;\n\n\t\t\tcase 'else':\n\t\t\t\tif (cntDepth > 0) break;\n\t\t\t\tif (idxGo === -1) idxGo = this.#idxToken +1;\n\t\t\t\tbreak;\n\n\t\t\tcase 'endif':\n\t\t\t\tif (cntDepth > 0) {--cntDepth; break}\n\t\t\t\tif (idxGo === -1) {\n\t\t\t\t\t++this.#idxToken;\n\t\t\t\t\tthis.#script.aLNum[this.#idxToken]! += zLn;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tthis.#aIfStk.unshift(this.#idxToken +1);\t// 先頭に要素追加\n\t\t\t\t\tthis.#idxToken = idxGo;\n\t\t\t\t\tthis.#lineNum = this.#script.aLNum[this.#idxToken]!;\n\t\t\t\t\t\t// +zLn 不要\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t\tthrow '[endif]がないままスクリプト終端です';\n\t\t//return false;\n\t}\n\n\n\t//MARK: サブルーチンコール\n\t#call(hArg: HArg) {\n\t\tif (! argChk_Boolean(hArg, 'count', false)) this.#eraseKidoku();\n\n\t\tconst {fn} = hArg;\n\t\tif (fn) this.#cnvSnPath(fn);\t// chk only\n\t\tthis.#callSub({...hArg, ':hEvt1Time': ReadingState.popLocalEvts()});\n\t\t\t// ':hEvt1Time'の扱いだけは[macro]と異なる\n\n\t\tif (argChk_Boolean(hArg, 'clear_local_event', false)) this.hTag.clear_event!({});\n\t\treturn this.#jumpWork(fn, hArg.label);\n\t}\n\t#callSub(h: any) {\n\t\tconst csa: ICallStackArg = {...h, ':hMp': this.val.cloneMp(), ':lenIfStk': this.#aIfStk.length};\n\t\tthis.#script.aLNum[this.#idxToken] = this.#lineNum;\t// 戻ったときの行番号\n\t\tif (! this.#resvToken) {csa[':resvToken'] = ''; this.#clearResvToken()}\n\t\tthis.#aCallStk.push(new CallStack(this.#scriptFn, this.#idxToken, csa));\n\t\tthis.#aIfStk.unshift(-1);\t// 最初に要素を追加\n\t}\n\n\t//MARK: シナリオジャンプ\n\t#jump(hArg: HArg) {\n\t\tif (! argChk_Boolean(hArg, 'count', true)) this.#eraseKidoku();\n\n\t\tthis.#aIfStk[0] = -1;\n\t\treturn this.#jumpWork(hArg.fn, hArg.label);\n\t}\n\n\t//MARK: コールスタック破棄\n\t#pop_stack(hArg: HArg) {\n\t\tif (argChk_Boolean(hArg, 'clear', false)) this.#aCallStk = [];\n\t\telse if (! this.#aCallStk.pop()) throw 'スタックが空です';\n\t\tthis.#clearResvToken();\n\t\tthis.#aIfStk = [-1];\n\t\tthis.val.setMp({});\n\n\t\treturn false;\n\t}\n\n\t//MARK: サブルーチンから戻る\n\t#return(hArg: HArg) {\n\t\tconst cs = this.#aCallStk.pop();\n\t\tif (! cs) throw 'スタックが空です';\n\t\tconst csa = cs.csArg;\n\t\tthis.#aIfStk = this.#aIfStk.slice(-csa[':lenIfStk']);\t// 最初の要素を取り除く\n\n\t\tconst hMp = csa[':hMp'];\t// マクロからの復帰の場合にmp:値も復帰\n\t\tif (hMp) this.val.setMp(hMp);\n\n\t\tconst after_token = csa[':resvToken'];\n\t\tif (after_token) this.nextToken = ()=> {\n\t\t\tthis.#clearResvToken();\n\t\t\treturn after_token;\n\t\t}\n\t\telse this.#clearResvToken();\n\t\tif (csa[':hEvt1Time']) ReadingState.pushLocalEvts(csa[':hEvt1Time']);\n\n\t\tconst {fn, label} = hArg;\n\t\tif (fn || label) return this.#jumpWork(fn, label);\n\n\t\tif (cs.fn in this.#hScript) {this.#jump_light(cs); return false}\n\t\treturn this.#jumpWork(cs.fn, '', cs.idx);\t// 確実にスクリプトロードなので\n\t}\n\n\t#resvToken\t= '';\n\t#clearResvToken() {\n\t\tthis.#resvToken = '';\n\t\tthis.nextToken = this.#nextToken_Proc;\n\t}\n\n\n\t#skipLabel = '';\n\t#jumpWork(fn = '', label = '', idx = 0): boolean {\n\t\tif (CmnLib.debugLog) console.log(`📜 %c1:jumpWork%c fn:${fn} lbl:${label} idx:${idx}`, 'color:#3B0;', '');\n\t\tif (! fn && ! label) this.main.errScript('[jump系] fnまたはlabelは必須です');\n\t\tif (label) {\n\t\t\tif (! label.startsWith('*')) this.main.errScript('[jump系] labelは*で始まります');\n\t\t\tthis.#skipLabel = label;\n\t\t\tif (! this.#skipLabel.startsWith('**')) this.#idxToken = idx;\n\t\t}\n\t\telse {\n\t\t\tthis.#skipLabel = '';\n\t\t\tthis.#idxToken = idx;\n\t\t}\n\n\t\tif (! fn) {this.analyzeInit(); return false}\n\t\tif (fn.includes('@')) throw `[jump系] fn には文字「@」は禁止です`;\n\n\t\tconst full_path = this.#cnvSnPath(fn);\n\t\tif (fn === this.#scriptFn) {this.analyzeInit(); return false}\n\t\tthis.#scriptFn = fn;\n\t\tconst st = this.#hScript[fn];\n\t\tif (st) {this.#script = st; this.analyzeInit(); return false}\n\n\t\tconst RPN_JUMPWORK = `jumpWork fn:${fn}`;\n\t\tReading.beginProc(RPN_JUMPWORK);\n\t\tlet fp_diff = '';\n\t\tconst ldr = new Loader;\n\t\ttry {\n\t\t\tfp_diff = this.#cnvSnPath(fn +'@');\n\t\t\t// 派生ファイルが存在する場合\n\t\t\tldr.add({name: fn +':base', url: full_path});\n\t\t\tldr.add({name: fn, url: fp_diff});\n\t\t} catch {\n\t\t\t// 派生ファイルはない\n\t\t\tldr.add({name: fn, url: full_path});\n\t\t}\n\t\tldr.use(async (res, next)=> {\n\t\t\ttry {\n\t\t\t\tres.data = await this.sys.dec(res.extension, res.data);\n\t\t\t} catch (e) {\n\t\t\t\tthis.main.errScript(`[jump系]snロード失敗です fn:${res.name} ${e}`, false);\n\t\t\t}\n\t\t\tnext();\n\t\t})\n\t\t.load((_ldr, hRes)=> {\n\t\t\tReading.endProc(RPN_JUMPWORK);\n\t\t\tif (fp_diff) {\t// 派生ファイルが存在する場合\n\t\t\t\tconst scrBase = hRes[fn +':base']!.data;\n\t\t\t\tconst scrDiff = hRes[fn]!.data;\n\t\t\t\tconst aBase = scrBase.split('\\n');\n\t\t\t\tconst aDiff = scrDiff.split('\\n');\n\t\t\t\tconst lenB = aBase.length;\n\t\t\t\tconst lenD = aDiff.length;\n\t\t\t\t// 【派生スクリプト】の空行へ、【基底スクリプト】の同じ行の内容をコピー\n\t\t\t\tfor (let i=0; i<lenD && i<lenB; ++i) aDiff[i] ||= aBase[i];\n\n\t\t\t\t// 【接尾辞つきファイル】として扱う\n\t\t\t\thRes[fn]!.data = aDiff.join('\\n');\n\t\t\t\tdelete hRes[fn +':base'];\n\t\t\t}\n\n\t\t\tthis.nextToken = this.#nextToken_Proc;\n\t\t\tthis.#lineNum = 1;\n\n\t\t\tthis.#resolveScript(hRes[fn]!.data);\n\t\t\tthis.hTag.record_place!({});\n\t\t\tthis.analyzeInit();\n\t\t});\n\n\t\treturn true;\n\t}\n\tprivate\tanalyzeInit(): void {\n\t\tif (CmnLib.debugLog) console.log(`📜 %c9:analyzeInit%c fn:${this.#scriptFn} lbl:${this.#skipLabel} idx:${this.#idxToken}`, 'color:#3B0;', '');\n\t\tconst o = this.#seekScript(this.#script, Boolean(this.val.getVal('mp:const.sn.macro.name')), this.#lineNum, this.#skipLabel, this.#idxToken);\n\t\tthis.#idxToken\t= o.idx;\n\t\tthis.#lineNum\t= o.ln;\n\t}\n\n\t// シナリオ解析処理ループ・冒頭処理\n\tnextToken = ()=> '';\t// 初期化前に終了した場合向け\n\t#nextToken_Proc(): string {\n\t\tif (this.#errOverScr()) return '';\n\n\t\tthis.#recordKidoku();\n\n\t\t// トークンの行番号更新\n\t\tthis.#script.aLNum[this.#idxToken] ||= this.#lineNum;\t// ??はNaN不可\n\t\tconst token = this.#script.aToken[this.#idxToken]!;\n\t\tthis.#dbgToken(token);\n\t\t++this.#idxToken;\n\n\t\treturn token;\n\t}\n\t#dbgToken = (_token: string)=> {};\n\t#errOverScr(): boolean {\n\t\tif (this.#idxToken < this.#script.len) return false;\n\t\tthis.main.errScript('スクリプト終端です errOverScr');\n\t\treturn true;\n\t}\n\n\n\treadonly #REG_NONAME_LABEL\t\t= /(\\*{2,})([^\\|]*)/;\n\treadonly #REG_TOKEN_MACRO_BEGIN\t= /^\\[macro\\s/;\n\treadonly #REG_TOKEN_MACRO_END\t= /^\\[endmacro[\\s\\]]/;\n\t#seekScript(st: Script, inMacro: boolean, ln: number, skipLabel: string, idx: number): ISeek {\n\t\t//console.log(`seekScript (from)inMacro:${inMacro} (from)ln:${ln} (to)skipLabel:${skipLabel}: (to)idx:${idx}`);\n\t\tconst len = st.aToken.length;\n\t\tif (! skipLabel) {\t// ラベルジャンプ以外（先頭から開始）\n\t\t\tif (this.#errOverScr()) return {idx, ln};\n\n\t\t\tif (! st.aLNum[idx]) {\t// NaN、undefined は falsy\n\t\t\t\tln = 1;\n\t\t\t\tfor (let j=0; j<idx; ++j) {\n\t\t\t\t\t// 走査ついでにトークンの行番号も更新\n\t\t\t\t\tst.aLNum[j] ||= ln;\t// ??はNaN不可\n\n\t\t\t\t\tconst tkn = st.aToken[j]!;\n\t\t\t\t\tif (tkn.startsWith('\\n')) ln += tkn.length;\t// \\n 改行\n\t\t\t\t\telse ln += (tkn.match(/\\n/g) ?? []).length;\n\t\t\t\t}\n\t\t\t\tst.aLNum[idx] = ln;\n\t\t\t}\n\t\t\telse ln = st.aLNum[idx];\n\n\t\t\treturn {idx, ln};\n\t\t}\n\n\t\t// 無名ラベルジャンプ\n\t\tst.aLNum[0] = 1;\n\t\tconst a_skipLabel = skipLabel.match(this.#REG_NONAME_LABEL);\n\t\tif (a_skipLabel) {\n\t\t\tskipLabel = a_skipLabel[1]!;\n\t\t\tlet i = idx;\n\t\t\tswitch (a_skipLabel[2]) {\n\t\t\tcase 'before':\n\t\t\t\twhile (st.aToken[--i] !== skipLabel) {\n\t\t\t\t\tif (i === 0) DebugMng.myTrace('[jump系 無名ラベルbefore] '\n\t\t\t\t\t\t+ ln +'行目以前で'+ (inMacro ?'マクロ内に' :'')\n\t\t\t\t\t\t+ 'ラベル【'+ skipLabel +'】がありません', 'ET');\n\t\t\t\t\tif (inMacro && st.aToken[i]!.search(this.#REG_TOKEN_MACRO_BEGIN) > -1) DebugMng.myTrace('[jump系 無名ラベルbefore] マクロ内にラベル【'+ skipLabel +'】がありません', 'ET');\n\t\t\t\t}\n\t\t\t\treturn {idx: i +1, ln: st.aLNum[i]!};\t//\tbreak;\n\n\t\t\tcase 'after':\n\t\t\t\twhile (st.aToken[++i] !== skipLabel) {\n\t\t\t\t\tif (i === len) DebugMng.myTrace('[jump系 無名ラベルafter] '\n\t\t\t\t\t\t+ ln +'行目以後でマクロ内にラベル【'+ skipLabel +'】がありません', 'ET');\n\t\t\t\t\tif (st.aToken[i]!.search(this.#REG_TOKEN_MACRO_END) > -1) DebugMng.myTrace('[jump系 無名ラベルafter] '\n\t\t\t\t\t\t+ ln +'行目以後でマクロ内にラベル【'+ skipLabel +'】がありません', 'ET');\n\t\t\t\t}\n\t\t\t\treturn {idx: i +1, ln: st.aLNum[i]!};\t//\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tDebugMng.myTrace('[jump系] 無名ラベル指定【label='+ skipLabel +'】が間違っています', 'ET');\n\t\t\t}\n\t\t}\n\n\t\t// ラベルジャンプ\n\t\tln = 1;\n\t\tconst reLabel = new RegExp(\n\t\t\t'^'+ skipLabel.replaceAll('*', '\\\\*') +'(?=\\\\s|;|\\\\[|\\\\||$)');\n\t\tlet in_let_ml = false;\n\t\tfor (let i=0; i<len; ++i) {\n\t\t\t// 走査ついでにトークンの行番号も更新\n\t\t\tst.aLNum[i] ||= ln;\t// ??はNaN不可\n\n\t\t\tconst tkn = st.aToken[i]!;\n\t\t\tif (in_let_ml) {\n\t\t\t\tif (this.#grm.testTagEndLetml(tkn)) in_let_ml = false;\n\t\t\t\telse ln += (tkn.match(/\\n/g) ?? []).length;\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst uc = tkn.charCodeAt(0);\t// TokenTopUnicode\n\t\t\tif (uc === 10) {ln += tkn.length; continue}\t// \\n 改行\n\t\t\tif (uc === 42) {\t// 42 = *\n\t\t\t\tif (tkn.search(reLabel) > -1) return {idx: i +1, ln};//\tbreak;\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif (uc !== 91) continue;\t// [ タグ開始\n\n\t\t\tln += (tkn.match(/\\n/g) ?? []).length;\n\t\t\tif (this.#grm.testTagLetml(tkn)) in_let_ml = true;\n\t\t}\n\t\tif (in_let_ml) throw '[let_ml]の終端・[endlet_ml]がありません';\n\n\t\tDebugMng.myTrace(`[jump系] ラベル【${skipLabel}】がありません`, 'ET');\n\t\tthrow 'Dummy';\n\t}\n\n\t#hScript\t: HScript\t= Object.create(null);\t//{} シナリオキャッシュ\n\t#resolveScript(txt: string) {\n\t\tlet mes = '';\n\t\ttry {\n\t\t\tmes = 'ScriptIterator.resolveScript';\n\t\t\tconst scr = this.#grm.resolveScript(txt);\n\t\t\tmes = 'ScriptIterator.replaceScript_Wildcard';\n\t\t\tthis.#replaceScript_Wildcard(scr);\n\t\t\tthis.#hScript[this.#scriptFn] = this.#script = scr;\n\t\t}\n\t\tcatch (e) {\n\t\t\tif (e instanceof Error) mes += `例外 mes=${e.message}(${e.name})`;\n\t\t\telse mes = String(e);\n\t\t\tthis.main.errScript(mes, false);\n\t\t}\n\t\tthis.val.touchAreaKidoku(this.#scriptFn);\n\t}\n\n\t#jump_light(cs: CallStack) {\n\t\t// jumpでは連続マクロでスタックオーバーフローになるので簡易版を\n\t\t// 主に[return]やマクロ終了でジャンプ先がチェック不要な場合用\n\t\t// analyzeInit()とかもジャンプ前にやってて不要だし\n\t\tthis.#scriptFn\t= cs.fn;\n\t\tthis.#idxToken\t= cs.idx;\n\t\tconst st = this.#hScript[this.#scriptFn];\n\t\tif (st) this.#script = st;\n\t\tthis.#lineNum = this.#script.aLNum[cs.idx]!;\n//console.log(`fn:ScriptIterator.ts %cjump_light cs ${cs.fn}:${this.#lineNum} idx:${cs.idx}`, 'background-color:#a03b79;');\n\t}\n\n\n\treadonly #REG_WILDCARD\t= /^\\[(call|loadplugin)\\s/;\n\treadonly #REG_WILDCARD2\t= /\\bfn\\s*=\\s*[^\\s\\]]+/;\n\t#replaceScript_Wildcard(scr: Script) {\n\t\tfor (let i=scr.len -1; i>=0; --i) {\n\t\t\tconst token = scr.aToken[i]!;\n\t\t\tif (! this.#REG_WILDCARD.test(token)) continue;\n\n\t\t\tconst [tag_name, args] = tagToken2Name_Args(token);\n\t\t\tthis.#alzTagArg.parse(args);\n\n\t\t\tconst p_fn = this.#alzTagArg.hPrm.fn;\n\t\t\tif (! p_fn) continue;\n\t\t\tconst {val: fn} = p_fn;\n\t\t\tif (! fn || ! fn.endsWith('*')) continue;\n\n\t\t\tscr.aToken.splice(i, 1, '\\t', '; '+ token);\n\t\t\tscr.aLNum.splice(i, 1, NaN, NaN);\n\n\t\t\tconst ext = tag_name === 'loadplugin'\n\t\t\t\t? SEARCH_PATH_ARG_EXT.CSS\n\t\t\t\t: SEARCH_PATH_ARG_EXT.SN;\n\t\t\tconst a = this.cfg.matchPath('^'+ fn.slice(0, -1) +'.*', ext);\n\t\t\tfor (const v of a) {\n\t\t\t\tconst nt = token.replace(\n\t\t\t\t\tthis.#REG_WILDCARD2,\n\t\t\t\t\t'fn='+ decodeURIComponent(getFn(v[ext]!))\n\t\t\t\t);\n\t\t\t\t//console.log('\\t='+ nt +'=');\n\t\t\t\tscr.aToken.splice(i, 0, nt);\n\t\t\t\tscr.aLNum.splice(i, 0, NaN);\n\t\t\t}\n\t\t}\n\t\tscr.len = scr.aToken.length;\n\t}\n\n\n\t#recordKidoku() {\n\t\tconst areas = this.val.touchAreaKidoku(this.#scriptFn);\n\n\t\t// マクロ内やサブルーチンではisKidokuを変更させない\n\t\tif (this.#aCallStk.length > 0) {areas.record(this.#idxToken); return}\n\n\t\tthis.#isKidoku = areas.search(this.#idxToken);\n\t\tthis.val.setVal_Nochk('tmp', 'const.sn.isKidoku', this.#isKidoku);\n\t\tif (this.#isKidoku) return;\n\n\t\tareas.record(this.#idxToken);\n\t\t// saveKidoku()\n\t\t\t// 厳密にはここですべきだが、パフォーマンスに問題があるので\n\t\t\t// クリック待ちを期待できるwait、waitclick、s、l、pタグで\n\t\t\t// saveKidoku()をコール。\n\t}\n\t#isKidoku\t= false;\n\tget isKidoku() {return this.#isKidoku};\n\t#eraseKidoku() {\n\t\tthis.val.getAreaKidoku(this.#scriptFn)?.erase(this.#idxToken);\n\t\tthis.#isKidoku = false;\n\t}\n\tget isNextKidoku(): boolean {\n\t\tlet fn\t= this.#scriptFn;\n\t\tlet idx\t= this.#idxToken;\n\t\tlet len\t= this.#script.len;\n\t\tif (this.#aCallStk.length > 0) {\n\t\t\tconst cs = this.#aCallStk[0]!;\n\t\t\tfn  = cs.fn;\n\t\t\tidx = cs.idx;\n\t\t\tconst st = this.#hScript[fn];\n\t\t\tif (st) len = st.len;\n\t\t}\n\n\t\tconst areas = this.val.getAreaKidoku(fn);\n\t\tif (idx === len) return false;\t// スクリプト終端\n\n\t\treturn areas.search(idx);\n\t}\n\n\n\tget normalWait(): number {\n\t\treturn this.#isKidoku\n\t\t? (\n\t\t\tthis.val.tagCh_doWait_Kidoku\n\t\t\t?\tthis.val.tagCh_msecWait_Kidoku\n\t\t\t:\t0\n\t\t)\n\t\t: (\n\t\t\tthis.val.tagCh_doWait\n\t\t\t?\tthis.val.tagCh_msecWait\n\t\t\t:\t0\n\t\t);\n\t}\n\n\n\t//MARK: 括弧マクロの定義\n\t#bracket2macro(hArg: HArg) {\n\t\tthis.#grm.bracket2macro(hArg, this.hTag, this.#script, this.#idxToken);\n\n\t\treturn false;\n\t}\n\n\t//MARK: 一文字マクロの定義\n\t#char2macro(hArg: HArg) {\n\t\tthis.#grm.char2macro(hArg, this.hTag, this.#script, this.#idxToken);\n\n\t\treturn false;\n\t}\n\n\t//MARK: マクロ定義の開始\n\treadonly\t#REG_NG4MAC_NM = /[\"'#;\\\\]　]+/;\n\t#macro(hArg: HArg) {\n\t\tconst {name} = hArg;\n\t\tif (! name) throw 'nameは必須です';\n\t\tif (name in this.hTag) throw `[${name}]はタグかすでに定義済みのマクロです`;\n\t\tif (this.#REG_NG4MAC_NM.test(name)) throw `[${name}]はマクロ名として異常です`;\n\n\t\tconst ln = this.#lineNum;\n\t\tconst cs = new CallStack(this.#scriptFn, this.#idxToken);\n\t\tthis.#strStepin += '|'+ name;\n\t\tthis.#REGSTEPIN = new RegExp(`\\\\[(${this.#strStepin})\\\\b`);\n\t\tthis.hTag[name] = hArgM=> {\n\t\t\thArgM.design_unit = hArg.design_unit;\n\t\t\tthis.#callSub(hArgM);\n\n\t\t\t// AIRNovelの仕様：親マクロが子マクロコール時、*がないのに値を引き継ぐ\n\t\t\t//for (const k of Object.keys(hArg)) this.val.setVal_Nochk('mp', k, hArg[k]);\n\t\t\tthis.val.setMp(hArgM as any);\n\t\t\tthis.val.setVal_Nochk('mp', 'const.sn.macro', JSON.stringify({\n\t\t\t\tname: hArg.name,\n\t\t\t}));\t// ムダに大きいスクリプター用情報を削除\n\t\t\tthis.val.setVal_Nochk('mp', 'const.sn.me_call_scriptFn', this.#scriptFn);\n\n\t\t\tthis.#lineNum = ln;\n\t\t\tthis.#jump_light(cs);\n\n\t\t\treturn false;\n\t\t};\n\n\t\tfor (; this.#idxToken < this.#script.len; ++this.#idxToken) {\n\t\t\t// トークンの行番号更新\n\t\t\tthis.#script.aLNum[this.#idxToken] ||= this.#lineNum; // ??はNaN不可\n\n\t\t\tconst token = this.#script.aToken[this.#idxToken]!;\n\t\t\tif (token.search(this.#REG_TOKEN_MACRO_END) > -1) {\n\t\t\t\t++this.#idxToken;\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tconst uc = token.charCodeAt(0);\t// TokenTopUnicode\n\t\t\tif (uc === 10) this.#lineNum += token.length;\t// \\n 改行\n\t\t\telse if (uc === 91) this.#lineNum += (token.match(/\\n/g) ?? []).length;\t// [ タグ開始\n\t\t}\n\t\tthrow `マクロ[${name}]定義の終端・[endmacro]がありません`;\n\t}\n\t#strStepin\t= 'call';\n\t#REGSTEPIN\t= /\\[(call)\\b/;\t// https://regex101.com/r/Lk9ASK/1\n\n\n\t//MARK: しおりの読込\n\t#load(hArg: HArg) {\n\t\tif (('fn' in hArg) !== ('label' in hArg)) throw 'fnとlabelはセットで指定して下さい';\n\n\t\tconst place = argChk_Num(hArg, 'place', 0);\n\t\tconst mark = this.val.getMark(place);\n\n\t\treturn this.loadFromMark(hArg, mark, SndProcOnLoad.ALL_STOP_AND_PLAY);\n\t}\n\tloadFromMark(hArg: HArg, mark: IMark, snd: SndProcOnLoad = SndProcOnLoad.MINIMAL_STOP) {\n\t\tthis.hTag.clear_event!({});\n\t\tthis.val.mark2save(mark);\n\t\tthis.val.setMp({});\n\t\tthis.#layMng.recPagebreak();\n\n\t\tlet ap: Promise<void>[] = [];\n\t\tif (snd !== SndProcOnLoad.NO_TOUCH) ap = this.sndMng\n\t\t.playLoopFromSaveObj(snd === SndProcOnLoad.ALL_STOP_AND_PLAY);\n\n\t\tif (argChk_Boolean(hArg, 'do_rec', true)) this.#mark = {\n\t\t\thSave\t: this.val.cloneSave(),\n\t\t\thPages\t: {...mark.hPages},\n\t\t\taIfStk\t: [...mark.aIfStk],\n\t\t}\n\n\t\tconst o: HArg = {\n\t\t\tenabled\t: this.val.getVal('save:const.sn.autowc.enabled'),\n\t\t\ttext\t: this.val.getVal('save:const.sn.autowc.text'),\n\t\t\ttime\t: Number(this.val.getVal('save:const.sn.autowc.time')),\n\t\t};\n\t\tthis.hTag.autowc!(o);\n\n\t\tthis.#aIfStk = [...this.#mark.aIfStk];\n\t\tthis.#aCallStk = [];\n\t\tCmnTween.stopAllTw();\n\n\t\tconst p = Promise.allSettled([...ap, ...this.#layMng.playback(this.#mark.hPages)])\n\t\t.then(()=> this.#layMng.cover(false))\n\t\t.catch(e=> console.error(`loadFromMark e:%o`, e));\n\t\tconst {index, fn} = hArg;\n\t\tif (index) {\t// ページ移動用\n\t\t\tif (CmnLib.debugLog) console.log(`📜 %cloadFromMark index:${index} move!%c fn:${fn}`, 'color:#3B0;', '');\n\t\t\tp.then(()=> {\n\t\t\t\tif (! this.#jumpWork(fn, '', index)) this.main.resume();\n\t\t\t\t// if (ret)\t\t// 中で非同期で endProc() を呼ぶのでまかせる\n\t\t\t\t// if (! ret)\t// 同期でなにもせずすぐ返る\n\t\t\t});\n\t\t\treturn true;\n\t\t}\n\n\t\tthis.#layMng.cover(true);\t// ページ移動では全画面黒で覆わない\n\t\tconst fn2 = String(this.val.getVal('save:const.sn.scriptFn'));\n\t\tconst idx = Number(this.val.getVal('save:const.sn.scriptIdx'));\n\t\tdelete this.#hScript[fn2];\t// 必ずスクリプトを再読込。吉里吉里に動作を合わせる\n\t\tconst {label} = hArg;\n\t\tif (label) p.then(()=> {\n\t\t\tthis.#scriptFn = fn2;\n\t\t\tthis.#idxToken = idx;\n\t\t\tif (! this.hTag.call!({fn, label})) this.main.resume();\n\t\t});\n\t\telse p.then(()=> {\n\t\t\tif (! this.#jumpWork(fn2, '', idx)) this.main.resume();\n\t\t});\n\t\treturn true;\n\t}\n\n\t//MARK: スクリプト再読込\n\t#reload_script(hArg: HArg) {\t// 最後の[record_place]から再開\n\t\tconst mark = this.val.getMark(0);\n\t\t// 起動から再読込までの間に追加・変更・削除されたファイルがあるかも、に対応\n\t\t//\tdelete this.hScript[this.#scriptFn];\t// これだと[reload_script]位置になる\n\t\tdelete this.#hScript[getFn(mark.hSave['const.sn.scriptFn'])];\n\n\t\t// 派生ファイルを削除\n\t\tconst h: HScript = {};\n\t\tfor (const fn in this.#hScript) {\n\t\t\ttry {this.#cnvSnPath(fn +'@')}\n\t\t\tcatch {h[fn] = this.#hScript[fn]!}\t// 派生ファイル以外を残す\n\t\t}\n\t\tthis.#hScript = h;\n\n\t\thArg.do_rec = false;\n\t\treturn this.loadFromMark(hArg, mark, SndProcOnLoad.NO_TOUCH);\n\t}\n\n\n\t//MARK: セーブポイント指定\n\t#mark: IMark = {\n\t\thSave\t: {},\n\t\thPages\t: {},\n\t\taIfStk\t: [-1],\n\t};\n\t#record_place = ()=> {\n\t\tconst {fn, idx} = this.nowScrIdx();\n\t\tthis.val.setVal_Nochk('save', 'const.sn.scriptFn', fn);\n\t\tthis.val.setVal_Nochk('save', 'const.sn.scriptIdx', idx);\n\t\tthis.#mark = {\n\t\t\thSave\t: this.val.cloneSave(),\n\t\t\thPages\t: this.#layMng.record(),\n\t\t\taIfStk\t: this.#aIfStk.slice(this.#aCallStk.length),\n\t\t};\n\n\t\treturn false;\n\t}\n\tnowScrIdx(): {fn: string, idx: number} {\n\t\tconst len = this.#aCallStk.length;\n\t\tif (len === 0) return {\n\t\t\tfn\t: this.#scriptFn,\n\t\t\tidx\t: this.#idxToken,\n\t\t};\n\n\t\tconst cs = this.#aCallStk[0]!;\n\t\treturn {\n\t\t\tfn\t: cs.fn,\n\t\t\tidx\t: cs.idx,\n\t\t}\n\t}\n\tnowMark(): IMark {return {...this.#mark}}\n\n\t//MARK: スクリプト停止位置（マクロなどなら最上位の呼び元）\n\tnowScrFnLn(): {fn: string, ln: number, col_s: number, col_e: number} {\n\t\tconst {fn, idx} = this.nowScrIdx();\n\t\tconst st = this.#hScript[fn]!;\n\t\tconst o = this.#cnvIdx2lineCol(st, idx);\t// -1不要\n\t\treturn {fn, ...o};\n\t}\n\n\t//MARK: しおりの保存\n\t#save(hArg: HArg) {\n\t\tif (! ('place' in hArg)) throw 'placeは必須です';\n\t\tconst place = Number(hArg.place);\n\n\t\tdelete hArg[':タグ名'];\n\t\tdelete hArg.place;\n\t\thArg.text = hArg.text ?? '';\n\t\tthis.#mark.json = hArg;\n\t\tthis.val.setMark(place, this.#mark);\n\n\t\tconst now_sp = Number(this.val.getVal('sys:const.sn.save.place'));\n\t\tif (place === now_sp) this.val.setVal_Nochk('sys', 'const.sn.save.place', now_sp +1);\n\n\t\treturn false;\n\t}\n\n\n\trecodeDesign(hArg: HArg) {\n\t\tlet fn = '';\n\t\tlet idx = 0;\n\n\t\tconst len = this.#aCallStk.length;\n\t\tif (hArg.design_unit && len > 0) {\n\t\t\t// デザインモードでこのマクロへの引数変更とするか（内部をサーチさせない）\n\t\t\tconst cs = this.#aCallStk[0]!;\n\t\t\tfn = cs.fn;\n\t\t\tidx = cs.idx;\n\t\t}\n\t\telse {\n\t\t\tfn = this.#scriptFn;\n\t\t\tidx = this.#idxToken;\n\t\t}\n\t\thArg[':path']\t= this.#cnvSnPath4Dbg(fn);\n\t\tconst scr = this.#hScript[fn]!;\n\t\tconst lc = this.#cnvIdx2lineCol(scr, idx);\n\t\thArg[':ln']\t\t= lc.ln;\n\t\thArg[':col_s']\t= lc.col_s;\n\t\thArg[':col_e']\t= lc.col_e;\n\t\tconst idx_1 = idx -1;\n\t\thArg[':idx_tkn']= idx_1;\n\t\thArg[':token']\t= scr.aToken[idx_1];\n\n\t\tthis.sys.send2Dbg('_recodeDesign', hArg);\n\t}\n\treplace(idx: number, val: string) {this.#script.aToken[idx] = val}\n\n}\n","/* ***** BEGIN LICENSE BLOCK *****\n\tCopyright (c) 2019-2025 Famibee (famibee.blog38.fc2.com)\n\n\tThis software is released under the MIT License.\n\thttp://opensource.org/licenses/mit-license.php\n** ***** END LICENSE BLOCK ***** */\n\nimport {CmnLib, type IEvtMng, argChk_Boolean, argChk_Num} from './CmnLib';\nimport type {HArg} from './Grammar';\nimport type {Config} from './Config';\nimport {CmnTween} from './CmnTween';\nimport {SpritesMng} from './SpritesMng';\nimport {DebugMng} from './DebugMng';\nimport type {IMakeDesignCast} from './LayerMng';\n//import {TxtLayDesignCast, TxtLayPadDesignCast} from './DesignCast';\nimport type {SysBase} from './SysBase';\nimport {Hyphenation, type IChRect} from './Hyphenation';\nimport {ScriptIterator, RPN_COMP_CHIN} from './ScriptIterator';\nimport {Reading} from './Reading';\n\nimport {Container, Texture, Sprite, Graphics, Rectangle, Renderer, Application} from 'pixi.js';\nimport {Tween} from '@tweenjs/tween.js'\n\ninterface IInfTxLay {\n\tfontsize\t: number;\n\t$width\t\t: number;\t// レイヤサイズであり、背景色（画像）サイズ\n\t$height\t\t: number;\n\tpad_left\t: number;\t// paddingLeft（レイヤサイズの内側のスペーサー）\n\tpad_right\t: number;\t// paddingRight\n\tpad_top\t\t: number;\t// paddingTop\n\tpad_bottom\t: number;\t// paddingBottom\n};\n\ninterface ISpTw {\n\tsp\t: Container;\n\ttw\t: Tween<Container> | undefined;\n};\n\n\nexport class TxtStage extends Container {\n\tstatic\t#cfg\t: Config;\n\tstatic\t#appPixi: Application;\n\tstatic\tinit(cfg: Config, appPixi: Application): void {\n\t\tTxtStage.#cfg = cfg;\n\t\tTxtStage.#appPixi = appPixi;\n\t}\n\tstatic\t#evtMng\t: IEvtMng;\n\tstatic\t#scrItr\t: ScriptIterator;\n\tstatic\tsetEvtMng(evtMng: IEvtMng, scrItr: ScriptIterator) {\n\t\tTxtStage.#evtMng = evtMng;\n\t\tTxtStage.#scrItr = scrItr;\n\t}\n\n\tstatic\tdestroy() {\n\t\tTxtStage.#hChInStyle\t= Object.create(null);\n\t\tTxtStage.#hChOutStyle\t= Object.create(null);\n\n\t\tTxtStage.delBreak();\n\t}\n\n\n\t\t\t\t#htmTxt\t= document.createElement('span');\t// サンプリング元\n\treadonly\t#cntTxt\t\t\t= new Container;\t\t\t// サンプリング先\n\treadonly\t#grpDbgMasume\t= new Graphics;\n\tstatic\treadonly\t#hWarnStyle = {\n\t\t'background-color'\t\t: 0,\n\t\t'border-bottom-width'\t: 0,\n\t\t'border-left-width'\t\t: 0,\n\t\t'border-right-width'\t: 0,\n\t\t'border-top-width'\t\t: 0,\n\t\t'margin-bottom'\t: 0,\n\t\t'margin-left'\t: 0,\n\t\t'margin-right'\t: 0,\n\t\t'margin-top'\t: 0,\n\t};\n\n\n\t#hyph\t= new Hyphenation;\n\tnoticeCompTxt\t= ()=> {};\n\tconstructor(private readonly ctn: Sprite, private readonly canFocus: ()=> boolean, private readonly sys: SysBase) {\n\t\tsuper();\n\n\t\tthis.#htmTxt.classList.add('sn_tx');\n\t\tthis.#htmTxt.style.position = 'absolute';\n\t\tTxtStage.#appPixi.view.parentElement!.appendChild(this.#htmTxt);\n\n\t\tthis.addChild(this.#cntTxt);\n\n\t\tthis.addChild(this.#grpDbgMasume);\n\t\tthis.#grpDbgMasume.name = 'grpDbgMasume';\n\n//\t\tthis.#idc = new TxtLayDesignCast(ctn, this);\n//\t\tthis.#idc.adopt(this.#idcCh);\n\n\t\tthis.noticeCompTxt = sys.isApp && TxtStage.#cfg.oCfg.debug.dumpHtm\n\t\t? ()=> {\n\t\t\tReading.notifyEndProc(RPN_COMP_CHIN);\n\n\t\t\tconst htm = this.#htmTxt.innerHTML;\n\t\t\tif (htm === '') return;\n\t\t\tconst {fn, ln} = TxtStage.#scrItr.nowScrFnLn();\n\t\t\tconst id = `dumpHtm ${\n\t\t\t\tctn.name.slice(0, -7)\t// 末尾「 page=B」削り\n\t\t\t\t.replaceAll(':', '=')\t\t\t// ファイル名で困る文字\n\t\t\t}(fn=${fn} line=${ln})`;\n\t\t\tsys.outputFile(\n\t\t\t\tsys.path_downloads + id +'.htm',\n`<!doctype html><html><head><meta charset=utf-8><title>${id}</title>\n<h1>${id}</h1>${\n\thtm\t// outerHTML からのレイヤ再現などしたいとこだがオーバースペック\n\t.replaceAll(/ class=\"sn_ch\"|animation-delay: \\d+ms; ?| data-add=\"{&quot;ch_in_style&quot;:&quot;default&quot;, &quot;ch_out_style&quot;:&quot;default&quot;}\"/g, '')\n\t.replaceAll(' style=\"\"', '')\t// chromeで警告が出るので\n\t.replaceAll(/(<\\/?ruby>)/g, '\\n$1\\n')\n\t.replaceAll(/<(br|\\/span)>/g, '<$1>\\n')\n}`,\n\t\t\t);\n\t\t}\n\t\t: ()=> Reading.notifyEndProc(RPN_COMP_CHIN);\n\t}\n\n//\treadonly\t#idc\t:TxtLayDesignCast;\n//\treadonly\t#idcCh\t= new TxtLayPadDesignCast(this);\n\t#infTL :IInfTxLay = {\n\t\tfontsize\t: 24,\n\t\t$width\t\t: 0,\t// レイヤサイズであり、背景色（画像）サイズ\n\t\t$height\t\t: 0,\n\t\tpad_left\t: 0,\t// paddingLeft（レイヤサイズの内側のスペーサー）\n\t\tpad_right\t: 0,\t// paddingRight\n\t\tpad_top\t\t: 0,\t// paddingTop\n\t\tpad_bottom\t: 0,\t// paddingBottom\n\t}\n\n\tlay(hArg: HArg) {\n\t\tconst s = this.#htmTxt.style;\n\t\tif ('style' in hArg) {\n\t\t\tif (hArg.style) {\n\t\t\t\tconst cln = document.createElement('span');\n\t\t\t\tcln.style.cssText = hArg.style;\n\t\t\t\tconst len = cln.style.length;\n\t\t\t\tfor (let i=0; i<len; ++i) {\n\t\t\t\t\tconst key: any = cln.style[i];\n\t\t\t\t\tif (key in TxtStage.#hWarnStyle) {\n\t\t\t\t\t\tDebugMng.myTrace(`${key}は指定できません`, 'W');\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\ts[key] = cln.style[key]!;\n\t\t\t\t}\n\t\t\t\tif (! cln.style.opacity && 'alpha' in hArg) s.opacity = String(this.ctn.alpha);\n\t\t\t}\n\t\t\telse this.#htmTxt.style.cssText = '';\n\t\t}\n\t\telse if ('alpha' in hArg) s.opacity = String(this.ctn.alpha);\n\n\t\tif ('width' in hArg) s.width = (hArg.width ?? '0') +'px';\n\t\tif ('height' in hArg) s.height = (hArg.height ?? '0') +'px';\n\t\tif ('pl' in hArg) s.paddingLeft = (hArg.pl ?? '0') +'px';\n\t\tif ('pr' in hArg) s.paddingRight = (hArg.pr ?? '0') +'px';\n\t\tif ('pt' in hArg) s.paddingTop = (hArg.pt ?? '0') +'px';\n\t\tif ('pb' in hArg) s.paddingBottom = (hArg.pb ?? '0') +'px';\n\t\tthis.#hyph.lay(hArg);\n\t\tthis.#lay_sub();\n//\t\tthis.#idc.sethArg(hArg);\n\n\t\t// CSS・インラインレイアウトで右や上にはみ出る分の余裕\n\t\tthis.#left = this.ctn.position.x;\n\t\t\t//-(CmnLib.isSafari && !CmnLib.isMobile && this.#isTategaki\n\t\t\t//\t? this.#infTL.pad_left +this.#infTL.pad_right\n\t\t\t//\t: 0);\t// 無効化 2022/02/09\n\t\ts.transformOrigin = `${this.ctn.pivot.x}px ${this.ctn.pivot.y}px`;\n\t\tthis.cvsResize();\n\t\ts.display = this.ctn.visible ?'inline' :'none';\n\n\t\t// パディングキャスト変更時・クリック待ち表示を追従させる（高速再描写）\n\t\tif (':redraw' in hArg && this.#lenHtmTxt > 0) {\n\t\t\tconst aSpan = [\n\t\t\t\tthis.#htmTxt.innerHTML.replaceAll(/(animation-delay: )\\d+ms/g, '$10ms'),\n\t\t\t\t`<span class='sn_ch' data-add='{\"ch_in_style\":\"default\"}'>&emsp;</span>`,\n\t\t\t];\n\t\t\tthis.#clearText();\t// 消去\n\t\t\tthis.goTxt(aSpan, true);\t// 高速 goTxt()\n\t\t}\n\t}\n\t#lh_half\t= 0;\t// 「g」などで下が欠ける問題対策\n\t#lay_sub() {\n\t\tconst s = this.#htmTxt.style;\n\t\tconst fs = parseFloat(s.fontSize || '0');\n\t\tthis.#infTL.fontsize = fs;\n\n\t\tthis.#infTL.pad_left = parseFloat(s.paddingLeft || '0');\n\t\tthis.#infTL.pad_right = parseFloat(s.paddingRight || '0');\n\t\tthis.#infTL.pad_top = parseFloat(s.paddingTop || '0');\n\t\tthis.#infTL.pad_bottom = parseFloat(s.paddingBottom || '0');\n\t\tthis.#infTL.$width = parseFloat(s.width || '0');\n\t\tthis.#infTL.$height = parseFloat(s.height || '0');\n\t\tthis.position.set(this.#infTL.pad_left, this.#infTL.pad_top);\n\n\t\tthis.#isTategaki = (s.writingMode === 'vertical-rl');\n\n\t\tthis.#padTx4x = 0;\n\t\tthis.#padTx4y = 0;\n\n\t\tconst lh = s.lineHeight ?? '0';\n\t\tthis.#lh_half = this.#isTategaki\n\t\t\t? 0\n\t\t\t: (\t(lh.endsWith('px'))\n\t\t\t\t? parseFloat(lh)\n\t\t\t\t: (fs *parseFloat(lh) -fs)) /2;\n\t\t\t// globalThis.getComputedStyle(this.htmTxt)がチョイチョイ値を返さないので\n\t}\n\tcvsResize() {\n\t\tconst s = this.#htmTxt.style;\n\t\tconst cvsScale = this.sys.cvsScale;\n\t\ts.left = `${this.sys.ofsLeft4elm +this.#left *cvsScale}px`;\n\t\ts.top = `${this.sys.ofsTop4elm +this.ctn.position.y *cvsScale}px`;\n\t\ts.transform = `rotate(${this.ctn.angle}deg) scale(${this.ctn.scale.x *cvsScale}, ${this.ctn.scale.y *cvsScale})`;\n\n//\t\tthis.#idc.cvsResize();\n//\t\tthis.#idcCh.cvsResize();\n\t}\n\t#left = 0;\n\t#isTategaki = false;\n\tget tategaki() {return this.#isTategaki}\n\t#padTx4x = 0;\n\t#padTx4y = 0;\n\n\tget\tinfTL(): IInfTxLay {return this.#infTL}\n\tget\tgetWidth() {return this.#infTL.$width}\n\tget\tgetHeight() {return this.#infTL.$height}\n\n\tsetMySize(width: number, height: number) {\n\t\tthis.#infTL.$width = width;\n\t\tthis.#infTL.$height = height;\n\t\tthis.#htmTxt.style.width = this.#infTL.$width +'px';\n\t\tthis.#htmTxt.style.height = this.#infTL.$height +'px';\n\t}\n\n\n\t#htm2tx(fnc: (tx2: any)=> void, hidden = true) {\n\t\t// tsayen/dom-to-image: Generates an image from a DOM node using HTML5 canvas https://github.com/tsayen/dom-to-image\n\n/*---*/\n\t\tconst util = {\n\t\t\tescape: (str: string)=> str.replaceAll(/([.*+?^${}()|\\[\\]\\/\\\\])/g, '\\\\$1'),\n\t\t\tmimeType: (url: any)=> {\n\t\t\t\tconst extension = parseExtension(url).toLowerCase();\n\t\t\t\treturn mimes()[extension] || '';\n\t\t\t},\n\t\t\tdataAsUrl: dataAsUrl,\n\t\t\tisDataUrl: isDataUrl,\n\t\t\tresolveUrl: resolveUrl,\n\t\t\tgetAndEncode: getAndEncode,\n\t\t\tasArray: (arrayLike: StyleSheetList)=> {\n\t\t\t\tconst a: StyleSheet[] = [];\n\t\t\t\tconst len = arrayLike.length;\n\t\t\t\tfor (let i=0; i<len; ++i) a.push(arrayLike[i]!);\n\t\t\t\treturn a;\n\t\t\t},\n\t\t};\n\t\t\tfunction mimes(): any {\n\t\t\t\t// Only WOFF and EOT mime types for fonts are 'real'\n\t\t\t\t// * see http://www.iana.org/assignments/media-types/media-types.xhtml\n\t\t\t\tconst WOFF = 'application/font-woff';\n\t\t\t\tconst JPEG = 'image/jpeg';\n\n\t\t\t\treturn {\n\t\t\t\t\t'woff': WOFF,\n\t\t\t\t\t'woff2': WOFF,\n\t\t\t\t\t'ttf': 'application/font-truetype',\n\t\t\t\t\t'eot': 'application/vnd.ms-fontobject',\n\t\t\t\t\t'png': 'image/png',\n\t\t\t\t\t'jpg': JPEG,\n\t\t\t\t\t'jpeg': JPEG,\n\t\t\t\t\t'gif': 'image/gif',\n\t\t\t\t\t'tiff': 'image/tiff',\n\t\t\t\t\t'svg': 'image/svg+xml'\n\t\t\t\t};\n\t\t\t}\n\n\n\t\tconst inliner = newInliner();\n\n\n\t\tconst fontFaces = newFontFaces();\n\n\n\t\tfunction embedFonts(node: any) {\n\t\t\treturn fontFaces.resolveAll()\n\t\t\t.then(cssText=> {\n\t\t\t\tconst styleNode = document.createElement('style');\n\t\t\t\tnode.appendChild(styleNode);\n\t\t\t\tstyleNode.appendChild(document.createTextNode(cssText));\n\t\t\t//console.log('cssText:%s:', cssText);\t//------------\n\t\t\t\treturn node;\n\t\t\t});\n\t\t}\n\n\n\t\t\tfunction parseExtension(url: any) {\n\t\t\t\tconst match = /\\.([^\\.\\/]*?)$/g.exec(url);\n\t\t\t\treturn match?.[1] ?? '';\n\t\t\t}\n\n\t\t\tfunction isDataUrl(url: any) {\n\t\t\t\treturn url.search(/^(data:)/) !== -1;\n\t\t\t}\n\n\t\t\tfunction resolveUrl(url: any, baseUrl: any) {\n\t\t\t\tconst doc = document.implementation.createHTMLDocument();\n\t\t\t\tconst base = doc.createElement('base');\n\t\t\t\tdoc.head.appendChild(base);\n\t\t\t\tconst a = doc.createElement('a');\n\t\t\t\tdoc.body.appendChild(a);\n\t\t\t\tbase.href = baseUrl;\n\t\t\t\ta.href = url;\n\t\t\t\treturn a.href;\n\t\t\t}\n\n\t\t\tfunction getAndEncode(url: any) {\n\t\t\t\tlet TIMEOUT = 30000;\n\t\t\t\t//if(domtoimage.impl.options.cacheBust) {\n\t\t\t\t\t// Cache bypass so we dont have CORS issues with cached images\n\t\t\t\t\t// Source: https://developer.mozilla.org/en/docs/Web/API/XMLHttpRequest/Using_XMLHttpRequest#Bypassing_the_cache\n\t\t\t\t//\turl += ((/\\?/).test(url) ? \"&\" : \"?\") + (new Date).getTime();\n\t\t\t\t//}\n\n\t\t\t\treturn new Promise(function (resolve) {\n\t\t\t\t\tconst request = new XMLHttpRequest;\n\n\t\t\t\t\trequest.onreadystatechange = done;\n\t\t\t\t\trequest.ontimeout = timeout;\n\t\t\t\t\trequest.responseType = 'blob';\n\t\t\t\t\trequest.timeout = TIMEOUT;\n\t\t\t\t\trequest.open('GET', url, true);\n\t\t\t\t\trequest.send();\n\n\t\t\t\t\t//let placeholder;\n\t\t\t\t\t//if(domtoimage.impl.options.imagePlaceholder) {\n\t\t\t\t\t//\tlet split = domtoimage.impl.options.imagePlaceholder.split(/,/);\n\t\t\t\t\t//\tif(split && split[1]) {\n\t\t\t\t\t//\t\tplaceholder = split[1];\n\t\t\t\t\t//\t}\n\t\t\t\t\t//}\n\n\t\t\t\t\tfunction done() {\n\t\t\t\t\t\tif (request.readyState !== 4) return;\n\n\t\t\t\t\t\tif (request.status !== 200) {\n\t\t\t\t\t\t//\tif(placeholder) {\n\t\t\t\t\t\t//\t\tresolve(placeholder);\n\t\t\t\t\t\t//\t} else {\n\t\t\t\t\t\t\t\tfail('cannot fetch resource: ' + url + ', status: ' + request.status);\n\t\t\t\t\t\t//\t}\n\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst encoder = new FileReader;\n\t\t\t\t\t\tencoder.onloadend = function () {\n\t\t\t\t\t\t\tconst content = encoder.result!.toString().split(/,/)[1];\n\t\t\t\t\t\t\tresolve(content);\n\t\t\t\t\t\t};\n\t\t\t\t\t\tencoder.readAsDataURL(request.response);\n\t\t\t\t\t}\n\n\t\t\t\t\tfunction timeout() {\n\t\t\t\t\t//\tif(placeholder) {\n\t\t\t\t\t//\t\tresolve(placeholder);\n\t\t\t\t\t//\t} else {\n\t\t\t\t\t\t\tfail('timeout of ' + TIMEOUT + 'ms occured while fetching resource: ' + url);\n\t\t\t\t\t//\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tfunction fail(message: any) {\n\t\t\t\t\t\tconsole.error(message);\n\t\t\t\t\t\tresolve('');\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction dataAsUrl(content: any, type: any) {\n\t\t\t\treturn 'data:' + type + ';base64,' + content;\n\t\t\t}\n\n\n\t\tfunction newInliner() {\n\t\t\tconst URL_REGEX = /url\\(['\"]?([^'\"]+?)['\"]?\\)/g;\n\n\t\t\treturn {\n\t\t\t\tinlineAll: inlineAll,\n\t\t\t\tshouldProcess: shouldProcess,\n\t\t\t};\n\n\t\t\tfunction shouldProcess(str: any) {\n\t\t\t\treturn str.search(URL_REGEX) !== -1;\n\t\t\t}\n\n\t\t\tfunction readUrls(str: any) {\n\t\t\t\tconst result: string[] = [];\n\t\t\t\tlet match: RegExpExecArray | null;\n\t\t\t\twhile ((match = URL_REGEX.exec(str))) {\n\t\t\t\t\tresult.push(match[1]!);\n\t\t\t\t}\n\t\t\t\treturn result.filter(function (url) {\n\t\t\t\t\treturn !util.isDataUrl(url);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction inline(str: any, url: any, baseUrl: any, get: any) {\n\t\t\t\treturn Promise.resolve(url)\n\t\t\t\t\t.then(url=> baseUrl ? util.resolveUrl(url, baseUrl) : url)\n\t\t\t\t\t.then(get || util.getAndEncode)\n\t\t\t\t\t.then(data=> util.dataAsUrl(data, util.mimeType(url)))\n\t\t\t\t\t.then(dataUrl=> str.replace(urlAsRegex(url), '$1' + dataUrl + '$3'));\n\n\t\t\t\tfunction urlAsRegex(url: any) {\n\t\t\t\t\treturn new RegExp('(url\\\\([\\'\"]?)(' + util.escape(url) + ')([\\'\"]?\\\\))', 'g');\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction inlineAll(str: any, baseUrl: any, get?: any) {\n\t\t\t\tif (nothingToInline()) return Promise.resolve(str);\n\n\t\t\t\treturn Promise.resolve(str)\n\t\t\t\t\t.then(readUrls)\n\t\t\t\t\t.then(urls=> {\n\t\t\t\t\t\tlet done = Promise.resolve(str);\n\t\t\t\t\t\tfor (const url of urls) done = done.then(string=> inline(string, url, baseUrl, get));\n\t\t\t\t\t\treturn done;\n\t\t\t\t\t});\n\n\t\t\t\tfunction nothingToInline() {\n\t\t\t\t\treturn !shouldProcess(str);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfunction newFontFaces() {\n\t\t\treturn {\n\t\t\t\tresolveAll: resolveAll,\n\t\t\t\timpl: {readAll: readAll}\n\t\t\t};\n\n\t\t\tfunction resolveAll() {\n\t\t\t\treturn readAll()\n\t\t\t\t.then(webFonts=> Promise.allSettled(\n\t\t\t\t\twebFonts.map((webFont: any)=> webFont.resolve())\n\t\t\t\t))\n\t\t\t\t.then(cssStrings=> cssStrings.join('\\n'));\n\t\t\t}\n\n\t\t\tfunction readAll() {\n\t\t\t\treturn Promise.resolve(util.asArray(document.styleSheets))\n\t\t\t\t\t.then(getCssRules)\n\t\t\t\t\t.then(selectWebFontRules)\n\t\t\t\t\t.then(rules=> rules.map(newWebFont));\n\t\t\t\t\t\t// console.log('map:%o:', rules) ||\n\n\t\t\t\tfunction selectWebFontRules(cssRules: any) {\n\t\t\t\t\treturn cssRules\n\t\t\t\t\t.filter((rule: any)=> rule.type === CSSRule.FONT_FACE_RULE)\n\t\t\t\t\t.filter((rule: any)=> inliner.shouldProcess(rule.style.getPropertyValue('src')));\n\t\t\t\t}\n\n\t\t\t\tfunction getCssRules(styleSheets: any) {\n\t\t\t\t\tconst cssRules: any = [];\n\t\t\t\t\tfor (const sheet of styleSheets) {\n\t\t\t\t\t//console.log('1:%o', sheet);\t//-------\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tif (sheet.href) continue;\n\t\t\t\t\t\t//console.log(sheet.cssRules);\n\t\t\t\t\t\t\tutil.asArray(sheet.cssRules || []).forEach(cssRules.push.bind(cssRules));\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcatch (e) {\n\t\t\t\t\t\t\tconsole.error('Error while reading CSS rules from ' + sheet.href, String(e));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn cssRules;\n\t\t\t\t}\n\n\t\t\t\tfunction newWebFont(webFontRule: any) {\n\t\t\t\t\t//console.log('newWebFont:%o:', webFontRule);\t//-------\n\t\t\t\t\treturn {\n\t\t\t\t\t\tresolve: function resolve() {\n\t\t\t\t\t\t\tconst baseUrl = (webFontRule.parentStyleSheet || {}).href;\n\t\t\t\t\t\t\treturn inliner.inlineAll(webFontRule.cssText, baseUrl);\n\t\t\t\t\t\t},\n\t\t\t\t\t\tsrc: function () {\n\t\t\t\t\t\t\treturn webFontRule.style.getPropertyValue('src');\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n/*\n\t\tfetch('http://localhost:8080/prj/mat/my_himajihoso.woff2')\n\t\t.then(response=> {\n\t\t\tif (response.ok) return response.blob();\n\t\t\tthrow new Error('Network response was not ok.');\n\t\t})\n\t\t.then(blob=> new Promise((resolve, reject)=> {\n\t\t\tconst reader = new FileReader;\n\t\t\treader.onloadend = ()=> resolve(reader.result);\n\t\t\treader.onerror = reject;\n\t\t\treader.readAsDataURL(blob);\n\t\t}))\n\t\t.then(dataUrl => {\n\t\t\t// data:application/font-woff2;base64,d09GMk9U\n\t\t\tconst css =\n\t\t\t'body { margin: 0px; padding: 0px; overflow: hidden; }\\n'+\n\t\t\t'body { line-height: 36px; }\\n'+\n\n\t\t\t`@font-face { font-family: my_himajihoso; src: url(\"${\n\t\t\t\t'data:application/font-woff;base64,'+\n\t\t\t\tString(dataUrl)\n\t\t\t\t.split(/,/)[1]\n\t\t//\t\t.replace(/([.*+?^${}()|\\[\\]\\/\\\\])/g, '\\\\$1')\n\t\t\t}\"); }`;\n\n\t\tconsole.log('css:'+ css);\n\t\tconsole.log('@font-face { font-family: my_himajihoso; src: url(\"data:application/font-woff;base64,d09GMk9UVE8AAA...bhUAAA==\"); }\\n');\n\t\t\tthis.styleHtmTxt.appendChild(document.createTextNode(css));\n*/\n\n\t\tPromise.resolve(this.#htmTxt)\n\t\t.then(node=> {\t//console.log(`🍇 toSvg`);\n\t\t\tconst cln = node.cloneNode(true) as HTMLSpanElement;\n\t\t\tcln.style.padding = '0px';\t\t// ややこしいのでシンプルに\n\t\t\tcln.style.paddingRight = this.#padTx4x +'px';\n\t\t\tcln.style.paddingTop = this.#padTx4y +'px';\n\t\t\tcln.style.left = '0px';\n\t\t\tcln.style.top = '0px';\n\t\t\tcln.style.width = (this.#infTL.$width -this.#infTL.pad_left -this.#infTL.pad_right) +'px';\n\t\t\tcln.style.height = (this.#infTL.$height -this.#infTL.pad_top -this.#infTL.pad_bottom) +'px';\n\t\t\t//console.log(cln.style.cssText);\n\t\t\tthis.#htmTxt.hidden = hidden;\n\t\t\treturn cln;\n\t\t})\n\t\t.then(embedFonts)\n\t\t.then(node=> {\t//console.log(`🍈 makeSvgDataUri`);\n\t\t\tnode.setAttribute('xmlns', 'http://www.w3.org/1999/xhtml');\n\t\t\tconst img = new Image;\n\t\t\t//img.crossOrigin = 'Anonymous';\t//--いまのとこ不要\n\t\t\timg.src = `data:image/svg+xml;charset=utf-8,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"${this.#infTL.$width\n\t\t\t}px\" height=\"${this.#infTL.$height\n\t\t\t}px\"><foreignObject x=\"0\" y=\"0\" width=\"100%\" height=\"100%\">${\n\t\t\t\t(new XMLSerializer).serializeToString(node)\n\t\t\t\t.replaceAll('#', '%23').replaceAll('\\n', '%0A')\n\t\t\t}</foreignObject></svg>` // ? + (new Date).getTime();\n\t\t\treturn new Promise(re=> img.onload = ()=> re(img));\n\t\t})\n\t\t.then(img=> new Promise(re=> setTimeout(()=> re(img) , 100)))\n\t\t\t// 無くすとSafariでテクスチャ取れない場合があった\n\t\t\t// clearTimeout()不要と判断\n\t\t.then((img: any)=> {\t//console.log(`🍉 toPng`);\n\t\t\tconst canvas = document.createElement('canvas');\n\t\t\tcanvas.width = this.#infTL.$width;\n\t\t\tcanvas.height = this.#infTL.$height;\n\t\t\tcanvas.getContext('2d')!.drawImage(img, 0, 0);\n\t\t\tfnc(Texture.from(canvas));\n\t\t})\n\t\t.catch(err=> DebugMng.myTrace(`goTxt() = ${err}`));\n\t}\n\n\n\t#aGoTxt\t: (()=> void)[] = [];\t// FIFO実行バッファ\n\tgoTxt(aSpan: string[], instant: boolean) {\n\t\tconst f = ()=> this.#goTxt_Proc(aSpan, instant);\n\t\tif (this.#aGoTxt.push(f) === 1) f();\t// len=1 で実行中を示す\n\t}\n\n\t#aRect\t\t: IChRect[]\t= [];\n\t#lenHtmTxt = 0;\n\tstatic\treadonly\t#SPAN_LAST = `<span class='sn_ch sn_ch_last'>&emsp;</span>`;\n\t#goTxt_Proc(aSpan: string[], instant: boolean) {\n\t\tTxtStage.#cntBreak.visible = false;\n\n\t\tlet begin = this.#aRect.length;\n\t\tlet bkHtm = '';\n\t\tif (begin === 0) {\t// 初回\n\t\t\tif (TxtStage.#cfg.oCfg.debug.masume) {\n\t\t\t\tif (CmnLib.debugLog) console.log(`🍌 masume ${\n\t\t\t\t\tthis.name} v:${this.visible} l:${this.x} t:${this.y\n\t\t\t\t\t} a:${this.alpha} pl:${this.#infTL.pad_left\n\t\t\t\t\t} pr:${this.#infTL.pad_right\n\t\t\t\t\t} pt:${this.#infTL.pad_top} pb:${this.#infTL.pad_bottom\n\t\t\t\t\t} w:${this.#infTL.$width} h:${this.#infTL.$height}`);\n\n\t\t\t\tthis.#grpDbgMasume.clear()\n\t\t\t\t.beginFill(0x33FF00, 0.2)\t// 文字レイヤ\n\t\t\t\t.lineStyle(1, 0x33FF00, 1)\n\t\t\t\t.drawRect(-this.#infTL.pad_left, -this.#infTL.pad_top, this.#infTL.$width, this.#infTL.$height)\n\t\t\t\t\t// 親の親の cntInsidePadding が padding ぶん水平移動してるので引く。\n\t\t\t\t.endFill()\n\n\t\t\t\t.beginFill(0x0033FF, 0.2)\t// cntInsidePadding\n\t\t\t\t.lineStyle(2, 0x0033FF, 1)\n\t\t\t\t.drawRect(0, 0,\n\t\t\t\tthis.#infTL.$width -this.#infTL.pad_left -this.#infTL.pad_right,\n\t\t\t\tthis.#infTL.$height -this.#infTL.pad_top -this.#infTL.pad_bottom)\n\t\t\t\t.endFill();\n\t\t\t}\n\n\t\t\tthis.#htmTxt.innerHTML = [...aSpan].join('').replaceAll(/[\\n\\t]/g, '') +TxtStage.#SPAN_LAST;\t// 末尾改行削除挙動対策\n\n\t\t\tif (! this.#hyph.break_fixed) {\n\t\t\t\tconst sty = globalThis.getComputedStyle(this.#htmTxt);\n\t\t\t\tconst rs = parseFloat(sty.fontSize);\n\t\t\t\tif (this.#isTategaki) {\n\t\t\t\t\tthis.#hyph.break_fixed_left = (this.#infTL.$width -this.#infTL.pad_left -this.#infTL.pad_right -rs *1.5) *this.sys.cvsScale;\n\t\t\t\t\tthis.#hyph.break_fixed_top = 0;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tthis.#hyph.break_fixed_left = 0;\n\t\t\t\t\tthis.#hyph.break_fixed_top = rs /2 *this.sys.cvsScale;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tbkHtm = this.#htmTxt.innerHTML;\n\t\t\t// 末尾改行削除挙動対策\n\t\t\t--begin;\n//console.log(`fn:TxtStage.ts nm=${this.name} begin:${begin} bkHtm=${bkHtm}=`);\n\t\t\tthis.#htmTxt.getElementsByClassName('sn_ch_last').item(0)?.remove();\n\t\t\t\t// 前回の末尾を削除\n\n\t\t\tthis.#htmTxt.querySelectorAll(':scope > br').forEach(e=> e.remove());\t// 前回の禁則処理を一度削除\n\t\t\t\t// :scope - CSS: カスケーディングスタイルシート | MDN https://developer.mozilla.org/ja/docs/Web/CSS/:scope\n\t\t\tthis.#htmTxt.insertAdjacentHTML(\n\t\t\t\t'beforeend',\n\t\t\t\taSpan.slice(this.#lenHtmTxt).join('').replaceAll(/[\\n\\t]/g, '')\n\t\t\t\t+TxtStage.#SPAN_LAST\t// 末尾改行削除挙動対策\n\t\t\t);\n\t\t}\n\t\t\t// 後の禁則処理判定で誤判定するので、innerHTML 時にムダな改行やタブは削除\n\t\t\t// [r]は後述コメントのHTMLタグになってるので問題なし\n\n\t\t// ルビ付き文字に背景指定（style='background:'）がある場合、「文字」と「ルビ」と「その二つを含んだ領域」の三つが個別に塗られるが、三つめは背景指定を削除する\n\t\tthis.#htmTxt.querySelectorAll('.sn_ch:has(> ruby)').forEach(v=> (v as HTMLElement).style.background = '');\t// :has直前に空白厳禁\n\n\t\tthis.#lenHtmTxt = aSpan.length;\n//console.log(`fn:TxtStage.ts nm=${this.name} === ==${this.#htmTxt.innerHTML.slice(360)}==`);\n\n\t\t// this.#getChRects()使用準備\n\t\tconst cvsScale = this.sys.cvsScale;\n\t\tconst bcr = this.#htmTxt.getBoundingClientRect();\n\t\tconst sx = bcr.left +this.#infTL.pad_left;\n\t\tconst sy = bcr.top +this.#infTL.pad_top;\n\t\tlet cnvRect :(rng: Range, ch: string)=> Rectangle;\n\t\tif (cvsScale === 1) cnvRect = (rng, ch)=> {\n\t\t\tconst r = rng.getBoundingClientRect();\n\t\t\treturn new Rectangle(\n\t\t\t\tr.left -sx,\n\t\t\t\tr.top  -sy,\n\t\t\t\tr.width,\n\t\t\t\tr.height +('gjqy'.includes(ch) ?this.#lh_half :0)\n\t\t\t);\n\t\t};\n\t\telse {\n\t\t\t// Resizeを意識してDOM位置をPIXIに変換\n\t\t\t// transform scale を一時的に変更する手もあるが、ややずれるしDOM影響大\n\t\t\tconst ox = this.sys.ofsPadLeft_Dom2PIXI +bcr.left *(1- cvsScale);\n\t\t\tconst oy = this.sys.ofsPadTop_Dom2PIXI +bcr.top *(1- cvsScale);\n\t\t\tcnvRect = (rng, ch)=> {\n\t\t\t\tconst r = rng.getBoundingClientRect();\n\t\t\t\treturn new Rectangle(\n\t\t\t\t\t(r.left -ox) /cvsScale -sx,\n\t\t\t\t\t(r.top  -oy) /cvsScale -sy,\n\t\t\t\t\tr.width /cvsScale,\n\t\t\t\t\t(r.height +('gjqy'.includes(ch) ?this.#lh_half :0)) /cvsScale,\n\t\t\t\t);\n\t\t\t};\n\t\t}\n\n\t\tconst [a, len] = this.#hyph.hyph(this.#htmTxt, cnvRect, this.#isTategaki, begin, bkHtm);\n\t\tthis.#aRect = a;\n\n\n\t\tconst fncMasumeLog = CmnLib.debugLog\n\t\t\t? ({ch}: IChRect, {x, y, width, height}: Rectangle)=> console.log(`🍌 masume ch:${ch} x:${x} y:${y} w:${width} h:${height}`)\n\t\t\t: ()=> {};\n\t\tconst fncMasume = TxtStage.#cfg.oCfg.debug.masume\n\t\t\t? (v: IChRect, rct: Rectangle)=> {\n\t\t\t\tfncMasumeLog(v, rct);\n\t\t\t\tthis.#grpDbgMasume\n\t\t\t\t.beginFill(0x66CCFF, 0.5)\n\t\t\t\t.lineStyle(2, 0xFF3300, 1)\n\t\t\t\t.drawRect(rct.x, rct.y, rct.width, rct.height)\n\t\t\t\t.endFill();\n\t\t\t}\n\t\t\t: ()=> {};\n\t\tconst ease = CmnTween.ease(this.#fi_easing);\n\n\t\tfor (let i=begin; i<len; ++i) {\n\t\t\tconst c = this.#aRect[i]!;\n\t\t\tconst rct = c.rect;\n\t\t\tconst arg = JSON.parse(c.elm.dataset.arg ?? '{\"delay\": 0}');\n\t\t\tconst add = JSON.parse(c.elm.dataset.add ?? '{}');\n\t\t\tconst cis = TxtStage.#hChInStyle[add.ch_in_style];\n\t\t\tfncMasume(c, rct);\n\n\t\t\tif (c.elm.dataset.cmd === 'grp') {\n\t\t\t\tconst cnt = new Container;\t// 親コンテナかまし、即spWork()\n\t\t\t\tthis.#cntTxt.addChild(cnt);\n\t\t\t\t\t// 次のcsv2Spritesが即終わる場合もあるので先に行なう\n\t\t\t\tnew SpritesMng(arg.pic, cnt, sp=> {\n\t\t\t\t\tthis.#spWork(cnt, arg, add, rct, ease, cis ?? {});\n\t\t\t\t\tif (! cnt.parent) cnt.removeChild(sp);\n\t\t\t\t});\n\t\t\t}\n\t\t\tif (c.elm.dataset.lnk) {\n\t\t\t\tconst eCh = c.elm.parentElement!.closest('[data-arg]')! as HTMLElement;\n\t\t\t\tconst aLnk = JSON.parse(eCh.dataset.arg ?? '{}');\n\t\t\t\taLnk.key = `lnk=[${i}] `+ this.name;\n\t\t\t\tconst sp = new Sprite;\n\t\t\t\tthis.#spWork(sp, aLnk, add, rct, ease, cis ?? {});\n\n\t\t\t\tconst st_normal = aLnk.style ?? '';\n\t\t\t\tconst st_hover = st_normal +(aLnk.style_hover ?? '');\n\t\t\t\tconst st_clicked = st_normal +(aLnk.style_clicked ?? '');\n\t\t\t\tconst st_r_normal = aLnk.r_style ?? '';\n\t\t\t\tconst st_r_hover = st_r_normal +(aLnk.r_style_hover ?? '');\n\t\t\t\tconst st_r_clicked = st_r_normal +(aLnk.r_style_clicked ?? '');\n\n\t\t\t\tconst nlRt = Array.from(eCh.getElementsByTagName('rt'));\n\t\t\t\tfor (const e of nlRt) e.dataset.st_r_bk = e.style.cssText;\n\t\t\t\tconst st_bk = eCh.style.cssText;\n\t\t\t\tconst fncStyle = (st: string, st_r: string)=> {\n\t\t\t\t\teCh.style.cssText = st_bk + st;\n\t\t\t\t\tfor (const e of nlRt) e.style.cssText = e.dataset.st_r_bk + st_r;\n\t\t\t\t};\n\n\t\t\t\tconst enabled = argChk_Boolean(aLnk, 'enabled', true);\n\t\t\t\tif (enabled) TxtStage.#evtMng.button(aLnk, sp,\n\t\t\t\t\t()=> fncStyle(st_normal, st_r_normal),\n\t\t\t\t\t()=> {\n\t\t\t\t\t\tif (! this.canFocus()) return false;\n\t\t\t\t\t\tfncStyle(st_hover, st_r_hover);\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t},\n\t\t\t\t\t()=> fncStyle(st_clicked, st_r_clicked)\n\t\t\t\t);\n\t\t\t\telse fncStyle(\n\t\t\t\t\tst_normal +(aLnk.style_disable ?? 'color: gray;'),\n\t\t\t\t\tst_r_normal +(aLnk.r_style_disable ?? 'color: gray;')\n\t\t\t\t);\n\t\t\t\tthis.#cntTxt.addChild(sp);\n\t\t\t}\n\t\t}\n\n\t\t// 文字出現演出・開始〜終了\n\t\tconst chs = Array.from(<HTMLCollectionOf<HTMLElement>>this.#htmTxt.getElementsByClassName('sn_ch_yet'));\n// console.log(`fn:TxtStage.ts nm=${this.name} StartChIn <==`);\n\t\tthis.#fncEndChIn = ()=> {\n// console.log(`fn:TxtStage.ts nm=${this.name} fncEndChIn ==> '${lastElm?.textContent}' cls:${lastElm?.className}:`);\n\n\t\t\tthis.#fncEndChIn = ()=> false;\n\t\t\tfor (const v of chs) v.className = 'sn_ch';\n\t\t\tTxtStage.#cntBreak.position.set(\n\t\t\t\tthis.#hyph.break_fixed_left,\n\t\t\t\tthis.#hyph.break_fixed_top,\n\t\t\t);\n\t\t\tTxtStage.#cntBreak.visible = true;\n\t\t\t/*\n\t\t\t\t- これらはセットで確認すること。兼ね合いにより、いずれかが破綻する場合がある\n\t\t\t\t\t- 末尾文字表示でカーソルが次行先頭に来てしまうことのないよう\n\t\t\t\t\t- 改行→クリック待ち、の後で改行が消えないよう\n\t\t\t\t\t- 冒頭クリック待ち＋改行での表示確認\n\t\t\t*/\n\n\t\t\tthis.noticeCompTxt();\n\n\t\t\tconst f = this.#aGoTxt.shift();\t// 実行中の一個必ず入ってる（clearText注意）\n\t\t\tif (this.#aGoTxt.length > 0) f!();\t// まだあれば実行待ちなので実行\n\n\t\t\treturn true;\n\t\t};\n\n\t\t// アニメ開始（sn_ch を置換しないよう注意）\n\t\tfor (const v of chs) v.className = v.className.replace('sn_ch_yet sn', 'go');\n\t\tif (begin > 0) ++begin;\t// 末尾改行削除挙動対策\n\n\t\t// 文字表示に時間をかける最後の文字を探す。末尾はダミー（#SPAN_LAST）\n\t\tlet lastElm: HTMLElement | undefined = undefined;\n\t\tfor (let i=len -2; i>=0; --i) {\t\t// 末尾の手前から\n\t\t\tconst {elm} = this.#aRect[i]!;\n\t\t\tif (elm.tagName !== 'SPAN') continue;\t// ルビ以外\n\n//console.log(`fn:TxtStage.ts nm=${this.name} txt:${elm.textContent}: i:${i} begin:${begin} len:${len} elm:%o`, elm);\n\t\t\tlastElm = (elm.parentElement?.tagName === 'RUBY')\n\t\t\t\t? elm.parentElement.parentElement ?? elm\t// [tcy]も[graph]も\n\t\t\t\t: elm;\n\t\t\tbreak;\n\t\t}\n\t\tif (! lastElm || instant || begin === len) {this.#fncEndChIn(); return}\n\t\t\t// 「animation-duration: 0ms;」だと animationend が発生しないので。\n\t\t\t// if 三項目の === は右クリック戻りで起こる\n\n\t\tlastElm.addEventListener('animationend', ()=> this.#fncEndChIn(), {once: true});\t// クリックキャンセル時は発生しない\n\t\t\t// 差し替えるので「()=> 」形式のままにすること\n\t}\n\t#fncEndChIn: ()=> boolean\t= ()=> false;\n\t#spWork(sp: Container, arg: any, add: any, rct: Rectangle, ease: (k: number)=> number, cis: any) {\n\t\tsp.alpha = 0;\n\t\tif (arg.x) rct.x = arg.x.startsWith('=')\n\t\t\t? rct.x +parseInt(arg.x.slice(1))\n\t\t\t: parseInt(arg.x);\n\t\tif (arg.y) rct.y = arg.y.startsWith('=')\n\t\t\t? rct.y +parseInt(arg.y.slice(1))\n\t\t\t: parseInt(arg.y);\n\t\tif (arg.width) rct.width = parseInt(arg.width);\n\t\tif (arg.height) rct.height = parseInt(arg.height);\n\t\tif (arg.wait) cis.wait = parseInt(arg.wait);\n\t\tsp.width = rct.width;\n\t\tsp.height = rct.height;\n\t\tif (cis.x) sp.position.set(\n\t\t\tcis.x.startsWith('=') ?rct.x +sp.width  *cis.nx :cis.nx,\n\t\t\tcis.y.startsWith('=') ?rct.y +sp.height *cis.ny :cis.ny\n\t\t);\n\t\telse sp.position.set(rct.x, rct.y,);\n\t\tconst st: ISpTw = {\n\t\t\tsp,\n\t\t\ttw: new Tween(sp)\n\t\t\t\t.to({ alpha: 1, x: rct.x, y: rct.y, width: rct.width, height: rct.height, angle: 0 }, cis.wait ?? 0)\n\t\t\t\t.easing(ease)\n\t\t\t\t.delay((add.wait ?? 0) +(arg.delay ?? 0))\n\t\t\t\t.onComplete(()=> {\n\t\t\t\t\tst.tw = undefined;\n\t\t\t\t\t//(略)\tif (rct.width === 0 || rct.height === 0) return;\n\t\t\t\t\t//if (sp instanceof Sprite) sp.cacheAsBitmap = true;\n\t\t\t\t\t// これを有効にすると[snapshot]で文字が出ない\n\t\t\t\t})\n\t\t\t\t.start(),\n\t\t};\n\t\tthis.#aSpTw.push(st);\n\t}\n\t#aSpTw\t\t: ISpTw[]\t= [];\n\n\tskipChIn(): boolean {\t// true: 文字出現中だったので、停止する\n\t\tlet wasChInIng = this.#fncEndChIn();\n\t\tfor (const st of this.#aSpTw) {\t// Text Skip。stop() と end() は別！\n\t\t\tif (st.tw) {st.tw.stop().end(); wasChInIng = true}\n\t\t}\n\t\tthis.#aSpTw = [];\n\t\treturn wasChInIng;\n\t}\n\n\tstatic\t#hChInStyle\t= Object.create(null);\n\tstatic\treadonly\t#REG_NG_CHSTYLE_NAME_CHR\t= /[{\\s\\.,*\\{]/;\n\t\t// https://regex101.com/r/APC91I/1\n\tstatic\tinitChStyle() {\n\t\tTxtStage.#hChInStyle = Object.create(null);\n\t\tTxtStage.#hChOutStyle = Object.create(null);\n\t}\n\tstatic\tgetChInStyle(name: string) {return TxtStage.#hChInStyle[name]}\n\tstatic\tch_in_style(hArg: HArg): any {\n\t\tconst {name} = hArg;\n\t\tif (! name) throw 'nameは必須です';\n\t\tif (TxtStage.#REG_NG_CHSTYLE_NAME_CHR.test(name)) throw `name【${name}】に使えない文字が含まれます`;\n\t\tif (name in TxtStage.#hChInStyle) throw `name【${name}】はすでにあります`;\n\n\t\tconst x = String(hArg.x ?? '=0');\n\t\tconst y = String(hArg.y ?? '=0');\n\t\treturn TxtStage.#hChInStyle[name] = {\n\t\t\twait\t: argChk_Num(hArg, 'wait', 500),\t// アニメ・FI時間\n\t\t\talpha\t: argChk_Num(hArg, 'alpha', 0),\n\t\t\tx\t\t: x,\t// 初期x値\n\t\t\ty\t\t: y,\t// [tsy]と同様に絶対・相対指定可能\n\t\t\t// {x:500}\t\t\tX位置を500に\n\t\t\t// {x:'=500'}\t\t現在のX位置に+500加算した位置\n\t\t\t// {x:'=-500'}\t\t現在のX位置に-500加算した位置\n\t\t\t// {x:'250,500'}\t+250から＋500までの間でランダムな値をX位置に\n\t\t\t// {x:'=250,500'}\t+250から＋500までの間でランダムな値を現在のX位置に加算\n\t\t\tnx\t\t: parseFloat((x.at(0) === '=') ? x.slice(1) : x),\n\t\t\tny\t\t: parseFloat((y.at(0) === '=') ? y.slice(1) : y),\n\t\t\tscale_x\t: argChk_Num(hArg, 'scale_x', 1),\n\t\t\tscale_y\t: argChk_Num(hArg, 'scale_y', 1),\n\t\t\trotate\t: argChk_Num(hArg, 'rotate', 0),\n\t\t\tjoin\t: argChk_Boolean(hArg, 'join', true),\n\t\t\t\t\t\t// 文字を順番に出すか（true）同時か（false）\n\t\t\tease\t: hArg.ease ?? 'ease-out',\n\t\t};\n\t}\n\n\tstatic\t#hChOutStyle: {[nm: string]: {\n\t\twait\t: number;\n\t\talpha\t: number;\n\t\tx\t\t: string;\n\t\ty\t\t: string;\n\t\tnx\t\t: number;\n\t\tny\t\t: number;\n\t\tscale_x\t: number;\n\t\tscale_y\t: number;\n\t\trotate\t: number;\n\t\tjoin\t: boolean;\n\t\tease\t: string;\n\t}}\t= Object.create(null);\n\tstatic\tgetChOutStyle(name: string) {return TxtStage.#hChOutStyle[name]}\n\tstatic\tch_out_style(hArg: HArg): any {\n\t\tconst {name} = hArg;\n\t\tif (! name) throw 'nameは必須です';\n\t\tif (TxtStage.#REG_NG_CHSTYLE_NAME_CHR.test(name)) throw `name【${name}】に使えない文字が含まれます`;\n\t\tif (name in TxtStage.#hChOutStyle) throw `name【${name}】はすでにあります`;\n\n\t\tconst x = String(hArg.x ?? '=0');\n\t\tconst y = String(hArg.y ?? '=0');\n\t\treturn TxtStage.#hChOutStyle[name] = {\n\t\t\twait\t: argChk_Num(hArg, 'wait', 500),\t// アニメ・FI時間\n\t\t\talpha\t: argChk_Num(hArg, 'alpha', 0),\n\t\t\tx\t\t: x,\t// 初期x値\n\t\t\ty\t\t: y,\t// [tsy]と同様に絶対・相対指定可能\n\t\t\t// {x:500}\t\t\tX位置を500に\n\t\t\t// {x:'=500'}\t\t現在のX位置に+500加算した位置\n\t\t\t// {x:'=-500'}\t\t現在のX位置に-500加算した位置\n\t\t\t// {x:'250,500'}\t+250から＋500までの間でランダムな値をX位置に\n\t\t\t// {x:'=250,500'}\t+250から＋500までの間でランダムな値を現在のX位置に加算\n\t\t\tnx\t\t: parseFloat((x.at(0) === '=') ? x.slice(1) : x),\n\t\t\tny\t\t: parseFloat((y.at(0) === '=') ? y.slice(1) : y),\n\t\t\tscale_x\t: argChk_Num(hArg, 'scale_x', 1),\n\t\t\tscale_y\t: argChk_Num(hArg, 'scale_y', 1),\n\t\t\trotate\t: argChk_Num(hArg, 'rotate', 0),\n\t\t\tjoin\t: argChk_Boolean(hArg, 'join', false),\n\t\t\t\t\t\t// 文字を順番に出すか（true）同時か（false）\n\t\t\tease\t: hArg.ease ?? 'ease-out',\n\t\t};\n\t}\n\n\tstatic\treadonly\t#cntBreak\t= new Container;\n\tstatic\t\t\t\t#spsBreak\t= new SpritesMng;\n\tdispBreak(o: HArg) {\n\t\tTxtStage.delBreak();\n\n\t\tconst cnt = TxtStage.#cntBreak;\n\t\tcnt.visible = false;\n\t\tthis.addChild(cnt);\t// 次のcsv2Spritesが即終わる場合もあるので先に行なう\n\t\tTxtStage.#spsBreak.destroy();\n\t\tTxtStage.#spsBreak = new SpritesMng(o.pic, cnt, sp=> {\n\t\t\tif (cnt.parent) {\n\t\t\t\tsp.x = argChk_Num(o, 'x', 0);\n\t\t\t\tsp.y = argChk_Num(o, 'y', 0);\n\t\t\t\tsp.width = argChk_Num(o, 'width', this.#infTL.fontsize);\n\t\t\t\tsp.height = argChk_Num(o, 'height', this.#infTL.fontsize);\n\t\t\t}\n\t\t\telse cnt.removeChild(sp);\n\t\t});\n\t}\n\tstatic\tdelBreak() {\n\t\tconst cnt = TxtStage.#cntBreak;\n\t\tcnt.parent?.removeChild(cnt);\t// 複数メッセージウインドウを想定\n\t\tTxtStage.#spsBreak.destroy();\n\t}\n\n\t#fi_easing\t= 'Quadratic.Out';\n\t#fo_easing\t= 'Quadratic.Out';\n\t#clearText() {\n\t\tthis.#grpDbgMasume.clear();\n\t\tthis.#aRect = [];\n\t\tthis.#lenHtmTxt = 0;\n\t\tthis.#aGoTxt = [];\n\n\t\t//utils.clearTextureCache();\t// 改ページと思われるこのタイミングで\n\t\tthis.skipChIn();\n\t\tconst n = this.#htmTxt.cloneNode(true) as HTMLSpanElement;\n\t\t//this.htmTxt.innerHTML = '';\t\t以下の方が早いらしい\n\t\tn.textContent = '';\n\t\tconst old = this.#htmTxt;\n\t\told.parentElement!.insertBefore(n, old);\n\n\t\tlet sum_wait = 0;\n\t\tArray.from(<HTMLCollectionOf<HTMLElement>>old.getElementsByClassName('sn_ch')).forEach(elm =>{\n\t\t\tconst add = JSON.parse(\n\t\t\t\telm.dataset.add ??\t\t\t\t// 通常文字\n\t\t\t\telm.children[0]?.getAttribute('data-add') ??\t// ルビ\n\t\t\t\telm.children[0]?.children[0]\n\t\t\t\t\t?.getAttribute('data-add') ?? '{}'\t\t// 縦中横\n\t\t\t);\n\t\t\tif (! add.ch_out_style) return;\n\n\t\t\tconst cos = TxtStage.#hChOutStyle[add.ch_out_style];\n\t\t\tif (! cos) return;\n\t\t\tif (cos.wait === 0) {elm.style.display = 'none'; return}\n\n\t\t\tsum_wait += cos.wait;\n\t\t\tif (! cos.join) elm.style.animationDelay = '0ms';\n\t\t\telm.classList.add(`go_ch_out_${add.ch_out_style}`);\n\t\t});\n\n\t\tconst end = ()=> {\n\t\t\told.parentElement!.removeChild(old);\n\t\t\tfor (const c of this.#cntTxt.removeChildren()) {\n\t\t\t\tif (c instanceof Container) TxtStage.#evtMng.unButton(c);\n\t\t\t\tc.destroy();\n\t\t\t}\n\t\t};\n\t\tif (sum_wait === 0) {this.#htmTxt.textContent = ''; end()}\n\t\telse old.lastElementChild?.addEventListener('animationend', end, {once: true});\n\n\t\tthis.#htmTxt = n;\n\n\t\t//this.#hyph.clear();\t// クリアはしない\n\t}\n\treNew(): TxtStage {\n\t\tthis.#clearText();\n\n\t\tconst to = new TxtStage(this.ctn, ()=> this.canFocus(), this.sys);\n\t\tto.#infTL = this.#infTL;\n\t\tto.#htmTxt.style.cssText = this.#htmTxt.style.cssText;\n\t\tto.#left = this.#left;\n\t\tto.name = this.name;\n\t\tto.#lay_sub();\n//\t\tto.#idc.sethArg(this.#idc.gethArg());\n\n\t\tto.#ch_filter = this.#ch_filter;\n\t\tto.#fi_easing = this.#fi_easing;\n\t\tto.#fo_easing = this.#fo_easing;\n\n\t\tthis.#hyph.reNew(to.#hyph);\n\n\t\tthis.destroy();\n\n\t\treturn to;\n\t}\n\t#ch_filter\t: any[] | undefined = undefined;\t// 文字にかけるフィルター\n\n\n\trecord() {return {\n\t\tinfTL\t\t: this.#infTL,\n\n\t\tcssText\t\t: this.#htmTxt.style.cssText,\n\t\tleft\t\t: this.#left,\n//\t\tidc_hArg\t: this.#idc.gethArg(),\n\n\t\tch_filter\t: this.#ch_filter,\n\t\tfi_easing\t: this.#fi_easing,\n\t\tfo_easing\t: this.#fo_easing,\n\n\t\thyph\t\t: this.#hyph.record(),\n\t}};\n\tplayback(hLay: any) {\n\t\tthis.#infTL = hLay.infTL;\n\t\tthis.position.set(this.#infTL.pad_left, this.#infTL.pad_top);\n\n\t\tthis.#htmTxt.style.cssText = hLay.cssText;\n\t\tthis.#left = hLay.left;\n\t\tthis.#lay_sub();\n//\t\tthis.#idc.sethArg(hLay.idc_hArg);\n\n\t\tthis.#ch_filter\t= hLay.ch_filter;\n\t\tthis.#fi_easing\t= hLay.fi_easing;\n\t\tthis.#fo_easing\t= hLay.fo_easing;\n\n\t\tthis.#hyph.playback(hLay.hyph);\n\t}\n\n\tget cssText() {return this.#htmTxt.style.cssText}\n\tset cssText(ct: string) {this.#htmTxt.style.cssText = ct}\n\n\t#sss :Sprite | undefined = undefined;\n\tsnapshot(rnd: Renderer, re: ()=> void) {\n\t\tthis.#htm2tx(tx=> {\n\t\t\tthis.#sss = Sprite.from(tx);\t// Safariだけ文字影が映らない\n\t\t\tif (this.#isTategaki) {\n\t\t\t\tthis.#sss.x += CmnLib.stageW -(this.#left +this.#infTL.$width)\n\t\t\t\t//- ((CmnLib.isSafari && !CmnLib.isMobile)\t// 無効化 2022/02/09\n\t\t\t\t//\t? 0\n\t\t\t\t//\t: this.#infTL.pad_left +this.#infTL.pad_right);\n\t\t\t}\n\t\t\tthis.#sss.y -= this.#padTx4y;\n\t\t\tthis.#sss.texture.frame = new Rectangle(\n\t\t\t\t0,\n\t\t\t\t0,\n\t\t\t\tMath.min(this.#sss.width, this.#infTL.$width -this.#left),\n\t\t\t\tMath.min(this.#sss.height, this.#infTL.$height),\n\t\t\t);\t// これがないと画面サイズを超える\n\t\t\tthis.#cntTxt.addChild(this.#sss);\n\t\t\trnd.render(this.#sss, {clear: false});\n\t\t\tre();\n\t\t}, false);\n\t}\n\tsnapshot_end() {\n\t\tif (! this.#sss) return;\n\t\tthis.#cntTxt.removeChild(this.#sss);\n\t\tthis.#sss = undefined;\n\t}\n\n\tmakeDesignCast(_gdc: IMakeDesignCast) {\n//\tmakeDesignCast(gdc: IMakeDesignCast) {\n//\t\tgdc(this.#idc);\n\n//\t\tconst o = this.#idc.gethArg();\n//\t\tthis.#idcCh.sethArg({...o, ':id_dc': o[':id_tag'] +'_pad'});\n//\t\tgdc(this.#idcCh);\n\t}\n\tshowDesignCast() {}\n//\tshowDesignCast() {this.#idc.visible = true; this.#idcCh.visible = true}\n\n\tdump(): string {\n\t\tconst aStyle: string[] = [];\n\t\tconst s = this.#htmTxt.style;\n\t\tconst len = s.length;\n\t\tfor (let i=0; i<len; ++i) {\n\t\t\tconst key: any = s[i];\n\t\t\taStyle.push(`\"${key}\":\"${s[key]!.replaceAll(/([\"\\\\])/g, '\\\\$1')}\"`);\n\t\t}\n\t\treturn `\"txt\":\"${this.#htmTxt.textContent!.replaceAll(/([\"\\\\])/g, '\\\\$1')\n\t\t}\", \"style\":{${aStyle.join(',')}}`;\n\t\t\t// 4Debug。++カウンターし、dump表示させても良さげ\n\t}\n\n\toverride destroy() {\n\t\tTxtStage.delBreak();\n\t\tthis.#htmTxt.parentElement!.removeChild(this.#htmTxt);\n\t\tthis.removeChild(this.#cntTxt);\n\t\tthis.removeChild(this.#grpDbgMasume);\n\t\tsuper.destroy();\n\t}\n}\n","/* ***** BEGIN LICENSE BLOCK *****\n\tCopyright (c) 2018-2025 Famibee (famibee.blog38.fc2.com)\n\n\tThis software is released under the MIT License.\n\thttp://opensource.org/licenses/mit-license.php\n** ***** END LICENSE BLOCK ***** */\n\nimport {Container, Text, Rectangle, Texture, TextStyle, Sprite, Graphics} from 'pixi.js';\nimport {uint, type IEvtMng, argChk_Boolean, argChk_Num, mesErrJSON} from './CmnLib';\nimport type {HArg} from './Grammar';\nimport {SpritesMng} from './SpritesMng';\nimport {Layer} from './Layer';\nimport {Config} from './Config';\nimport type {IMakeDesignCast} from './LayerMng';\n//import {DesignCast, TxtBtnDesignCast, PicBtnDesignCast} from './DesignCast';\n\nexport class Button extends Container {\n\tstatic\tfontFamily\t= \"'Hiragino Sans', 'Hiragino Kaku Gothic ProN', '游ゴシック Medium', meiryo, sans-serif\";\n\tstatic\t#procMasume4txt = (_me: Button, _txt: Text)=> {};\n\tstatic\t#procMasume4pic = (_me: Button, _sp: Sprite, _w3: number, _h: number)=> {};\n\tstatic\tinit(cfg: Config) {\n\t\tif (! cfg.oCfg.debug.masume) return;\n\n\t\tButton.#procMasume4txt = (me, txt)=> me.addChild(\n\t\t\t(new Graphics)\n\t\t\t.beginFill(0x883388, 0.2)\n\t\t\t.lineStyle(1, 0x883388, 1)\n\t\t\t.drawRect(txt.x, txt.y, txt.width, txt.height)\n\t\t\t.endFill()\n\t\t);\n\t\tButton.#procMasume4pic = (me, sp, w3, h)=> me.addChild(\n\t\t\t(new Graphics)\n\t\t\t.beginFill(0x883388, 0.2)\n\t\t\t.lineStyle(1, 0x883388, 1)\n\t\t\t.drawRect(sp.x, sp.y, w3, h)\n\t\t\t.endFill()\n\t\t);\n\t}\n\n\tsetText(_text: string) {}\n\tgetBtnBounds = ()=> this.#rctBtnTxt;\n\t\t// 文字ボタンは背景画像を含まない位置指定なので、その当たり判定用\n\t#rctBtnTxt\t= new Rectangle;\n\n\t#sps\t\t= new SpritesMng;\n\n//\t#idc\t\t: DesignCast;\n\treadonly\t#o\t: {\n\t\ttype\t: 'pic'|'text';\n\t\tenabled\t: boolean;\n\t\tx\t\t: number;\n\t\ty\t\t: number;\n\t\trotation: number;\n\t\t\t// flash : rotation is in degrees.\n\t\t\t// pixijs: rotation is in radians, angle is in degrees.\n\t\tpivot_x\t: number;\n\t\tpivot_y\t: number;\n\t\tscale_x\t: number;\n\t\tscale_y\t: number;\n\t\talpha\t: number;\n\t\ttext\t: string;\n\t\tb_pic\t: string;\n\t\twidth\t: number;\n\t\theight\t: number;\n\t};\n\n\tconstructor(private readonly hArg: HArg, readonly evtMng: IEvtMng, readonly resolve: ()=> void, private readonly canFocus: ()=> boolean) {\n\t\tsuper();\n/*\n\t\tif (CmnLib.isDbg) {\n\t\t\tthis.makeDesignCast = gdc=> gdc(this.#idc);\n\t\t\tthis.cvsResize = ()=> this.#idc.cvsResize();\n\t\t}\n*/\n\t\tthis.#o = {\n\t\t\ttype\t: 'pic',\n\t\t\tenabled\t: argChk_Boolean(hArg, 'enabled', true),\n\t\t\tx\t\t: this.x = uint(hArg.left ?? 0),\n\t\t\ty\t\t: this.y = uint(hArg.top ?? 0),\n\t\t\trotation: this.angle = argChk_Num(hArg, 'rotation', this.angle),\n\t\t\t\t// flash : rotation is in degrees.\n\t\t\t\t// pixijs: rotation is in radians, angle is in degrees.\n\t\t\tpivot_x\t: this.pivot.x = argChk_Num(hArg, 'pivot_x', this.pivot.x),\n\t\t\tpivot_y\t: this.pivot.y = argChk_Num(hArg, 'pivot_y', this.pivot.y),\n\t\t\tscale_x\t: this.scale.x = argChk_Num(hArg, 'scale_x', this.scale.x),\n\t\t\tscale_y\t: this.scale.y = argChk_Num(hArg, 'scale_y', this.scale.y),\n\t\t\talpha\t: 1,\n\t\t\ttext\t: '',\n\t\t\tb_pic\t: '',\n\t\t\twidth\t: 0,\n\t\t\theight\t: 0,\n\t\t};\n\t\tthis.getBtnBounds = ()=> {\n\t\t\tthis.#rctBtnTxt.x = this.#o.x;\n\t\t\tthis.#rctBtnTxt.y = this.#o.y;\n\t\t\treturn this.#rctBtnTxt;\n\t\t};\n\n\t\tif (this.#o.enabled) evtMng.button(hArg, this, ()=> this.normal(), ()=> this.#hover(), ()=> this.#clicked());\t// あとで差し替えるのでアロー必須\n\n\t\t// == 画像から生成\n\t\tif (hArg.pic) {\n\t\t\tthis.#o.type = 'pic';\t// dump用\n//\t\t\tthis.#idc = new PicBtnDesignCast(this, hArg);\n\n\t\t\tthis.#sps = new SpritesMng(\n\t\t\t\thArg.pic,\n\t\t\t\tthis,\n\t\t\t\tsp=> {\n\t\t\t\t\tthis.#loaded_pic(sp);\n\t\t\t\t\tthis.#rctBtnTxt.width  = sp.width  * this.#o.scale_x;\n\t\t\t\t\tthis.#rctBtnTxt.height = sp.height * this.#o.scale_y;\n\t\t\t\t},\n\t\t\t\t_isStop=> resolve,\n\t\t\t);\n\t\t\treturn;\n\t\t}\n\t\tif (! hArg.text) throw 'textまたはpic属性は必須です';\n\n\t\t// == 文字列から生成\n\t\tconst height = argChk_Num(hArg, 'height', 30);\n\t\tconst style = new TextStyle({\n\t\t\talign\t\t: 'center',\n\t\t\tdropShadow\t: true,\n\t\t\tdropShadowAlpha\t: 0.7,\n\t\t\tdropShadowColor\t: 'white',\n\t\t\tdropShadowBlur\t: 7,\n\t\t\tdropShadowDistance\t: 0,\n\t\t\tfill\t\t: this.#o.enabled ?'black' :'gray',\n\t\t\tfontFamily\t: Button.fontFamily,\n\t\t\tfontSize\t: height,\n\t\t\tpadding\t\t: 5,\n\t\t});\n\t\tif (hArg.style) try {\n\t\t\tconst o = JSON.parse(hArg.style);\n\t\t\tfor (const [nm, v] of Object.entries(o)) (style as any)[nm] = v;\n\t\t//\tstyle = {...style, ...JSON.parse(hArg.style)};\t// 上手くいかない\n\n\t\t\tthis.#o = {...this.#o, ...o};\n\t\t} catch (e) {\n\t\t\tif (e instanceof SyntaxError) throw new Error(mesErrJSON(hArg, 'style', e.message));\n\t\t\telse throw `fn:Button.ts style`;\n\t\t}\n\n\t\tconst txt = new Text(hArg.text ?? '', style);\n\t\ttxt.alpha = argChk_Num(hArg, 'alpha', txt.alpha);\t// 上にまとめない\n\t\ttxt.width = argChk_Num(hArg, 'width', 100);\n\t\ttxt.height = hArg.height = height;\n\t\tthis.setText = text=> txt.text = text;\n\n\t\tthis.#o = {...this.#o,\n\t\t\ttype\t: 'text',\t// dump用\n\t\t\talpha\t: txt.alpha,\n\t\t\ttext\t: txt.text,\n\t\t\twidth\t: txt.width,\n\t\t\theight\t: txt.height,\n\t\t};\n//\t\tthis.#idc = new TxtBtnDesignCast(this, hArg, txt);\n\n\t\tlet isStop = false;\n\t\tthis.#o.width = this.width;\n\t\tthis.#o.height = this.height;\n\t\tif (hArg.b_pic) {\n\t\t\tthis.#o.b_pic = hArg.b_pic;\n\t\t\tthis.#sps = new SpritesMng(\n\t\t\t\thArg.b_pic,\n\t\t\t\tthis,\n\t\t\t\tsp=> {\n\t\t\t\t\tthis.#loaded_b_pic(sp, txt);\n\t\t\t\t\tthis.#o.width = this.width;\n\t\t\t\t\tthis.#o.height = this.height;\n\t\t\t\t\ttxt.name = JSON.stringify(this.#o);\n\t\t\t\t},\n\t\t\t\tisStop=> {\n\t\t\t\t\tLayer.setBlendmode(this, hArg);\n\t\t\t\t\tif (isStop) resolve();\n\t\t\t\t},\n\t\t\t);\n\t\t\tisStop = this.#sps.ret;\n\t\t}\n\t\ttxt.name = JSON.stringify(this.#o);\n\n\t\tthis.addChild(txt);\n\t\tthis.#rctBtnTxt.width = txt.width;\t// addChild()後に取得すること\n\t\tthis.#rctBtnTxt.height = txt.height;\n\t//x\tthis.#rctBtnTxt = txt.getBounds();\t// 上手くいかない\n\n\t\tif (! hArg.b_pic) Layer.setBlendmode(this, hArg);\t// 重なり順でここ\n\t\tButton.#procMasume4txt(this, txt);\n\t\tif (! this.#o.enabled) {if (! isStop) resolve(); return}\n\n\t\tconst style_hover = style.clone();\n\t\tif (hArg.style_hover) try {\n\t\t\tconst o = JSON.parse(hArg.style_hover);\n\t\t\tfor (const [nm, v] of Object.entries(o)) (style_hover as any)[nm] = v;\n\t\t} catch (e) {\n\t\t\tif (e instanceof SyntaxError) throw new Error(mesErrJSON(hArg, 'style_hover', e.message));\n\t\t\telse throw `fn:Button.ts style_hover`;\n\t\t}\n\t\telse style_hover.fill = 'white';\n\n\t\tconst style_clicked = style_hover.clone();\n\t\tif (hArg.style_clicked) try {\n\t\t\tconst o = JSON.parse(hArg.style_clicked);\n\t\t\tfor (const [nm, v] of Object.entries(o)) (style_clicked as any)[nm] = v;\n\t\t} catch (e) {\n\t\t\tif (e instanceof SyntaxError) throw new Error(mesErrJSON(hArg, 'style_clicked', e.message));\n\t\t\telse throw `fn:Button.ts style_clicked`;\n\t\t}\n\t\telse style_clicked.dropShadow = false;\n\n\t\tthis.normal = ()=> txt.style = style;\n\t\tthis.#hover = ()=> {\n\t\t\tif (! canFocus()) return false;\n\t\t\ttxt.style = style_hover;\n\t\t\treturn true;\n\t\t};\n\t\tthis.#clicked = ()=> txt.style = style_clicked;\n\n\t\tif (! isStop) resolve();\n\t}\n\n\toverride\tdestroy(): void {\n\t\tthis.evtMng.unButton(this);\n\t\tthis.#sps.destroy();\n\t\tsuper.destroy();\n\t}\n\n\tmakeDesignCast(_gdc: IMakeDesignCast) {}\n\tshowDesignCast() {}\n//\tshowDesignCast() {this.#idc.visible = true}\n\tcvsResize() {}\n\n\t#loaded_b_pic(sp: Sprite, txt: Text) {\n\t\tthis.setChildIndex(sp, 0);\n\t\tsp.alpha = txt.alpha;\n\t\tsp.setTransform(\n\t\t\ttxt.x, txt.y,\n\t\t\t1, 1, txt.rotation, 0, 0,\n\t\t\t(sp.width -txt.width) /2,\n\t\t\t(sp.height -txt.height) /2,\n\t\t);\n\n\t\tsp.name = txt.name;\n\t}\n\n\tnormal\t\t: ()=> void\t\t= ()=> {};\n\t#hover\t\t: ()=> boolean\t= ()=> false;\n\t#clicked\t: ()=> void\t\t= ()=> {};\n\t#loaded_pic(sp: Sprite) {\n\t\tthis.#o.alpha = sp.alpha = argChk_Num(this.hArg, 'alpha', sp.alpha);\n//\t\t(this.#idc as PicBtnDesignCast).setSp(sp);\n\n\t\tconst w_3 = sp.width /3;\n\t\tconst w = this.#o.enabled ?w_3 :sp.width;\n\t\tconst h = sp.height;\n\t\tconst tx = sp.texture.baseTexture;\n\t\tconst txNormal = new Texture(tx, new Rectangle(0, 0, w_3, h));\n\t\tconst txClicked = new Texture(tx, new Rectangle(w_3, 0, w_3, h));\n\t\tconst txHover = new Texture(tx, new Rectangle(w_3 *2, 0, w_3, h));\n\t\tconst normal = ()=> sp.texture = txNormal;\n\t\tif (this.#o.enabled) normal();\n\n\t\tthis.normal\t= normal;\n\t\tthis.#hover\t\t= ()=> {\n\t\t\tif (! this.canFocus()) return false;\n\t\t\tsp.texture = txHover;\n\t\t\treturn true;\n\t\t};\n\t\tthis.#clicked\t= ()=> sp.texture = txClicked;\n\n\t\tif ('width' in this.hArg) {\n\t\t\tthis.#o.width = uint(this.hArg.width);\n\t\t\tthis.scale.x *= this.#o.width /w;\n\t\t}\n\t\telse this.#o.width = w;\n\t\tif ('height' in this.hArg) {\n\t\t\tthis.#o.height = uint(this.hArg.height);\n\t\t\tthis.scale.y *= this.#o.height /h;\n\t\t}\n\t\telse this.#o.height = h;\n\t\tsp.name = JSON.stringify(this.#o);\t// dump用\n\n\t\tButton.#procMasume4pic(this, sp, w, h);\n\t}\n\n}\n","/* ***** BEGIN LICENSE BLOCK *****\n\tCopyright (c) 2018-2025 Famibee (famibee.blog38.fc2.com)\n\n\tThis software is released under the MIT License.\n\thttp://opensource.org/licenses/mit-license.php\n** ***** END LICENSE BLOCK ***** */\n\nimport type {HArg} from './Grammar';\nimport type {IVariable} from './CmnInterface';\nimport type {Layer} from './Layer';\nimport type {SysBase} from './SysBase';\nimport {argChk_Boolean} from './CmnLib';\n\nimport type {Container} from 'pixi.js';\n\nexport class Pages {\n\t#pg: {fore: Layer, back: Layer};\n\n\tconstructor(layname: string, readonly cls: string, fore: Container, back: Container, readonly hArg: HArg, readonly sys: SysBase, readonly val: IVariable, readonly ret: {isWait: boolean}) {\n\t\tconst fncF = sys.hFactoryCls[cls];\n\t\tif (! fncF) throw `属性 class【${cls}】が不正です`;\n\n\t\tconst f = fncF();\n\t\tconst b = fncF();\n\t\tf.layname =\n\t\tb.layname = layname;\n\t\tconst nm = hArg[':id_tag'] = `layer:${layname} cls:${cls} page:`;\n\t\tf.ctn.name = f.name = nm +'A';\n\t\tb.ctn.name = b.name = nm +'B';\n\t\tfore.addChild(f.ctn);\n\t\tback.addChild(b.ctn);\n\t\targChk_Boolean(hArg, 'visible', true);\n\t\targChk_Boolean(hArg, 'visible', true);// SKYNovelではデフォルトはtrueとする\n\t\tret.isWait = f.lay(hArg) || b.lay(hArg);\n\t\tthis.#pg = {fore: f, back: b};\n\n\t\t// 組み込み変数\n\t\tconst valnm = `const.sn.lay.${layname}`;\n\t\tval.setVal_Nochk('tmp', valnm, true);\n\t\tval.defTmp(valnm +'.fore.alpha', ()=> this.#pg.fore.alpha);\n\t\tval.defTmp(valnm +'.back.alpha', ()=> this.#pg.back.alpha);\n\t\tval.defTmp(valnm +'.fore.height', ()=> this.#pg.fore.height);\n\t\tval.defTmp(valnm +'.back.height', ()=> this.#pg.back.height);\n\t\tval.defTmp(valnm +'.fore.visible', ()=> this.#pg.fore.ctn.visible);\n\t\tval.defTmp(valnm +'.back.visible', ()=> this.#pg.back.ctn.visible);\n\t\tval.defTmp(valnm +'.fore.width', ()=> this.#pg.fore.width);\n\t\tval.defTmp(valnm +'.back.width', ()=> this.#pg.back.width);\n\t\tval.defTmp(valnm +'.fore.x', ()=> this.#pg.fore.x);\n\t\tval.defTmp(valnm +'.back.x', ()=> this.#pg.back.x);\n\t\tval.defTmp(valnm +'.fore.y', ()=> this.#pg.fore.y);\n\t\tval.defTmp(valnm +'.back.y', ()=> this.#pg.back.y);\n\t}\n\tdestroy() {\n\t\tthis.#pg.fore.destroy();\n\t\tthis.#pg.back.destroy();\n\t}\n\n\treadonly lay = (hArg: HArg)=> this.getPage(hArg).lay(hArg);\n\treadonly getPage = (hArg: HArg)=>\n\t\t(Pages.argChk_page(hArg, 'fore') !== 'back')\n\t\t\t? this.#pg.fore\n\t\t\t: this.#pg.back;\n\tstatic\targChk_page(hash: HArg, def: string): string {\n\t\tconst v = hash.page ?? def;\n\t\tif (v === 'fore') return hash.page = v;\n\t\tif (v === 'back') return hash.page = v;\n\n\t\tthrow Error('属性 page【'+ v +'】が不正です');\n\t}\n\tget fore(): Layer {return this.#pg.fore}\n\tget back(): Layer {return this.#pg.back}\n\n\ttransPage(aPrm: Promise<void>[]): void {\n\t\t[this.#pg.back, this.#pg.fore] = [this.#pg.fore, this.#pg.back];\n\t\tthis.#pg.back.copy(this.#pg.fore, aPrm);\n\t}\n\n}\n","/* ***** BEGIN LICENSE BLOCK *****\n\tCopyright (c) 2021-2025 Famibee (famibee.blog38.fc2.com)\n\n\tThis software is released under the MIT License.\n\thttp://opensource.org/licenses/mit-license.php\n** ***** END LICENSE BLOCK ***** */\n\nimport type {HArg} from './Grammar';\nimport type {IPropParser} from './CmnInterface';\nimport type {SysBase} from './SysBase';\nimport type {ScriptIterator} from './ScriptIterator';\nimport type {HPage} from './LayerMng';\nimport type {HPRM} from './AnalyzeTagArg';\nimport type {TxtStage} from './TxtStage';\nimport type {Button} from './Button';\nimport type {GrpLayer} from './GrpLayer';\nimport type {Config} from './Config';\n\nimport {Application, Text, Sprite} from 'pixi.js';\n\n\nexport class DesignCast {\n\tstatic\tinit(_appPixi: Application, _sys: SysBase, _scrItr: ScriptIterator, _prpPrs: IPropParser, _cfg: Config, _hPages: HPage) {}\n\tstatic\tcvsResizeDesign() {}\n//\tstatic\treadonly\t#alzTagArg\t= new AnalyzeTagArg;\n\n\n\tconstructor(readonly bg_col: string, readonly isLay = false) {}\n\tdestroy() {}\n\n\tgethArg(): HArg {return this.hArg}\n\tprotected\thArg\t: HArg\t= {};\n\tsethArg(hArg: HArg): void {\n\t\tthis.hArg = hArg;\n\t}\n\n\tsetOther(_hPrm: HPRM) {}\n\n\tadopt(_idcCh: DesignCast) {\t// 養子縁組\n\t}\n\n\tstatic\tenterMode() {}\n\tstatic\tallHide() {}\n\tset visible(_v: boolean) {}\n\tstatic\tleaveMode() {}\n\n\n\tcvsResize() {}\n\tmake() {}\n\tstatic replaceToken(_o: any) {}\n\n}\n\n\n// 画像レイヤ\nexport class GrpLayDesignCast extends DesignCast {\n\tconstructor(_ctn: Sprite, _gl: GrpLayer) {super('#29e', true)}\n\tsetSp(_sp: Sprite) {}\n}\n\n// 文字レイヤ\nexport class TxtLayDesignCast extends DesignCast {\n\tconstructor(_ctn: Sprite, _ts: TxtStage) {\n\t\tsuper('#29e', true);\n\t}\n}\n// 文字レイヤ・パディング\nexport class TxtLayPadDesignCast extends DesignCast {\n\tconstructor(_ts: TxtStage) {super('#9e2')}\n}\n\n// 文字レイヤ・ボタン基本\nexport class BtnDesignCast extends DesignCast {\n\tconstructor(protected readonly btn: Button, override readonly hArg: HArg) {\n\t\tsuper('#e92');\n\t}\n}\n// 文字レイヤ・文字ボタン\nexport class TxtBtnDesignCast extends BtnDesignCast {\n\tconstructor(btn: Button, hArg: HArg, _txt: Text) {\n\t\tsuper(btn, hArg);\n\t}\n}\n\n// 文字レイヤ・画像ボタン\nexport class PicBtnDesignCast extends BtnDesignCast {\n\tconstructor(btn: Button, hArg: HArg) {super(btn, hArg)}\n\tsetSp(_sp: Sprite) {}\n}\n","/* ***** BEGIN LICENSE BLOCK *****\n\tCopyright (c) 2018-2025 Famibee (famibee.blog38.fc2.com)\n\n\tThis software is released under the MIT License.\n\thttp://opensource.org/licenses/mit-license.php\n** ***** END LICENSE BLOCK ***** */\n\nimport {Layer} from './Layer';\n\nimport {CmnLib, argChk_Boolean, argChk_Num} from './CmnLib';\nimport type {HArg} from './Grammar';\nimport type {IMain, IVariable} from './CmnInterface';\nimport {Config} from './Config';\nimport type {SysBase} from './SysBase';\nimport {EventListenerCtn} from './EventListenerCtn';\nimport type {SoundMng} from './SoundMng';\nimport type {IMakeDesignCast} from './LayerMng';\nimport {GrpLayDesignCast} from './DesignCast';\nimport {SpritesMng} from './SpritesMng';\nimport {Reading} from './Reading';\n\nimport {Sprite, AnimatedSprite, RenderTexture, Application} from 'pixi.js';\n\n\nexport class GrpLayer extends Layer {\n\tstatic\treadonly\t#elc\t= new EventListenerCtn;\n\n\tstatic\t#appPixi: Application;\n\tstatic\tinit(main: IMain, cfg: Config, appPixi: Application, sys: SysBase, sndMng: SoundMng, val: IVariable): void {\n\t\tGrpLayer.#appPixi = appPixi;\n\t\tSpritesMng.init(cfg, val, sys, main, sndMng);\n\t}\n\tstatic\tdestroy() {GrpLayer.#elc.clear(); SpritesMng.destroy()}\n\n\treadonly\t#idc\t= new GrpLayDesignCast(this.ctn, this);\n\tconstructor() {\n\t\tsuper();\n\t\tif (CmnLib.isDbg) {\n\t\t\tthis.#setIdcSp = sp=> this.#idc.setSp(sp);\n\t\t\tthis.cvsResize = ()=> {super.cvsResize(); this.#idc.cvsResize()}\n\t\t}\n\t}\n\t#setIdcSp\t: (sp: Sprite)=> void\t= ()=> {};\n\n\t#csvFn\t\t= '';\n\t#sBkFn\t\t= '';\n\t#sBkFace\t= '';\n\toverride readonly\tlay = (hArg: HArg)=> {\n\t\tconst RPN_GRP_LAY = Reading.procID +`GrpLayer lay name:${this.name_}`;\n\t\tconst ret = this.#laySub(hArg, isStop=> {\n\t\t\tif (isStop) Reading.endProc(RPN_GRP_LAY);\n\t\t});\n\t\tif (ret) Reading.beginProc(RPN_GRP_LAY);\n\t\treturn ret;\n\t}\n\t#laySub(hArg: HArg, resolve: (isStop: boolean)=> void): boolean {\n\t\tconst {fn, face = ''} = hArg;\n\t\tthis.#idc.sethArg(hArg);\n\t\tif (! fn) {\n\t\t\tsuper.lay(hArg);\n\n\t\t\tif (this.ctn.children.length > 0) this.setPos(hArg);\n\t\t\tthis.#sBkFn = '';\n\t\t\tthis.#csvFn = this.#sBkFace = face;\n\t\t\tresolve(false);\n\t\t\treturn false;\n\t\t}\n\n\t\tconst inFn = 'fn' in hArg;\n\t\tconst inFace = 'face' in hArg;\n\n\t\tthis.clearLay({clear_filter: argChk_Boolean(hArg, 'clear_filter', true)});\n\t\tif (inFn) this.#sBkFn = fn;\t// clearLay()後に置く事\n\t\tif (inFace) this.#sBkFace = face;\n\t\tsuper.lay(hArg);\t// filter設定してる場合も\n\n\t\thArg.dx = 0;\n\t\thArg.dy = 0;\n\n\t\tthis.#sps.destroy();\n\t\tthis.#sps = new SpritesMng(\n\t\t\tthis.#csvFn = fn + (face ?','+ face :''),\n\t\t\tthis.ctn,\n\t\t\tsp=> {\n\t\t\t\tif ('width' in hArg || 'height' in hArg) {\n\t\t\t\t\tsp.width = argChk_Num(hArg, 'width', 0);\n\t\t\t\t\tsp.height = argChk_Num(hArg, 'height', 0);\n\t\t\t\t}\n\t\t\t\tthis.#width = sp.width;\n\t\t\t\tthis.#height = sp.height;\n\t\t\t\tLayer.setXY(sp, hArg, this.ctn, true);\n\t\t\t\tLayer.setBlendmode(this.ctn, hArg);\n\t\t\t//\tif (hArg.page === 'fore') this.rsvEvent(sp);\t// ======\n\t\t\t\t\t// [lay page=fore]のみswfアニメ終了イベント発生\n\t\t\t\tthis.#setIdcSp(sp);\n\t\t\t},\n\t\t\tisStop=> resolve(isStop),\n\t\t);\n\t\treturn this.#sps.ret;\n\t}\n\t#sps\t= new SpritesMng;\n\t#width\t= 0;\n\t#height\t= 0;\n\toverride\tget\twidth() {return this.#width}\n\toverride\tget\theight() {return this.#height}\n\n\n\toverride\trenderStart() {\n\t\tthis.#spTsy = new Sprite(this.#rtTsy);\n\t\tthis.#spTsy.visible = false;\n\t\tthis.ctn.addChildAt(this.#spTsy, 0);\n\t\tthis.#spTsy.position.set(-this.ctn.x, -this.ctn.y);\n\n\t\tlet fncRenderFore = ()=> {\n\t\t\tconst a = this.ctn.alpha;\n\t\t\tthis.ctn.alpha = 1;\n\t\t\tfor (const s of this.ctn.children) s.visible = true;\n\t\t\tthis.#spTsy.visible = false;\n\t\t\tGrpLayer.#appPixi.renderer.render(this.ctn, {renderTexture: this.#rtTsy});\t// clear: true\n\t\t\tthis.ctn.alpha = a;\n\t\t\tfor (const s of this.ctn.children) s.visible = false;\n\t\t}\n\t\tif (! this.containMovement) {\n\t\t\tlet oldFnc = fncRenderFore;\t// 動きがないなら最初に一度\n\t\t\tfncRenderFore = ()=> {fncRenderFore = ()=> {}; oldFnc()};\n\t\t}\n\t\tthis.#fncRender = ()=> {\n\t\t\tfncRenderFore();\n\t\t\tthis.#spTsy.visible = true;\n\t\t};\n\t\tGrpLayer.#appPixi.ticker.add(this.#fncRender);\n\t}\n\t#rtTsy\t= RenderTexture.create({\n\t\twidth\t: CmnLib.stageW,\n\t\theight\t: CmnLib.stageH,\n\t});\n\t#spTsy\t= new Sprite;\n\t#fncRender = ()=> {};\n\toverride\trenderEnd() {\n\t\tGrpLayer.#appPixi.ticker.remove(this.#fncRender);\n\t\tthis.ctn.removeChild(this.#spTsy);\n\t\tfor (const s of this.ctn.children) s.visible = true;\n\t\tthis.#spTsy.destroy(true);\n\n\t\tthis.#rtTsy = RenderTexture.create({\n\t\t\twidth\t: CmnLib.stageW,\n\t\t\theight\t: CmnLib.stageH,\n\t\t});\n\t}\n\n\n\tsetPos(hArg: HArg): void {\n\t\tLayer.setXY(\n\t\t\tthis.ctn.children[0] ?? this.ctn,\n\t\t\thArg,\n\t\t\tthis.ctn,\n\t\t\ttrue\n\t\t);\n\t}\n\n\t// アニメ・動画を含むか\n\toverride get containMovement(): boolean {\n\t\tif (this.#csvFn === '') return false;\n\n\t\tconst c = this.ctn.children;\n\t\treturn this.#csvFn.split(',').some(\n\t\t\t(fn, i)=> c[i] instanceof AnimatedSprite || SpritesMng.getHFn2VElm(fn)\n\t\t);\n\t}\n\n\toverride clearLay(hArg: HArg): void {\n\t\tsuper.clearLay(hArg);\n\t\tthis.#sps.destroy();\n\t\tthis.#sBkFn\t\t= '';\n\t\tthis.#sBkFace\t= '';\n\t\tthis.#csvFn\t\t= '';\n\t}\n\toverride readonly record = ()=> ({...super.record(),\n\t\tsBkFn\t\t: this.#sBkFn,\n\t\tsBkFace\t\t: this.#sBkFace,\n//\t\tidc_hArg\t: this.#idc.gethArg(),\n\t});\n\toverride playback(hLay: any, aPrm: Promise<void>[]): void {\n\t\tsuper.playback(hLay, aPrm);\n\t\tif (hLay.sBkFn === '' && hLay.sBkFace === '') {\n\t\t\tthis.#sBkFn\t\t= '';\n\t\t\tthis.#sBkFace\t= '';\n//\t\t\tthis.#idc.sethArg(hLay.idc_hArg);\n\t\t\treturn;\n\t\t}\n\n\t\taPrm.push(new Promise(re=> this.#laySub(\n\t\t\t{fn: hLay.sBkFn, face: hLay.sBkFace, left: hLay.x, top: hLay.y, alpha: hLay.alpha, blendmode: Layer.getNum2Blendmode(hLay.blendMode), rotation: hLay.rotation, scale_x: hLay.scale_x, scale_y: hLay.scale_y},\n\t\t\t_isStop=> {this.ctn.position.set(hLay.x, hLay.y); re()},\n\t\t\t\t// Layer.setXY()の後に再度移動\n\t\t)));\n\t}\n\n\toverride makeDesignCast(gdc: IMakeDesignCast) {\n\t\tif (! this.ctn.visible) return;\n\t\tgdc(this.#idc);\n\t}\n\t//makeDesignCastChildren(_gdc: IMakeDesignCast) {}\n\n\toverride cvsResize() {super.cvsResize()}\n\n\toverride showDesignCast() {this.#idc.visible = true}\n\t//showDesignCastChildren() {}\n\n\toverride readonly dump = ()=> super.dump() +`, \"pic\":\"${this.#csvFn}\"`;\n\n}\n","/* ***** BEGIN LICENSE BLOCK *****\n\tCopyright (c) 2018-2025 Famibee (famibee.blog38.fc2.com)\n\n\tThis software is released under the MIT License.\n\thttp://opensource.org/licenses/mit-license.php\n** ***** END LICENSE BLOCK ***** */\n\nimport {CmnLib, type IEvtMng, argChk_Boolean, argChk_Num} from './CmnLib';\nimport {CmnTween} from './CmnTween';\nimport type {IHTag, HArg} from './Grammar';\nimport type {IVariable, IMain, IGetFrm} from './CmnInterface';\nimport type {SysBase} from './SysBase';\nimport type {Config} from './Config';\nimport {SEARCH_PATH_ARG_EXT} from './ConfigBase';\nimport {Reading} from './Reading';\n\nimport {type Application, Loader, LoaderResource} from 'pixi.js';\n\n\nexport class FrameMng implements IGetFrm {\n\tstatic\t#cfg\t: Config;\n\tstatic\t#sys\t: SysBase;\n\tstatic\t#main\t: IMain;\n\tstatic\tinit(cfg: Config, sys: SysBase, main: IMain): void {\n\t\tFrameMng.#cfg = cfg;\n\t\tFrameMng.#sys = sys;\n\t\tFrameMng.#main = main;\n\t}\n\n\tconstructor(hTag: IHTag, private readonly appPixi: Application, private readonly val: IVariable) {\n\t\t//\tHTMLフレーム\n\t\thTag.add_frame\t\t= o=> this.#add_frame(o);\t// フレーム追加\n\t\thTag.let_frame\t\t= o=> this.#let_frame(o);\t// フレーム変数を取得\n\t\thTag.set_frame\t\t= o=> this.#set_frame(o);\t// フレーム変数に設定\n\t\thTag.frame\t\t\t= o=> this.#frame(o);\t\t// フレームに設定\n\t\thTag.tsy_frame\t\t= o=> this.#tsy_frame(o);\t// フレームをトゥイーン開始\n\t}\n\n\t#evtMng\t: IEvtMng;\n\tsetEvtMng(evtMng: IEvtMng) {this.#evtMng = evtMng}\n\n\t#hIfrm\t: {[id: string]: HTMLIFrameElement} = Object.create(null);\n\tdestroy() {\n\t\tfor (const f of Object.values(this.#hIfrm)) f.parentElement!.removeChild(f);\n\t\tthis.#hIfrm = Object.create(null);\n\t}\n\n\thideAllFrame() {\t// （表示・非表示を保存しつつ）すべて非表示に\n\t\tfor (const [id, {style}] of Object.entries(this.#hIfrm)) {\n\t\t\tthis.#hIfrmVisibleBk[id] = style.display !== 'none';\n\t\t\tstyle.display = 'none';\n\t\t}\n\t}\n\t#hIfrmVisibleBk: {[id: string]: boolean} = Object.create(null);\n\trestoreAllFrame() {\t// 保存していた表示・非表示を回復\n\t\tfor (const [id, v] of Object.entries(this.#hIfrmVisibleBk)) {\n\t\t\tconst f = this.#hIfrm[id];\n\t\t\tif (f) f.style.display = v ?'inline' :'none';\n\t\t}\n\t\tthis.#hIfrmVisibleBk = Object.create(null);\n\t}\n\n\t//\tHTMLフレーム\n\t// フレーム追加\n\t#add_frame(hArg: HArg) {\n\t\tconst {id, src, alpha: a=1, scale_x: sx=1, scale_y: sy=1, rotate: r=0,} = hArg;\n\t\tif (! id) throw 'idは必須です';\n\t\tif (! src) throw 'srcは必須です';\n\t\tconst vn = 'const.sn.frm.'+ id;\n\t\tif (this.val.getVal(`tmp:${vn}`)) throw `frame【${id}】はすでにあります`;\n\n\t\tconst v = argChk_Boolean(hArg, 'visible', true);\n\t\tconst b_color = hArg.b_color ?` background-color: ${hArg.b_color};` :'';\n\t\tconst rct = this.#rect(hArg);\n\t\t// 【sandbox=\"allow-scripts allow-same-origin\"】は必要なのに警告が出るので削除\n\t\tFrameMng.#main.cvs.insertAdjacentHTML('beforebegin', `<iframe id=\"${id}\" style=\"opacity: ${a}; ${b_color} position: absolute; left:${\n\t\t\tFrameMng.#sys.ofsLeft4elm +rct.x *FrameMng.#sys.cvsScale\n\t\t}px; top: ${\n\t\t\tFrameMng.#sys.ofsTop4elm +rct.y *FrameMng.#sys.cvsScale\n\t\t}px; z-index: 1; border: 0px; overflow: hidden; display: ${\n\t\t\tv ?'inline' :'none'\n\t\t}; transform: scale(${sx}, ${sy}) rotate(${r}deg);\" width=\"${\n\t\t\trct.width *FrameMng.#sys.cvsScale\n\t\t}\" height=\"${\n\t\t\trct.height *FrameMng.#sys.cvsScale\n\t\t}\"></iframe>`);\n\n\t\tconst RPN_ADD_FRAME = Reading.procID +`add_frame id:${id}`;\n\t\tReading.beginProc(RPN_ADD_FRAME);\n\t\tconst url = FrameMng.#cfg.searchPath(src, SEARCH_PATH_ARG_EXT.HTML);\n\t\tconst ld = (new Loader)\n\t\t.add({name: src, url, xhrType: LoaderResource.XHR_RESPONSE_TYPE.TEXT});\n\t\tif (FrameMng.#sys.arg.crypto) ld.use(async (res, next)=> {\n\t\t\ttry {\n\t\t\t\tres.data = await FrameMng.#sys.dec(res.extension, res.data);\n\t\t\t} catch (e) {\n\t\t\t\tFrameMng.#main.errScript(`[add_frame]Html ロード失敗です src:${res.name} ${e}`, false);\n\t\t\t}\n\t\t\tnext();\n\t\t});\n\t\tld.load((_ldr, hRes)=> {\n\t\t\tconst f = document.getElementById(id) as HTMLIFrameElement;\n\t\t\tthis.#hIfrm[id] = f;\n\t\t\tthis.#hDisabled[id] = false;\n\n\t\t\tconst iLastSep = url.lastIndexOf('/') +1;\n\t\t\tconst path_parent = url.slice(0, iLastSep);\n\t\t\tconst path_pa_pa = path_parent.slice(0, iLastSep);\n\t\t\tf.srcdoc = String(hRes[src]?.data)\t// .src はふりーむで問題発生\n\t\t\t.replace('sn_repRes();', '')\t// これはいずれやめる\n\t\t\t.replaceAll(\n\t\t\t\t/\\s(?:src|href)=([\"'])(\\S+?)\\1/g,\t// 【\\s】が大事、data-src弾く\n\t\t\t\t(m, br, v)=> v.startsWith('../')\n\t\t\t\t? m.replace('../', path_pa_pa)\n\t\t\t\t: m.replace('./', '')\t// 「./」は無視\n\t\t\t\t\t.replace(br, br + path_parent)\n\t\t\t);\n\n\t\t\tif (f.srcdoc.includes('true/*WEBP*/;')) f.srcdoc = f.srcdoc.replaceAll(\n\t\t\t\t/data-src=\"(.+?\\.)(?:jpe?g|png)/g,\n\t\t\t\t(_, p1)=> `data-src=\"${p1}webp`\n\t\t\t);\n\n\t\t\tf.onload = ()=> {\t// 一度変数に入れてここで設定するのはFirefox対応。ifrm.onloadが二度呼ばれる！\n\t\t\t\tReading.endProc(RPN_ADD_FRAME);\n\n\t\t\t\t// 組み込み変数\n\t\t\t\tthis.val.setVal_Nochk('tmp', vn, true);\n\t\t\t\tthis.val.setVal_Nochk('tmp', vn +'.alpha', a);\n\t\t\t\tthis.val.setVal_Nochk('tmp', vn +'.x', rct.x);\n\t\t\t\tthis.val.setVal_Nochk('tmp', vn +'.y', rct.y);\n\t\t\t\tthis.val.setVal_Nochk('tmp', vn +'.scale_x', sx);\n\t\t\t\tthis.val.setVal_Nochk('tmp', vn +'.scale_y', sy);\n\t\t\t\tthis.val.setVal_Nochk('tmp', vn +'.rotate', r);\n\t\t\t\tthis.val.setVal_Nochk('tmp', vn +'.width', rct.width);\n\t\t\t\tthis.val.setVal_Nochk('tmp', vn +'.height', rct.height);\n\t\t\t\tthis.val.setVal_Nochk('tmp', vn +'.visible', v);\n\n\t\t\t\tconst win = f.contentWindow!;\n\t\t\t\tthis.#evtMng.resvFlameEvent(win);\n\t\t\t\t// sn_repRes()をコール。引数は画像ロード処理差し替えメソッド\n\t\t\t\t((win as any).sn_repRes)?.((i: HTMLImageElement)=> FrameMng.#loadPic2Img(i.dataset.src ?? '', i));\n\t\t\t};\n\t\t});\n\t\treturn true;\n\t}\n\t#hDisabled\t: {[id: string]: boolean}\t= {};\n\tgetFrmDisabled(id: string): boolean {return this.#hDisabled[id] as boolean}\n\t#rect(hArg: HArg): DOMRect {\n\t\tconst a = {...hArg};\n\t\tconst re = FrameMng.#sys.resolution;\n\t\treturn new DOMRect(\n\t\t\targChk_Num(a, 'x', 0) *re,\n\t\t\targChk_Num(a, 'y', 0) *re,\n\t\t\targChk_Num(a, 'width', CmnLib.stageW) *re,\n\t\t\targChk_Num(a, 'height', CmnLib.stageH) *re,\n\t\t);\n\t}\n\n\tstatic\t#loadPic2Img(src: string, img: HTMLImageElement, onload?: (img2: HTMLImageElement)=> void) {\n\t\tconst oUrl = this.#hEncImgOUrl[src];\n\t\tif (oUrl) {\n\t\t\timg.src = oUrl;\n\t\t\tif (onload) img.onload = ()=> onload(img);\n\t\t\treturn;\n\t\t}\n\n\t\tconst aImg = this.#hARetImg[src];\n\t\tif (aImg) {aImg.push(img); return}\t// load 終了前の駆け込み対応\n\t\tthis.#hARetImg[src] = [img];\n\n\t\tconst [srcNoPrm='', Prm=''] = src.split('?');\n\t\tconst path = FrameMng.#cfg.searchPath(srcNoPrm, SEARCH_PATH_ARG_EXT.SP_GSM);\n\t\tconst ld2 = (new Loader)\n\t\t.add({name: src, url: path, xhrType: LoaderResource.XHR_RESPONSE_TYPE.BUFFER,});\n\t\tif (FrameMng.#sys.arg.crypto && path.endsWith('.bin')) ld2.use(async (res, next)=> {\n\t\t\ttry {\n\t\t\t\tconst r = await FrameMng.#sys.decAB(res.data);\n\t\t\t\tif (res.extension !== 'bin') {next(); return}\n\n\t\t\t\tres.data = r;\n\t\t\t\tif (r instanceof HTMLImageElement) res.type = LoaderResource.TYPE.IMAGE;\n\t\t\t} catch (e) {\n\t\t\t\tFrameMng.#main.errScript(`FrameMng loadPic ロード失敗です fn:${res.name} ${e}`, false)\n\t\t\t}\n\t\t\tnext();\n\t\t});\n\t\tld2.load((_ldr, hRes)=> {\n\t\t\tfor (const [s2, {data: {src}}] of Object.entries(hRes)) {\n\t\t\t\tconst u2 = this.#hEncImgOUrl[s2] = src\n\t\t\t\t+ (src.startsWith('blob:') || src.startsWith('data:') ?'' :(Prm ? '?'+ Prm: ''));\n\t\t\t\tconst ri = this.#hARetImg[s2];\n\t\t\t\tif (ri) for (const i of ri) {\n\t\t\t\t\ti.src = u2;\n\t\t\t\t\tif (onload) i.onload = ()=> onload(i);\n\t\t\t\t}\n\t\t\t\tdelete this.#hARetImg[s2];\n\t\t\t//\tURL.revokeObjectURL(u2);// 画面遷移で毎回再生成するので\n\t\t\t}\n\t\t});\n\t}\n\tstatic\t#hARetImg\t\t: {[src: string]: HTMLImageElement[]}\t= {};\n\tstatic\t#hEncImgOUrl\t: {[src: string]: string}\t\t\t\t= {};\n\n\n\tcvsResize() {\t// NOTE: フォントサイズはどう変更すべきか\n\t\tfor (const [id, f] of Object.entries(this.#hIfrm)) {\n\t\t\tconst vn = 'const.sn.frm.'+ id;\n\t\t\tconst x = Number(this.val.getVal(vn +'.x'));\n\t\t\tconst y = Number(this.val.getVal(vn +'.y'));\n\t\t\tconst w = Number(this.val.getVal(vn +'.width'));\n\t\t\tconst h = Number(this.val.getVal(vn +'.height'));\n\t\t\tf.style.left = `${FrameMng.#sys.ofsLeft4elm +x *FrameMng.#sys.cvsScale}px`;\n\t\t\tf.style.top  = `${FrameMng.#sys.ofsTop4elm  +y *FrameMng.#sys.cvsScale}px`;\n\t\t\tf.width = String(w *FrameMng.#sys.cvsScale);\n\t\t\tf.height = String(h *FrameMng.#sys.cvsScale);\n\t\t}\n\t}\n\n\t// フレーム変数を取得\n\t#let_frame(hArg: HArg) {\n\t\tconst {id, var_name} = hArg;\n\t\tif (! id) throw 'idは必須です';\n\t\tconst f = document.getElementById(id) as HTMLIFrameElement;\n\t\tif (! f) throw `id【${id}】はフレームではありません`;\n\t\tconst vn = 'const.sn.frm.'+ id;\n\t\tif (! this.val.getVal(`tmp:${vn}`)) throw `frame【${id}】が読み込まれていません`;\n\t\tif (! var_name) throw 'var_nameは必須です';\n\n\t\tconst win = f.contentWindow!;\n\t\tif (! Object.hasOwn(win, var_name)) throw `frame【${id}】に変数/関数【${var_name}】がありません。変数は var付きにして下さい`;\n\n\t\tconst v = (win as any)[var_name];\n\t\t// var変数 / 関数実行の戻り値 -> 組み込み変数\n\t\tthis.val.setVal_Nochk(\n\t\t\t'tmp',\n\t\t\tvn +'.'+ var_name,\n\t\t\targChk_Boolean(hArg, 'function', false) ?v() :v\n\t\t);\n\n\t\treturn false;\n\t}\n\n\t// フレーム変数に設定\n\t#set_frame(hArg: HArg) {\n\t\tconst {id, var_name, text} = hArg;\n\t\tif (! id) throw 'idは必須です';\n\t\tconst f = document.getElementById(id) as HTMLIFrameElement;\n\t\tif (! f) throw `id【${id}】はフレームではありません`;\n\t\tconst vn = 'const.sn.frm.'+ id;\n\t\tif (! this.val.getVal(`tmp:${vn}`)) throw `frame【${id}】が読み込まれていません`;\n\t\tif (! var_name) throw 'var_nameは必須です';\n\t\tif (! text) throw 'textは必須です';\n\n\t\t// -> 組み込み変数\n\t\tthis.val.setVal_Nochk('tmp', vn +'.'+ var_name, text);\n\n\t\t// -> var変数に設定\n\t\tconst win: any = f.contentWindow!;\n\t\twin[var_name] = text;\n\n\t\treturn false;\n\t}\n\n\t// フレームに設定\n\t#zIdx = 1;\n\t#frame(hArg: HArg) {\n\t\tconst {id} = hArg;\n\t\tif (! id) throw 'idは必須です';\n\t\tconst f = document.getElementById(id) as HTMLIFrameElement;\n\t\tif (! f) throw `id【${id}】はフレームではありません`;\n\t\tconst vn = 'const.sn.frm.'+ id;\n\t\tif (! this.val.getVal('tmp:'+ vn)) throw `frame【${id}】が読み込まれていません`;\n\n\t\tconst s = f.style;\n\t\tif (argChk_Boolean(hArg, 'float', false)) s.zIndex = `${++this.#zIdx}`;\n\t\telse if ('index' in hArg) s.zIndex = `${argChk_Num(hArg, 'index', 0)}`;\n\t\telse if (hArg.dive) s.zIndex = `-${++this.#zIdx}`;\n\n\t\tif ('alpha' in hArg) {\n\t\t\tconst a = s.opacity = String(hArg.alpha);\n\t\t\tthis.val.setVal_Nochk('tmp', vn +'.alpha', a);\n\t\t}\n\t\tconst rct = this.#rect(hArg);\n\t\tif ('x' in hArg || 'y' in hArg) {\n\t\t\ts.left = `${FrameMng.#sys.ofsLeft4elm +rct.x *FrameMng.#sys.cvsScale}px`;\n\t\t\ts.top  = `${FrameMng.#sys.ofsTop4elm  +rct.y *FrameMng.#sys.cvsScale}px`;\n\t\t\tthis.val.setVal_Nochk('tmp', vn +'.x', rct.x);\n\t\t\tthis.val.setVal_Nochk('tmp', vn +'.y', rct.y);\n\t\t}\n\t\tif ('scale_x' in hArg || 'scale_y' in hArg || 'rotate' in hArg) {\n\t\t\tconst sx = argChk_Num(hArg, 'scale_x', 1);\n\t\t\tconst sy = argChk_Num(hArg, 'scale_y', 1);\n\t\t\tconst r = argChk_Num(hArg, 'rotate', 0);\n\t\t\ts.transform = `scale(${sx}, ${sy}) rotate(${r}deg)`;\n\t\t\tthis.val.setVal_Nochk('tmp', vn +'.scale_x', sx);\n\t\t\tthis.val.setVal_Nochk('tmp', vn +'.scale_y', sy);\n\t\t\tthis.val.setVal_Nochk('tmp', vn +'.rotate', r);\n\t\t}\n\t\tif ('width' in hArg) {\n\t\t\tf.width = String(rct.width *FrameMng.#sys.cvsScale);\n\t\t\tthis.val.setVal_Nochk('tmp', vn +'.width', rct.width);\n\t\t}\n\t\tif ('height' in hArg) {\n\t\t\tf.height = String(rct.height *FrameMng.#sys.cvsScale);\n\t\t\tthis.val.setVal_Nochk('tmp', vn +'.height', rct.height);\n\t\t}\n\t\tif ('visible' in hArg) {\n\t\t\tconst v = argChk_Boolean(hArg, 'visible', true);\n\t\t\ts.display = v ?'inline' :'none';\n\t\t\tthis.val.setVal_Nochk('tmp', vn +'.visible', v);\n\t\t}\n\t\tif ('b_color' in hArg) s.backgroundColor = hArg.b_color!;\n\t\tif ('disabled' in hArg) {\n\t\t\tconst d = this.#hDisabled[id] = argChk_Boolean(hArg, 'disabled', true);\n\t\t\tconst b = f.contentDocument!.body;\n\t\t\tfor (const e of [\n\t\t\t\t...Array.from(b.getElementsByTagName('input')),\n\t\t\t\t...Array.from(b.getElementsByTagName('select')),\n\t\t\t]) e.disabled = d;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\t// フレームをトゥイーン開始\n\t#tsy_frame(hArg: HArg) {\n\t\tconst {id, alpha, x, y, scale_x, scale_y, rotate, width, height} = hArg;\n\t\tif (! id) throw 'idは必須です';\n\t\tconst f = document.getElementById(id) as HTMLIFrameElement;\n\t\tif (! f) throw `id【${id}】はフレームではありません`;\n\t\tconst vn = `const.sn.frm.`+ id;\n\t\tif (! this.val.getVal(`tmp:${vn}`, 0)) throw `frame【${id}】が読み込まれていません`;\n\n\t\tconst hNow: any = {};\n\t\tif (alpha) hNow.a = f.style.opacity;\n\t\tif (x || y || scale_x || scale_y || rotate) {\n\t\t\thNow.x = Number(this.val.getVal(`tmp:${vn}.x`));\n\t\t\thNow.y = Number(this.val.getVal(`tmp:${vn}.y`));\n\t\t\thNow.sx = Number(this.val.getVal(`tmp:${vn}.scale_x`));\n\t\t\thNow.sy = Number(this.val.getVal(`tmp:${vn}.scale_y`));\n\t\t\thNow.r = Number(this.val.getVal(`tmp:${vn}.rotate`));\n\t\t}\n\t\tif (width) hNow.w = this.val.getVal(`tmp:${vn}.width`);\n\t\tif (height) hNow.h = this.val.getVal(`tmp:${vn}.height`);\n\t\tconst hArg2 = CmnTween.cnvTweenArg(hArg, hNow);\n\n\t\tconst hTo: any = {};\n\t\tlet fncA = ()=> {};\n\t\tif (alpha) {\n\t\t\thTo.a = argChk_Num(hArg2, 'alpha', 0);\n\t\t\tfncA = ()=> {\n\t\t\t\tf.style.opacity = hNow.a;\n\t\t\t\tthis.val.setVal_Nochk('tmp', 'alpha', hNow.a);\n\t\t\t};\n\t\t}\n\t\tlet fncXYSR = ()=> {};\n\t\tconst rct = this.#rect(hArg2);\n\t\tif (x || y || scale_x || scale_y || rotate) {\n\t\t\thTo.x = rct.x;\n\t\t\thTo.y = rct.y;\n\t\t\thTo.sx = argChk_Num(hArg2, 'scale_x', 1);\n\t\t\thTo.sy = argChk_Num(hArg2, 'scale_y', 1);\n\t\t\thTo.r = argChk_Num(hArg2, 'rotate', 0);\n\t\t\tfncXYSR = ()=> {\n\t\t\t\tf.style.left = FrameMng.#sys.ofsLeft4elm +hNow.x *FrameMng.#sys.cvsScale +'px';\n\t\t\t\tf.style.top  = FrameMng.#sys.ofsTop4elm  +hNow.y *FrameMng.#sys.cvsScale +'px';\n\t\t\t\tf.style.transform = `scale(${hNow.sx}, ${hNow.sy}) rotate(${hNow.r}deg)`;\n\t\t\t\tthis.val.setVal_Nochk('tmp', vn +'.x', hNow.x);\n\t\t\t\tthis.val.setVal_Nochk('tmp', vn +'.y', hNow.y);\n\t\t\t\tthis.val.setVal_Nochk('tmp', vn +'.scale_x', hNow.sx);\n\t\t\t\tthis.val.setVal_Nochk('tmp', vn +'.scale_y', hNow.sy);\n\t\t\t\tthis.val.setVal_Nochk('tmp', vn +'.rotate', hNow.r);\n\t\t\t};\n\t\t}\n\t\tlet fncW = ()=> {};\n\t\tif (width) {\n\t\t\thTo.w = rct.width;\n\t\t\tfncW = ()=> {\n\t\t\t\tf.width = hNow.w *FrameMng.#sys.cvsScale +'px';\n\t\t\t\tthis.val.setVal_Nochk('tmp', vn +'.width', hNow.w);\n\t\t\t};\n\t\t}\n\t\tlet fncH = ()=> {};\n\t\tif (height) {\n\t\t\thTo.h = rct.height;\n\t\t\tfncH = ()=> {\n\t\t\t\tf.height = hNow.h *FrameMng.#sys.cvsScale +'px';\n\t\t\t\tthis.val.setVal_Nochk('tmp', vn +'.height', hNow.h);\n\t\t\t};\n\t\t}\n\n\t\tthis.appPixi.stage.interactive = false;\n\t\tCmnTween.tween(`frm\\n${id}`, hArg, hNow, CmnTween.cnvTweenArg(hArg, hNow), ()=> {\n\t\t\tfncA(); fncXYSR(); fncW(); fncH();\n\t\t}, ()=> this.appPixi.stage.interactive = true, ()=> {});\n\n\t\treturn false;\n\t}\n\n}\n","/* ***** BEGIN LICENSE BLOCK *****\n\tCopyright (c) 2018-2025 Famibee (famibee.blog38.fc2.com)\n\n\tThis software is released under the MIT License.\n\thttp://opensource.org/licenses/mit-license.php\n** ***** END LICENSE BLOCK ***** */\n\nimport {CmnLib, getDateStr, uint, type IEvtMng, argChk_Boolean, argChk_Num, addStyle, argChk_Color, parseColor} from './CmnLib';\nimport {CmnTween, TMP_TSY_NM, TW_INT_TRANS} from './CmnTween';\nimport type {IHTag, HArg} from './Grammar';\nimport type {IVariable, IMain, HIPage, IGetFrm, IPropParser, IRecorder} from './CmnInterface';\nimport {Pages} from './Pages';\nimport {Layer} from './Layer';\nimport {GrpLayer} from './GrpLayer';\nimport {SpritesMng} from './SpritesMng';\nimport {TxtLayer} from './TxtLayer';\nimport {RubySpliter} from './RubySpliter';\nimport {TxtStage} from './TxtStage';\nimport {PROTOCOL_DL, PROTOCOL_USERDATA, type Config} from './Config';\nimport type {ScriptIterator} from './ScriptIterator';\nimport type {SysBase} from './SysBase';\nimport {FrameMng} from './FrameMng';\nimport {Button} from './Button';\nimport type {SoundMng} from './SoundMng';\nimport {DesignCast} from './DesignCast';\nimport {EventListenerCtn} from './EventListenerCtn';\nimport {Reading} from './Reading';\n\nimport {Container, Application, Graphics, Filter, RenderTexture, Sprite, autoDetectRenderer, Texture} from 'pixi.js';\n\nexport interface IMakeDesignCast { (idc\t: DesignCast): void; };\n\nexport interface HPage {[ln: string]: Pages};\n\ntype T_LOG = HArg & {\n\ttext\t: string;\t// 履歴文字列\n};\n\n\nexport class LayerMng implements IGetFrm, IRecorder {\n\treadonly\t#stage\t: Container;\n\t\t\t\t#fore\t= new Container;\n\t\t\t\t#back\t= new Container;\n\n\treadonly\t#frmMng\t\t: FrameMng;\n\treadonly\t#bg_color\t: number;\n\n\treadonly\t#elc\t\t= new EventListenerCtn;\n\n\t//MARK: コンストラクタ\n\tconstructor(private readonly cfg: Config, private readonly hTag: IHTag, private readonly appPixi: Application, private readonly val: IVariable, readonly main: IMain, private readonly scrItr: ScriptIterator, private readonly sys: SysBase, readonly sndMng: SoundMng, readonly prpPrs: IPropParser) {\n\t\t// レスポンシブや回転・全画面切り替え・DevTools 表示切り替えの対応\n\t\tconst fncResizeLay = ()=> {\n\t\t\tsys.cvsResize();\n\t\t\tthis.cvsResizeDesign();\n\t\t\tif (this.#modeLnSub) for (const ln of this.#aLayName) {\n\t\t\t\tthis.#hPages[ln]!.fore.cvsResizeChildren();\n\t\t\t}\n\t\t\telse for (const ln of this.#aLayName) {\n\t\t\t\tthis.#hPages[ln]!.fore.cvsResize();\n\t\t\t}\n\n\t\t\tthis.#frmMng.cvsResize();\n\t\t\tthis.#evtMng.cvsResize();\n\t\t};\n\t\tif (CmnLib.isMobile) {\n\t\t\tthis.#elc.add(globalThis, 'orientationchange', fncResizeLay, {passive: true});\n\t\t}\n\t\telse {\n\t\t\tlet tid: NodeJS.Timeout | undefined = undefined;\n\t\t\tthis.#elc.add(globalThis, 'resize', ()=> {\n\t\t\t\tif (tid) return;\n\t\t\t\ttid = setTimeout(()=> {tid = undefined; fncResizeLay()}, 1000 /60 *10);\t// clearTimeout()不要と判断\n\t\t\t}, {passive: true});\n\t\t}\n\t\tsys.cvsResize();\n\n\t\tTxtLayer.init(cfg, hTag, val, this, me=> this.#hPages[me.layname]!.fore === me, appPixi);\n\t\tGrpLayer.init(main, cfg, appPixi, sys, sndMng, val);\n\t\tFrameMng.init(cfg, sys, main);\n\t\tButton.init(cfg);\n\n\t\tthis.#frmMng = new FrameMng(hTag, appPixi, val);\n\t\tsys.hFactoryCls.grp = ()=> new GrpLayer;\n\t\tsys.hFactoryCls.txt = ()=> new TxtLayer;\n\n\t\t//\tシステム\n\t\thTag.loadplugin\t\t= o=> this.#loadplugin(o);\t// プラグインの読み込み\n\t\t//hTag.set_focus\t// EventMng.tsで定義\t \t// フォーカス移動\n\t\thTag.snapshot\t\t= o=> this.#snapshot(o);\t// スナップショット\n\t\tthis.#snapshot4proc = this.sys.isApp\n\t\t\t? this.#snapshot4app\n\t\t\t: this.#snapshot4web;\n\n\t\t//\tレイヤ共通\n\t\thTag.add_lay\t\t= o=> this.#add_lay(o);\t\t// レイヤを追加する\n\t\thTag.clear_lay\t\t= o=> this.#clear_lay(o);\t// レイヤ設定の消去\n\t\thTag.finish_trans\t= ()=> CmnTween.finish_trans();// トランス強制終了\n\t\thTag.lay\t\t\t= o=> this.#lay(o);\t\t\t// レイヤ設定\n\t\thTag.trans\t\t\t= o=> this.#trans(o);\t\t// ページ裏表を交換\n\t\thTag.wt\t\t\t\t= o=> CmnTween.wt(o);\t\t// トランス終了待ち\n\n\t\thTag.quake\t\t\t= o=> this.#quake(o);\t\t// 画面を揺らす\n\t\thTag.stop_quake\t\t= hTag.finish_trans;\t\t// 画面揺らし中断\n\t\thTag.wq\t\t\t\t= o=> hTag.wt!(o);\t\t\t// 画面揺らし終了待ち\n\n\t\thTag.pause_tsy\t\t= o=> CmnTween.pause_tsy(o);\t// 一時停止\n\t\thTag.resume_tsy\t\t= o=> CmnTween.resume_tsy(o);\t// 一時停止再開\n\t\thTag.stop_tsy\t\t= o=> CmnTween.stop_tsy(o);\t// トゥイーン中断\n\t\thTag.tsy\t\t\t= o=> this.#tsy(o);\t\t\t// トゥイーン開始\n\t\thTag.wait_tsy\t\t= o=> CmnTween.wait_tsy(o);\t// トゥイーン終了待ち\n\n\t\thTag.add_filter\t\t= o=> this.#add_filter(o);\t// フィルター追加\n\t\thTag.clear_filter\t= o=> this.#clear_filter(o);// フィルター全削除\n\t\thTag.enable_filter\t= o=> this.#enable_filter(o);// フィルター個別切替\n\n\t\t//\t文字・文字レイヤ\n\t//\thTag.auto_pager\t\t= o=> this.auto_pager(o);\t// 自動改ページの設定\n\t\t//hTag.autowc\t\t// TxtLayer.ts で定義\t\t// 文字ごとのウェイト\n\t\thTag.ch\t\t\t\t= o=> this.#ch(o);\t\t\t// 文字を追加する\n\t\t//hTag.ch_in_style\t// TxtLayer.ts で定義\t\t// 文字出現文字出現演出\n\t\t//hTag.ch_out_style\t// TxtLayer.ts で定義\t\t// 文字消去文字出現演出\n\t\thTag.clear_text\t\t= o=> this.#clear_text(o);\t// 文字消去\n\t\thTag.current\t\t= o=> this.#current(o);\t\t// デフォルト文字レイヤ設定\n\t\thTag.endlink\t\t= o=> this.#endlink(o);\t\t// ハイパーリンクの終了\n\t\thTag.er\t\t\t\t= o=> this.#er(o);\t\t\t// ページ両面の文字消去\n\t\thTag.graph\t\t\t= o=> this.#graph(o);\t\t// インライン画像表示\n\t\thTag.link\t\t\t= o=> this.#link(o);\t\t// ハイパーリンク\n\t\thTag.r\t\t\t\t= o=> this.#r(o);\t\t\t// 改行\n\t\thTag.rec_ch\t\t\t= o=> this.#rec_ch(o);\t\t// 履歴書き込み\n\t\thTag.rec_r\t\t\t= o=> this.#rec_r(o);\t\t// 履歴改行\n\t\thTag.reset_rec\t\t= o=> this.#reset_rec(o);\t// 履歴リセット\n\t\t//hTag.ruby\t\t\t= o=> this.ruby(o);\t\t\t// 直前一文字のルビ（廃止\n\t\t\t// タグでは無く、「｜＠《》」というスクリプト書き換えで良い\n\t\thTag.ruby2\t\t\t= o=> this.#ruby2(o);\t\t// 文字列と複数ルビの追加\n\t\thTag.span\t\t\t= o=> this.#span(o);\t\t// インラインスタイル設定\n\t\thTag.tcy\t\t\t= o=> this.#tcy(o);\t\t\t// 縦中横を表示する\n\n\t\t//\t画像・画像レイヤ\n\t\thTag.add_face\t\t= o=> SpritesMng.add_face(o);\t// 差分名称の定義\n\n\t\t//\tムービーレイヤ\n\t\thTag.wv\t\t\t\t= o=> SpritesMng.wv(o);\t\t// ムービー再生終了待ち\n\n\t\t//\tデバッグ・その他\n\t\thTag.dump_lay\t\t= o=> this.#dump_lay(o);\t// レイヤのダンプ\n\n\t\t//\tイベント\n\t\thTag.enable_event\t= o=> this.#enable_event(o);// イベント有無の切替\n\n\t\t//\tラベル・ジャンプ\n\t\thTag.button\t\t\t= o=> this.#button(o);\t\t// ボタンを表示\n\n\n\t\tif (cfg.existsBreakline) this.breakLine = (hArg: HArg)=> {\n\t\t\tdelete hArg.visible;\n\t\t\thArg.id = 'break';\n\t\t\thArg.pic= 'breakline';\n\t\t\tconst sArg = encodeURIComponent(JSON.stringify(hArg));\n\t\t\tthis.#cmdTxt('grp｜'+ sArg);\n\t\t};\n\t\tif (cfg.existsBreakpage) this.breakPage = (hArg: HArg)=> {\n\t\t\tdelete hArg.visible;\n\t\t\thArg.id = 'break';\n\t\t\thArg.pic= 'breakpage';\n\t\t\tconst sArg = encodeURIComponent(JSON.stringify(hArg));\n\t\t\tthis.#cmdTxt('grp｜'+ sArg);\n\t\t};\n\n\t\tthis.#bg_color = parseColor(String(cfg.oCfg.init.bg_color));\n\t\tconst grp = new Graphics;\n\t\tgrp\n\t\t.beginFill(this.#bg_color)\t// イベントを受け取るためにも塗る\n\t\t.lineStyle(0, this.#bg_color)\n\t\t.drawRect(0, 0, CmnLib.stageW, CmnLib.stageH)\n\t\t.endFill();\n\t\tthis.#fore.addChild(grp.clone());\n\t\tthis.#back.addChild(grp);\n\t\tthis.#back.visible = false;\n\t\tthis.#fore.name = 'page:A';\t// 4tst\n\t\tthis.#back.name = 'page:B';\t// 4tst\n\n\t\tthis.#stage = appPixi.stage;\n\t\tthis.#stage.addChild(this.#back);\n\t\tthis.#stage.addChild(this.#fore);\n\t\tthis.#stage.addChild(this.#spTransBack);\n\t\tthis.#stage.addChild(this.#spTransFore);\n\t\tthis.#stage.name = 'stage';\t// 4tst\n/*\n\t\tconsole.group('new DispMng info');\n\t\tconsole.info(appPixi.renderer);\n\t\tconsole.info('utils.isMobile():'+ utils.isMobile.any);\n\t\t\t\t// https://github.com/kaimallea/isMobile\n\t\tconsole.info('utils.isWebGLSupported():'+ utils.isWebGLSupported());\n\t\tconsole.info('w:%O: h:%O:', CmnLib.stageW, CmnLib.stageH);\n\t\tconsole.groupEnd();\n*/\n\t\tconst fncTxt_b_alpha = (_name: string, val: any)=> {\n\t\t\tthis.#foreachRedrawTxtLayBack(Number(val))\n\t\t};\n\t\tfncTxt_b_alpha('', val.getVal('sys:TextLayer.Back.Alpha', 1));\n\t\tval.defValTrg('sys:TextLayer.Back.Alpha', fncTxt_b_alpha);\n\n\t\tconst fncBtnFont = (_name: string, val: any)=> Button.fontFamily = val;\n\t\tfncBtnFont('', val.getVal('tmp:sn.button.fontFamily', Button.fontFamily));\n\t\tval.defValTrg('tmp:sn.button.fontFamily', fncBtnFont);\n\n\t\tval.defTmp('const.sn.log.json', ()=> JSON.stringify(\n\t\t\t(this.#oLastPage.text = this.#oLastPage.text?.replaceAll(`<\\/span><span class='sn_ch'>`, '') ?? '')\n\t\t\t\t? [...this.#aTxtLog, this.#oLastPage]\n\t\t\t\t: this.#aTxtLog\n\t\t));\n\t\tval.defTmp('const.sn.last_page_text', ()=> this.currentTxtlayFore?.pageText ?? '');\n\t\tval.defTmp('const.sn.last_page_plain_text', ()=> this.currentTxtlayFore?.pagePlainText ?? '');\n\t\tif (CmnLib.isDbg) {\n\t\t\tDesignCast.init(appPixi, sys, scrItr, prpPrs, cfg, this.#hPages);\n\t\t\tthis.cvsResizeDesign = ()=> DesignCast.cvsResizeDesign();\n\t\t\tsys.addHook((type, o)=> {\n\t\t\t\tif (! this.#hProcDbgRes[type]?.(type, o)) return;\n\t\t\t\tdelete this.#hProcDbgRes[type];\n\t\t\t});\n\t\t}\n\t}\n\tprivate\tcvsResizeDesign() {}\n\n\n\treadonly\t#hProcDbgRes\n\t: {[type: string]: (type: string, o: any)=> boolean}\t= {\n\t\tattach\t\t: _=> {DesignCast.leaveMode();\treturn false},\n\t\tcontinue\t: _=> {DesignCast.leaveMode();\treturn false},\n\t\tdisconnect\t: _=> {DesignCast.leaveMode();\treturn false},\n\t\t_enterDesign: _=> {\n\t\t\tDesignCast.enterMode();\n\t\t\tfor (const ln of this.#aLayName) {\n\t\t\t\tconst lay = this.#hPages[ln]!.fore;\n\t\t\t\tlay.makeDesignCastChildren(gdc=> gdc.make());\n\t\t\t\tlay.makeDesignCast(gdc=> gdc.make());\n\t\t\t}\n\n\t\t\tthis.#selectNode(this.#curTxtlay);\treturn false;\n\t\t//\tthis.selectNode('mes/ボタン');\treturn false;\t// Test用\n\t\t//\tthis.selectNode(this.firstGrplay);\treturn false;\n\t\t\t\t// 制作中は普通画像レイヤをいじるのが主なので、これがいい\n\t\t},\n\t\t_replaceToken: (_, o)=> {DesignCast.replaceToken(o); return false},\n\t\t_selectNode\t: (_, o)=> {this.#selectNode(o.node); return false},\n\t}\n\t#modeLn\t\t= '';\n\t#modeLnSub\t= '';\n\t#selectNode(node: string) {\n\t\t[this.#modeLn='', this.#modeLnSub=''] = node.split('/');\n\t\tconst pages = this.#hPages[this.#modeLn];\n\t\tif (! pages) return;\n\n\t\tDesignCast.allHide();\n\t\tif (this.#modeLnSub) pages.fore.showDesignCastChildren();\n\t\telse pages.fore.showDesignCast();\n\t}\n\n\tgetFrmDisabled = (id: string)=> this.#frmMng.getFrmDisabled(id);\n\n\t#grpCover : Graphics | undefined = undefined;\n\tcover(visible: boolean, bg_color = 0x0) {\n\t\tif (this.#grpCover) {\n\t\t\tthis.#stage.removeChild(this.#grpCover);\n\t\t\tthis.#grpCover.destroy();\n\t\t\tthis.#grpCover = undefined;\n\t\t}\n\t\tif (visible) this.#stage.addChild(\n\t\t\t(this.#grpCover = new Graphics)\n\t\t\t.beginFill(bg_color)\n\t\t\t.lineStyle(0, bg_color)\n\t\t\t.drawRect(0, 0, CmnLib.stageW, CmnLib.stageH)\n\t\t\t.endFill()\n\t\t);\n\t}\n\n\t#evtMng\t: IEvtMng;\n\tsetEvtMng(evtMng: IEvtMng) {\n\t\tthis.#evtMng = evtMng;\n\t\tthis.#frmMng.setEvtMng(evtMng);\n\t\tSpritesMng.setEvtMng(evtMng);\n\t\tCmnTween.init(evtMng, this.appPixi);\n\t}\n\n\tdestroy() {\n\t\tfor (const p of Object.values(this.#hPages)) p.destroy();\n\n\t\tthis.#elc.clear();\n\t\tGrpLayer.destroy();\n\t\tRubySpliter.destroy();\n\t\tTxtStage.destroy();\n\t\tTxtLayer.destroy();\n\n\t\tthis.#frmMng.destroy();\n\n\t\tCmnTween.destroy();\n\t\tLayerMng.#msecChWait = 10;\n\t}\n\n\n\t// 既存の全文字レイヤの実際のバック不透明度、を再計算\n\t#foreachRedrawTxtLayBack(g_alpha: number) {\n\t\tfor (const {fore, back} of Object.values(this.#hPages)) {\n\t\t\tif (! (fore instanceof TxtLayer)) continue;\n\t\t\tfore.chgBackAlpha(g_alpha);\n\t\t\t(<TxtLayer>back).chgBackAlpha(g_alpha);\n\t\t}\n\t}\n\n\n\t#cmdTxt = (cmd: string, tl = this.currentTxtlayForeNeedErr, _record = true)=> tl.tagCh('｜&emsp;《'+ cmd +'》');\n\tgoTxt = ()=> {};\n\tget needGoTxt() {return this.currentTxtlayFore?.needGoTxt ?? false;}\n\tbreakLine = (_hArg: HArg)=> {};\n\tbreakPage = (_hArg: HArg)=> {};\n\tclearBreak() {\n\t\tif (! this.currentTxtlayFore) return;\n\n\t\tthis.clearBreak = ()=> this.#cmdTxt('del｜break');\n\t\tthis.clearBreak();\n\t}\n\n\tclickTxtLay(): boolean {\t// true: 文字出現中だったので、停止する\n\t\tif (! this.currentTxtlayFore) return false;\n\n\t\treturn Object.values(this.#hPages)\n\t\t.some(f=> f instanceof TxtLayer && f.click());\n\t}\n\n\n//\t//\tシステム\n\t//MARK: スナップショット\n\t#snapshot(hArg: HArg) {\n\t\tconst dt = getDateStr('-', '_', '', '_');\n\t\tconst fn0 = hArg.fn\n\t\t? hArg.fn.startsWith(PROTOCOL_USERDATA)\n\t\t\t? hArg.fn\n\t\t\t: `${PROTOCOL_DL + hArg.fn + dt}.png`\n\t\t: `${PROTOCOL_DL}snapshot${dt}.png`;\n\t\tconst url = this.cfg.searchPath(fn0);\n\t\tconst width = argChk_Num(hArg, 'width', CmnLib.stageW);\n\t\tconst height= argChk_Num(hArg, 'height', CmnLib.stageH);\n\t\treturn this.#snapshot4proc(hArg, url, width, height, `snapshot dt:${dt}`);\n\t}\n\t#snapshot4proc :(hArg: HArg, url: string, width: number, height: number, RPN_SNAPSHOT: string)=> boolean = ()=> false;\n\t#snapshot4app({layer}: HArg, url: string, width: number, height: number, RPN_SNAPSHOT: string): boolean {\n\t\tthis.#frmMng.hideAllFrame();\n\t\tReading.beginProc(RPN_SNAPSHOT);\n\t\tif (! layer) {\n\t\t\tthis.sys.capturePage(url, width, height, ()=> {\n\t\t\t\tthis.#frmMng.restoreAllFrame();\n\t\t\t\tReading.endProc(RPN_SNAPSHOT);\n\t\t\t});\n\t\t\treturn true;\n\t\t}\n\n\t\t// 一時的に非表示にしてスナップショット\n\t\tconst aBk = Object.values(this.#hPages)\n\t\t.map(({fore: {ctn}})=> {\n\t\t\tconst ret: [Sprite, boolean] = [ctn, ctn.visible];\n\t\t\tctn.visible = false;\n\t\t\treturn ret;\n\t\t});\n\t\tfor (const ln of this.#getLayers(layer)) this.#hPages[ln]!.fore.ctn.visible = true;\n\n\t\tthis.sys.capturePage(url, width, height, ()=> {\n\t\t\tfor (const [sp, v] of aBk) sp.visible = v;\n\t\t\tthis.#frmMng.restoreAllFrame();\n\t\t\tReading.endProc(RPN_SNAPSHOT);\n\t\t});\n\t\treturn true;\n\t}\n\t#snapshot4web(hArg: HArg, url: string, width: number, height: number, RPN_SNAPSHOT: string): boolean {\n\t\tReading.beginProc(RPN_SNAPSHOT);\n\t\tconst b_color = argChk_Color(hArg, 'b_color', this.#bg_color);\n\t\tconst rnd = autoDetectRenderer({\n\t\t\twidth,\n\t\t\theight,\n\t\t\tbackgroundAlpha: b_color > 0x1000000 && url.endsWith('.png') ?0 :1,\n\t\t\tantialias: argChk_Boolean(hArg, 'smoothing', false),\n\t\t\tpreserveDrawingBuffer: true,\n\t\t\tbackgroundColor: b_color & 0xFFFFFF,\n\t\t\tautoDensity: true,\n\t\t});\n\t\tconst pg = hArg.page !== 'back' ?'fore' :'back';\n\t\tconst {layer} = hArg;\n\t\tPromise.allSettled(\n\t\t\tthis.#getLayers(layer).map(ln=> new Promise<void>(\n\t\t\t\tre=> this.#hPages[ln]![pg].snapshot(rnd, re)\n\t\t\t))\n\t\t).then(async ()=> {\n\t\t\tconst renTx = RenderTexture.create({width: rnd.width, height: rnd.height});\t// はみ出し対策\n\t\t\trnd.render(this.#stage, {renderTexture: renTx});\n\t\t\tawait this.sys.savePic(\n\t\t\t\turl,\n\t\t\t\trnd.plugins.extract.base64(renTx),\n\t\t\t);\n\t\t\trenTx.destroy();\n\n\t\t\tfor (const ln of this.#getLayers(layer)) this.#hPages[ln]![pg].snapshot_end();\n\t\t\trnd.destroy(true);\n\n\t\t\tReading.endProc(RPN_SNAPSHOT);\n\t\t});\n\t\treturn true;\n\t}\n\n\t//MARK: プラグインの読み込み\n\t#loadplugin(hArg: HArg) {\n\t\tconst {fn} = hArg;\n\t\tif (! fn) throw 'fnは必須です';\n\t\tif (! fn.endsWith('.css')) throw 'サポートされない拡張子です';\n\n\t\tconst join = argChk_Boolean(hArg, 'join', true);\n\t\tconst RPN_LOADPLUGIN = Reading.procID +`loadplugin fn:${fn}`;\n\t\tif (join) Reading.beginProc(RPN_LOADPLUGIN);\n\t\t(async ()=> {\n\t\t\tconst res = await fetch(fn);\n\t\t\tif (! res.ok) throw new Error('Network response was not ok.');\n\n\t\t\taddStyle(await res.text());\n\t\t\tif (join) Reading.endProc(RPN_LOADPLUGIN);\n\t\t})();\n\n\t\treturn join;\n\t}\n\n\n//\t//\tレイヤ共通\n\t//MARK: レイヤを追加する\n\t#add_lay(hArg: HArg) {\n\t\tconst {layer, class: cls} = hArg;\n\t\tif (! layer) throw 'layerは必須です';\n\t\tif (layer.includes(',')) throw 'layer名に「,」は使えません';\n\t\tif (layer in this.#hPages) throw `layer【${layer}】はすでにあります`;\n\t\tif (! cls) throw 'clsは必須です';\n\n\t\tconst ret = {isWait: false}\n\t\tthis.#hPages[layer] = new Pages(layer, cls, this.#fore, this.#back, hArg, this.sys, this.val, ret);\n\t\tthis.#aLayName.push(layer);\n\t\tswitch (cls) {\n\t\tcase 'txt':\n\t\t\tif (! this.#curTxtlay) {\n\t\t\t\tthis.#chkTxtLay = ()=> {};\n\t\t\t\tthis.#getTxtLayer = this.#$getTxtLayer;\n\t\t\t\tthis.#current = this.#$current;\n\t\t\t\tthis.hTag.current!({layer});\t// hPages更新後でないと呼べない\n\t\t\t\tthis.goTxt = ()=> {\n\t\t\t\t\tif (this.#evtMng.isSkipping) LayerMng.#msecChWait = 0;\n\t\t\t\t\telse this.setNormalChWait();\n\t\t\t\t\tfor (const {fore} of Object.values(this.#hPages)) {\n\t\t\t\t\t\tif (fore instanceof TxtLayer) this.#cmdTxt('gotxt｜', fore, false);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.val.setVal_Nochk(\n\t\t\t\t'save',\n\t\t\t\t'const.sn.layer.'+ (layer ?? this.#curTxtlay) +'.enabled',\n\t\t\t\ttrue,\n\t\t\t);\n\t\t\tbreak;\n\n\t\tcase 'grp':\n\t\t\tif (this.#firstGrplay) break;\n\t\t\tthis.#firstGrplay = layer;\n\t\t\tbreak;\n\t\t}\n\n\t\tthis.scrItr.recodeDesign(hArg);\t// hArg[':id_tag'] は new Pages 内で設定\n\n\t\treturn ret.isWait;\n\t}\n\t#hPages\t\t: HPage\t\t= {};\t// しおりLoad時再読込\n\t#aLayName\t: string[]\t= [];\t// 最適化用\n\t#curTxtlay\t\t= '';\n\t#firstGrplay\t= '';\n\n\t#lay(hArg: HArg): boolean {\n\t\t// Trans\n\t\tconst ln = this.#argChk_layer(hArg);\n\t\tconst pg = this.#hPages[ln]!;\n\t\tconst back = pg.back.ctn;\n\t\tconst fore = pg.fore.ctn;\n\t\tif (argChk_Boolean(hArg, 'float', false)) {\n\t\t\tthis.#back.setChildIndex(back, this.#back.children.length -1);\n\t\t\tthis.#fore.setChildIndex(fore, this.#fore.children.length -1);\n\t\t\tthis.#rebuildLayerRankInfo();\n\t\t}\n\t\telse if (hArg.index) {\n\t\t\tif (argChk_Num(hArg, 'index', 0)) {\n\t\t\t\tthis.#back.setChildIndex(back, hArg.index);\n\t\t\t\tthis.#fore.setChildIndex(fore, hArg.index);\n\t\t\t\tthis.#rebuildLayerRankInfo();\n\t\t\t}\n\t\t}\n\t\telse if (hArg.dive) {\n\t\t\tconst {dive} = hArg;\n\t\t\tlet idx_dive = 0;\n\t\t\tif (ln === dive) throw '[lay] 属性 layerとdiveが同じ【'+ dive +'】です';\n\n\t\t\tconst pg_dive = this.#hPages[dive];\n\t\t\tif (! pg_dive) throw '[lay] 属性 dive【'+ dive +'】が不正です。レイヤーがありません';\n\t\t\tconst back_dive = pg_dive.back;\n\t\t\tconst fore_dive = pg_dive.fore;\n\t\t\tconst idx_back_dive = this.#back.getChildIndex(back_dive.ctn);\n\t\t\tconst idx_fore_dive = this.#fore.getChildIndex(fore_dive.ctn);\n\t\t\tidx_dive = (idx_back_dive < idx_fore_dive) ?idx_back_dive :idx_fore_dive;\n\t\t\tif (idx_dive > this.#back.getChildIndex(back)) --idx_dive;\t//自分が無くなって下がる分下げる\n\n\t\t\tthis.#fore.setChildIndex(fore, idx_dive);\n\t\t\tthis.#back.setChildIndex(back, idx_dive);\n\t\t\tthis.#rebuildLayerRankInfo();\n\t\t}\n\n\t\thArg[':id_tag'] = pg.fore.name.slice(0, -7);\n\t\tthis.scrItr.recodeDesign(hArg);\t// 必ず[':id_tag'] を設定すること\n\n\t\treturn pg.lay(hArg);\n\t}\n\t#rebuildLayerRankInfo() {this.#aLayName = this.#sortLayers()}\n\n\t//MARK: レイヤ設定の消去\n\t#clear_lay(hArg: HArg) {\n\t\tthis.#foreachLayers(hArg, layer=> {\n\t\t\t//if (name === this.strTxtlay && hArg.page !== 'back') this.recText('', true);\n\t\t\t\t// 改ページ\n\t\t\tconst pg = this.#hPages[this.#argChk_layer({layer})]!;\n\t\t\tif (hArg.page === 'both') {\t// page=both で両面削除\n\t\t\t\tpg.fore.clearLay(hArg);\n\t\t\t\tpg.back.clearLay(hArg);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tpg.getPage(hArg).clearLay(hArg);\n\t\t});\n\n\t\treturn false;\n\t}\n\n\t//===================================================\n\t//MARK: WebGL フラグメントシェーダー GLSL\n\tstatic\treadonly\t#srcRuleTransFragment = /* glsl */`\nprecision mediump float;\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\n\nuniform sampler2D rule;\nuniform float vague;\nuniform float tick;\n\nuniform vec4 inputPixel;\nuniform highp vec4 outputFrame;\nvec2 getUV(vec2 coord) {\n\treturn coord * inputPixel.xy / outputFrame.zw;\n}\n\nvoid main() {\n\tvec4 fg = texture2D(uSampler, vTextureCoord);\n\tvec4 ru = texture2D(rule, getUV(vTextureCoord));\n\n\tfloat v = ru.r - tick;\n\tgl_FragColor = abs(v) < vague\n\t\t? vec4(fg.rgb, 1) *fg.a *(0.5 +v /vague *0.5)\n\t\t: 0.0 <= v ? fg : vec4(0);\n}`;\n/*\n\t末尾が読みづらいが、以下のif文を消して三項演算子にしている。\n\n\tif (abs(v) < vague) {\n\t\tfloat f_a = fg.a *(0.5 +v /vague *0.5);\n\t\tgl_FragColor.rgb = fg.rgb *f_a;\n\t\tgl_FragColor.a = f_a;\n\t\treturn;\n\t}\n\tgl_FragColor = v >= 0.0 ? fg : vec4(0);\n\n\t\t★GLSL : don't use \"if\"｜Nobu note.com/nobuhirosaijo/n/n606a3f5d8e89\n\t\t\t> if文はあまり使わない方がいいらしい (処理負荷が高い)\n*/\n\n\n\t#rtTransBack = RenderTexture.create({\n\t\twidth\t: CmnLib.stageW,\n\t\theight\t: CmnLib.stageH,\n\t});\n\t#spTransBack = new Sprite(this.#rtTransBack);\n\n\t#rtTransFore = RenderTexture.create({\n\t\twidth\t: CmnLib.stageW,\n\t\theight\t: CmnLib.stageH,\n\t});\n\t#spTransFore = new Sprite(this.#rtTransFore);\n\n\n\t//MARK: ページ裏表を交換\n\t#trans(hArg: HArg) {\n\t\tCmnTween.finish_trans();\n\t\tthis.#evtMng.hideHint();\n\n\t\tconst {layer} = hArg;\n\t\tconst sDoTrans = new Set<string>;\n\t\tconst aLayFore = this.#getLayers(layer).map(ln=> {\n\t\t\tsDoTrans.add(ln);\n\t\t\treturn this.#hPages[ln]!.fore;\n\t\t});\n\n\t\tconst comp = async ()=> {\n\t\t\t[this.#fore, this.#back] = [this.#back, this.#fore];\n\t\t\tconst aPrm: Promise<void>[] = [];\n\t\t\tfor (const [ln, pg] of Object.entries(this.#hPages)) {\n\t\t\t\tif (sDoTrans.has(ln)) {pg.transPage(aPrm); continue}\n\n\t\t\t\t// transしないために交換する\n\t\t\t\tconst {fore: {ctn: f}, back: {ctn: b}} = pg;\n\t\t\t\tconst idx = this.#fore.getChildIndex(b);\n\t\t\t\tthis.#fore.removeChild(b);\n\t\t\t\tthis.#back.removeChild(f);\n\t\t\t\tthis.#fore.addChildAt(f, idx);\n\t\t\t\tthis.#back.addChildAt(b, idx);\n\t\t\t}\n\t\t\tawait Promise.allSettled(aPrm);\n\n\t\t\tthis.#fore.visible = true;\n\t\t\tthis.#back.visible = false;\t// 再び非表示の裏方に（直前までforeだった）\n\t\t\tthis.#spTransBack.visible = false;\n\t\t\tthis.#spTransFore.visible = false;\n\n\t\t\tReading.notifyEndProc(TMP_TSY_NM + TW_INT_TRANS);\n\t\t};\n//\t\thArg[':id'] = pg.fore.name.slice(0, -7);\n//\t\tthis.scrItr.getDesignInfo(hArg);\t// 必ず[':id'] を設定すること\n\t\tthis.#spTransFore.filters = [];\n\t\tthis.#spTransFore.alpha = 1;\n\n\t\t// 一瞬切り替え\n\t\tconst time = argChk_Num(hArg, 'time', 0);\n\t\tif (time === 0 || this.#evtMng.isSkipping) {comp(); return false}\n\n\n\t\tlet aBackTransAfter = [];\n\t\tconst aBack: Layer[] = [];\n\t\tfor (const [ln, pg] of Object.entries(this.#hPages)) {\n\t\t\tconst lay = sDoTrans.has(ln) ?pg.back :pg.fore;\n\t\t\tif (lay.ctn.visible) aBackTransAfter.push(lay.ctn);\n\t\t\taBack.push(lay);\n\t\t}\n\t\tconst {ticker, renderer} = this.appPixi;\n\t\trenderer.render(this.#back, {renderTexture: this.#rtTransBack});\t// clear: true\n\n\t\tlet fncRenderBack = ()=> {\n\t\t\tfor (const ctn of aBackTransAfter) renderer.render(\n\t\t\t\tctn,\n\t\t\t\t{renderTexture: this.#rtTransBack, clear: false}\n\t\t\t);\n\t\t};\n\t\tif (! aBack.some(lay=> lay.containMovement)) {\n\t\t\tconst oldFnc = fncRenderBack;\t// 動きがないなら最初に一度\n\t\t\tfncRenderBack = ()=> {fncRenderBack = ()=> {}; oldFnc()};\n\t\t}\n\n\t\tconst render = ()=> renderer.render(this.#fore, {renderTexture: this.#rtTransFore});\t// clear: true\n\t\trender();\n\t\tlet fncRenderFore = ()=> {\n\t\t\tthis.#fore.visible = true;\n\t\t\trender();\n\t\t\tthis.#fore.visible = false;\n\t\t};\n\t\tif (! aLayFore.some(lay=> lay.containMovement)) {\n\t\t\tconst oldFnc = fncRenderFore;\t// 動きがないなら最初に一度\n\t\t\tfncRenderFore = ()=> {fncRenderFore = ()=> {}; oldFnc()};\n\t\t}\n\t\tconst fncRender = ()=> {\n\t\t\tfncRenderBack();\n\t\t\tthis.#spTransBack.visible = true;\n\n\t\t\tfncRenderFore();\n\t\t\tthis.#spTransFore.visible = true;\n\t\t};\n\n\n\t\t// クロスフェード\n\t\tconst {glsl, rule} = hArg;\n\t\tconst comp2 = async ()=> {ticker.remove(fncRender); await comp()};\n\t\tif (! glsl && ! rule) {\n\t\t\tCmnTween.tween(TW_INT_TRANS, hArg, this.#spTransFore, {alpha: 0}, ()=> {}, comp2, ()=> {});\n\t\t\tticker.add(fncRender);\n\t\t\treturn false;\n\t\t}\n\n\t\t// Filter使用系（デフォルト値を glsl 属性で上書き可能）\n\t\tconst uniforms = {\n\t\t\trule\t: Texture.EMPTY,\n\t\t\tvague\t: argChk_Num(hArg, 'vague', 0.04),\n\t\t\ttick\t: 0.0,\n\t\t};\n\t\tthis.#spTransFore.filters = [new Filter(\n\t\t\tundefined,\n\t\t\tglsl ?? LayerMng.#srcRuleTransFragment,\n\t\t\tuniforms,\n\t\t)];\n\n\t\tconst tw = CmnTween.tween(TW_INT_TRANS, hArg, uniforms, {tick: 1}, ()=> {}, comp2, ()=> {}, ! rule);\n\t\tif (! rule) {\n\t\t\tticker.add(fncRender);\n\t\t\treturn false;\n\t\t}\n\t\t// ルール画像あり\n\t\tconst sm = new SpritesMng(rule, undefined, sp=> {\n\t\t\tuniforms.rule = sp.texture;\n\t\t\tsp.destroy();\n\t\t\tsm.destroy();\n\n\t\t\ttw.start();\n\t\t\tticker.add(fncRender);\n\t\t});\n\t\treturn false;\n\t}\n\n\t#getLayers(layer = ''): string[] {return layer ?layer.split(',') :this.#aLayName}\n\t#foreachLayers(hArg: HArg, fnc: (ln: string, $pg: Pages)=> void): ReadonlyArray<string> {\n\t\tconst aLn = this.#getLayers(hArg.layer);\n\t\tfor (const ln of aLn) {\n\t\t\tconst pg = this.#hPages[ln];\n\t\t\tif (! pg) throw '存在しないlayer【'+ ln +'】です';\n\n\t\t\tfnc(ln, pg);\n\t\t}\n\n\t\treturn aLn;\n\t}\n\t#sortLayers(layers = ''): string[] {\n\t\treturn this.#getLayers(layers)\n\t\t.sort((a, b)=> {\n\t\t\tconst ai = this.#fore.getChildIndex(this.#hPages[a]!.fore.ctn);\n\t\t\tconst bi = this.#fore.getChildIndex(this.#hPages[b]!.fore.ctn);\n\t\t\tif (ai < bi) return -1;\n\t\t\tif (ai > bi) return 1;\n\t\t\treturn 0;\n\t\t});\n\t}\n\n\tsetAllStyle2TxtLay(style: string) {\n\t\t// 必要最小限設定なので\n\t\tfor (const {fore} of Object.values(this.#hPages)) {\n\t\t\tif (fore instanceof TxtLayer) fore.lay({style});\n\t\t\t//\t... fore.cssText = style;\n\t\t}\n\t}\n\n\t//MARK: 画面を揺らす\n\t#quake(hArg: HArg) {\n\t\tCmnTween.finish_trans();\n\t\tif (argChk_Num(hArg, 'time', NaN) === 0) return false;\n\n\t\tconst aDo = this.#getLayers(hArg.layer)\n\t\t.map(ln=> this.#hPages[ln]!.fore.ctn);\n\t\tconst {renderer, ticker} = this.appPixi;\n\t\tthis.#rtTransFore.resize(CmnLib.stageW, CmnLib.stageH);\n\t\tconst fncRender = ()=> {\n\t\t\tthis.#fore.visible = true;\n\t\t\tfor (const d of aDo) renderer.render(\n\t\t\t\td, {renderTexture: this.#rtTransFore, clear: false}\n\t\t\t);\n\t\t\tthis.#fore.visible = false;\n\t\t};\n\t\tthis.#spTransFore.visible = true;\n\t\tthis.#spTransFore.alpha = 1;\n\n\t\tconst h = uint(argChk_Num(hArg, 'hmax', 10));\n\t\tconst v = uint(argChk_Num(hArg, 'vmax', 10));\n\t\tconst fncH = (h === 0)\n\t\t\t? ()=> {}\n\t\t\t: ()=> this.#spTransFore.x = Math.round(Math.random()* h*2) -h;\n\t\tconst fncV = (v === 0)\n\t\t\t? ()=> {}\n\t\t\t: ()=> this.#spTransFore.y = Math.round(Math.random()* v*2) -v;\n\t\tthis.#spTransFore.filters = [];\n\n\t\tCmnTween.tween(TW_INT_TRANS, hArg, this.#spTransFore, {x: 0, y: 0}, ()=> {fncH(); fncV()}, ()=> {\n\t\t\tticker.remove(fncRender);\n\t\t\t\t// transなしでもadd()してなくても走るが、構わないっぽい。\n\t\t\tthis.#fore.visible = true;\n\t\t\tthis.#spTransFore.visible = false;\n\t\t\tthis.#spTransFore.x = 0;\t// 必須、onUpdate は toの値にしてくれない\n\t\t\tthis.#spTransFore.y = 0;\n\t\t}, ()=> {});\n\t\tticker.add(fncRender);\n\n\t\treturn false;\n\t}\n\n\n\t//MARK: トゥイーン開始\n\t#tsy(hArg: HArg) {\n\t\tconst {layer, render, name} = hArg;\n\t\tif (! layer) throw 'layerは必須です';\n\n\t\tconst pg = this.#hPages[this.#argChk_layer(hArg)]!;\n\t\tconst lay = pg.fore;\n\n\t\tlet finishBlendLayer = ()=> {};\n\t\tif (render && ! this.#evtMng.isSkipping) {\n\t\t\tlay.renderStart();\n\t\t\tfinishBlendLayer = ()=> lay.renderEnd();\n\t\t}\n\n\t\tconst hTo = CmnTween.cnvTweenArg(hArg, lay);\n\t\tconst arrive = argChk_Boolean(hArg, 'arrive', false);\n\t\tconst backlay = argChk_Boolean(hArg, 'backlay', false);\n\t\tconst spBack: any = pg.back.ctn;\t// fore, back が変わる恐れで外へ\n\t\tCmnTween.tween(name ?? layer, hArg, lay, CmnTween.cnvTweenArg(hArg, lay), ()=> {}, finishBlendLayer, ()=> {\n\t\t\tif (arrive) Object.assign(lay, hTo);\n\t\t\tif (backlay) for (const nm of Object.keys(CmnTween.hMemberCnt)) spBack[nm] = (lay as any)[nm];\n\t\t});\n//\t\thArg[':id'] = pg.fore.name.slice(0, -7);\n//\t\tthis.scrItr.getDesignInfo(hArg);\t// 必ず[':id'] を設定すること\n\n\t\tif ('filter' in hArg) {\n\t\t\tlay.ctn.filters = [Layer.bldFilters(hArg)];\n\t\t\tlay.aFltHArg = [hArg];\n\t\t}\n\n\t\treturn false;\n\t}\n\n\n\t//MARK: フィルター追加\n\t#add_filter(hArg: HArg) {\n\t\tCmnTween.finish_trans();\n\n\t\tthis.#foreachLayers(hArg, layer=> {\n\t\t\tconst pg = this.#hPages[this.#argChk_layer({layer})]!;\n\t\t\tif (hArg.page === 'both') {\t// page=both で両面に\n\t\t\t\tthis.#add_filter2(pg.fore, hArg);\n\t\t\t\tthis.#add_filter2(pg.back, hArg);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst l = pg.getPage(hArg);\n\t\t\tthis.#add_filter2(l, hArg);\n\t\t});\n\n\t\treturn false;\n\t}\n\t#add_filter2(l: Layer, hArg: HArg) {\n\t\tconst s = l.ctn;\n\t\ts.filters ??= [];\n\t\ts.filters = [...s.filters, Layer.bldFilters(hArg)];\n\t\tl.aFltHArg.push(hArg);\n\t}\n\n\t//MARK: フィルター全削除\n\t#clear_filter(hArg: HArg) {\n\t\tthis.#foreachLayers(hArg, layer=> {\n\t\t\tconst pg = this.#hPages[this.#argChk_layer({layer})]!;\n\t\t\tif (hArg.page === 'both') {\t// page=both で両面に\n\t\t\t\tconst f = pg.fore;\n\t\t\t\tconst b = pg.back;\n\t\t\t\tf.ctn.filters = null;\n\t\t\t\tb.ctn.filters = null;\n\t\t\t\tf.aFltHArg = [];\n\t\t\t\tb.aFltHArg = [];\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst l = pg.getPage(hArg);\n\t\t\tl.ctn.filters = null;\n\t\t\tl.aFltHArg = [];\n\t\t});\n\n\t\treturn false;\n\t}\n\n\t//MARK: フィルター個別切替\n\t#enable_filter(hArg: HArg) {\n\t\tthis.#foreachLayers(hArg, layer=> {\n\t\t\tconst pg = this.#hPages[this.#argChk_layer({layer})]!;\n\t\t\tif (hArg.page === 'both') {\t// page=both で両面に\n\t\t\t\tthis.#enable_filter2(pg.fore, hArg);\n\t\t\t\tthis.#enable_filter2(pg.back, hArg);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst l = pg.getPage(hArg);\n\t\t\tthis.#enable_filter2(l, hArg);\n\t\t});\n\n\t\treturn false;\n\t}\n\t#enable_filter2(l: Layer, hArg: HArg) {\n\t\tconst s = l.ctn;\n\t\tif (! s.filters) throw 'フィルターがありません';\n\n\t\tconst i = uint(argChk_Num(hArg, 'index', 0));\n\t\tconst len = s.filters.length;\n\t\tif (len <= i) throw `フィルターの個数（${len}）を越えています`;\n\n\t\tl.aFltHArg[i]!.enabled =\n\t\ts.filters[i]!.enabled = argChk_Boolean(hArg, 'enabled', true);\n\t}\n\n\n//\t// 文字・文字レイヤ\n\tstatic\t\t#msecChWait\t\t= 10;\n\tstatic get\tmsecChWait() {return LayerMng.#msecChWait}\n\t//MARK: 文字を追加する\n\t#ch(hArg: HArg) {\n\t\tconst {text} = hArg;\n\t\tif (! text) throw 'textは必須です';\n\n\t\tconst tl = this.#getTxtLayer(hArg);\n\t\tdelete hArg.text;\t// [graph]時、次行がルビ文法でトラブったので\n\t\tthis.setNormalChWait();\n\t\tif (this.#evtMng.isSkipping) hArg.wait = 0;\n\t\telse if ('wait' in hArg) argChk_Num(hArg, 'wait', NaN);\n\n\t\tconst sArg = encodeURIComponent(JSON.stringify(hArg));\n\t\tthis.#cmdTxt('add｜'+ sArg, tl);\t// [ch style]用\n\n\t\tconst record = argChk_Boolean(hArg, 'record', true);\n\t\tconst doRecLog = this.val.doRecLog();\n\t\tif (! record) this.val.setVal_Nochk('save', 'sn.doRecLog', record);\n\t\ttl.tagCh(text.replaceAll('[r]', '\\n'));\n\t\tthis.val.setVal_Nochk('save', 'sn.doRecLog', doRecLog);\n\n\t\tthis.#cmdTxt(`add_close｜`, tl);\t// [ch style]用\n\n\t\treturn false;\n\t}\n\n\t#getTxtLayer = (_hArg: HArg): TxtLayer=> {this.#chkTxtLay(); throw 0};\n\t#$getTxtLayer(hArg: HArg): TxtLayer {\n\t\tconst ln = this.#argChk_layer(hArg, this.#curTxtlay);\n\t\tconst pg = this.#hPages[ln]!;\n\t\tconst lay = pg.getPage(hArg);\n\t\tif (! (lay instanceof TxtLayer)) throw ln +'はTxtLayerではありません';\n\n\t\treturn lay;\n\t}\n\tsetNormalChWait(): void {LayerMng.#msecChWait = this.scrItr.normalWait}\n\n\n\t//MARK: 操作対象のメッセージレイヤの指定\n\t#current = (_hArg: HArg): boolean=> {this.#chkTxtLay(); throw 0};\n\t#$current(hArg: HArg) {\n\t\tconst {layer} = hArg;\n\t\tif (! layer) throw '[current] layerは必須です';\n\n\t\tconst lay = this.#hPages[layer];\n\t\tif (! lay || ! (lay.getPage(hArg) instanceof TxtLayer)) throw `${layer}はTxtLayerではありません`;\n\t\tthis.#pgTxtlay = lay;\n\n\t\tthis.recPagebreak();\t// カレント変更前に現在の履歴を保存\n\t\tthis.#curTxtlay = layer;\n\t\tthis.val.setVal_Nochk('save', 'const.sn.mesLayer', layer);\n\t\tfor (const [ln, {fore, back}] of Object.entries(this.#hPages)) {\n\t\t\tif (fore instanceof TxtLayer) fore.isCur =\n\t\t\t(<TxtLayer>back).isCur = ln === layer;\n\t\t}\n\n\t\treturn false;\n\t}\n\tget currentTxtlayForeNeedErr(): TxtLayer {\n\t\tthis.#chkTxtLay();\n\t\treturn this.currentTxtlayFore!;\n\t}\n\tget currentTxtlayFore(): TxtLayer | null {\n\t\tif (! this.#pgTxtlay) return null;\n\n\t\treturn this.#pgTxtlay.fore as TxtLayer;\n\t}\n\t#pgTxtlay\t: Pages;\t// カレントテキストレイヤ\n\t#chkTxtLay\t: ()=> void\t= ()=> {throw '文字レイヤーがありません。文字表示や操作する前に、[add_lay layer=（レイヤ名） class=txt]で文字レイヤを追加して下さい'};\n\n\t#argChk_layer(hash: any, def = ''): string {\n\t\tconst ln = hash.layer ?? def;\n\t\tif (ln.includes(',')) throw 'layer名に「,」は使えません';\n\t\tif (! (ln in this.#hPages)) throw '属性 layer【'+ ln +'】が不正です。レイヤーがありません';\n\n\t\treturn hash.layer = ln;\n\t}\n\n\n\t#oLastPage\t: T_LOG\t= {text: ''};\n\t#aTxtLog\t: {[name: string]: number | string}[]\t= [];\n\trecText(text: string) {\n\t\tthis.#oLastPage = {text};\n\t\tthis.val.setVal_Nochk('save', 'const.sn.sLog',\n\t\t\tString(this.val.getVal('const.sn.log.json'))\t// これを起動したい\n\t\t);\n\t}\n\trecPagebreak() {\n\t\tif (! this.#oLastPage.text) return;\n\n\t\tthis.#oLastPage.text = this.#oLastPage.text.replaceAll(`<\\/span><span class='sn_ch'>`, '');\n\t\tif (this.#aTxtLog.push(this.#oLastPage as {[name: string]: any}) > this.cfg.oCfg.log.max_len) this.#aTxtLog = this.#aTxtLog.slice(-this.cfg.oCfg.log.max_len);\n\t\tthis.#oLastPage = {text: ''};\n\t}\n\n\n\t//MARK: 文字消去\n\t#clear_text(hArg: HArg) {\n\t\tconst tf = this.#getTxtLayer(hArg);\n\t\tif (hArg.layer === this.#curTxtlay && hArg.page === 'fore') this.recPagebreak();\t// 改ページ、クリア前に\n\t\ttf.clearText();\n\t\treturn false;\n\t}\n\n\n\t//MARK: ハイパーリンクの終了\n\t#endlink(hArg: HArg) {this.#cmdTxt('endlink｜', this.#getTxtLayer(hArg)); return false}\n\n\t//MARK: ページ両面の文字消去\n\t#er(hArg: HArg) {\n\t\tif (argChk_Boolean(hArg, 'rec_page_break', true)) this.recPagebreak();\t// 改ページ、クリア前に\n\n\t\tif (this.#pgTxtlay) {\n\t\t\tthis.#pgTxtlay.fore.clearLay(hArg);\n\t\t\tthis.#pgTxtlay.back.clearLay(hArg);\n\t\t}\n\n\t\treturn false;\n\t}\n\n\t//MARK: インライン画像表示\n\t#graph(hArg: HArg) {\n\t\tif (! hArg.pic) throw '[graph] picは必須です';\n\n\t\tconst sArg = encodeURIComponent(JSON.stringify(hArg));\n\t\tthis.#cmdTxt('grp｜'+ sArg, this.#getTxtLayer(hArg));\n\t\treturn false;\n\t}\n\n\t//MARK: ハイパーリンク\n\t#link(hArg: HArg) {\n\t\tif (! hArg.fn && ! hArg.label && ! hArg.url) throw 'fn,label,url いずれかは必須です';\n\t\thArg.fn ??= this.scrItr.scriptFn;\t// ここで指定する必要がある\n\n\t\thArg.style ??= 'background-color: rgba(255,0,0,0.5);';\n\t\thArg.style_hover ??= 'background-color: rgba(255,0,0,0.9);';\n\t\thArg.style_clicked ??= hArg.style;\n\t\tconst sArg = encodeURIComponent(JSON.stringify(hArg));\n\t\tthis.#cmdTxt('link｜'+ sArg, this.#getTxtLayer(hArg));\n\t\treturn false;\n\t}\n\n\t//MARK: 改行\n\t#r(hArg: HArg) {hArg.text = '\\n'; return this.#ch(hArg)}\n\n\t//MARK: 履歴改行\n\t#rec_r(hArg: HArg) {return this.#rec_ch({...hArg, text: '[r]'})};\n\n\t//MARK: 履歴書き込み\n\t#rec_ch(hArg: HArg) {\n\t\tthis.#oLastPage = {...hArg, text: this.#oLastPage.text};\t// text 以外を先に更新\n\t\tif (! hArg.text) return false;\n\n\t\thArg.record = true;\n\t\thArg.style ??= '';\n\t\thArg.style += 'display: none;';\t// gotxt内で削除し履歴に表示\n\t\thArg.wait = 0;\n\t\treturn this.#ch(hArg);\t// この先は text, style, r_style 以外破棄されてしまうので注意\n\t};\n\n\t//MARK: 履歴リセット\n\t#reset_rec(hArg: HArg) {\n\t\tthis.#aTxtLog = [];\n\t\tthis.#oLastPage = {text: hArg.text ?? ''};\n\t\tthis.val.setVal_Nochk('save', 'const.sn.sLog', \n\t\t\thArg.text ?`[{text:\"${hArg.text}\"}]` : '[]'\n\t\t);\n\n\t\treturn false;\n\t}\n\n\t//MARK: 文字列と複数ルビの追加\n\t#ruby2(hArg: HArg) {\n\t\tconst {t, r} = hArg;\n\t\tif (! t) throw '[ruby2] tは必須です';\n\t\tif (! r) throw '[ruby2] rは必須です';\n\n\t\thArg.text = '｜'+ encodeURIComponent(t) +'《'+ encodeURIComponent(r) +'》';\n\t\tdelete hArg.t;\n\t\tdelete hArg.r;\n\t\treturn this.#ch(hArg);\n\t}\n\n\n\t//MARK: インラインスタイル設定\n\t#span(hArg: HArg) {\n\t\tconst sArg = encodeURIComponent(JSON.stringify(hArg));\n\t\tthis.#cmdTxt('span｜'+ sArg, this.#getTxtLayer(hArg));\n\t\treturn false;\n\t}\n\n\t//MARK: tcy縦中横を表示する\n\t#tcy(hArg: HArg) {\n\t\tif (! hArg.t) throw '[tcy] tは必須です';\n\n\t\tconst sArg = encodeURIComponent(JSON.stringify(hArg));\n\t\tthis.#cmdTxt('tcy｜'+ sArg, this.#getTxtLayer(hArg));\n\t\treturn false;\n\t}\n\n\n\t//MARK: レイヤのダンプ\n\t#dump_lay({layer}: HArg) {\n\t\tconsole.group('🥟 [dump_lay]');\n\t\tfor (const ln of this.#getLayers(layer)) {\n\t\t\tconst {fore, back} = this.#hPages[ln]!;\n\t\t\ttry {\n\t\t\t\tconsole.info(`%c${fore.name.slice(0, -7)} %o`, `color:#${CmnLib.isDarkMode ?'49F' :'05A'};`,\n\t\t\t\tJSON.parse(`{\"back\":{${back.dump()}}, \"fore\":{${fore.dump()}}}`));\n\t\t\t} catch (e) {\n\t\t\t\tconsole.error(`dump_lay err:%o`, e);\n\t\t\t\tconsole.error(`   back:${back.dump()}`);\n\t\t\t\tconsole.error(`   fore:${fore.dump()}`);\n\t\t\t}\n\t\t}\n\t\tconsole.groupEnd();\n\n\t\treturn false;\n\t}\n\n\n\t//MARK: イベント有無の切替\n\t#enable_event(hArg: HArg) {\n\t\tconst ln = this.#argChk_layer(hArg, this.#curTxtlay);\n\t\tconst v = argChk_Boolean(hArg, 'enabled', true);\n\t\tthis.#getTxtLayer(hArg).enabled = v;\n\t\tthis.val.setVal_Nochk('save', 'const.sn.layer.'+ ln +'.enabled', v);\n\n\t\treturn false;\n\t}\n\n\n\t//MARK: ボタンを表示\n\t#button(hArg: HArg) {\n\t\tPages.argChk_page(hArg, 'back');\t// チェックしたいというよりデフォルトをbackに\n\t\thArg.fn ??= this.scrItr.scriptFn;\t// ここで指定する必要がある\n\t\t\t// fn省略時、画像ボタンはロード後という後のタイミングで scrItr.scriptFn を\n\t\t\t// 参照してしまうので\n\t\tthis.#getTxtLayer(hArg).addButton(hArg);\t// hArg[':id_tag'] も設定\n\n\t\tthis.scrItr.recodeDesign(hArg);\t// 必ず[':id_tag'] を設定すること\n\n\t\treturn false;\n\t}\n\n\n\trecord(): any {\n\t\tconst o: any = {};\n\t\tfor (const ln of this.#aLayName) {\n\t\t\tconst pg = this.#hPages[ln]!;\n\t\t\to[ln] = {\n\t\t\t\tcls: pg.cls,\n\t\t\t\tfore: pg.fore.record(),\n\t\t\t\tback: pg.back.record(),\n\t\t\t};\n\t\t}\n\t\treturn o;\n\t}\n\tplayback($hPages: HIPage): Promise<void>[] {\n\t\t// これを先に。save:const.sn.sLog がクリアされてしまう\n\t\tthis.#aTxtLog = JSON.parse(String(this.val.getVal('save:const.sn.sLog')));\n\t\tthis.#oLastPage = {text: ''};\n\n\t\tconst aPrm: Promise<void>[] = [];\n\t\tconst aSort: {ln: string, idx: number}[] = [];\n\t\tfor (const [ln, {fore, fore: {idx}, back, cls}] of Object.entries($hPages)) {\t// 引数で言及の無いレイヤはそのまま。特に削除しない\n\t\t\taSort.push({ln, idx});\n\t\t\tconst ps = this.#hPages[ln] ??= new Pages(ln, cls, this.#fore, this.#back, {}, this.sys, this.val, {isWait: false});\n\t\t\tps.fore.playback(fore, aPrm);\n\t\t\tps.back.playback(back, aPrm);\n\t\t}\n\n\t\tconst len = this.#fore.children.length;\n\t\taPrm.push(new Promise(re=> {\t// 若い順にsetChildIndex()\n\t\t\tfor (const {ln, idx} of\n\t\t\t\taSort.sort(({idx: a}, {idx: b})=> a === b ?0 :a < b ?-1 :1)) {\n\t\t\t\tconst {fore, back} = this.#hPages[ln]!;\n\t\t\t\tif (! fore) continue;\n\n\t\t\t\tconst i = len > idx ?idx :len -1;\n\t\t\t\tthis.#fore.setChildIndex(fore.ctn, i);\n\t\t\t\tthis.#back.setChildIndex(back.ctn, i);\n\t\t\t}\n\t\t\tre();\n\t\t}));\n\t\treturn aPrm;\n\t}\n\n}\n","/* ***** BEGIN LICENSE BLOCK *****\n\tCopyright (c) 2018-2025 Famibee (famibee.blog38.fc2.com)\n\n\tThis software is released under the MIT License.\n\thttp://opensource.org/licenses/mit-license.php\n** ***** END LICENSE BLOCK ***** */\n\nimport {Layer} from './Layer';\nimport {uint, CmnLib, type IEvtMng, argChk_Boolean, argChk_Num, initStyle, addStyle, argChk_Color} from './CmnLib';\nimport type {IHTag, HArg} from './Grammar';\nimport type {IVariable, IPutCh, IRecorder} from './CmnInterface';\nimport {TxtStage} from './TxtStage';\nimport type {Config} from './Config';\nimport {RubySpliter} from './RubySpliter';\nimport {SpritesMng} from './SpritesMng';\nimport {Button} from './Button';\nimport {LayerMng, type IMakeDesignCast} from './LayerMng';\nimport type {SysBase} from './SysBase';\nimport {DebugMng} from './DebugMng';\nimport {SEARCH_PATH_ARG_EXT} from './ConfigBase';\nimport {Reading} from './Reading';\nimport type {ScriptIterator} from './ScriptIterator';\n\nimport {Sprite, DisplayObject, Graphics, Container, Renderer, Application} from 'pixi.js';\n\n\nexport class TxtLayer extends Layer {\n\tstatic\t#cfg\t\t: Config;\n\tstatic\t#val\t\t: IVariable;\n\tstatic\t#isPageFore\t: (me: TxtLayer)=> boolean;\n\tstatic\t#recorder\t: IRecorder;\n\tstatic\tinit(cfg: Config, hTag: IHTag, val: IVariable, recorder: IRecorder, isPageFore: (me: TxtLayer)=> boolean, appPixi: Application): void {\n\t\tTxtLayer.#cfg = cfg;\n\t\tTxtStage.init(cfg, appPixi);\n\t\tTxtLayer.#val = val;\n\t\tTxtLayer.#recorder = recorder;\n\t\tTxtLayer.#isPageFore = isPageFore;\n\n\t\tval.setDoRecProc(TxtLayer.chgDoRec);\n\n\t\thTag.autowc\t\t\t= o=> TxtLayer.#autowc(o);\t// 文字を追加する\n\t\thTag.autowc({enabled: false, text: '', time: 0});\n\t\thTag.ch_in_style\t= o=> TxtLayer.#ch_in_style(o);\t// 文字出現演出\n\t\thTag.ch_out_style\t= o=> TxtLayer.#ch_out_style(o);\t// 文字消去演出\n\n\t\t// ギャラリーリロード用初期化\n\t\tTxtStage.initChStyle();\n\t\tinitStyle();\n\n\t\taddStyle(\n\t\t\tcfg.matchPath('.+', SEARCH_PATH_ARG_EXT.FONT)\n\t\t\t.flatMap(o=> Object.values(o).map(v=> `\n@font-face {\n\tfont-family: '${v}';\n\tsrc: url('${this.#cfg.searchPath(v, SEARCH_PATH_ARG_EXT.FONT)}');\n}\n`)).join('')\n\n\t\t\t// 文字出現演出関係\n\t\t\t+`\n.sn_tx {\n\tpointer-events: none;\n\tuser-select: none;\n\t-webkit-touch-callout: none;\n\tbox-sizing: border-box;\n}\n.sn_ch {\n\tposition: relative;\n\tdisplay: inline-block;\n}\n`\t// 「sn_ch」と「sn_ch_in_〜」の中身が重複しているが、これは必須\n\t\t);\n\n\t\tTxtLayer.#ch_in_style({\n\t\t\tname\t: 'default',\n\t\t\twait\t: 500,\n\t\t\talpha\t: 0,\n\t\t\tx\t\t: '=0.3',\n\t\t\ty\t\t: '=0',\n\t\t\tscale_x\t: 1,\n\t\t\tscale_y\t: 1,\n\t\t\trotate\t: 0,\n\t\t\tjoin\t: true,\n\t\t\tease\t: 'ease-out',\n\t\t});\n\t\tTxtLayer.#ch_out_style({\n\t\t\tname\t: 'default',\n\t\t\twait\t: 0,\n\t\t\talpha\t: 0,\n\t\t\tx\t\t: '=0',\n\t\t\ty\t\t: '=0',\n\t\t\tscale_x\t: 1,\n\t\t\tscale_y\t: 1,\n\t\t\trotate\t: 0,\n\t\t\tjoin\t: false,\n\t\t\tease\t: 'ease-out',\n\t\t});\n\t}\n\n\t// 文字出現演出\n\tstatic\t#ch_in_style(hArg: HArg) {\n\t\tconst o = TxtStage.ch_in_style(hArg);\n\t\tconst x = o.x.startsWith('=') ?`${o.nx *100}%` :`${o.nx}px`;\n\t\tconst y = o.y.startsWith('=') ?`${o.ny *100}%` :`${o.ny}px`;\n\t\tconst {name} = hArg;\n\t\taddStyle(`\n.sn_ch_in_${name} {\n\tposition: relative;\n\tdisplay: inline-block;\n}\n.go_ch_in_${name} {\n\topacity: ${o.alpha};\n\tposition: relative;\n\tdisplay: inline-block;\n\tanimation: sn_ch_in_${name} ${o.wait}ms ${o.ease} 0s both;\n}\n@keyframes sn_ch_in_${name} {\n\tfrom {transform: rotate(${o.rotate}deg) scale(${o.scale_x}, ${o.scale_y}) translate(${x}, ${y})}\n\tto {opacity: 1; transform: none;}\n}\n`);\n\n\t\treturn false;\n\t}\n\t// 文字消去演出\n\tstatic\t#ch_out_style(hArg: HArg) {\n\t\tconst o = TxtStage.ch_out_style(hArg);\n\t\tconst x = o.x.startsWith('=') ?`${o.nx *100}%` :`${o.nx}px`;\n\t\tconst y = o.y.startsWith('=') ?`${o.ny *100}%` :`${o.ny}px`;\n\t\tconst {name} = hArg;\n\t\taddStyle(`\n.go_ch_out_${name} {\n\tposition: relative;\n\tdisplay: inline-block;\n\tanimation: go_ch_out_${name} ${o.wait}ms ${o.ease} 0s both;\n}\n@keyframes go_ch_out_${name} {\n\tto {\n\t\topacity: ${o.alpha};\n\t\ttransform: rotate(${o.rotate}deg) scale(${o.scale_x}, ${o.scale_y}) translate(${x}, ${y});\n\t}\n`);\n\n\t\treturn false;\n\t}\n\n\n\tstatic\t#evtMng\t: IEvtMng;\n\tstatic\t#sys\t: SysBase;\n\tstatic setEvtMng(evtMng: IEvtMng, sys: SysBase, scrItr: ScriptIterator) {\n\t\tTxtLayer.#evtMng = evtMng;\n\t\tTxtLayer.#sys = sys;\n\t\tTxtStage.setEvtMng(evtMng, scrItr);\n\t}\n\n\t// 文字ごとのウェイト\n\tstatic #doAutoWc\t= false;\n\tstatic #hAutoWc\t: {[ch: string]: number}\t= {};\n\tstatic #autowc(hArg: HArg) {\n\t\tTxtLayer.#doAutoWc = argChk_Boolean(hArg, 'enabled', TxtLayer.#doAutoWc);\n\t\tTxtLayer.#val.setVal_Nochk('save', 'const.sn.autowc.enabled', TxtLayer.#doAutoWc);\n\n\t\tconst {text} = hArg;\n\t\tif (('text' in hArg) !== ('time' in hArg)) throw '[autowc] textとtimeは同時指定必須です';\n\t\tTxtLayer.#val.setVal_Nochk('save', 'const.sn.autowc.text', text);\n\t\tif (! text) {\n\t\t\tTxtLayer.#val.setVal_Nochk('save', 'const.sn.autowc.time', '');\n\t\t\treturn false;\n\t\t}\n\n\t\tconst len = text.length;\n\t\tif (TxtLayer.#doAutoWc && len === 0) throw '[autowc] enabled === false かつ text === \"\" は許されません';\n\n\t\tconst a = String(hArg.time).split(',');\n\t\tif (a.length !== len) throw '[autowc] text文字数とtimeに記述された待ち時間（コンマ区切り）は同数にして下さい';\n\t\tTxtLayer.#hAutoWc = {};\t// 毎回クリアを仕様とする\n\t\tfor (let i=0; i<len; ++i) TxtLayer.#hAutoWc[text[i]!] = uint(a[i]);\n\t\tTxtLayer.#val.setVal_Nochk('save', 'const.sn.autowc.time', hArg.time);\n\n\t\treturn false;\n\t}\n\n\n\t// バック\n\t#b_color\t\t\t= 0x000000;\n\t#b_alpha\t\t\t= 0;\n\t#b_alpha_isfixed\t= false;\n\t#b_do\t\t\t: DisplayObject | undefined\t= undefined;\n\t#b_pic\t\t\t= '';\t// 背景画像無し（＝単色塗り）\n\n\t// 文字表示\n\t#txs\t= new TxtStage(this.ctn, ()=> this.canFocus(), TxtLayer.#sys);\n\n\treadonly\t#rbSpl\t= new RubySpliter;\n\treadonly\t#htmRb\t= document.createElement('span');// cssチェック・保存用\n\tstatic\treadonly\t#hWarnR_Style = {\n\t\t'text-align'\t\t: 0,\n\t\t'text-align-last'\t: 0,\n\t\t'height'\t: 0,\n\t\t'width'\t\t: 0,\n\t\t'padding-left'\t\t: 0,\n\t\t'padding-right'\t\t: 0,\n\t\t'padding-top'\t\t: 0,\n\t\t'padding-bottom'\t: 0,\n\t};\n\n\treadonly\t#cntBtn: Container<Button>\t= new Container;\n\n\tconstructor() {\n\t\tsuper();\n\n\t\tthis.ctn.addChild(this.#txs);\n\n\t\tthis.#rbSpl.init(this.#putCh);\n\n\t\tthis.ctn.addChild(this.#cntBtn);\t// ボタンはpaddingの影響を受けない\n\t\tthis.#cntBtn.name = 'cntBtn';\n\n\t\tconst padding = 16;\t// 初期padding\n\t\tthis.lay({style: `width: ${CmnLib.stageW}px; height: ${CmnLib.stageH}px; font-family: 'Hiragino Sans', 'Hiragino Kaku Gothic ProN', '游ゴシック Medium', meiryo, sans-serif; color: white; font-size: 24px; line-height: 1.5; padding: ${padding}px;`, in_style: 'default', out_style: 'default', back_clear: 'true'});\n\t}\n\toverride destroy() {\n\t\tif (this.#b_do) {this.ctn.removeChild(this.#b_do).destroy(); this.#b_do = undefined}\n\n\t\tTxtLayer.#recorder.recPagebreak();\n\t\tthis.#txs.destroy();\n\t}\n\tstatic\tdestroy() {\n\t\tTxtLayer.#doAutoWc = false;\n\t\tTxtLayer.#hAutoWc = {};\n\n\t\tTxtLayer.#rec = tx=> tx;\n\t}\n\toverride set name(nm: string) {this.name_ = nm; this.#txs.name = nm}\n\toverride get name() {return this.name_}\t// getは継承しないらしい\n\n\n\toverride cvsResize() {this.#txs.cvsResize()}\n\toverride cvsResizeChildren() {\n\t\tfor (const b of this.#cntBtn.children) b.cvsResize();\n\t}\n\n\tprotected\toverride\tprocSetX(x: number) {this.#txs.lay({x})}\n\tprotected\toverride\tprocSetY(y: number) {this.#txs.lay({y})}\n\n\toverride lay(hArg: HArg) {\n\t\tsuper.lay(hArg);\n\t\tLayer.setXY(this.ctn, hArg, this.ctn);\n\n\t\thArg[':id_tag'] = this.name_.slice(0, -7);\t// Design用\n\t\tRubySpliter.setting(hArg);\n\t\tthis.#setFfs(hArg);\n\t\tthis.#txs.lay(hArg);\n\n\t\tif ('r_align' in hArg) this.#r_align = hArg.r_align ?? '';\n\t\tthis.#ruby_pd = CmnLib.isSafari\n\t\t? this.#txs.tategaki\t\t// Safariでは親文字幅 l は疑似値\n\t\t\t? (v, l)=> `text-align: start; height: ${l}em; padding-top: ${v}; padding-bottom: ${v};`\n\t\t\t: (v, l)=> `text-align: start; width: ${l}em; padding-left: ${v}; padding-right: ${v};`\n\t\t: this.#txs.tategaki\n\t\t\t? v=> `text-align: justify; text-align-last: justify; padding-top: ${v}; padding-bottom: ${v};`\n\t\t\t: v=> `text-align: justify; text-align-last: justify; padding-left: ${v}; padding-right: ${v};`;\n\t\tif (CmnLib.isFirefox) this.#mkStyle_r_align = this.#mkStyle_r_align4ff;\n\n\t\tif ('r_style' in hArg) {\n\t\t\tif (hArg.r_style) {\n\t\t\t\tconst cln = document.createElement('span');\n\t\t\t\tcln.style.cssText = hArg.r_style;\n\t\t\t\tconst len = cln.style.length;\n\t\t\t\tconst s = this.#htmRb.style;\n\t\t\t\tfor (let i=0; i<len; ++i) {\n\t\t\t\t\tconst key: any = cln.style[i];\n\t\t\t\t\tif (key in TxtLayer.#hWarnR_Style) {\n\t\t\t\t\t\tDebugMng.myTrace(`${key}は指定できません`, 'W');\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tconst v = cln.style[key];\n\t\t\t\t\tif (v) s[key] = v;\n\t\t\t\t}\n\t//\t\t\tif ((! cln.style.opacity) && ('alpha' in hArg)) s.opacity = String(this.spLay.alpha);\n\t\t\t}\n\t\t\telse this.#htmRb.style.cssText = '';\n\t\t}\n\n\t\tif ('alpha' in hArg) for (const b of this.#cntBtn.children) b.alpha = this.ctn.alpha;\n\n\t\tthis.#set_ch_in(hArg);\n\t\tthis.#set_ch_out(hArg);\n\n\t\tconst RPN_TXT_LAY = Reading.procID +`TxtLayer lay name:${this.name_}`;\n\t\tconst ret = this.#drawBack(hArg, isStop=> {\n\t\t\tif (isStop) Reading.endProc(RPN_TXT_LAY);\n\t\t});\n\t\tif (ret) Reading.beginProc(RPN_TXT_LAY);\n\t\treturn ret;\n\t}\n\t#set_ch_in(hArg: HArg) {\n\t\tconst {in_style} = hArg;\n\t\tif (! in_style) return;\n\t\tconst cis = TxtStage.getChInStyle(in_style);\n\t\tif (! cis) throw `存在しないin_style【${in_style}】です`;\n\t\tthis.#$ch_in_style = in_style;\n\t\tthis.#ch_in_join = cis.join;\n\t}\n\t#$ch_in_style\t= '';\n\t#ch_in_join\t\t= true;\n\n\toverride get\twidth() {return this.#txs.getWidth}\n\toverride get\theight() {return this.#txs.getHeight}\n\n\t#set_ch_out(hArg: HArg) {\n\t\tconst {out_style} = hArg;\n\t\tif (! out_style) return;\n\t\tconst cos = TxtStage.getChOutStyle(out_style);\n\t\tif (! cos) throw `存在しないout_style【${out_style}】です`;\n\t\tthis.#$ch_out_style = out_style;\n\t}\n\t#$ch_out_style\t= '';\n\n\t#sps\t= new SpritesMng;\n\t#drawBack(hArg: HArg, fncComp: (isStop: boolean)=> void): boolean {\n\t\tif ('back_clear' in hArg) {\n\t\t\tif (argChk_Boolean(hArg, 'back_clear', false)) {\n\t\t\t\tthis.#b_color = 0x000000;\n\t\t\t\tthis.#b_alpha = 0;\n\t\t\t\tthis.#b_alpha_isfixed = false;\n\t\t\t\tthis.#b_pic = '';\n\t\t\t}\n\t\t\tfncComp(false);\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.#b_alpha = argChk_Num(hArg, 'b_alpha', this.#b_alpha);\n\t\tthis.#b_alpha_isfixed = argChk_Boolean(hArg, 'b_alpha_isfixed', this.#b_alpha_isfixed);\n\t\tconst alpha = (this.#b_alpha_isfixed\n\t\t\t? 1\n\t\t\t: Number(TxtLayer.#val.getVal('sys:TextLayer.Back.Alpha'))\n\t\t) *this.#b_alpha;\n\t\tif (hArg.b_pic) {\n\t\t\tif (this.#b_pic !== hArg.b_pic) {\n\t\t\t\tthis.#b_pic = hArg.b_pic;\n\t\t\t\tif (this.#b_do) {\n\t\t\t\t\tthis.ctn.removeChild(this.#b_do);\t// Graphics かも\n\t\t\t\t\tthis.#b_do.destroy();\t// Graphics かも\n\t\t\t\t}\n\t\t\t\t//this.#sps.destroy();\t// Graphics かもなので使用不可\n\t\t\t\tthis.#sps = new SpritesMng(this.#b_pic, this.ctn, sp=> {\n\t\t\t\t\tthis.#b_do = sp;\n\t\t\t\t\tsp.name = 'back(pic)';\n\t\t\t\t\tsp.visible = (alpha > 0);\n\t\t\t\t\tsp.alpha = alpha;\n\t\t\t\t\t//CmnLib.adjustRetinaSize(this.b_pic, sp);\n\t\t\t\t\tthis.#txs.setMySize(sp.width, sp.height);\n\t\t\t\t\t\t// ちなみに左上表示位置は本レイヤと同じ\n\t\t\t\t\tthis.ctn.setChildIndex(sp, 0);\n\t\t\t\t\tfncComp(true);\n\t\t\t\t});\n\t\t\t\treturn this.#sps.ret;\n\t\t\t}\n\t\t}\n\t\telse if ('b_color' in hArg) {\n\t\t\tthis.#b_color = argChk_Color(hArg, 'b_color', 0x000000);\n\t\t\tif (this.#b_do) {\n\t\t\t\tthis.ctn.removeChild(this.#b_do);\t// Graphics かも\n\t\t\t\tthis.#b_do.destroy();\t// Graphics かも\n\t\t\t\t//this.#sps.destroy();\t// Graphics かもなので使用不可\n\t\t\t}\n\t\t\tthis.#b_pic = '';\t// 忘れずクリア\n\t\t\tthis.ctn.addChildAt(\n\t\t\t\t(this.#b_do = new Graphics)\n\t\t\t\t.beginFill(this.#b_color, alpha)\n\t\t\t\t.lineStyle(undefined)\n\t\t\t\t.drawRect(0, 0, this.#txs.getWidth, this.#txs.getHeight)\n\t\t\t\t.endFill(), 0);\n\t\t\tthis.#b_do.name = 'back(color)';\n\t\t\t//cacheAsBitmap = true;\t// これを有効にするとスナップショットが撮れない？？\n\t\t}\n\n\t\tif (this.#b_do) {\n\t\t\tthis.#b_do.visible = (alpha > 0);\n\t\t\t\t// 透明の時は表示しない。こうしないと透明テキストレイヤ下のボタンが\n\t\t\t\t// 押せなくなる（透明だが塗りがあるという扱いなので）\n\t\t\tthis.#b_do.alpha = alpha;\n\t\t}\n\t\tfncComp(false);\n\n\t\treturn false;\n\t}\n\tchgBackAlpha(g_alpha: number): void {\n\t\tconst alpha = this.#b_alpha_isfixed\n\t\t\t? this.#b_alpha\n\t\t\t: g_alpha * this.#b_alpha;\n\t\tif (this.#b_do instanceof Graphics) {\n\t\t\tif (this.#b_do) {\n\t\t\t\tthis.ctn.removeChild(this.#b_do);\n\t\t\t\tthis.#b_do.destroy();\n\t\t\t}\n\t\t\tthis.ctn.addChildAt(\n\t\t\t\t(this.#b_do = new Graphics)\n\t\t\t\t.beginFill(this.#b_color, alpha)\n\t\t\t\t.lineStyle(undefined)\n\t\t\t\t.drawRect(0, 0, this.#txs.getWidth, this.#txs.getHeight)\n\t\t\t\t.endFill(), 0);\n\t\t\tthis.#b_do.name = 'back(color)';\n\t\t\t//cacheAsBitmap = true;\t// これを有効にするとスナップショットが撮れない？？\n\t\t}\n\t\tif (this.#b_do) {\n\t\t\tthis.#b_do.visible = (alpha > 0);\n\t\t\t\t// 透明の時は表示しない。こうしないと透明テキストレイヤ下のボタンが\n\t\t\t\t// 押せなくなる（透明だが塗りがあるという扱いなので）\n\t\t\tthis.#b_do.alpha = alpha;\n\t\t}\n\t}\n\n\t#setFfs(hArg: HArg) {\n\t\tif ('noffs' in hArg) {\n\t\t\tthis.#strNoFFS = hArg.noffs ?? '';\n\t\t\tthis.#regNoFFS = new RegExp(`[　${this.#strNoFFS}]`);\n\t\t}\n\t\tif (! ('ffs' in hArg)) return;\n\n\t\tthis.#ffs ??= '';\n\t\tthis.#fncFFSStyle = (this.#ffs === '')\n\t\t\t? ()=> ''\n\t\t\t: ch=> this.#regNoFFS.test(ch)\n\t\t\t\t? ''\n\t\t\t\t: ` font-feature-settings: ${this.#ffs};`;\n\t}\n\t#ffs\t= '';\n\t#fncFFSStyle\t= (_ch: string)=> '';\n\t#strNoFFS\t= '';\n\t#regNoFFS\t= /[　]/;\n\t// Safariが全体に「font-feature-settings」した後、特定文字の「font-feature-settings: initial;」を受け付けてくれないのでわざわざ一つずつ指定\n\n\n\tstatic\tchgDoRec(doRec: boolean) {\n\t\tTxtLayer.#rec = doRec\n\t\t\t? tx=> tx\n\t\t\t: tx=> `<span class='offrec'>${tx}</span>`;\n\t\t\t\t// 囲んだ領域は履歴で非表示\n\t}\n\tstatic\t#rec = (tx: string)=> tx;\n\n\tisCur\t= false;\n\t#ruby_pd: (v: string, l: number)=> string = ()=> '';\n\t#mkStyle_r_align: (ch: string, rb: string, r_align: string, add_sty?: string)=> string = (ch, rb, r_align, add_sty='')=> {\n\t\tif (! r_align) return ` style='${add_sty}'`;\n\n\t\tconst len = ch.length *2;\n\t\tif (len -rb.length < 0) return ` style='text-align: ${r_align}; ${add_sty}'`;\n\n\t\tlet st = '';\n\t\tswitch (r_align) {\n\t\tcase 'justify':\n\t\t\tst = this.#ruby_pd('0', len);\tbreak;\n\t\tcase '121':\n\t\t\tst = this.#ruby_pd(`calc(${(len -rb.length) /(rb.length *2)}em)`, len);\tbreak;\n\t\tcase 'even':\n\t\t\tst = this.#ruby_pd(`calc(${(len -rb.length) /(rb.length +1)}em)`, len);\tbreak;\n\t\tcase '1ruby':\n\t\t\tst = this.#ruby_pd('1em', len);\tbreak;\n\t\tdefault:\n\t\t\tst = `text-align: ${r_align};`;\n\t\t}\n\t\treturn ` style='${st} ${add_sty}'`;\n\t};\n\t#r_align\t= '';\n\t#mkStyle_r_align4ff(ch: string, rb: string, r_align: string, add_sty=''): string {\n\t\tif (! r_align) return ` style='${add_sty}'`;\n\n\t\tconst len = ch.length *2;\n\t\tif (len -rb.length < 0) return ` style='text-align: ${r_align}; ${add_sty}'`;\n\n\t\tlet st = '';\n\t\tswitch (r_align) {\n\t\t\tcase 'left':\tst = `ruby-align: start;`;\tbreak;\n\t\t\tcase 'center':\tst = `ruby-align: center;`;\tbreak;\n\t\t\tcase 'right':\t// エレガントにサポートできていない\n\t\t\t\tst = `ruby-align: start;`;\tbreak;\n\t\t\tcase 'justify':\tst = `ruby-align: space-between;`;\tbreak;\n\t\t\tcase '121':\t\tst = `ruby-align: space-around;`;\tbreak;\n\t\t\tcase 'even':\n\t\t\t\tconst ev = (len -rb.length) /(rb.length +1);\n\t\t\t\tst = `ruby-align: space-between; `+\n\t\t\t\t(this.#txs.tategaki\n\t\t\t\t\t? `padding-top: ${ev}em; padding-bottom: ${ev}em;`\n\t\t\t\t\t: `padding-left: ${ev}em; padding-right: ${ev}em;`);\n\t\t\t\tbreak;\n\t\t\tcase '1ruby':\tst = `ruby-align: space-between; `+\n\t\t\t\t(this.#txs.tategaki\n\t\t\t\t\t? `padding-top: 1em; padding-bottom: 1em;`\n\t\t\t\t\t: `padding-left: 1em; padding-right: 1em;`);\n\t\t\t\tbreak;\n\t\t\tdefault:\t\tst = `text-align: ${r_align};`;\n\t\t}\n\t\treturn ` style='${st} ${add_sty}'`;\n\t}\n\n\ttagCh(text: string): void {this.#rbSpl.putTxt(text)}\n\t#needGoTxt = false;\n\tget needGoTxt() {return this.#needGoTxt}\n\treadonly\t#putCh\t: IPutCh = (ch, ruby)=> {\n\t\tif (TxtLayer.#cfg.oCfg.debug.putCh) console.log(`🖊 文字表示 text:\\`${ch}\\`(${ch.charCodeAt(0).toString(16)}) ruby:\\`${ruby}\\` name:\\`${this.name_}\\``);\n\n\t\tconst a_ruby = ruby.split('｜');\n\t\tlet add_htm = '';\n\t\tconst [a0, ...a1_] = a_ruby;\n\t\tconst a1 = a1_.join('｜');\n\t\tswitch (a_ruby.length) {\n\t\tcase 1:\t\t// 字or春《はる》\n\t\t\tthis.#needGoTxt = true;\n\t\t\tif (ch === '\\n') {\n\t\t\t\tif (this.#firstCh) {// １文字目にルビが無い場合、不可視ルビで行揃え\n\t\t\t\t\tthis.#firstCh = false;\n\t\t\t\t\tadd_htm = '<ruby>&emsp;<rt>&emsp;</rt></ruby><br/>';\n\t\t\t\t}\n\t\t\t\telse add_htm = '<br/>';\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tif (this.#firstCh) {\t// １文字目にルビが無い場合、不可視ルビで行揃え\n\t\t\t\tthis.#firstCh = false;\n\t\t\t\tif (ruby === '') ruby = '&emsp;';\n\t\t\t}\n\t\t\tadd_htm = this.#tagCh_sub(ch, ruby, this.#r_align);\n\t\t\tbreak;\n\n\t\tdefault:\t// 《grp｜{\"id\":\"break\",\"pic\":\"breakline\"}》\n\t\t\tswitch (a0) {\t// ルビ揃え指定と同時シリーズ\n\t\t\tcase 'start':\t// 初期値\n\t\t\tcase 'left':\t//（肩付き）先頭親文字から、ルビ間は密着\n\t\t\tcase 'center':\t//（中付き）センター合わせ、〃\n\t\t\tcase 'right':\t//（右／下揃え）末尾親文字から、〃\n\t\t\tcase 'justify':\t//（両端揃え）先頭から末尾親文字間に、ルビ間は均等にあける\n\t\t\tcase '121':\t\t//（1-2-1(JIS)）ルビの前後を比率1、ルビ間を比率2であける\n\t\t\tcase 'even':\t//（均等アキ）ルビの前後、ルビ間も均等にあける\n\t\t\tcase '1ruby':\t//（1ルビ文字アキ）ルビの前後をルビ一文字空け、ルビ間は均等にあける\n\t\t\t\tthis.#firstCh = false;\n\t\t\t\tthis.#needGoTxt = true;\n\t\t\t\tadd_htm = this.#tagCh_sub(ch, a1, a0);\n\t\t\t\tbreak;\n\n\t\t\tcase 'gotxt':{\n\t\t\t\tthis.#popSpan();\n\t\t\t\tif (this.#needGoTxt) {\n\t\t\t\t\tif (this.isCur) TxtLayer.#recorder.recText(\n\t\t\t\t\t\tthis.#aSpan.join('')\n\t\t\t\t\t\t.replace(/^<ruby>&emsp;<rt>&emsp;<\\/rt><\\/ruby>(<br\\/>)+/, '')\n\t\t\t\t\t\t\t// 前方の空行をtrim\n\t\t\t\t\t\t.replaceAll(/style='(anim\\S+ [^;]+;\\s*)+/g, `style='`)\n\t\t\t\t\t\t\t// 2 matches (40 step, 205µs) https://regex101.com/r/u1H6v2/1\n\t\t\t\t\t\t.replaceAll(/( style=''| data-(add|arg|cmd)='[^']+'|\\n+|\\t+)/g, '')\n\t\t\t\t\t\t\t// 2 matches (94 step, 175µs) https://regex101.com/r/5DFUmv/1\n\t\t\t\t\t\t.replaceAll(/class='sn_ch[^']+/g, `class='sn_ch`)\n\t\t\t\t\t\t\t// 不要情報削除\n\t\t\t\t\t\t\t// 2 matches (28 step, 280µs) https://regex101.com/r/XhBbYo/1\n\t\t\t\t\t\t.replaceAll(`display: none;`, '')\t// 履歴情報可視化\n\t\t\t\t\t\t.replaceAll(`class='offrec'`, `style='display: none;'`)\n\t\t\t\t\t\t\t// 囲んだ領域は履歴で非表示\n\t\t\t\t\t);\n\n\t\t\t\t\tthis.#txs.goTxt(this.#aSpan, this.#cumDelay === 0);\n\t\t\t\t\tthis.#needGoTxt = false;\n\t\t\t\t\tthis.#cumDelay = 0;\n\t\t\t\t}\n\t\t\t\telse if (this.isCur) this.#txs.noticeCompTxt();\n\t\t\t}\treturn;\t// breakではない\n\n\t\t\tcase 'add':{\t// 文字幅を持たない汎用的な命令（必ずadd_closeすること）\n\t\t\t\tconst o = JSON.parse(a1);\n\n\t\t\t\tconst {style='', wait=null} = o;// wait=0にすると背景が最初から出る\n\t\t\t\tconst {cl, sty} = this.#o2domArg(true, wait);\n\t\t\t\tthis.#aSpan.push(`<span${cl} style='${sty} display: inline; ${style}'>`);\t// display: inline; がないと前の改行が改行しなくなる\n\t\t\t\tdelete o.style;\t// 背景styleなどを[ch]で一塊とする\n\t\t\t\tthis.#pushSpan(o);\n\t\t\t}\treturn;\t// breakではない\n\t\t\tcase 'add_close':\n\t\t\t\tthis.#aSpan.push('</span>');\n\t\t\t\tthis.#popSpan();\n\t\t\t\treturn;\t// breakではない\n\n\t\t\tcase 'grp':\t//\t画像など 《grp｜{\"id\":\"break\",\"pic\":\"breakline\"}》\n\t\t\t\tthis.#needGoTxt = true;\n\t\t\t{\n\t\t\t\tconst o = JSON.parse(a1);\n\t\t\t\to.id ??= this.#aSpan.length;\n\t\t\t\tif (o.id === 'break') {this.#txs.dispBreak(o); return}\t// breakではない\n\n\t\t\t\tthis.#firstCh = false;\n\t\t\t\to.delay = this.#cumDelay;\t// 画像のスライドインで使う\n\t\t\t\to.r ??= '';\n\t\t\t\to.style ??= '';\n\t\t\t\to.r_style ??= '';\n\t\t\t\tconst {cl, sty, lnk} = this.#o2domArg(true, o.wait);\n\t\t\t\tadd_htm = `<span${cl} style='${sty} ${o.style\n\t\t\t\t}'><ruby><span data-cmd='grp' data-arg='${JSON.stringify(o)\n\t\t\t\t}'${lnk} style='${sty} display: inline;'>&emsp;</span><rt${lnk}${\n\t\t\t\t\tthis.#mkStyle_r_align('　', o.r, this.#r_align,\n\t\t\t\t\tthis.#htmRb.style.cssText\t// この並びで上書きされていく\n\t\t\t\t\t+ (this.#stkASpan.at(-1)?.o.r_style ?? '')\n\t\t\t\t\t+ o.r_style)\n\t\t\t\t}>${o.r}</rt></ruby></span>`;\n\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tcase 'tcy':\t// ルビ付き縦中横\n\t\t\t\tthis.#firstCh = false;\n\t\t\t\tthis.#needGoTxt = true;\n\t\t\t{\n\t\t\t\tconst {t, r='', wait=null, style='', r_style=''} = <{\n\t\t\t\t\tt: string, r?: string, wait? :number,\n\t\t\t\t\tstyle? :string, r_style? :string,\n\t\t\t\t}>JSON.parse(a1);\n\t\t\t\tif (TxtLayer.#val.doRecLog()) {\n\t\t\t\t\tthis.#page_text += ch +(ruby ?`《${ruby}》` :'');\n\t\t\t\t\tthis.#page_plain_text += t;\n\t\t\t\t}\n\n\t\t\t\tconst rb = CmnLib.isSafari\n\t\t\t\t\t? r.replaceAll(/[A-Za-z0-9]/g, s=> String.fromCharCode(s.charCodeAt(0) + 65248))\n\t\t\t\t\t\t// 英数字を全角に(Safariで縦中横ルビが半角文字だと、\n\t\t\t\t\t\t// 選択矩形が横倒しになる不具合対策)\n\t\t\t\t\t: r;\n\t\t\t\tconst {cl, sty, lnk} = this.#o2domArg(true, wait);\n\t\t\t\tadd_htm = `<span${cl} style='${sty}${this.#fncFFSStyle(t)} ${style}'><ruby><span${lnk} style='${sty} display: inline; text-combine-upright: all;'>${t}</span><rt${lnk}${\n\t\t\t\t\tthis.#mkStyle_r_align(t, rb, this.#r_align,\n\t\t\t\t\tthis.#htmRb.style.cssText\t// この並びで上書きされていく\n\t\t\t\t\t+ (this.#stkASpan.at(-1)?.o.r_style ?? '')\n\t\t\t\t\t+ r_style)\n\t\t\t\t}>${rb}</rt></ruby></span>`;\n\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tcase 'del':\t//if (a1 !== 'break') throw '文字レイヤdelコマンドは、現在id=breakのみサポートします';\n\t\t\t\tTxtStage.delBreak();\n\t\t\t\treturn;\t// breakではない\n\n\t\t\tcase 'span':\n\t\t\t\tthis.#needGoTxt = true;\n\t\t\t\tthis.#mergePushSpan(JSON.parse(a1));\n\t\t\t\treturn;\t// breakではない\n\n\t\t\tcase 'link':\n\t\t\t\tthis.#needGoTxt = true;\n\t\t\t{\n\t\t\t\tconst o = JSON.parse(a1);\n\t\t\t\to[':link'] = ` data-lnk='@'`;\n\t\t\t\tconst {cl, sty, curpos} = this.#o2domArg(false, o.wait);\n\t\t\t\tthis.#aSpan.push(`<span${cl} style='${sty} display: inline; ${o.style ?? ''}' ${curpos} data-arg='${a1}'>`);\n\t\t\t\t\t// display: inline; を削除するとルビもリンク背景に含まれる\n\t\t\t\t\t// ただし当たり判定は文字・ルビ上のみ\n\t\t\t\tdelete o.style;\n\t\t\t\tthis.#mergePushSpan(o);\n\t\t\t}\treturn;\t// breakではない\n\n\t\t\tcase 'endlink':\n\t\t\t\tthis.#needGoTxt = true;\n\t\t\t\tthis.#aSpan.push('</span>');\n\t\t\t\tthis.#popSpan();\n\t\t\t\treturn;\t// breakではない\n\n\t\t\tdefault:\t// ルビあり文字列\n\t\t\t\tthis.#needGoTxt = true;\n\t\t\t\tadd_htm = this.#tagCh_sub(ch, ruby, this.#r_align);\n\t\t\t}\n\t\t\tbreak;\n\t\t}\n\t\tthis.#aSpan.push(TxtLayer.#rec(add_htm));\n\t}\n\t#tagCh_sub(ch: string, rb: string, r_align: string): string {\n\t\tconst ht = ch===' ' ?'&nbsp;' :ch==='　' ?'&emsp;' :ch;\n\t\tif (TxtLayer.#val.doRecLog()) {\n\t\t\tthis.#page_text += ht +(rb ?`《${rb}》` :'');\n\t\t\tif (ch !== ' ') this.#page_plain_text += ch;\n\t\t}\n\t\tconst {cl, sty, lnk} = this.#o2domArg(true, null, ch);\n\n\t\tif (rb) return `<span${cl} style='${sty} ${this.#fncFFSStyle(ch)\n\t\t//<ruby style='ruby-position:under;'>\t// 下付ルビ\n\t\t}'><ruby>${\t// 文字個別に出現させるため以下にも ${cl} が必要\n\t\t\tArray.from(ch).map((c, i)=> `<span${cl}${lnk} style='${\n\t\t\t\ti > 0 ?this.#o2domArg(true, null, ch).sty :sty\n\t\t\t} display: inline;'>${\n\t\t\t\tc===' ' ?'&nbsp;' :c==='　' ?'&emsp;' :c\n\t\t\t}</span>`).join('')\n\t\t\t\t// display: inline; がないと[span]区間外のルビが浮く\n\t\t}<rt${lnk}${this.#mkStyle_r_align(ch, rb, r_align,\n\t\t\tthis.#htmRb.style.cssText\t// この並びで上書きされていく\n\t\t\t+ (this.#stkASpan.at(-1)?.o.r_style ?? ''))\n\t\t}>${rb}</rt></ruby></span>`;\t// <span>に入れないと崩れ一文字ずつ出ない\n\n\t\treturn `<span${cl} style='${sty} ${this.#fncFFSStyle(ch)}'${lnk}>${ht}</span>`;\n\t}\n\t#o2domArg(isAddWait: boolean, argWait: number | null, ch = '\\n') {\n\t\tconst wait = this.#ch_in_join ?(argWait\n\t\t\t?? this.#stkASpan.at(0)?.o.wait\t// 親要素\n\t\t\t?? (TxtLayer.#doAutoWc\t// ()は必要\n\t\t\t\t? TxtLayer.#hAutoWc[ch.at(0) ?? ''] ?? 0\n\t\t\t\t: LayerMng.msecChWait)) :0;\n\t\tif (TxtLayer.#evtMng.isSkipping) this.#cumDelay = 0;\n\t//\telse if (isAddWait && this.#ch_in_join) this.#cumDelay += Number(wait)*5;\t// 出現視認テスト用\n\t\telse if (isAddWait && this.#ch_in_join) this.#cumDelay += Number(wait);\n\t\tconst curpos = `data-add='{\"ch_in_style\":\"${this.#$ch_in_style}\", \"ch_out_style\":\"${this.#$ch_out_style}\"}'`;\n\n\t\treturn {\n\t\t\tcl\t: ` class='sn_ch sn_ch_yet sn_ch_in_${this.#$ch_in_style}'`,\t// TxtStage.goTxt()はこれ単位で文字出現させる\n\t\t\tsty\t: `animation-delay: ${this.#cumDelay}ms;${\n\t\t\t\tthis.#stkASpan.at(-1)?.o.style ?? ''\n\t\t\t}`,\t\t// TxtStage.goTxt()はこれ単位で文字出現させる\n\t\t\tlnk\t: (this.#stkASpan.at(0)?.o[':link'] ?? '')+' '+ curpos,\n\t\t\tcurpos,\n\t\t};\n\t}\n\t#cumDelay\t= 0;\n\t#firstCh\t= true;\n\t#aSpan\t\t: string[]\t= [];\n\t#stkASpan\t: {\n\t\to\t\t: {\n\t\t\tstyle?\t\t: string;\n\t\t\tr_style?\t: string;\n\t\t\t':link'?\t: string;\n\t\t\twait?\t\t: number;\n\t\t};\n\t\tr_align\t\t\t: string;\n\t\tch_in_style\t\t: string;\n\t\tch_out_style\t: string;\n\t}[] = [];\n\n\t#pushSpan(o :any) {\n\t\tthis.#stkASpan.push({\n\t\t\to,\n\t\t\tr_align\t\t\t: this.#r_align,\n\t\t\tch_in_style\t\t: this.#$ch_in_style,\n\t\t\tch_out_style\t: this.#$ch_out_style,\n\t\t});\n\t\tif ('r_align' in o) this.#r_align = o.r_align;\n\t\tthis.#set_ch_in(o);\n\t\tthis.#set_ch_out(o);\n\t}\n\t#popSpan() {\n\t\tconst stk = this.#stkASpan.pop();\n\t\tif (! stk) return;\n\n\t\tthis.#r_align = stk.r_align;\n\t\tthis.#set_ch_in({in_style: stk.ch_in_style});\n\t\tthis.#set_ch_out({out_style: stk.ch_out_style});\n\t}\n\t#mergePushSpan(o :any) {\n\t\tconst stk = this.#stkASpan.at(-1);\n\t\tif (! stk) {this.#pushSpan(o); return}\n\n\t\tstk.o = {...stk.o, ...o};\n\t\tif (! o.style && ! o.r_style) {stk.o.style = ''; stk.o.r_style = ''}\n\t\t\t// どちらも指定されてなければクリア\n\t\tif ('r_align' in o) this.#r_align = o.r_align;\n\t\tthis.#set_ch_in(o);\n\t\tthis.#set_ch_out(o);\n\t}\n\n\treadonly click = ()=> {\t// true: 文字出現中だったので、停止する\n\t\tif (! this.ctn.interactiveChildren || ! this.ctn.visible) return false;\n\t\treturn this.#txs.skipChIn();\n\t}\n\n\tclearText(): void {\n\t\tthis.ctn.addChild(this.#txs = this.#txs.reNew());\n\n\t\tthis.#cumDelay = 0;\n\t\tthis.#firstCh = true;\n\t\tthis.#aSpan = [];\n\t\tthis.#page_text = '';\n\t\tthis.#page_plain_text = '';\n\t\tTxtLayer.#recorder.recPagebreak();\n\t}\n\t#page_text\t\t\t= '';\n\t#page_plain_text\t= '';\n\tget pageText() {return this.#page_text.replace('《&emsp;》', '')}\n\tget pagePlainText() {return this.#page_plain_text}\n\n\tget enabled() {return this.ctn.interactiveChildren}\n\tset enabled(e) {this.ctn.interactiveChildren = e}\n\n\treadonly\taddButton = (hArg: HArg)=> new Promise<void>(re=> {\n\t\thArg.key = `btn=[${this.#cntBtn.children.length}] `+ this.name_;\n\t\thArg[':id_tag'] = hArg.key.slice(0, -7);\t// Design用\n\t\targChk_Boolean(hArg, 'hint_tate', this.#txs.tategaki);\t// hint用\n\t\tconst btn = new Button(hArg, TxtLayer.#evtMng, ()=> re(), ()=> this.canFocus());\n\t\tbtn.name = JSON.stringify(hArg).replaceAll('\"', \"'\");// playback時に使用\n\t\tthis.#cntBtn.addChild(btn);\n\t});\n\tcanFocus(): boolean {\n\t\treturn (this.ctn.interactiveChildren ?? false)\n\t\t&& this.ctn.visible\n\t\t&& TxtLayer.#isPageFore(this);\n\t}\n\n\n\toverride clearLay(hArg: HArg): void {\n\t\tsuper.clearLay(hArg);\n\n\t\tthis.clearText();\n\t\t// 上で呼ばれる this.#evtMng.escapeHint();\t// Hintごとdestroyされるのを回避\n\t\tfor (const b of this.#cntBtn.removeChildren()) b.destroy();\n\t}\n\toverride readonly record = ()=> {return <any>{...super.record(),\n\t\tenabled\t: this.enabled,\n\n\t\tr_cssText\t: this.#htmRb.style.cssText,\n\t\tr_align\t\t: this.#r_align,\n\n\t\t// バック\n\t\tb_do\t: (this.#b_do === undefined)\n\t\t\t\t\t? undefined\n\t\t\t\t\t: (this.#b_do instanceof Sprite ?'Sprite' :'Graphics'),\n\t\tb_pic\t: this.#b_pic,\n\t\tb_color\t: this.#b_color,\n\t\tb_alpha\t: this.#b_alpha,\n\t\tb_alpha_isfixed\t: this.#b_alpha_isfixed,\n\n\t\tffs\t\t: this.#ffs,\n\t\ttxs\t\t: this.#txs.record(),\n\t\tstrNoFFS: this.#strNoFFS,\n\n\t\tbtns\t: this.#cntBtn.children.map(b=> b.name),\n\t}};\n\toverride playback(hLay: any, aPrm: Promise<void>[]): void {\n\t\tsuper.playback(hLay, aPrm);\n\n\t\tthis.enabled\t= hLay.enabled;\n\n\t\tthis.#htmRb.style.cssText = hLay.r_cssText;\n\t\tthis.#r_align\t= hLay.r_align;\n\t\tthis.cvsResize();\n\n\t\tthis.#setFfs(hLay);\n\t\tthis.#txs.playback(hLay.txs);\n\t\t// 文字背景サイズは TxtStage を参照するのでこの順で\n\t\tthis.#b_alpha\t\t\t= hLay.b_alpha;\n\t\tthis.#b_alpha_isfixed\t= hLay.b_alpha_isfixed;\n\n\t\taPrm = [\n\t\t\taPrm,\n\t\t\tnew Promise<void>(re=> {\n\t\t\t\tconst h: HArg = (hLay.b_do)\n\t\t\t\t\t? (hLay.b_do === 'Sprite'\n\t\t\t\t\t\t? {b_pic: hLay.b_pic}\n\t\t\t\t\t\t: {b_color: hLay.b_color})\n\t\t\t\t\t: {b_pic: ''};\n\t\t\t\th.b_alpha = hLay.b_alpha;\n\t\t\t\th.b_alpha_isfixed = hLay.b_alpha_isfixed;\n\t\t\t\tif (! this.#drawBack(h, isStop=> {if (isStop) re()})) re();\n\t\t\t}),\n\t\t\t(hLay.btns as string[]).map(b=> new Promise<void>(re=> {\n\t\t\t\tthis.addButton(JSON.parse(b.replaceAll(`'`, '\"'))); re()\n\t\t\t})),\n\t\t].flat();\n\t}\n\n\tget cssText() {return this.#txs.cssText}\n\tset cssText(ct: string) {this.#txs.cssText = ct}\n\n\toverride snapshot(rnd: Renderer, re: ()=> void) {\n\t\trnd.render(this.ctn, {clear: false});\n\t\tthis.#txs.snapshot(rnd, re);\n\t}\n\toverride snapshot_end() {this.#txs.snapshot_end()}\n\n\toverride makeDesignCast(gdc: IMakeDesignCast) {\n\t\tif (! this.ctn.visible) return;\n\t\tthis.#txs.makeDesignCast(gdc);\n\t}\n\toverride makeDesignCastChildren(gdc: IMakeDesignCast) {\n\t\tif (! this.ctn.visible) return;\n\t\tfor (const b of this.#cntBtn.children) b.makeDesignCast(gdc);\n\t}\n\n\toverride showDesignCast() {this.#txs.showDesignCast()}\n\toverride showDesignCastChildren() {\n\t\tfor (const b of this.#cntBtn.children) b.showDesignCast();\n\t}\n\n\toverride dump(): string {\n\t\tthis.#putCh('', 'gotxt｜');\t// バッファの文字を印字してしまう\n\n\t\treturn super.dump() +`, \"enabled\":\"${this.enabled}\", ${this.#txs.dump()\n\t\t}, \"b_pic\":\"${this.#b_pic}\", \"b_color\":\"${this.#b_color\n\t\t}\", \"b_alpha\":${this.#b_alpha}, \"b_alpha_isfixed\":\"${this.#b_alpha_isfixed\n\t\t}\", \"width\":${this.#txs.getWidth}, \"height\":${this.#txs.getHeight\n\t\t}, \"pixi_obj\":[${\n\t\t\tthis.ctn.children.map(e=> `{\"class\":\"${\n\t\t\t\t(e instanceof Sprite) ?'Sprite' :(\n\t\t\t\t\t(e instanceof Graphics) ?'Graphics' :(\n\t\t\t\t\t\t(e instanceof Container) ?'Container' :'?'\n\t\t\t\t\t)\n\t\t\t\t)\n\t\t\t}\", \"name\":\"${e.name}\", \"alpha\":${e.alpha}, \"x\":${e.x}, \"y\":${e.y}, \"visible\":\"${e.visible}\"}`).join(',')\n\t\t}], \"button\":[${\n\t\t\tthis.#cntBtn.children.map(b=> b.children[0]?.name ?? '{}').join(',')\n\t\t}]`;\n\t}\n\n}\n","/* ***** BEGIN LICENSE BLOCK *****\n\tCopyright (c) 2020-2025 Famibee (famibee.blog38.fc2.com)\n\n\tThis software is released under the MIT License.\n\thttp://opensource.org/licenses/mit-license.php\n** ***** END LICENSE BLOCK ***** */\n\nimport {CmnLib} from './CmnLib';\nimport {EventListenerCtn} from './EventListenerCtn';\n\nimport {Container} from 'pixi.js';\n\ninterface IFocusBtn {\n\tbtn\t: Container | HTMLElement;\n\ton\t: ()=> boolean;\n\toff\t: ()=> void;\n};\n\nexport class FocusMng {\n\t#aBtn\t: IFocusBtn[]\t= [];\n\t#idx\t\t\t\t\t= -1;\n\treadonly\t#elc\t\t= new EventListenerCtn;\n\n\tdestroy() {this.#aBtn = []; this.#idx = -1; this.#elc.clear()}\n\n\tadd(cmp: Container | HTMLElement, on: ()=> boolean, off: ()=> void) {\n//console.log(`fn:FocusMng.ts line:62 ADD idx:${this.aBtn.length} local:${(cmp as HTMLElement).localName} type:${(cmp as HTMLInputElement).type} cmp:%o`, cmp);\n\t\t// 重複チェック\n\t\tif (this.#aBtn.findIndex(b=> b.btn === cmp) >= 0) return;\n\t\tif (cmp instanceof Container) {\n\t\t\t// フレーム部品に【 if (btn instanceof HTMLElement) 】が上手く使えない\n\t\t\tcmp.on('pointerdown', ()=> {\n\t\t\t\tfor (let i=this.#aBtn.length -1; i>=0; --i) {\n\t\t\t\t\tif (this.#aBtn[i]!.btn === cmp) {this.#idx = i; return}\n\t\t\t\t}\n\t\t\t\tthis.#idx = -1;\n\t\t\t});\n\n\t\t\tthis.#aBtn.push({btn: cmp, on: on, off: off});\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#elc.add(cmp, 'focus', ()=> {\n\t\t\tfor (let i=this.#aBtn.length -1; i>=0; --i) {\n\t\t\t\tif (this.#aBtn[i]!.btn === cmp) {this.#idx = i; return}\n\t\t\t}\n\t\t\tthis.#idx = -1;\n\t\t});\n\n\t\tlet fnc = (_: KeyboardEvent)=> {};\n\t\tlet fnc4EnterSwitch: (e: KeyboardEvent)=> boolean\n\t\t= (cmp.localName === 'button' || cmp.localName === 'a')\n\t\t\t? e=> ! e.isTrusted && e.key === 'Enter'\n\t\t\t: e=> e.key === 'Enter';\n\t\t\t// Enterで全画面スイッチは切り替わるが画面が全画面化しない対応\n\t\tconst inp = cmp as HTMLInputElement;\n\t\tswitch (inp.type ?? '') {\n\t//\tswitch (btn.getAttribute('type') ?? '') {\t// textareaで''になる\n\t\t\tcase 'checkbox':\tfnc = ()=> inp.checked = ! inp.checked;\tbreak;\n\t\t\tcase '':\n\t\t\t\t// ラジオボタン\n\t\t\t\tif (cmp.querySelectorAll('input[type]').length > 0) {\n\t\t\t\t\tfnc = e=> this.#radio_next(cmp, e.key);\n\t\t\t\t\tfnc4EnterSwitch = ()=> false;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'range':\n\t\t\t\tfnc = e=> {\n\t\t\t\t\tif (e.isTrusted) return;\t// Gamepadのみ処理したい\n\t\t\t\t\tif (e.key === 'ArrowUp') inp.stepUp(); else inp.stepDown();\n\t\t\t\t};\n\t\t\t\tbreak;\n\t\t\tcase 'text':\n\t\t\tcase 'textarea':\n\t\t\t\tfnc = e=> {\n\t\t\t\t\tif (e.isTrusted) return;\t// Gamepadのみ処理したい\n\t\t\t\t\tlet cur = (inp.selectionStart ?? 0)\n\t\t\t\t\t\t+(e.key === 'ArrowUp' ?-1 :1);\n\t\t\t\t\tif (cur < 0) cur = 0;\n\t\t\t\t\tinp.setSelectionRange(cur, cur);\n\t\t\t\t};\n\t\t\t\tbreak;\n\t\t}\n\t\tthis.#elc.add(cmp, 'keydown', (e: KeyboardEvent)=> {\n\t\t\tif (e.key !== 'ArrowUp' && e.key !== 'ArrowDown'\n\t\t\t&& e.key !== 'Enter') return;\n\n\t\t\te.stopPropagation();\n\t\t\te.stopImmediatePropagation();\n\t\t\tif (fnc4EnterSwitch(e)) {\n\t\t\t\tcmp.dispatchEvent(new MouseEvent('click'));\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tfnc(e);\n\t\t}, {passive: true});\n\n\t\t// spanなどでもフォーカスを持つように\n\t\tif (! cmp.hasAttribute('tabindex')) cmp.tabIndex = 0;\n\n\t\tthis.#aBtn.push({btn: cmp, on: on, off: off});\n\t}\n\tremove(cmp: Container | HTMLElement) {\n\t\tconst idx = this.#aBtn.findIndex(b=> b.btn === cmp);\n\t\tif (idx < 0) return;\n\t\tthis.#aBtn.splice(idx, 1);\n\t\tif (this.#aBtn.length === 0) this.#idx = -1;\n\t\telse if (idx <= this.#idx) --this.#idx;\t// -1 でもOK\n\t}\n\t#radio_next(elm: HTMLElement, key: string) {\n\t\tconst op = elm.querySelectorAll('input[type]') as NodeListOf<HTMLInputElement>;\n\t\tconst len = op.length;\n\t\tfor (let i=0; i<len; ++i) {\n\t\t\tif (! op[i]!.checked) continue;\n\n\t\t\top[(i +len +(key === 'ArrowUp' ?-1 :1)) %len]!.checked = true;\n\t\t\tbreak;\n\t\t}\n\t}\n\n\tisFocus(cmp: Container | HTMLElement) {\n\t\tif (this.#idx < 0) return false;\t//  || this.aBtn.length === 0 は略できる\n\t\treturn this.#aBtn[this.#idx]!.btn === cmp;\n\t}\n\n\tprev() {\n\t\tthis.#allOff();\n\t\tconst len = this.#aBtn.length;\n\t\tif (len === 0) return;\n\n\t\tif (--this.#idx < 0) this.#idx = len -1;\n\t\tfor (let i=len; i>=1; --i) {\n\t\t\tconst j = (this.#idx +i) % len;\n\t\t\tif (this.#aBtn[j]!.on()) {this.#idx = j; this.#logFocus(j); return}\n\t\t}\n\t\tthis.#idx = -1;\n\t}\n\tnext() {\n\t\tthis.#allOff();\n\t\tconst len = this.#aBtn.length;\n\t\tif (len === 0) return;\n\n\t\tif (++this.#idx >= len) this.#idx = 0;\n\t\tfor (let i=0; i<len; ++i) {\n\t\t\tconst j = (this.#idx +i) % len;\n\t\t\tif (this.#aBtn[j]!.on()) {this.#idx = j; this.#logFocus(j); return}\n\t\t}\n\t\tthis.#idx = -1;\n\t}\n\treadonly\t#logFocus = CmnLib.debugLog\n\t\t? (i: number)=> console.log(`👾 <FocusMng idx:${i} btn:%o`, this.#aBtn[i]!.btn)\n\t\t: ()=> {};\n\tgetFocus(): Container | HTMLElement | null {\n\t\tif (this.#idx < 0) return null;\n\n\t\tthis.#allOff();\n\t\tif (this.#idx >= this.#aBtn.length) this.#idx = 0;\n\t\tconst b = this.#aBtn[this.#idx]!;\n\t\treturn b.on() ?b.btn : null;\n\t}\n\n\tblur() {this.#allOff(); this.#idx = -1; globalThis.focus()}\n\t#allOff() {\n\t\tfor (let i=this.#aBtn.length -1; i>=0; --i) {\n\t\t\tconst b = this.#aBtn[i]!;\n\t\t\tif (! (b.btn instanceof Container) || b.btn.parent) b.off();\n\t\t\telse this.#aBtn.splice(i, 1);\n\t\t}\n\t}\n\n}\n","export var top = 'top';\nexport var bottom = 'bottom';\nexport var right = 'right';\nexport var left = 'left';\nexport var auto = 'auto';\nexport var basePlacements = [top, bottom, right, left];\nexport var start = 'start';\nexport var end = 'end';\nexport var clippingParents = 'clippingParents';\nexport var viewport = 'viewport';\nexport var popper = 'popper';\nexport var reference = 'reference';\nexport var variationPlacements = /*#__PURE__*/basePlacements.reduce(function (acc, placement) {\n  return acc.concat([placement + \"-\" + start, placement + \"-\" + end]);\n}, []);\nexport var placements = /*#__PURE__*/[].concat(basePlacements, [auto]).reduce(function (acc, placement) {\n  return acc.concat([placement, placement + \"-\" + start, placement + \"-\" + end]);\n}, []); // modifiers that need to read the DOM\n\nexport var beforeRead = 'beforeRead';\nexport var read = 'read';\nexport var afterRead = 'afterRead'; // pure-logic modifiers\n\nexport var beforeMain = 'beforeMain';\nexport var main = 'main';\nexport var afterMain = 'afterMain'; // modifier with the purpose to write to the DOM (or write into a framework state)\n\nexport var beforeWrite = 'beforeWrite';\nexport var write = 'write';\nexport var afterWrite = 'afterWrite';\nexport var modifierPhases = [beforeRead, read, afterRead, beforeMain, main, afterMain, beforeWrite, write, afterWrite];","export default function getNodeName(element) {\n  return element ? (element.nodeName || '').toLowerCase() : null;\n}","export default function getWindow(node) {\n  if (node == null) {\n    return window;\n  }\n\n  if (node.toString() !== '[object Window]') {\n    var ownerDocument = node.ownerDocument;\n    return ownerDocument ? ownerDocument.defaultView || window : window;\n  }\n\n  return node;\n}","import getWindow from \"./getWindow.js\";\n\nfunction isElement(node) {\n  var OwnElement = getWindow(node).Element;\n  return node instanceof OwnElement || node instanceof Element;\n}\n\nfunction isHTMLElement(node) {\n  var OwnElement = getWindow(node).HTMLElement;\n  return node instanceof OwnElement || node instanceof HTMLElement;\n}\n\nfunction isShadowRoot(node) {\n  // IE 11 has no ShadowRoot\n  if (typeof ShadowRoot === 'undefined') {\n    return false;\n  }\n\n  var OwnElement = getWindow(node).ShadowRoot;\n  return node instanceof OwnElement || node instanceof ShadowRoot;\n}\n\nexport { isElement, isHTMLElement, isShadowRoot };","import getNodeName from \"../dom-utils/getNodeName.js\";\nimport { isHTMLElement } from \"../dom-utils/instanceOf.js\"; // This modifier takes the styles prepared by the `computeStyles` modifier\n// and applies them to the HTMLElements such as popper and arrow\n\nfunction applyStyles(_ref) {\n  var state = _ref.state;\n  Object.keys(state.elements).forEach(function (name) {\n    var style = state.styles[name] || {};\n    var attributes = state.attributes[name] || {};\n    var element = state.elements[name]; // arrow is optional + virtual elements\n\n    if (!isHTMLElement(element) || !getNodeName(element)) {\n      return;\n    } // Flow doesn't support to extend this property, but it's the most\n    // effective way to apply styles to an HTMLElement\n    // $FlowFixMe[cannot-write]\n\n\n    Object.assign(element.style, style);\n    Object.keys(attributes).forEach(function (name) {\n      var value = attributes[name];\n\n      if (value === false) {\n        element.removeAttribute(name);\n      } else {\n        element.setAttribute(name, value === true ? '' : value);\n      }\n    });\n  });\n}\n\nfunction effect(_ref2) {\n  var state = _ref2.state;\n  var initialStyles = {\n    popper: {\n      position: state.options.strategy,\n      left: '0',\n      top: '0',\n      margin: '0'\n    },\n    arrow: {\n      position: 'absolute'\n    },\n    reference: {}\n  };\n  Object.assign(state.elements.popper.style, initialStyles.popper);\n  state.styles = initialStyles;\n\n  if (state.elements.arrow) {\n    Object.assign(state.elements.arrow.style, initialStyles.arrow);\n  }\n\n  return function () {\n    Object.keys(state.elements).forEach(function (name) {\n      var element = state.elements[name];\n      var attributes = state.attributes[name] || {};\n      var styleProperties = Object.keys(state.styles.hasOwnProperty(name) ? state.styles[name] : initialStyles[name]); // Set all values to an empty string to unset them\n\n      var style = styleProperties.reduce(function (style, property) {\n        style[property] = '';\n        return style;\n      }, {}); // arrow is optional + virtual elements\n\n      if (!isHTMLElement(element) || !getNodeName(element)) {\n        return;\n      }\n\n      Object.assign(element.style, style);\n      Object.keys(attributes).forEach(function (attribute) {\n        element.removeAttribute(attribute);\n      });\n    });\n  };\n} // eslint-disable-next-line import/no-unused-modules\n\n\nexport default {\n  name: 'applyStyles',\n  enabled: true,\n  phase: 'write',\n  fn: applyStyles,\n  effect: effect,\n  requires: ['computeStyles']\n};","import { auto } from \"../enums.js\";\nexport default function getBasePlacement(placement) {\n  return placement.split('-')[0];\n}","export var max = Math.max;\nexport var min = Math.min;\nexport var round = Math.round;","export default function getUAString() {\n  var uaData = navigator.userAgentData;\n\n  if (uaData != null && uaData.brands && Array.isArray(uaData.brands)) {\n    return uaData.brands.map(function (item) {\n      return item.brand + \"/\" + item.version;\n    }).join(' ');\n  }\n\n  return navigator.userAgent;\n}","import getUAString from \"../utils/userAgent.js\";\nexport default function isLayoutViewport() {\n  return !/^((?!chrome|android).)*safari/i.test(getUAString());\n}","import { isElement, isHTMLElement } from \"./instanceOf.js\";\nimport { round } from \"../utils/math.js\";\nimport getWindow from \"./getWindow.js\";\nimport isLayoutViewport from \"./isLayoutViewport.js\";\nexport default function getBoundingClientRect(element, includeScale, isFixedStrategy) {\n  if (includeScale === void 0) {\n    includeScale = false;\n  }\n\n  if (isFixedStrategy === void 0) {\n    isFixedStrategy = false;\n  }\n\n  var clientRect = element.getBoundingClientRect();\n  var scaleX = 1;\n  var scaleY = 1;\n\n  if (includeScale && isHTMLElement(element)) {\n    scaleX = element.offsetWidth > 0 ? round(clientRect.width) / element.offsetWidth || 1 : 1;\n    scaleY = element.offsetHeight > 0 ? round(clientRect.height) / element.offsetHeight || 1 : 1;\n  }\n\n  var _ref = isElement(element) ? getWindow(element) : window,\n      visualViewport = _ref.visualViewport;\n\n  var addVisualOffsets = !isLayoutViewport() && isFixedStrategy;\n  var x = (clientRect.left + (addVisualOffsets && visualViewport ? visualViewport.offsetLeft : 0)) / scaleX;\n  var y = (clientRect.top + (addVisualOffsets && visualViewport ? visualViewport.offsetTop : 0)) / scaleY;\n  var width = clientRect.width / scaleX;\n  var height = clientRect.height / scaleY;\n  return {\n    width: width,\n    height: height,\n    top: y,\n    right: x + width,\n    bottom: y + height,\n    left: x,\n    x: x,\n    y: y\n  };\n}","import getBoundingClientRect from \"./getBoundingClientRect.js\"; // Returns the layout rect of an element relative to its offsetParent. Layout\n// means it doesn't take into account transforms.\n\nexport default function getLayoutRect(element) {\n  var clientRect = getBoundingClientRect(element); // Use the clientRect sizes if it's not been transformed.\n  // Fixes https://github.com/popperjs/popper-core/issues/1223\n\n  var width = element.offsetWidth;\n  var height = element.offsetHeight;\n\n  if (Math.abs(clientRect.width - width) <= 1) {\n    width = clientRect.width;\n  }\n\n  if (Math.abs(clientRect.height - height) <= 1) {\n    height = clientRect.height;\n  }\n\n  return {\n    x: element.offsetLeft,\n    y: element.offsetTop,\n    width: width,\n    height: height\n  };\n}","import { isShadowRoot } from \"./instanceOf.js\";\nexport default function contains(parent, child) {\n  var rootNode = child.getRootNode && child.getRootNode(); // First, attempt with faster native method\n\n  if (parent.contains(child)) {\n    return true;\n  } // then fallback to custom implementation with Shadow DOM support\n  else if (rootNode && isShadowRoot(rootNode)) {\n      var next = child;\n\n      do {\n        if (next && parent.isSameNode(next)) {\n          return true;\n        } // $FlowFixMe[prop-missing]: need a better way to handle this...\n\n\n        next = next.parentNode || next.host;\n      } while (next);\n    } // Give up, the result is false\n\n\n  return false;\n}","import getWindow from \"./getWindow.js\";\nexport default function getComputedStyle(element) {\n  return getWindow(element).getComputedStyle(element);\n}","import getNodeName from \"./getNodeName.js\";\nexport default function isTableElement(element) {\n  return ['table', 'td', 'th'].indexOf(getNodeName(element)) >= 0;\n}","import { isElement } from \"./instanceOf.js\";\nexport default function getDocumentElement(element) {\n  // $FlowFixMe[incompatible-return]: assume body is always available\n  return ((isElement(element) ? element.ownerDocument : // $FlowFixMe[prop-missing]\n  element.document) || window.document).documentElement;\n}","import getNodeName from \"./getNodeName.js\";\nimport getDocumentElement from \"./getDocumentElement.js\";\nimport { isShadowRoot } from \"./instanceOf.js\";\nexport default function getParentNode(element) {\n  if (getNodeName(element) === 'html') {\n    return element;\n  }\n\n  return (// this is a quicker (but less type safe) way to save quite some bytes from the bundle\n    // $FlowFixMe[incompatible-return]\n    // $FlowFixMe[prop-missing]\n    element.assignedSlot || // step into the shadow DOM of the parent of a slotted node\n    element.parentNode || ( // DOM Element detected\n    isShadowRoot(element) ? element.host : null) || // ShadowRoot detected\n    // $FlowFixMe[incompatible-call]: HTMLElement is a Node\n    getDocumentElement(element) // fallback\n\n  );\n}","import getWindow from \"./getWindow.js\";\nimport getNodeName from \"./getNodeName.js\";\nimport getComputedStyle from \"./getComputedStyle.js\";\nimport { isHTMLElement, isShadowRoot } from \"./instanceOf.js\";\nimport isTableElement from \"./isTableElement.js\";\nimport getParentNode from \"./getParentNode.js\";\nimport getUAString from \"../utils/userAgent.js\";\n\nfunction getTrueOffsetParent(element) {\n  if (!isHTMLElement(element) || // https://github.com/popperjs/popper-core/issues/837\n  getComputedStyle(element).position === 'fixed') {\n    return null;\n  }\n\n  return element.offsetParent;\n} // `.offsetParent` reports `null` for fixed elements, while absolute elements\n// return the containing block\n\n\nfunction getContainingBlock(element) {\n  var isFirefox = /firefox/i.test(getUAString());\n  var isIE = /Trident/i.test(getUAString());\n\n  if (isIE && isHTMLElement(element)) {\n    // In IE 9, 10 and 11 fixed elements containing block is always established by the viewport\n    var elementCss = getComputedStyle(element);\n\n    if (elementCss.position === 'fixed') {\n      return null;\n    }\n  }\n\n  var currentNode = getParentNode(element);\n\n  if (isShadowRoot(currentNode)) {\n    currentNode = currentNode.host;\n  }\n\n  while (isHTMLElement(currentNode) && ['html', 'body'].indexOf(getNodeName(currentNode)) < 0) {\n    var css = getComputedStyle(currentNode); // This is non-exhaustive but covers the most common CSS properties that\n    // create a containing block.\n    // https://developer.mozilla.org/en-US/docs/Web/CSS/Containing_block#identifying_the_containing_block\n\n    if (css.transform !== 'none' || css.perspective !== 'none' || css.contain === 'paint' || ['transform', 'perspective'].indexOf(css.willChange) !== -1 || isFirefox && css.willChange === 'filter' || isFirefox && css.filter && css.filter !== 'none') {\n      return currentNode;\n    } else {\n      currentNode = currentNode.parentNode;\n    }\n  }\n\n  return null;\n} // Gets the closest ancestor positioned element. Handles some edge cases,\n// such as table ancestors and cross browser bugs.\n\n\nexport default function getOffsetParent(element) {\n  var window = getWindow(element);\n  var offsetParent = getTrueOffsetParent(element);\n\n  while (offsetParent && isTableElement(offsetParent) && getComputedStyle(offsetParent).position === 'static') {\n    offsetParent = getTrueOffsetParent(offsetParent);\n  }\n\n  if (offsetParent && (getNodeName(offsetParent) === 'html' || getNodeName(offsetParent) === 'body' && getComputedStyle(offsetParent).position === 'static')) {\n    return window;\n  }\n\n  return offsetParent || getContainingBlock(element) || window;\n}","export default function getMainAxisFromPlacement(placement) {\n  return ['top', 'bottom'].indexOf(placement) >= 0 ? 'x' : 'y';\n}","import { max as mathMax, min as mathMin } from \"./math.js\";\nexport function within(min, value, max) {\n  return mathMax(min, mathMin(value, max));\n}\nexport function withinMaxClamp(min, value, max) {\n  var v = within(min, value, max);\n  return v > max ? max : v;\n}","export default function getFreshSideObject() {\n  return {\n    top: 0,\n    right: 0,\n    bottom: 0,\n    left: 0\n  };\n}","import getFreshSideObject from \"./getFreshSideObject.js\";\nexport default function mergePaddingObject(paddingObject) {\n  return Object.assign({}, getFreshSideObject(), paddingObject);\n}","export default function expandToHashMap(value, keys) {\n  return keys.reduce(function (hashMap, key) {\n    hashMap[key] = value;\n    return hashMap;\n  }, {});\n}","import getBasePlacement from \"../utils/getBasePlacement.js\";\nimport getLayoutRect from \"../dom-utils/getLayoutRect.js\";\nimport contains from \"../dom-utils/contains.js\";\nimport getOffsetParent from \"../dom-utils/getOffsetParent.js\";\nimport getMainAxisFromPlacement from \"../utils/getMainAxisFromPlacement.js\";\nimport { within } from \"../utils/within.js\";\nimport mergePaddingObject from \"../utils/mergePaddingObject.js\";\nimport expandToHashMap from \"../utils/expandToHashMap.js\";\nimport { left, right, basePlacements, top, bottom } from \"../enums.js\"; // eslint-disable-next-line import/no-unused-modules\n\nvar toPaddingObject = function toPaddingObject(padding, state) {\n  padding = typeof padding === 'function' ? padding(Object.assign({}, state.rects, {\n    placement: state.placement\n  })) : padding;\n  return mergePaddingObject(typeof padding !== 'number' ? padding : expandToHashMap(padding, basePlacements));\n};\n\nfunction arrow(_ref) {\n  var _state$modifiersData$;\n\n  var state = _ref.state,\n      name = _ref.name,\n      options = _ref.options;\n  var arrowElement = state.elements.arrow;\n  var popperOffsets = state.modifiersData.popperOffsets;\n  var basePlacement = getBasePlacement(state.placement);\n  var axis = getMainAxisFromPlacement(basePlacement);\n  var isVertical = [left, right].indexOf(basePlacement) >= 0;\n  var len = isVertical ? 'height' : 'width';\n\n  if (!arrowElement || !popperOffsets) {\n    return;\n  }\n\n  var paddingObject = toPaddingObject(options.padding, state);\n  var arrowRect = getLayoutRect(arrowElement);\n  var minProp = axis === 'y' ? top : left;\n  var maxProp = axis === 'y' ? bottom : right;\n  var endDiff = state.rects.reference[len] + state.rects.reference[axis] - popperOffsets[axis] - state.rects.popper[len];\n  var startDiff = popperOffsets[axis] - state.rects.reference[axis];\n  var arrowOffsetParent = getOffsetParent(arrowElement);\n  var clientSize = arrowOffsetParent ? axis === 'y' ? arrowOffsetParent.clientHeight || 0 : arrowOffsetParent.clientWidth || 0 : 0;\n  var centerToReference = endDiff / 2 - startDiff / 2; // Make sure the arrow doesn't overflow the popper if the center point is\n  // outside of the popper bounds\n\n  var min = paddingObject[minProp];\n  var max = clientSize - arrowRect[len] - paddingObject[maxProp];\n  var center = clientSize / 2 - arrowRect[len] / 2 + centerToReference;\n  var offset = within(min, center, max); // Prevents breaking syntax highlighting...\n\n  var axisProp = axis;\n  state.modifiersData[name] = (_state$modifiersData$ = {}, _state$modifiersData$[axisProp] = offset, _state$modifiersData$.centerOffset = offset - center, _state$modifiersData$);\n}\n\nfunction effect(_ref2) {\n  var state = _ref2.state,\n      options = _ref2.options;\n  var _options$element = options.element,\n      arrowElement = _options$element === void 0 ? '[data-popper-arrow]' : _options$element;\n\n  if (arrowElement == null) {\n    return;\n  } // CSS selector\n\n\n  if (typeof arrowElement === 'string') {\n    arrowElement = state.elements.popper.querySelector(arrowElement);\n\n    if (!arrowElement) {\n      return;\n    }\n  }\n\n  if (!contains(state.elements.popper, arrowElement)) {\n    return;\n  }\n\n  state.elements.arrow = arrowElement;\n} // eslint-disable-next-line import/no-unused-modules\n\n\nexport default {\n  name: 'arrow',\n  enabled: true,\n  phase: 'main',\n  fn: arrow,\n  effect: effect,\n  requires: ['popperOffsets'],\n  requiresIfExists: ['preventOverflow']\n};","export default function getVariation(placement) {\n  return placement.split('-')[1];\n}","import { top, left, right, bottom, end } from \"../enums.js\";\nimport getOffsetParent from \"../dom-utils/getOffsetParent.js\";\nimport getWindow from \"../dom-utils/getWindow.js\";\nimport getDocumentElement from \"../dom-utils/getDocumentElement.js\";\nimport getComputedStyle from \"../dom-utils/getComputedStyle.js\";\nimport getBasePlacement from \"../utils/getBasePlacement.js\";\nimport getVariation from \"../utils/getVariation.js\";\nimport { round } from \"../utils/math.js\"; // eslint-disable-next-line import/no-unused-modules\n\nvar unsetSides = {\n  top: 'auto',\n  right: 'auto',\n  bottom: 'auto',\n  left: 'auto'\n}; // Round the offsets to the nearest suitable subpixel based on the DPR.\n// Zooming can change the DPR, but it seems to report a value that will\n// cleanly divide the values into the appropriate subpixels.\n\nfunction roundOffsetsByDPR(_ref, win) {\n  var x = _ref.x,\n      y = _ref.y;\n  var dpr = win.devicePixelRatio || 1;\n  return {\n    x: round(x * dpr) / dpr || 0,\n    y: round(y * dpr) / dpr || 0\n  };\n}\n\nexport function mapToStyles(_ref2) {\n  var _Object$assign2;\n\n  var popper = _ref2.popper,\n      popperRect = _ref2.popperRect,\n      placement = _ref2.placement,\n      variation = _ref2.variation,\n      offsets = _ref2.offsets,\n      position = _ref2.position,\n      gpuAcceleration = _ref2.gpuAcceleration,\n      adaptive = _ref2.adaptive,\n      roundOffsets = _ref2.roundOffsets,\n      isFixed = _ref2.isFixed;\n  var _offsets$x = offsets.x,\n      x = _offsets$x === void 0 ? 0 : _offsets$x,\n      _offsets$y = offsets.y,\n      y = _offsets$y === void 0 ? 0 : _offsets$y;\n\n  var _ref3 = typeof roundOffsets === 'function' ? roundOffsets({\n    x: x,\n    y: y\n  }) : {\n    x: x,\n    y: y\n  };\n\n  x = _ref3.x;\n  y = _ref3.y;\n  var hasX = offsets.hasOwnProperty('x');\n  var hasY = offsets.hasOwnProperty('y');\n  var sideX = left;\n  var sideY = top;\n  var win = window;\n\n  if (adaptive) {\n    var offsetParent = getOffsetParent(popper);\n    var heightProp = 'clientHeight';\n    var widthProp = 'clientWidth';\n\n    if (offsetParent === getWindow(popper)) {\n      offsetParent = getDocumentElement(popper);\n\n      if (getComputedStyle(offsetParent).position !== 'static' && position === 'absolute') {\n        heightProp = 'scrollHeight';\n        widthProp = 'scrollWidth';\n      }\n    } // $FlowFixMe[incompatible-cast]: force type refinement, we compare offsetParent with window above, but Flow doesn't detect it\n\n\n    offsetParent = offsetParent;\n\n    if (placement === top || (placement === left || placement === right) && variation === end) {\n      sideY = bottom;\n      var offsetY = isFixed && offsetParent === win && win.visualViewport ? win.visualViewport.height : // $FlowFixMe[prop-missing]\n      offsetParent[heightProp];\n      y -= offsetY - popperRect.height;\n      y *= gpuAcceleration ? 1 : -1;\n    }\n\n    if (placement === left || (placement === top || placement === bottom) && variation === end) {\n      sideX = right;\n      var offsetX = isFixed && offsetParent === win && win.visualViewport ? win.visualViewport.width : // $FlowFixMe[prop-missing]\n      offsetParent[widthProp];\n      x -= offsetX - popperRect.width;\n      x *= gpuAcceleration ? 1 : -1;\n    }\n  }\n\n  var commonStyles = Object.assign({\n    position: position\n  }, adaptive && unsetSides);\n\n  var _ref4 = roundOffsets === true ? roundOffsetsByDPR({\n    x: x,\n    y: y\n  }, getWindow(popper)) : {\n    x: x,\n    y: y\n  };\n\n  x = _ref4.x;\n  y = _ref4.y;\n\n  if (gpuAcceleration) {\n    var _Object$assign;\n\n    return Object.assign({}, commonStyles, (_Object$assign = {}, _Object$assign[sideY] = hasY ? '0' : '', _Object$assign[sideX] = hasX ? '0' : '', _Object$assign.transform = (win.devicePixelRatio || 1) <= 1 ? \"translate(\" + x + \"px, \" + y + \"px)\" : \"translate3d(\" + x + \"px, \" + y + \"px, 0)\", _Object$assign));\n  }\n\n  return Object.assign({}, commonStyles, (_Object$assign2 = {}, _Object$assign2[sideY] = hasY ? y + \"px\" : '', _Object$assign2[sideX] = hasX ? x + \"px\" : '', _Object$assign2.transform = '', _Object$assign2));\n}\n\nfunction computeStyles(_ref5) {\n  var state = _ref5.state,\n      options = _ref5.options;\n  var _options$gpuAccelerat = options.gpuAcceleration,\n      gpuAcceleration = _options$gpuAccelerat === void 0 ? true : _options$gpuAccelerat,\n      _options$adaptive = options.adaptive,\n      adaptive = _options$adaptive === void 0 ? true : _options$adaptive,\n      _options$roundOffsets = options.roundOffsets,\n      roundOffsets = _options$roundOffsets === void 0 ? true : _options$roundOffsets;\n  var commonStyles = {\n    placement: getBasePlacement(state.placement),\n    variation: getVariation(state.placement),\n    popper: state.elements.popper,\n    popperRect: state.rects.popper,\n    gpuAcceleration: gpuAcceleration,\n    isFixed: state.options.strategy === 'fixed'\n  };\n\n  if (state.modifiersData.popperOffsets != null) {\n    state.styles.popper = Object.assign({}, state.styles.popper, mapToStyles(Object.assign({}, commonStyles, {\n      offsets: state.modifiersData.popperOffsets,\n      position: state.options.strategy,\n      adaptive: adaptive,\n      roundOffsets: roundOffsets\n    })));\n  }\n\n  if (state.modifiersData.arrow != null) {\n    state.styles.arrow = Object.assign({}, state.styles.arrow, mapToStyles(Object.assign({}, commonStyles, {\n      offsets: state.modifiersData.arrow,\n      position: 'absolute',\n      adaptive: false,\n      roundOffsets: roundOffsets\n    })));\n  }\n\n  state.attributes.popper = Object.assign({}, state.attributes.popper, {\n    'data-popper-placement': state.placement\n  });\n} // eslint-disable-next-line import/no-unused-modules\n\n\nexport default {\n  name: 'computeStyles',\n  enabled: true,\n  phase: 'beforeWrite',\n  fn: computeStyles,\n  data: {}\n};","import getWindow from \"../dom-utils/getWindow.js\"; // eslint-disable-next-line import/no-unused-modules\n\nvar passive = {\n  passive: true\n};\n\nfunction effect(_ref) {\n  var state = _ref.state,\n      instance = _ref.instance,\n      options = _ref.options;\n  var _options$scroll = options.scroll,\n      scroll = _options$scroll === void 0 ? true : _options$scroll,\n      _options$resize = options.resize,\n      resize = _options$resize === void 0 ? true : _options$resize;\n  var window = getWindow(state.elements.popper);\n  var scrollParents = [].concat(state.scrollParents.reference, state.scrollParents.popper);\n\n  if (scroll) {\n    scrollParents.forEach(function (scrollParent) {\n      scrollParent.addEventListener('scroll', instance.update, passive);\n    });\n  }\n\n  if (resize) {\n    window.addEventListener('resize', instance.update, passive);\n  }\n\n  return function () {\n    if (scroll) {\n      scrollParents.forEach(function (scrollParent) {\n        scrollParent.removeEventListener('scroll', instance.update, passive);\n      });\n    }\n\n    if (resize) {\n      window.removeEventListener('resize', instance.update, passive);\n    }\n  };\n} // eslint-disable-next-line import/no-unused-modules\n\n\nexport default {\n  name: 'eventListeners',\n  enabled: true,\n  phase: 'write',\n  fn: function fn() {},\n  effect: effect,\n  data: {}\n};","var hash = {\n  left: 'right',\n  right: 'left',\n  bottom: 'top',\n  top: 'bottom'\n};\nexport default function getOppositePlacement(placement) {\n  return placement.replace(/left|right|bottom|top/g, function (matched) {\n    return hash[matched];\n  });\n}","var hash = {\n  start: 'end',\n  end: 'start'\n};\nexport default function getOppositeVariationPlacement(placement) {\n  return placement.replace(/start|end/g, function (matched) {\n    return hash[matched];\n  });\n}","import getWindow from \"./getWindow.js\";\nexport default function getWindowScroll(node) {\n  var win = getWindow(node);\n  var scrollLeft = win.pageXOffset;\n  var scrollTop = win.pageYOffset;\n  return {\n    scrollLeft: scrollLeft,\n    scrollTop: scrollTop\n  };\n}","import getBoundingClientRect from \"./getBoundingClientRect.js\";\nimport getDocumentElement from \"./getDocumentElement.js\";\nimport getWindowScroll from \"./getWindowScroll.js\";\nexport default function getWindowScrollBarX(element) {\n  // If <html> has a CSS width greater than the viewport, then this will be\n  // incorrect for RTL.\n  // Popper 1 is broken in this case and never had a bug report so let's assume\n  // it's not an issue. I don't think anyone ever specifies width on <html>\n  // anyway.\n  // Browsers where the left scrollbar doesn't cause an issue report `0` for\n  // this (e.g. Edge 2019, IE11, Safari)\n  return getBoundingClientRect(getDocumentElement(element)).left + getWindowScroll(element).scrollLeft;\n}","import getWindow from \"./getWindow.js\";\nimport getDocumentElement from \"./getDocumentElement.js\";\nimport getWindowScrollBarX from \"./getWindowScrollBarX.js\";\nimport isLayoutViewport from \"./isLayoutViewport.js\";\nexport default function getViewportRect(element, strategy) {\n  var win = getWindow(element);\n  var html = getDocumentElement(element);\n  var visualViewport = win.visualViewport;\n  var width = html.clientWidth;\n  var height = html.clientHeight;\n  var x = 0;\n  var y = 0;\n\n  if (visualViewport) {\n    width = visualViewport.width;\n    height = visualViewport.height;\n    var layoutViewport = isLayoutViewport();\n\n    if (layoutViewport || !layoutViewport && strategy === 'fixed') {\n      x = visualViewport.offsetLeft;\n      y = visualViewport.offsetTop;\n    }\n  }\n\n  return {\n    width: width,\n    height: height,\n    x: x + getWindowScrollBarX(element),\n    y: y\n  };\n}","import getDocumentElement from \"./getDocumentElement.js\";\nimport getComputedStyle from \"./getComputedStyle.js\";\nimport getWindowScrollBarX from \"./getWindowScrollBarX.js\";\nimport getWindowScroll from \"./getWindowScroll.js\";\nimport { max } from \"../utils/math.js\"; // Gets the entire size of the scrollable document area, even extending outside\n// of the `<html>` and `<body>` rect bounds if horizontally scrollable\n\nexport default function getDocumentRect(element) {\n  var _element$ownerDocumen;\n\n  var html = getDocumentElement(element);\n  var winScroll = getWindowScroll(element);\n  var body = (_element$ownerDocumen = element.ownerDocument) == null ? void 0 : _element$ownerDocumen.body;\n  var width = max(html.scrollWidth, html.clientWidth, body ? body.scrollWidth : 0, body ? body.clientWidth : 0);\n  var height = max(html.scrollHeight, html.clientHeight, body ? body.scrollHeight : 0, body ? body.clientHeight : 0);\n  var x = -winScroll.scrollLeft + getWindowScrollBarX(element);\n  var y = -winScroll.scrollTop;\n\n  if (getComputedStyle(body || html).direction === 'rtl') {\n    x += max(html.clientWidth, body ? body.clientWidth : 0) - width;\n  }\n\n  return {\n    width: width,\n    height: height,\n    x: x,\n    y: y\n  };\n}","import getComputedStyle from \"./getComputedStyle.js\";\nexport default function isScrollParent(element) {\n  // Firefox wants us to check `-x` and `-y` variations as well\n  var _getComputedStyle = getComputedStyle(element),\n      overflow = _getComputedStyle.overflow,\n      overflowX = _getComputedStyle.overflowX,\n      overflowY = _getComputedStyle.overflowY;\n\n  return /auto|scroll|overlay|hidden/.test(overflow + overflowY + overflowX);\n}","import getParentNode from \"./getParentNode.js\";\nimport isScrollParent from \"./isScrollParent.js\";\nimport getNodeName from \"./getNodeName.js\";\nimport { isHTMLElement } from \"./instanceOf.js\";\nexport default function getScrollParent(node) {\n  if (['html', 'body', '#document'].indexOf(getNodeName(node)) >= 0) {\n    // $FlowFixMe[incompatible-return]: assume body is always available\n    return node.ownerDocument.body;\n  }\n\n  if (isHTMLElement(node) && isScrollParent(node)) {\n    return node;\n  }\n\n  return getScrollParent(getParentNode(node));\n}","import getScrollParent from \"./getScrollParent.js\";\nimport getParentNode from \"./getParentNode.js\";\nimport getWindow from \"./getWindow.js\";\nimport isScrollParent from \"./isScrollParent.js\";\n/*\ngiven a DOM element, return the list of all scroll parents, up the list of ancesors\nuntil we get to the top window object. This list is what we attach scroll listeners\nto, because if any of these parent elements scroll, we'll need to re-calculate the\nreference element's position.\n*/\n\nexport default function listScrollParents(element, list) {\n  var _element$ownerDocumen;\n\n  if (list === void 0) {\n    list = [];\n  }\n\n  var scrollParent = getScrollParent(element);\n  var isBody = scrollParent === ((_element$ownerDocumen = element.ownerDocument) == null ? void 0 : _element$ownerDocumen.body);\n  var win = getWindow(scrollParent);\n  var target = isBody ? [win].concat(win.visualViewport || [], isScrollParent(scrollParent) ? scrollParent : []) : scrollParent;\n  var updatedList = list.concat(target);\n  return isBody ? updatedList : // $FlowFixMe[incompatible-call]: isBody tells us target will be an HTMLElement here\n  updatedList.concat(listScrollParents(getParentNode(target)));\n}","export default function rectToClientRect(rect) {\n  return Object.assign({}, rect, {\n    left: rect.x,\n    top: rect.y,\n    right: rect.x + rect.width,\n    bottom: rect.y + rect.height\n  });\n}","import { viewport } from \"../enums.js\";\nimport getViewportRect from \"./getViewportRect.js\";\nimport getDocumentRect from \"./getDocumentRect.js\";\nimport listScrollParents from \"./listScrollParents.js\";\nimport getOffsetParent from \"./getOffsetParent.js\";\nimport getDocumentElement from \"./getDocumentElement.js\";\nimport getComputedStyle from \"./getComputedStyle.js\";\nimport { isElement, isHTMLElement } from \"./instanceOf.js\";\nimport getBoundingClientRect from \"./getBoundingClientRect.js\";\nimport getParentNode from \"./getParentNode.js\";\nimport contains from \"./contains.js\";\nimport getNodeName from \"./getNodeName.js\";\nimport rectToClientRect from \"../utils/rectToClientRect.js\";\nimport { max, min } from \"../utils/math.js\";\n\nfunction getInnerBoundingClientRect(element, strategy) {\n  var rect = getBoundingClientRect(element, false, strategy === 'fixed');\n  rect.top = rect.top + element.clientTop;\n  rect.left = rect.left + element.clientLeft;\n  rect.bottom = rect.top + element.clientHeight;\n  rect.right = rect.left + element.clientWidth;\n  rect.width = element.clientWidth;\n  rect.height = element.clientHeight;\n  rect.x = rect.left;\n  rect.y = rect.top;\n  return rect;\n}\n\nfunction getClientRectFromMixedType(element, clippingParent, strategy) {\n  return clippingParent === viewport ? rectToClientRect(getViewportRect(element, strategy)) : isElement(clippingParent) ? getInnerBoundingClientRect(clippingParent, strategy) : rectToClientRect(getDocumentRect(getDocumentElement(element)));\n} // A \"clipping parent\" is an overflowable container with the characteristic of\n// clipping (or hiding) overflowing elements with a position different from\n// `initial`\n\n\nfunction getClippingParents(element) {\n  var clippingParents = listScrollParents(getParentNode(element));\n  var canEscapeClipping = ['absolute', 'fixed'].indexOf(getComputedStyle(element).position) >= 0;\n  var clipperElement = canEscapeClipping && isHTMLElement(element) ? getOffsetParent(element) : element;\n\n  if (!isElement(clipperElement)) {\n    return [];\n  } // $FlowFixMe[incompatible-return]: https://github.com/facebook/flow/issues/1414\n\n\n  return clippingParents.filter(function (clippingParent) {\n    return isElement(clippingParent) && contains(clippingParent, clipperElement) && getNodeName(clippingParent) !== 'body';\n  });\n} // Gets the maximum area that the element is visible in due to any number of\n// clipping parents\n\n\nexport default function getClippingRect(element, boundary, rootBoundary, strategy) {\n  var mainClippingParents = boundary === 'clippingParents' ? getClippingParents(element) : [].concat(boundary);\n  var clippingParents = [].concat(mainClippingParents, [rootBoundary]);\n  var firstClippingParent = clippingParents[0];\n  var clippingRect = clippingParents.reduce(function (accRect, clippingParent) {\n    var rect = getClientRectFromMixedType(element, clippingParent, strategy);\n    accRect.top = max(rect.top, accRect.top);\n    accRect.right = min(rect.right, accRect.right);\n    accRect.bottom = min(rect.bottom, accRect.bottom);\n    accRect.left = max(rect.left, accRect.left);\n    return accRect;\n  }, getClientRectFromMixedType(element, firstClippingParent, strategy));\n  clippingRect.width = clippingRect.right - clippingRect.left;\n  clippingRect.height = clippingRect.bottom - clippingRect.top;\n  clippingRect.x = clippingRect.left;\n  clippingRect.y = clippingRect.top;\n  return clippingRect;\n}","import getBasePlacement from \"./getBasePlacement.js\";\nimport getVariation from \"./getVariation.js\";\nimport getMainAxisFromPlacement from \"./getMainAxisFromPlacement.js\";\nimport { top, right, bottom, left, start, end } from \"../enums.js\";\nexport default function computeOffsets(_ref) {\n  var reference = _ref.reference,\n      element = _ref.element,\n      placement = _ref.placement;\n  var basePlacement = placement ? getBasePlacement(placement) : null;\n  var variation = placement ? getVariation(placement) : null;\n  var commonX = reference.x + reference.width / 2 - element.width / 2;\n  var commonY = reference.y + reference.height / 2 - element.height / 2;\n  var offsets;\n\n  switch (basePlacement) {\n    case top:\n      offsets = {\n        x: commonX,\n        y: reference.y - element.height\n      };\n      break;\n\n    case bottom:\n      offsets = {\n        x: commonX,\n        y: reference.y + reference.height\n      };\n      break;\n\n    case right:\n      offsets = {\n        x: reference.x + reference.width,\n        y: commonY\n      };\n      break;\n\n    case left:\n      offsets = {\n        x: reference.x - element.width,\n        y: commonY\n      };\n      break;\n\n    default:\n      offsets = {\n        x: reference.x,\n        y: reference.y\n      };\n  }\n\n  var mainAxis = basePlacement ? getMainAxisFromPlacement(basePlacement) : null;\n\n  if (mainAxis != null) {\n    var len = mainAxis === 'y' ? 'height' : 'width';\n\n    switch (variation) {\n      case start:\n        offsets[mainAxis] = offsets[mainAxis] - (reference[len] / 2 - element[len] / 2);\n        break;\n\n      case end:\n        offsets[mainAxis] = offsets[mainAxis] + (reference[len] / 2 - element[len] / 2);\n        break;\n\n      default:\n    }\n  }\n\n  return offsets;\n}","import getClippingRect from \"../dom-utils/getClippingRect.js\";\nimport getDocumentElement from \"../dom-utils/getDocumentElement.js\";\nimport getBoundingClientRect from \"../dom-utils/getBoundingClientRect.js\";\nimport computeOffsets from \"./computeOffsets.js\";\nimport rectToClientRect from \"./rectToClientRect.js\";\nimport { clippingParents, reference, popper, bottom, top, right, basePlacements, viewport } from \"../enums.js\";\nimport { isElement } from \"../dom-utils/instanceOf.js\";\nimport mergePaddingObject from \"./mergePaddingObject.js\";\nimport expandToHashMap from \"./expandToHashMap.js\"; // eslint-disable-next-line import/no-unused-modules\n\nexport default function detectOverflow(state, options) {\n  if (options === void 0) {\n    options = {};\n  }\n\n  var _options = options,\n      _options$placement = _options.placement,\n      placement = _options$placement === void 0 ? state.placement : _options$placement,\n      _options$strategy = _options.strategy,\n      strategy = _options$strategy === void 0 ? state.strategy : _options$strategy,\n      _options$boundary = _options.boundary,\n      boundary = _options$boundary === void 0 ? clippingParents : _options$boundary,\n      _options$rootBoundary = _options.rootBoundary,\n      rootBoundary = _options$rootBoundary === void 0 ? viewport : _options$rootBoundary,\n      _options$elementConte = _options.elementContext,\n      elementContext = _options$elementConte === void 0 ? popper : _options$elementConte,\n      _options$altBoundary = _options.altBoundary,\n      altBoundary = _options$altBoundary === void 0 ? false : _options$altBoundary,\n      _options$padding = _options.padding,\n      padding = _options$padding === void 0 ? 0 : _options$padding;\n  var paddingObject = mergePaddingObject(typeof padding !== 'number' ? padding : expandToHashMap(padding, basePlacements));\n  var altContext = elementContext === popper ? reference : popper;\n  var popperRect = state.rects.popper;\n  var element = state.elements[altBoundary ? altContext : elementContext];\n  var clippingClientRect = getClippingRect(isElement(element) ? element : element.contextElement || getDocumentElement(state.elements.popper), boundary, rootBoundary, strategy);\n  var referenceClientRect = getBoundingClientRect(state.elements.reference);\n  var popperOffsets = computeOffsets({\n    reference: referenceClientRect,\n    element: popperRect,\n    strategy: 'absolute',\n    placement: placement\n  });\n  var popperClientRect = rectToClientRect(Object.assign({}, popperRect, popperOffsets));\n  var elementClientRect = elementContext === popper ? popperClientRect : referenceClientRect; // positive = overflowing the clipping rect\n  // 0 or negative = within the clipping rect\n\n  var overflowOffsets = {\n    top: clippingClientRect.top - elementClientRect.top + paddingObject.top,\n    bottom: elementClientRect.bottom - clippingClientRect.bottom + paddingObject.bottom,\n    left: clippingClientRect.left - elementClientRect.left + paddingObject.left,\n    right: elementClientRect.right - clippingClientRect.right + paddingObject.right\n  };\n  var offsetData = state.modifiersData.offset; // Offsets can be applied only to the popper element\n\n  if (elementContext === popper && offsetData) {\n    var offset = offsetData[placement];\n    Object.keys(overflowOffsets).forEach(function (key) {\n      var multiply = [right, bottom].indexOf(key) >= 0 ? 1 : -1;\n      var axis = [top, bottom].indexOf(key) >= 0 ? 'y' : 'x';\n      overflowOffsets[key] += offset[axis] * multiply;\n    });\n  }\n\n  return overflowOffsets;\n}","import getVariation from \"./getVariation.js\";\nimport { variationPlacements, basePlacements, placements as allPlacements } from \"../enums.js\";\nimport detectOverflow from \"./detectOverflow.js\";\nimport getBasePlacement from \"./getBasePlacement.js\";\nexport default function computeAutoPlacement(state, options) {\n  if (options === void 0) {\n    options = {};\n  }\n\n  var _options = options,\n      placement = _options.placement,\n      boundary = _options.boundary,\n      rootBoundary = _options.rootBoundary,\n      padding = _options.padding,\n      flipVariations = _options.flipVariations,\n      _options$allowedAutoP = _options.allowedAutoPlacements,\n      allowedAutoPlacements = _options$allowedAutoP === void 0 ? allPlacements : _options$allowedAutoP;\n  var variation = getVariation(placement);\n  var placements = variation ? flipVariations ? variationPlacements : variationPlacements.filter(function (placement) {\n    return getVariation(placement) === variation;\n  }) : basePlacements;\n  var allowedPlacements = placements.filter(function (placement) {\n    return allowedAutoPlacements.indexOf(placement) >= 0;\n  });\n\n  if (allowedPlacements.length === 0) {\n    allowedPlacements = placements;\n  } // $FlowFixMe[incompatible-type]: Flow seems to have problems with two array unions...\n\n\n  var overflows = allowedPlacements.reduce(function (acc, placement) {\n    acc[placement] = detectOverflow(state, {\n      placement: placement,\n      boundary: boundary,\n      rootBoundary: rootBoundary,\n      padding: padding\n    })[getBasePlacement(placement)];\n    return acc;\n  }, {});\n  return Object.keys(overflows).sort(function (a, b) {\n    return overflows[a] - overflows[b];\n  });\n}","import getOppositePlacement from \"../utils/getOppositePlacement.js\";\nimport getBasePlacement from \"../utils/getBasePlacement.js\";\nimport getOppositeVariationPlacement from \"../utils/getOppositeVariationPlacement.js\";\nimport detectOverflow from \"../utils/detectOverflow.js\";\nimport computeAutoPlacement from \"../utils/computeAutoPlacement.js\";\nimport { bottom, top, start, right, left, auto } from \"../enums.js\";\nimport getVariation from \"../utils/getVariation.js\"; // eslint-disable-next-line import/no-unused-modules\n\nfunction getExpandedFallbackPlacements(placement) {\n  if (getBasePlacement(placement) === auto) {\n    return [];\n  }\n\n  var oppositePlacement = getOppositePlacement(placement);\n  return [getOppositeVariationPlacement(placement), oppositePlacement, getOppositeVariationPlacement(oppositePlacement)];\n}\n\nfunction flip(_ref) {\n  var state = _ref.state,\n      options = _ref.options,\n      name = _ref.name;\n\n  if (state.modifiersData[name]._skip) {\n    return;\n  }\n\n  var _options$mainAxis = options.mainAxis,\n      checkMainAxis = _options$mainAxis === void 0 ? true : _options$mainAxis,\n      _options$altAxis = options.altAxis,\n      checkAltAxis = _options$altAxis === void 0 ? true : _options$altAxis,\n      specifiedFallbackPlacements = options.fallbackPlacements,\n      padding = options.padding,\n      boundary = options.boundary,\n      rootBoundary = options.rootBoundary,\n      altBoundary = options.altBoundary,\n      _options$flipVariatio = options.flipVariations,\n      flipVariations = _options$flipVariatio === void 0 ? true : _options$flipVariatio,\n      allowedAutoPlacements = options.allowedAutoPlacements;\n  var preferredPlacement = state.options.placement;\n  var basePlacement = getBasePlacement(preferredPlacement);\n  var isBasePlacement = basePlacement === preferredPlacement;\n  var fallbackPlacements = specifiedFallbackPlacements || (isBasePlacement || !flipVariations ? [getOppositePlacement(preferredPlacement)] : getExpandedFallbackPlacements(preferredPlacement));\n  var placements = [preferredPlacement].concat(fallbackPlacements).reduce(function (acc, placement) {\n    return acc.concat(getBasePlacement(placement) === auto ? computeAutoPlacement(state, {\n      placement: placement,\n      boundary: boundary,\n      rootBoundary: rootBoundary,\n      padding: padding,\n      flipVariations: flipVariations,\n      allowedAutoPlacements: allowedAutoPlacements\n    }) : placement);\n  }, []);\n  var referenceRect = state.rects.reference;\n  var popperRect = state.rects.popper;\n  var checksMap = new Map();\n  var makeFallbackChecks = true;\n  var firstFittingPlacement = placements[0];\n\n  for (var i = 0; i < placements.length; i++) {\n    var placement = placements[i];\n\n    var _basePlacement = getBasePlacement(placement);\n\n    var isStartVariation = getVariation(placement) === start;\n    var isVertical = [top, bottom].indexOf(_basePlacement) >= 0;\n    var len = isVertical ? 'width' : 'height';\n    var overflow = detectOverflow(state, {\n      placement: placement,\n      boundary: boundary,\n      rootBoundary: rootBoundary,\n      altBoundary: altBoundary,\n      padding: padding\n    });\n    var mainVariationSide = isVertical ? isStartVariation ? right : left : isStartVariation ? bottom : top;\n\n    if (referenceRect[len] > popperRect[len]) {\n      mainVariationSide = getOppositePlacement(mainVariationSide);\n    }\n\n    var altVariationSide = getOppositePlacement(mainVariationSide);\n    var checks = [];\n\n    if (checkMainAxis) {\n      checks.push(overflow[_basePlacement] <= 0);\n    }\n\n    if (checkAltAxis) {\n      checks.push(overflow[mainVariationSide] <= 0, overflow[altVariationSide] <= 0);\n    }\n\n    if (checks.every(function (check) {\n      return check;\n    })) {\n      firstFittingPlacement = placement;\n      makeFallbackChecks = false;\n      break;\n    }\n\n    checksMap.set(placement, checks);\n  }\n\n  if (makeFallbackChecks) {\n    // `2` may be desired in some cases – research later\n    var numberOfChecks = flipVariations ? 3 : 1;\n\n    var _loop = function _loop(_i) {\n      var fittingPlacement = placements.find(function (placement) {\n        var checks = checksMap.get(placement);\n\n        if (checks) {\n          return checks.slice(0, _i).every(function (check) {\n            return check;\n          });\n        }\n      });\n\n      if (fittingPlacement) {\n        firstFittingPlacement = fittingPlacement;\n        return \"break\";\n      }\n    };\n\n    for (var _i = numberOfChecks; _i > 0; _i--) {\n      var _ret = _loop(_i);\n\n      if (_ret === \"break\") break;\n    }\n  }\n\n  if (state.placement !== firstFittingPlacement) {\n    state.modifiersData[name]._skip = true;\n    state.placement = firstFittingPlacement;\n    state.reset = true;\n  }\n} // eslint-disable-next-line import/no-unused-modules\n\n\nexport default {\n  name: 'flip',\n  enabled: true,\n  phase: 'main',\n  fn: flip,\n  requiresIfExists: ['offset'],\n  data: {\n    _skip: false\n  }\n};","import { top, bottom, left, right } from \"../enums.js\";\nimport detectOverflow from \"../utils/detectOverflow.js\";\n\nfunction getSideOffsets(overflow, rect, preventedOffsets) {\n  if (preventedOffsets === void 0) {\n    preventedOffsets = {\n      x: 0,\n      y: 0\n    };\n  }\n\n  return {\n    top: overflow.top - rect.height - preventedOffsets.y,\n    right: overflow.right - rect.width + preventedOffsets.x,\n    bottom: overflow.bottom - rect.height + preventedOffsets.y,\n    left: overflow.left - rect.width - preventedOffsets.x\n  };\n}\n\nfunction isAnySideFullyClipped(overflow) {\n  return [top, right, bottom, left].some(function (side) {\n    return overflow[side] >= 0;\n  });\n}\n\nfunction hide(_ref) {\n  var state = _ref.state,\n      name = _ref.name;\n  var referenceRect = state.rects.reference;\n  var popperRect = state.rects.popper;\n  var preventedOffsets = state.modifiersData.preventOverflow;\n  var referenceOverflow = detectOverflow(state, {\n    elementContext: 'reference'\n  });\n  var popperAltOverflow = detectOverflow(state, {\n    altBoundary: true\n  });\n  var referenceClippingOffsets = getSideOffsets(referenceOverflow, referenceRect);\n  var popperEscapeOffsets = getSideOffsets(popperAltOverflow, popperRect, preventedOffsets);\n  var isReferenceHidden = isAnySideFullyClipped(referenceClippingOffsets);\n  var hasPopperEscaped = isAnySideFullyClipped(popperEscapeOffsets);\n  state.modifiersData[name] = {\n    referenceClippingOffsets: referenceClippingOffsets,\n    popperEscapeOffsets: popperEscapeOffsets,\n    isReferenceHidden: isReferenceHidden,\n    hasPopperEscaped: hasPopperEscaped\n  };\n  state.attributes.popper = Object.assign({}, state.attributes.popper, {\n    'data-popper-reference-hidden': isReferenceHidden,\n    'data-popper-escaped': hasPopperEscaped\n  });\n} // eslint-disable-next-line import/no-unused-modules\n\n\nexport default {\n  name: 'hide',\n  enabled: true,\n  phase: 'main',\n  requiresIfExists: ['preventOverflow'],\n  fn: hide\n};","import getBasePlacement from \"../utils/getBasePlacement.js\";\nimport { top, left, right, placements } from \"../enums.js\"; // eslint-disable-next-line import/no-unused-modules\n\nexport function distanceAndSkiddingToXY(placement, rects, offset) {\n  var basePlacement = getBasePlacement(placement);\n  var invertDistance = [left, top].indexOf(basePlacement) >= 0 ? -1 : 1;\n\n  var _ref = typeof offset === 'function' ? offset(Object.assign({}, rects, {\n    placement: placement\n  })) : offset,\n      skidding = _ref[0],\n      distance = _ref[1];\n\n  skidding = skidding || 0;\n  distance = (distance || 0) * invertDistance;\n  return [left, right].indexOf(basePlacement) >= 0 ? {\n    x: distance,\n    y: skidding\n  } : {\n    x: skidding,\n    y: distance\n  };\n}\n\nfunction offset(_ref2) {\n  var state = _ref2.state,\n      options = _ref2.options,\n      name = _ref2.name;\n  var _options$offset = options.offset,\n      offset = _options$offset === void 0 ? [0, 0] : _options$offset;\n  var data = placements.reduce(function (acc, placement) {\n    acc[placement] = distanceAndSkiddingToXY(placement, state.rects, offset);\n    return acc;\n  }, {});\n  var _data$state$placement = data[state.placement],\n      x = _data$state$placement.x,\n      y = _data$state$placement.y;\n\n  if (state.modifiersData.popperOffsets != null) {\n    state.modifiersData.popperOffsets.x += x;\n    state.modifiersData.popperOffsets.y += y;\n  }\n\n  state.modifiersData[name] = data;\n} // eslint-disable-next-line import/no-unused-modules\n\n\nexport default {\n  name: 'offset',\n  enabled: true,\n  phase: 'main',\n  requires: ['popperOffsets'],\n  fn: offset\n};","import computeOffsets from \"../utils/computeOffsets.js\";\n\nfunction popperOffsets(_ref) {\n  var state = _ref.state,\n      name = _ref.name;\n  // Offsets are the actual position the popper needs to have to be\n  // properly positioned near its reference element\n  // This is the most basic placement, and will be adjusted by\n  // the modifiers in the next step\n  state.modifiersData[name] = computeOffsets({\n    reference: state.rects.reference,\n    element: state.rects.popper,\n    strategy: 'absolute',\n    placement: state.placement\n  });\n} // eslint-disable-next-line import/no-unused-modules\n\n\nexport default {\n  name: 'popperOffsets',\n  enabled: true,\n  phase: 'read',\n  fn: popperOffsets,\n  data: {}\n};","export default function getAltAxis(axis) {\n  return axis === 'x' ? 'y' : 'x';\n}","import { top, left, right, bottom, start } from \"../enums.js\";\nimport getBasePlacement from \"../utils/getBasePlacement.js\";\nimport getMainAxisFromPlacement from \"../utils/getMainAxisFromPlacement.js\";\nimport getAltAxis from \"../utils/getAltAxis.js\";\nimport { within, withinMaxClamp } from \"../utils/within.js\";\nimport getLayoutRect from \"../dom-utils/getLayoutRect.js\";\nimport getOffsetParent from \"../dom-utils/getOffsetParent.js\";\nimport detectOverflow from \"../utils/detectOverflow.js\";\nimport getVariation from \"../utils/getVariation.js\";\nimport getFreshSideObject from \"../utils/getFreshSideObject.js\";\nimport { min as mathMin, max as mathMax } from \"../utils/math.js\";\n\nfunction preventOverflow(_ref) {\n  var state = _ref.state,\n      options = _ref.options,\n      name = _ref.name;\n  var _options$mainAxis = options.mainAxis,\n      checkMainAxis = _options$mainAxis === void 0 ? true : _options$mainAxis,\n      _options$altAxis = options.altAxis,\n      checkAltAxis = _options$altAxis === void 0 ? false : _options$altAxis,\n      boundary = options.boundary,\n      rootBoundary = options.rootBoundary,\n      altBoundary = options.altBoundary,\n      padding = options.padding,\n      _options$tether = options.tether,\n      tether = _options$tether === void 0 ? true : _options$tether,\n      _options$tetherOffset = options.tetherOffset,\n      tetherOffset = _options$tetherOffset === void 0 ? 0 : _options$tetherOffset;\n  var overflow = detectOverflow(state, {\n    boundary: boundary,\n    rootBoundary: rootBoundary,\n    padding: padding,\n    altBoundary: altBoundary\n  });\n  var basePlacement = getBasePlacement(state.placement);\n  var variation = getVariation(state.placement);\n  var isBasePlacement = !variation;\n  var mainAxis = getMainAxisFromPlacement(basePlacement);\n  var altAxis = getAltAxis(mainAxis);\n  var popperOffsets = state.modifiersData.popperOffsets;\n  var referenceRect = state.rects.reference;\n  var popperRect = state.rects.popper;\n  var tetherOffsetValue = typeof tetherOffset === 'function' ? tetherOffset(Object.assign({}, state.rects, {\n    placement: state.placement\n  })) : tetherOffset;\n  var normalizedTetherOffsetValue = typeof tetherOffsetValue === 'number' ? {\n    mainAxis: tetherOffsetValue,\n    altAxis: tetherOffsetValue\n  } : Object.assign({\n    mainAxis: 0,\n    altAxis: 0\n  }, tetherOffsetValue);\n  var offsetModifierState = state.modifiersData.offset ? state.modifiersData.offset[state.placement] : null;\n  var data = {\n    x: 0,\n    y: 0\n  };\n\n  if (!popperOffsets) {\n    return;\n  }\n\n  if (checkMainAxis) {\n    var _offsetModifierState$;\n\n    var mainSide = mainAxis === 'y' ? top : left;\n    var altSide = mainAxis === 'y' ? bottom : right;\n    var len = mainAxis === 'y' ? 'height' : 'width';\n    var offset = popperOffsets[mainAxis];\n    var min = offset + overflow[mainSide];\n    var max = offset - overflow[altSide];\n    var additive = tether ? -popperRect[len] / 2 : 0;\n    var minLen = variation === start ? referenceRect[len] : popperRect[len];\n    var maxLen = variation === start ? -popperRect[len] : -referenceRect[len]; // We need to include the arrow in the calculation so the arrow doesn't go\n    // outside the reference bounds\n\n    var arrowElement = state.elements.arrow;\n    var arrowRect = tether && arrowElement ? getLayoutRect(arrowElement) : {\n      width: 0,\n      height: 0\n    };\n    var arrowPaddingObject = state.modifiersData['arrow#persistent'] ? state.modifiersData['arrow#persistent'].padding : getFreshSideObject();\n    var arrowPaddingMin = arrowPaddingObject[mainSide];\n    var arrowPaddingMax = arrowPaddingObject[altSide]; // If the reference length is smaller than the arrow length, we don't want\n    // to include its full size in the calculation. If the reference is small\n    // and near the edge of a boundary, the popper can overflow even if the\n    // reference is not overflowing as well (e.g. virtual elements with no\n    // width or height)\n\n    var arrowLen = within(0, referenceRect[len], arrowRect[len]);\n    var minOffset = isBasePlacement ? referenceRect[len] / 2 - additive - arrowLen - arrowPaddingMin - normalizedTetherOffsetValue.mainAxis : minLen - arrowLen - arrowPaddingMin - normalizedTetherOffsetValue.mainAxis;\n    var maxOffset = isBasePlacement ? -referenceRect[len] / 2 + additive + arrowLen + arrowPaddingMax + normalizedTetherOffsetValue.mainAxis : maxLen + arrowLen + arrowPaddingMax + normalizedTetherOffsetValue.mainAxis;\n    var arrowOffsetParent = state.elements.arrow && getOffsetParent(state.elements.arrow);\n    var clientOffset = arrowOffsetParent ? mainAxis === 'y' ? arrowOffsetParent.clientTop || 0 : arrowOffsetParent.clientLeft || 0 : 0;\n    var offsetModifierValue = (_offsetModifierState$ = offsetModifierState == null ? void 0 : offsetModifierState[mainAxis]) != null ? _offsetModifierState$ : 0;\n    var tetherMin = offset + minOffset - offsetModifierValue - clientOffset;\n    var tetherMax = offset + maxOffset - offsetModifierValue;\n    var preventedOffset = within(tether ? mathMin(min, tetherMin) : min, offset, tether ? mathMax(max, tetherMax) : max);\n    popperOffsets[mainAxis] = preventedOffset;\n    data[mainAxis] = preventedOffset - offset;\n  }\n\n  if (checkAltAxis) {\n    var _offsetModifierState$2;\n\n    var _mainSide = mainAxis === 'x' ? top : left;\n\n    var _altSide = mainAxis === 'x' ? bottom : right;\n\n    var _offset = popperOffsets[altAxis];\n\n    var _len = altAxis === 'y' ? 'height' : 'width';\n\n    var _min = _offset + overflow[_mainSide];\n\n    var _max = _offset - overflow[_altSide];\n\n    var isOriginSide = [top, left].indexOf(basePlacement) !== -1;\n\n    var _offsetModifierValue = (_offsetModifierState$2 = offsetModifierState == null ? void 0 : offsetModifierState[altAxis]) != null ? _offsetModifierState$2 : 0;\n\n    var _tetherMin = isOriginSide ? _min : _offset - referenceRect[_len] - popperRect[_len] - _offsetModifierValue + normalizedTetherOffsetValue.altAxis;\n\n    var _tetherMax = isOriginSide ? _offset + referenceRect[_len] + popperRect[_len] - _offsetModifierValue - normalizedTetherOffsetValue.altAxis : _max;\n\n    var _preventedOffset = tether && isOriginSide ? withinMaxClamp(_tetherMin, _offset, _tetherMax) : within(tether ? _tetherMin : _min, _offset, tether ? _tetherMax : _max);\n\n    popperOffsets[altAxis] = _preventedOffset;\n    data[altAxis] = _preventedOffset - _offset;\n  }\n\n  state.modifiersData[name] = data;\n} // eslint-disable-next-line import/no-unused-modules\n\n\nexport default {\n  name: 'preventOverflow',\n  enabled: true,\n  phase: 'main',\n  fn: preventOverflow,\n  requiresIfExists: ['offset']\n};","export default function getHTMLElementScroll(element) {\n  return {\n    scrollLeft: element.scrollLeft,\n    scrollTop: element.scrollTop\n  };\n}","import getWindowScroll from \"./getWindowScroll.js\";\nimport getWindow from \"./getWindow.js\";\nimport { isHTMLElement } from \"./instanceOf.js\";\nimport getHTMLElementScroll from \"./getHTMLElementScroll.js\";\nexport default function getNodeScroll(node) {\n  if (node === getWindow(node) || !isHTMLElement(node)) {\n    return getWindowScroll(node);\n  } else {\n    return getHTMLElementScroll(node);\n  }\n}","import getBoundingClientRect from \"./getBoundingClientRect.js\";\nimport getNodeScroll from \"./getNodeScroll.js\";\nimport getNodeName from \"./getNodeName.js\";\nimport { isHTMLElement } from \"./instanceOf.js\";\nimport getWindowScrollBarX from \"./getWindowScrollBarX.js\";\nimport getDocumentElement from \"./getDocumentElement.js\";\nimport isScrollParent from \"./isScrollParent.js\";\nimport { round } from \"../utils/math.js\";\n\nfunction isElementScaled(element) {\n  var rect = element.getBoundingClientRect();\n  var scaleX = round(rect.width) / element.offsetWidth || 1;\n  var scaleY = round(rect.height) / element.offsetHeight || 1;\n  return scaleX !== 1 || scaleY !== 1;\n} // Returns the composite rect of an element relative to its offsetParent.\n// Composite means it takes into account transforms as well as layout.\n\n\nexport default function getCompositeRect(elementOrVirtualElement, offsetParent, isFixed) {\n  if (isFixed === void 0) {\n    isFixed = false;\n  }\n\n  var isOffsetParentAnElement = isHTMLElement(offsetParent);\n  var offsetParentIsScaled = isHTMLElement(offsetParent) && isElementScaled(offsetParent);\n  var documentElement = getDocumentElement(offsetParent);\n  var rect = getBoundingClientRect(elementOrVirtualElement, offsetParentIsScaled, isFixed);\n  var scroll = {\n    scrollLeft: 0,\n    scrollTop: 0\n  };\n  var offsets = {\n    x: 0,\n    y: 0\n  };\n\n  if (isOffsetParentAnElement || !isOffsetParentAnElement && !isFixed) {\n    if (getNodeName(offsetParent) !== 'body' || // https://github.com/popperjs/popper-core/issues/1078\n    isScrollParent(documentElement)) {\n      scroll = getNodeScroll(offsetParent);\n    }\n\n    if (isHTMLElement(offsetParent)) {\n      offsets = getBoundingClientRect(offsetParent, true);\n      offsets.x += offsetParent.clientLeft;\n      offsets.y += offsetParent.clientTop;\n    } else if (documentElement) {\n      offsets.x = getWindowScrollBarX(documentElement);\n    }\n  }\n\n  return {\n    x: rect.left + scroll.scrollLeft - offsets.x,\n    y: rect.top + scroll.scrollTop - offsets.y,\n    width: rect.width,\n    height: rect.height\n  };\n}","import { modifierPhases } from \"../enums.js\"; // source: https://stackoverflow.com/questions/49875255\n\nfunction order(modifiers) {\n  var map = new Map();\n  var visited = new Set();\n  var result = [];\n  modifiers.forEach(function (modifier) {\n    map.set(modifier.name, modifier);\n  }); // On visiting object, check for its dependencies and visit them recursively\n\n  function sort(modifier) {\n    visited.add(modifier.name);\n    var requires = [].concat(modifier.requires || [], modifier.requiresIfExists || []);\n    requires.forEach(function (dep) {\n      if (!visited.has(dep)) {\n        var depModifier = map.get(dep);\n\n        if (depModifier) {\n          sort(depModifier);\n        }\n      }\n    });\n    result.push(modifier);\n  }\n\n  modifiers.forEach(function (modifier) {\n    if (!visited.has(modifier.name)) {\n      // check for visited object\n      sort(modifier);\n    }\n  });\n  return result;\n}\n\nexport default function orderModifiers(modifiers) {\n  // order based on dependencies\n  var orderedModifiers = order(modifiers); // order based on phase\n\n  return modifierPhases.reduce(function (acc, phase) {\n    return acc.concat(orderedModifiers.filter(function (modifier) {\n      return modifier.phase === phase;\n    }));\n  }, []);\n}","export default function debounce(fn) {\n  var pending;\n  return function () {\n    if (!pending) {\n      pending = new Promise(function (resolve) {\n        Promise.resolve().then(function () {\n          pending = undefined;\n          resolve(fn());\n        });\n      });\n    }\n\n    return pending;\n  };\n}","export default function mergeByName(modifiers) {\n  var merged = modifiers.reduce(function (merged, current) {\n    var existing = merged[current.name];\n    merged[current.name] = existing ? Object.assign({}, existing, current, {\n      options: Object.assign({}, existing.options, current.options),\n      data: Object.assign({}, existing.data, current.data)\n    }) : current;\n    return merged;\n  }, {}); // IE11 does not support Object.values\n\n  return Object.keys(merged).map(function (key) {\n    return merged[key];\n  });\n}","import getCompositeRect from \"./dom-utils/getCompositeRect.js\";\nimport getLayoutRect from \"./dom-utils/getLayoutRect.js\";\nimport listScrollParents from \"./dom-utils/listScrollParents.js\";\nimport getOffsetParent from \"./dom-utils/getOffsetParent.js\";\nimport orderModifiers from \"./utils/orderModifiers.js\";\nimport debounce from \"./utils/debounce.js\";\nimport mergeByName from \"./utils/mergeByName.js\";\nimport detectOverflow from \"./utils/detectOverflow.js\";\nimport { isElement } from \"./dom-utils/instanceOf.js\";\nvar DEFAULT_OPTIONS = {\n  placement: 'bottom',\n  modifiers: [],\n  strategy: 'absolute'\n};\n\nfunction areValidElements() {\n  for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n    args[_key] = arguments[_key];\n  }\n\n  return !args.some(function (element) {\n    return !(element && typeof element.getBoundingClientRect === 'function');\n  });\n}\n\nexport function popperGenerator(generatorOptions) {\n  if (generatorOptions === void 0) {\n    generatorOptions = {};\n  }\n\n  var _generatorOptions = generatorOptions,\n      _generatorOptions$def = _generatorOptions.defaultModifiers,\n      defaultModifiers = _generatorOptions$def === void 0 ? [] : _generatorOptions$def,\n      _generatorOptions$def2 = _generatorOptions.defaultOptions,\n      defaultOptions = _generatorOptions$def2 === void 0 ? DEFAULT_OPTIONS : _generatorOptions$def2;\n  return function createPopper(reference, popper, options) {\n    if (options === void 0) {\n      options = defaultOptions;\n    }\n\n    var state = {\n      placement: 'bottom',\n      orderedModifiers: [],\n      options: Object.assign({}, DEFAULT_OPTIONS, defaultOptions),\n      modifiersData: {},\n      elements: {\n        reference: reference,\n        popper: popper\n      },\n      attributes: {},\n      styles: {}\n    };\n    var effectCleanupFns = [];\n    var isDestroyed = false;\n    var instance = {\n      state: state,\n      setOptions: function setOptions(setOptionsAction) {\n        var options = typeof setOptionsAction === 'function' ? setOptionsAction(state.options) : setOptionsAction;\n        cleanupModifierEffects();\n        state.options = Object.assign({}, defaultOptions, state.options, options);\n        state.scrollParents = {\n          reference: isElement(reference) ? listScrollParents(reference) : reference.contextElement ? listScrollParents(reference.contextElement) : [],\n          popper: listScrollParents(popper)\n        }; // Orders the modifiers based on their dependencies and `phase`\n        // properties\n\n        var orderedModifiers = orderModifiers(mergeByName([].concat(defaultModifiers, state.options.modifiers))); // Strip out disabled modifiers\n\n        state.orderedModifiers = orderedModifiers.filter(function (m) {\n          return m.enabled;\n        });\n        runModifierEffects();\n        return instance.update();\n      },\n      // Sync update – it will always be executed, even if not necessary. This\n      // is useful for low frequency updates where sync behavior simplifies the\n      // logic.\n      // For high frequency updates (e.g. `resize` and `scroll` events), always\n      // prefer the async Popper#update method\n      forceUpdate: function forceUpdate() {\n        if (isDestroyed) {\n          return;\n        }\n\n        var _state$elements = state.elements,\n            reference = _state$elements.reference,\n            popper = _state$elements.popper; // Don't proceed if `reference` or `popper` are not valid elements\n        // anymore\n\n        if (!areValidElements(reference, popper)) {\n          return;\n        } // Store the reference and popper rects to be read by modifiers\n\n\n        state.rects = {\n          reference: getCompositeRect(reference, getOffsetParent(popper), state.options.strategy === 'fixed'),\n          popper: getLayoutRect(popper)\n        }; // Modifiers have the ability to reset the current update cycle. The\n        // most common use case for this is the `flip` modifier changing the\n        // placement, which then needs to re-run all the modifiers, because the\n        // logic was previously ran for the previous placement and is therefore\n        // stale/incorrect\n\n        state.reset = false;\n        state.placement = state.options.placement; // On each update cycle, the `modifiersData` property for each modifier\n        // is filled with the initial data specified by the modifier. This means\n        // it doesn't persist and is fresh on each update.\n        // To ensure persistent data, use `${name}#persistent`\n\n        state.orderedModifiers.forEach(function (modifier) {\n          return state.modifiersData[modifier.name] = Object.assign({}, modifier.data);\n        });\n\n        for (var index = 0; index < state.orderedModifiers.length; index++) {\n          if (state.reset === true) {\n            state.reset = false;\n            index = -1;\n            continue;\n          }\n\n          var _state$orderedModifie = state.orderedModifiers[index],\n              fn = _state$orderedModifie.fn,\n              _state$orderedModifie2 = _state$orderedModifie.options,\n              _options = _state$orderedModifie2 === void 0 ? {} : _state$orderedModifie2,\n              name = _state$orderedModifie.name;\n\n          if (typeof fn === 'function') {\n            state = fn({\n              state: state,\n              options: _options,\n              name: name,\n              instance: instance\n            }) || state;\n          }\n        }\n      },\n      // Async and optimistically optimized update – it will not be executed if\n      // not necessary (debounced to run at most once-per-tick)\n      update: debounce(function () {\n        return new Promise(function (resolve) {\n          instance.forceUpdate();\n          resolve(state);\n        });\n      }),\n      destroy: function destroy() {\n        cleanupModifierEffects();\n        isDestroyed = true;\n      }\n    };\n\n    if (!areValidElements(reference, popper)) {\n      return instance;\n    }\n\n    instance.setOptions(options).then(function (state) {\n      if (!isDestroyed && options.onFirstUpdate) {\n        options.onFirstUpdate(state);\n      }\n    }); // Modifiers have the ability to execute arbitrary code before the first\n    // update cycle runs. They will be executed in the same order as the update\n    // cycle. This is useful when a modifier adds some persistent data that\n    // other modifiers need to use, but the modifier is run after the dependent\n    // one.\n\n    function runModifierEffects() {\n      state.orderedModifiers.forEach(function (_ref) {\n        var name = _ref.name,\n            _ref$options = _ref.options,\n            options = _ref$options === void 0 ? {} : _ref$options,\n            effect = _ref.effect;\n\n        if (typeof effect === 'function') {\n          var cleanupFn = effect({\n            state: state,\n            name: name,\n            instance: instance,\n            options: options\n          });\n\n          var noopFn = function noopFn() {};\n\n          effectCleanupFns.push(cleanupFn || noopFn);\n        }\n      });\n    }\n\n    function cleanupModifierEffects() {\n      effectCleanupFns.forEach(function (fn) {\n        return fn();\n      });\n      effectCleanupFns = [];\n    }\n\n    return instance;\n  };\n}\nexport var createPopper = /*#__PURE__*/popperGenerator(); // eslint-disable-next-line import/no-unused-modules\n\nexport { detectOverflow };","import { popperGenerator, detectOverflow } from \"./createPopper.js\";\nimport eventListeners from \"./modifiers/eventListeners.js\";\nimport popperOffsets from \"./modifiers/popperOffsets.js\";\nimport computeStyles from \"./modifiers/computeStyles.js\";\nimport applyStyles from \"./modifiers/applyStyles.js\";\nimport offset from \"./modifiers/offset.js\";\nimport flip from \"./modifiers/flip.js\";\nimport preventOverflow from \"./modifiers/preventOverflow.js\";\nimport arrow from \"./modifiers/arrow.js\";\nimport hide from \"./modifiers/hide.js\";\nvar defaultModifiers = [eventListeners, popperOffsets, computeStyles, applyStyles, offset, flip, preventOverflow, arrow, hide];\nvar createPopper = /*#__PURE__*/popperGenerator({\n  defaultModifiers: defaultModifiers\n}); // eslint-disable-next-line import/no-unused-modules\n\nexport { createPopper, popperGenerator, defaultModifiers, detectOverflow }; // eslint-disable-next-line import/no-unused-modules\n\nexport { createPopper as createPopperLite } from \"./popper-lite.js\"; // eslint-disable-next-line import/no-unused-modules\n\nexport * from \"./modifiers/index.js\";","/* ***** BEGIN LICENSE BLOCK *****\n\tCopyright (c) 2018-2025 Famibee (famibee.blog38.fc2.com)\n\n\tThis software is released under the MIT License.\n\thttp://opensource.org/licenses/mit-license.php\n** ***** END LICENSE BLOCK ***** */\n\nimport {CmnLib, type IEvtMng, argChk_Boolean, addStyle, mesErrJSON} from './CmnLib';\nimport type {IHTag, HArg} from './Grammar';\nimport type {IVariable, IMain} from './CmnInterface';\nimport type {LayerMng} from './LayerMng';\nimport type {ScriptIterator} from './ScriptIterator';\nimport {TxtLayer} from './TxtLayer';\nimport {EventListenerCtn} from './EventListenerCtn';\nimport {Button} from './Button';\nimport {FocusMng} from './FocusMng';\nimport type {SoundMng} from './SoundMng';\nimport type {Config} from './Config';\nimport {SysBase} from './SysBase';\nimport {SEARCH_PATH_ARG_EXT} from './ConfigBase';\nimport {Reading, ReadingState} from './Reading';\n\nimport {Container, type Application, type InteractionEvent, utils} from 'pixi.js';\nimport {createPopper, type Instance as InsPop} from '@popperjs/core';\n\n\nconst enum eDownKeys {\n\tNO_PUSH = 0,\n\tONE_PUSH,\n\tPUSH_REPEATING,\n};\n\nexport const EVNM_CLICK\t= 'pointerup';\nexport const EVNM_KEY\t= 'keydown';\n\n\nexport class EventMng implements IEvtMng {\n\treadonly\t#elc\t\t= new EventListenerCtn;\n\treadonly\t#fcs\t\t= new FocusMng;\n\n\tconstructor(private readonly cfg: Config, private readonly hTag: IHTag, readonly appPixi: Application, private readonly main: IMain, private readonly layMng: LayerMng, private readonly val: IVariable, sndMng: SoundMng, private readonly scrItr: ScriptIterator, private readonly sys: SysBase) {\n\t\t//\tイベント\n\t\thTag.clear_event= o=> ReadingState.clear_event(o);\t// イベントを全消去\n\t\t// enable_event\t\t// LayerMng.ts内で定義\t\t//イベント有無の切替\n\t\thTag.event\t\t\t= o=> this.#event(o);\t// イベントを予約\n\t\t//hTag.gesture_event\t（形式変更）\t\t\t// ジェスチャイベントを予約\n\t\t// hTag.l\t\t\t\t// Reading.ts内で定義\t\t// 行末クリック待ち\n\t\t// hTag.p\t\t\t\t// Reading.ts内で定義\t\t// 改ページクリック待ち\n\t\t// hTag.s\t\t\t\t// Reading.ts内で定義\t\t// 停止する\n\t\thTag.set_cancel_skip= ()=> false;\t\t\t// (2023/05/27 廃止)スキップ中断予約\n\t\thTag.set_focus\t\t= o=> this.#set_focus(o);\t// フォーカス移動\n\t\t// hTag.wait\t\t\t// Reading.ts内で定義\t\t// ウェイトを入れる\n\t\t// hTag.waitclick\t\t// Reading.ts内で定義\t// クリックを待つ\n\n\t\t// ラベル・ジャンプ\n\t\t// hTag.page\t\t\t// Reading.ts内で定義\t\t// ページ移動\n\n\t\tsndMng.setEvtMng(this);\n\t\tscrItr.setOtherObj(this, layMng);\n\t\tTxtLayer.setEvtMng(this, sys, scrItr);\n\t\tlayMng.setEvtMng(this);\n\t\tReading.setFcs(this.#fcs);\n\t\tsys.setFire((KEY, e)=> Reading.fire(KEY, e));\n\n\t\tif (CmnLib.isDbg) {\n\t\t\tconst hHook\t: {[type: string]: ()=> void}\t= {\n\t\t\t\tpause\t: ()=> {\n//\t\t\t\t\tthis.#isDbgBreak = true;\n\t\t\t\t\tif (! Reading.isWait) return;\n\n\t\t\t\t\tconst hArg: HArg = {};\n\t\t\t\t\tscrItr.recodeDesign(hArg);\n\t\t\t\t\tsys.callHook('_enterDesign', hArg);\n\t\t\t\t\tsys.send2Dbg('_enterDesign', hArg);\n\t\t\t\t},\n//\t\t\t\tstopOnBreakpoint\t\t: ()=> this.#isDbgBreak = true,\n//\t\t\t\tstopOnDataBreakpoint\t: ()=> this.#isDbgBreak = true,\n//\t\t\t\tcontinue\t\t\t\t: ()=> this.#isDbgBreak = false,\n//\t\t\t\tdisconnect\t\t\t\t: ()=> this.#isDbgBreak = false,\n\t\t\t};\n\t\t\thHook.attach =\n\t\t\thHook.stopOnEntry =\n\t\t\thHook.stopOnStep =\n\t\t\thHook.stopOnStepIn =\n\t\t\thHook.stopOnStepOut =\n\t\t\thHook.stopOnBackstep = hHook.pause!;\n\n\t\t\tsys.addHook(type=> hHook[type]?.());\n\t\t}\n\n\t\taddStyle(`\n.sn_hint {\n\tbackground-color: #3c3225;\n\tcolor: white;\n\tpadding: 4px 8px;\n\tborder-radius: 4px;\n\tfont-size: 1.2em;\n\tz-index: 10000;\n\tpointer-events: none;\n\tuser-select: none;\n}\n\n.sn_hint_ar,\n.sn_hint_ar::before {\n\tposition: absolute;\n\twidth: 8px;\n\theight: 8px;\n\tbackground: inherit;\n}\n.sn_hint_ar {\n\tvisibility: hidden;\n}\n.sn_hint_ar::before {\n\tvisibility: visible;\n\tcontent: '';\n\ttransform: rotate(45deg);\n}\n\n.sn_hint[data-popper-placement^='top']\t\t> .sn_hint_ar {bottom: -4px;}\n.sn_hint[data-popper-placement^='bottom']\t> .sn_hint_ar {top: -4px;}\n.sn_hint[data-popper-placement^='left']\t\t> .sn_hint_ar {right: -4px;}\n.sn_hint[data-popper-placement^='right']\t> .sn_hint_ar {left: -4px;}\n`);\n\n\t\tthis.main.cvs.parentElement?.insertAdjacentHTML('beforeend', `\n<div class=\"sn_hint\" role=\"tooltip\">\n\t<span>Dummy</span>\n\t<div class=\"sn_hint_ar\" data-popper-arrow></div>\n</div>`);\n\t\tthis.#elmHint = document.querySelector('.sn_hint') as HTMLElement;\n\t\tthis.#spanHint = this.#elmHint.querySelector('span')!;\n\t\tthis.#popper = createPopper(this.#elmV, this.#elmHint);\n\t\tthis.#elmHint.hidden = true;\n\n\n\t\t// マウスボタンやキーボードイベント登録\n\t\tappPixi.stage.interactive = true;\n\t\tconst setBtnNM = new Map<number, string>([\n\t\t\t[0, ''],\n\t\t\t[1, 'middle'],\n\t\t\t[2, 'right'],\n\t\t]);\n\t\tthis.#elc.addC(appPixi.stage, EVNM_CLICK, e=> {\n\t\t\tif (e instanceof TouchEvent) {Reading.fire('click', e); return}\n\n\t\t\tconst nmEvt = this.#modKey4MouseEvent(e) +`${\n\t\t\t\tsetBtnNM.get(e.button) ?? ''}click`;\nconsole.log(`fn:EventMng.ts -tap- nmEvt:${nmEvt} e:%o`, e);\n\t\t\tReading.fire(nmEvt, e);\n\t\t});\n\t\tthis.#elc.add(window, EVNM_KEY, e=> this.#ev_keydown(e));\n\n\t\tlet pressed = false;\t// 長押しとクリックを排他的にする仕組み\n\t\tconst tg = new TinyGesture(document.body);\n\t\ttg.on('tap', e=> {\n\t\t\tif (pressed) return;\n\n// \t\t\te.stopImmediatePropagation();\n// \t\t\tif (e instanceof TouchEvent) {Reading.fire('click', e); return}\nconsole.log(`fn:EventMng.ts line:161 click e:%o`, e);\n// \t\t\tconst nmEvt = this.#modKey4MouseEvent(e) +`${\n// \t\t\t\tsetBtnNM.get(e.button) ?? ''}click`;\n// // console.log(`fn:EventMng.ts -tap- nmEvt:${nmEvt} e:%o`, e);\n// \t\t\tReading.fire(nmEvt, e);\n\t\t});\n\t\t// gesture.on('doubletap'\t// 原理上 tap 反応が遅くなるので不使用\n\t\ttg.on('longpress', e=> {\n\t\t\tpressed = true;\n\t\t\te.stopImmediatePropagation();\n\t\t\tif (e instanceof TouchEvent) {Reading.fire('longpress', e); return}\n\n\t\t\tconst nmEvt = this.#modKey4MouseEvent(e) +`${\n\t\t\t\tsetBtnNM.get(e.button) ?? ''}longpress`;\n// console.log(`fn:EventMng.ts -longpress- nmEvt:${nmEvt} e:%o`, e);\n\t\t\tReading.fire(nmEvt, e);\n\t\t});\n\t\ttg.on('panend', ()=> {\n\t\t\tif (pressed) queueMicrotask(()=> pressed = false);\n\t\t});\n\t\ttg.on('swipeup', e=> {\n\t\t\te.stopImmediatePropagation();\n\t\t\tif (e instanceof TouchEvent) {Reading.fire('swipeup', e); return}\n\n\t\t\tconst nmEvt = this.#modKey4MouseEvent(e) +'swipeup';\n// console.log(`fn:EventMng.ts -swipeup- nmEvt:${nmEvt} e:%o`, e);\n\t\t\tReading.fire(nmEvt, e);\n\t\t});\n\t\ttg.on('swipedown', e=> {\n\t\t\te.stopImmediatePropagation();\n\t\t\tif (e instanceof TouchEvent) {Reading.fire('swipedown', e); return}\n\n\t\t\tconst nmEvt = this.#modKey4MouseEvent(e) +'swipedown';\n// console.log(`fn:EventMng.ts -swipedown- nmEvt:${nmEvt} e:%o`, e);\n\t\t\tReading.fire(nmEvt, e);\n\t\t});\n\n\n\t\t// 言語切り替え通知\n\t\tconst fncUpdNavLang = ()=> val.setVal_Nochk('tmp', 'const.sn.navigator.language', navigator.language);\n\t\t// TODO: アプリ版で[event key=sn:chgNavLang]が発生しない件\n//\t\tthis.#elc.add(globalThis, 'languagechange', e=> {\n\t\tthis.#elc.add(window, 'languagechange', e=> {\n//console.log(`fn:EventMng.ts languagechange `);\n\t\t\tfncUpdNavLang();\n\t\t\tReading.fire('sn:chgNavLang', e);\n\t\t\tutils.clearTextureCache();\n\t\t});\n\t\tfncUpdNavLang();\n\n\t\t// ダークモード切り替え検知\n\t\tconst fncMql = (mq: MediaQueryList | MediaQueryListEvent)=> {\n\t\t\tCmnLib.isDarkMode = mq.matches;\n\t\t\tval.setVal_Nochk('tmp', 'const.sn.isDarkMode', CmnLib.isDarkMode);\n\t\t};\n\t\tconst mql = globalThis.matchMedia('(prefers-color-scheme: dark)');\n\t\tfncMql(mql);\n\t\tthis.#elc.add(mql, 'change', e=> {\n\t\t\tfncMql(e);\n\t\t\tReading.fire('sn:chgDarkMode', e);\n\t\t});\n\n\t\t//: 縦回転ホイール\n\t\tlet procWheel4wle = (_elc: EventListenerCtn, _onIntr: ()=> void)=> {};\n\t\tif ('WheelEvent' in window) {\n\t\t\tthis.#elc.add(main.cvs, 'wheel', e=> this.#ev_wheel(e), {passive: true});\n\t\t\tthis.#resvFlameEvent4Wheel = win=> this.#elc.add(win, 'wheel', e=> this.#ev_wheel(e), {passive: true});\n\n\t\t\tprocWheel4wle = (elc: EventListenerCtn, fnc: ()=> void)=> elc.add(main.cvs, 'wheel', e=> {\n\t\t\t\t//if (! e.isTrusted) return;\n\t\t\t\tif (e['isComposing']) return; // サポートしてない環境でもいける書き方\n\t\t\t\tif (e.deltaY <= 0) return;\n\n\t\t\t\te.stopPropagation();\n\t\t\t\tfnc();\n\t\t\t});\n\t\t}\n\t\tReading.init(cfg, hTag, main, val, scrItr, layMng, this, sndMng, procWheel4wle);\n\n\n\t\timport('gamepad.js').then(({GamepadListener})=> {\n\t\t\tconst gamepad = new GamepadListener({\n\t\t\t\tanalog\t: false,\n\t\t\t\tdeadZone: 0.3,\n\t\t\t});\n\t\t\tif (CmnLib.debugLog) {\n\t\t\t\t// コネクタを挿した時ではなく、ボタンなどを押した時に発生\n\t\t\t\t// ただ一度抜き→差しするとすぐ発生するようになる\n\t\t\t\tgamepad.on('gamepad:connected', (e: any)=> console.log(`👺<'gamepad:connected' index:${e.detail.index} id:${e.detail.gamepad.id}`));\n\t\t\t\t// コネクタを抜いた時に発生\n\t\t\t\tgamepad.on('gamepad:disconnected', (e: any)=> console.log(`👺<'gamepad:disconnected' index:${e.detail.index} id:${e.detail.gamepad?.id}`));\t// e.detail.gamepad = undefined\n\t\t\t}\n\t\t\tconst aStick: string[] = [\n\t\t\t\t'',\t\t\t'ArrowUp',\t'',\t\t\t\t// '7', '8', '9',\n\t\t\t\t'ArrowLeft', '',\t\t'ArrowRight',\t// '4', '5', '6',\n\t\t\t\t'',\t\t\t'ArrowDown', '',\t\t\t// '1', '2', '3',\n\t\t\t];\n\t\t\tconst stick_xy = [0, 0];\n\t\t\tgamepad.on('gamepad:axis', (e: any)=> {\n\t\t\t\tif (! document.hasFocus()) return;\n\t\t\t\tstick_xy[e.detail.axis] = e.detail.value;\n\t\t\t\tconst [x=0, y=0] = stick_xy;\n\t\t\t\tconst s = (y +1)*3 + (x +1);\n//console.log(`fn:EventMng.ts 👺 'gamepad:axis' detail:%o`, e.detail);\n\t\t\t\tconst s2 = aStick[s];\n\t\t\t\tif (! s2) return;\n\t\t\t\tconst cmp = this.#fcs.getFocus();\n\t\t\t\t((! cmp || cmp instanceof Container) ?globalThis :cmp)\n\t\t\t\t.dispatchEvent(new KeyboardEvent(EVNM_KEY, {key: s2, bubbles: true}));\n\n\t\t\t\tif (! cmp || cmp instanceof Container) return;\n\t\t\t\tif (cmp.getAttribute('type') === 'range') cmp.dispatchEvent(new InputEvent('input', {bubbles: true}));\t// スライダー変更時、表示数字が変わらない対応\n\t\t\t});\n\t\t\tgamepad.on('gamepad:button', (e: any)=> {\n\t\t\t\tif (! document.hasFocus()) return;\n//console.log(`fn:EventMng.ts 👺 'gamepad:button' detail:%o`, e.detail);\n\t\t\t\tif (e.detail.button % 2 === 0) {\n\t\t\t\t\tconst cmp = this.#fcs.getFocus();\n\t\t\t\t\t((! cmp || cmp instanceof Container) ?globalThis :cmp)\n\t\t\t\t\t.dispatchEvent(new KeyboardEvent(EVNM_KEY, {key: 'Enter', bubbles: true}));\n\t\t\t\t}\n\t\t\t\telse Reading.fire('middleclick', e);\n\t\t\t});\n\t\t\tgamepad.start();\n\n\t\t});\n\n\t\tthis.#elc.add(window, 'keyup', (e: any)=> {\n\t\t\tif (e['isComposing']) return;\t// サポートしてない環境でもいける書き方\n\n\t\t\tif (e.key in this.#hDownKeys) this.#hDownKeys[e.key] = eDownKeys.NO_PUSH;\n\t\t});\n\t\tval.defTmp('const.sn.key.alternate', ()=> this.#hDownKeys.Alt! > eDownKeys.NO_PUSH);\n\t\tval.defTmp('const.sn.key.command', ()=> this.#hDownKeys.Meta! > eDownKeys.NO_PUSH);\n\t\tval.defTmp('const.sn.key.control', ()=> this.#hDownKeys.Control! > eDownKeys.NO_PUSH);\n\t\tval.defTmp('const.sn.key.end', ()=> this.#hDownKeys.End! > eDownKeys.NO_PUSH);\n\t\tval.defTmp('const.sn.key.escape', ()=> this.#hDownKeys.Escape! > eDownKeys.NO_PUSH);\n\t\tval.defTmp('const.sn.key.back', ()=> this.#hDownKeys.GoBack! > eDownKeys.NO_PUSH);\n\t}\n\n\tresvFlameEvent(win: Window) {\n\t\tthis.#elc.add(win, EVNM_KEY, e=> this.#ev_keydown(e));\n\t\tthis.#elc.add(win, 'contextmenu', e=> {\n\t\t\t//if (! e.isTrusted) return;\n\n\t\t\tReading.fire(this.#modKey4MouseEvent(e) +'rightclick', e);\n\t\t\te.preventDefault();\t\t// イベント未登録時、メニューが出てしまうので\n\t\t});\n\t\tthis.#resvFlameEvent4Wheel(win);\n\t}\n\t#resvFlameEvent4Wheel = (_win: Window)=> {};\n\t#ev_keydown(e: KeyboardEvent) {\n\t\t//if (! e.isTrusted) return;\n\t\tif (e['isComposing']) return;\t// サポートしてない環境でもいける書き方\n\n\t\tif (e.key in this.#hDownKeys) this.#hDownKeys[e.key] = e.repeat ?eDownKeys.PUSH_REPEATING :eDownKeys.ONE_PUSH;\n\n\t\tReading.fire(SysBase.modKey(e) + e.key, e);\n\t}\n\t\t#modKey4MouseEvent(e: MouseEvent) {\n\t\t\treturn (e.altKey ?'alt+' :'')\n\t\t\t+\t(e.ctrlKey ?'ctrl+' :'')\n\t\t\t+\t(e.metaKey ?'meta+' :'')\n\t\t\t+\t(e.shiftKey ?'shift+' :'');\n\t\t}\n\n\t// 縦回転ホイール\n\t#ev_wheel(e: WheelEvent) {\n\t\t//if (! e.isTrusted) return;\n\n\t\tif (this.#wheeling) {this.#extend_wheel = true; return}\n\t\tthis.#wheeling = true;\n\t\tthis.#ev_wheel_waitstop();\n\n\t\t// 今のところ縦回転ホイールのみ想定\n\t\tconst key = this.#modKey4MouseEvent(e)\n\t\t+\t(e.deltaY > 0 ?'downwheel' :'upwheel');\n\t\tReading.fire(key, e);\n\t}\n\t#wheeling = false;\n\t#extend_wheel = false;\n\t#ev_wheel_waitstop() {\n\t\tsetTimeout(()=> {\t// clearTimeout()不要と判断\n\t\t\tif (this.#extend_wheel) {\n\t\t\t\tthis.#extend_wheel = false;\n\t\t\t\tthis.#ev_wheel_waitstop();\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.#wheeling = false;\n\t\t}, 250);\n\t}\n\n\tdestroy() {\n\t\tfor (const v of Array.from(document.getElementsByClassName('sn_hint'))) v.parentElement?.removeChild(v);\t// ギャラリーリロード用初期化\n\n\t\tReadingState.destroy();\n\t\tthis.#fcs.destroy();\n\t\tthis.#elc.clear();\n\t}\n\n\tfire(KEY: string, e: Event) {Reading.fire(KEY, e)}\n\n\tunButton(ctnBtn: Container) {this.#fcs.remove(ctnBtn)}\n\tbutton(hArg: HArg, ctnBtn: Container, normal: ()=> void, hover: ()=> boolean, clicked: ()=> void) {\n\t\tif (! hArg.fn && ! hArg.label && ! hArg.url) this.main.errScript('fnまたはlabelまたはurlは必須です');\n\t\thArg.fn ??= this.scrItr.scriptFn;\n\n\t\t// クリックイベント予約\n\t\tctnBtn.interactive = true;\n\t\tctnBtn.cursor = 'pointer';\n\t\tconst key = hArg.key?.toLowerCase() ?? ' ';\n\t\tconst glb = argChk_Boolean(hArg, 'global', false);\n\t\tReadingState.setEvt2Fnc(glb, key, ()=> this.main.resumeByJumpOrCall(hArg));\n\t\tctnBtn.on(EVNM_CLICK, (e: InteractionEvent)=> {\n\t\t\t// e.stopPropagation();\t// fire() 内でやる\n\t\t\t// e.stopImmediatePropagation();\t// err\n\t\t\t// e.preventDefault();\t//  is not a function\n\t\t\tReading.fire(key, <any>e);\n\t\t});\n\t\t\t// 直後にも pointer〜 があるのでダブリに見えるが、こちらが fire 用\n\n\t\t// マウスイベント発生\n\t\t// マウスカーソルを載せるとヒントをツールチップス表示する\n\t\tconst onHint = hArg.hint ?()=> this.#dispHint(hArg, ctnBtn) :()=> {};\n\t\t// マウスオーバーでの見た目変化\n\t\tconst nr = ()=> {normal(); this.#elmHint.hidden = true};\n\t\tconst hv = ()=> {onHint(); return hover()};\n\t\tctnBtn.on('pointerover', hv);\n\t\tctnBtn.on('pointerout', ()=> {if (this.#fcs.isFocus(ctnBtn)) hv(); else nr()});\n\t\tctnBtn.on('pointerdown', ()=> {\n\t\t\tthis.#elmHint.hidden = true;\n\t\t\tconst f = this.#fcs.getFocus();\n\t\t\tclicked();\n\t\t\tif (f instanceof Button) f.normal();// 旧フォーカスボタンを通常状態に\n\t\t});\n\t\tctnBtn.on('pointerup', CmnLib.isMobile\n\t\t\t? nr\n\t\t\t: ()=> {if (this.#fcs.isFocus(ctnBtn)) hv(); else nr()}\n\t\t);\n\t\t// フォーカス処理対象として登録\n\t\tthis.#fcs.add(ctnBtn, hv, nr);\n\n\t\t// 音関係\n\t\tif (hArg.clickse) {\t//\tclickse\tクリック時に効果音\n\t\t\thArg.clicksebuf ??= 'SYS';\n\t\t\tthis.cfg.searchPath(hArg.clickse, SEARCH_PATH_ARG_EXT.SOUND);// 存在チェック\n\t\t\tctnBtn.on('pointerdown', ()=> {\n\t\t\t\tthis.hTag.playse!({fn: hArg.clickse, buf: hArg.clicksebuf, join: false});\n\t\t\t});\n\t\t}\n\t\tif (hArg.enterse) {\t//\tenterse\tボタン上にマウスカーソルが載った時に効果音\n\t\t\thArg.entersebuf ??= 'SYS';\n\t\t\tthis.cfg.searchPath(hArg.enterse, SEARCH_PATH_ARG_EXT.SOUND);// 存在チェック\n\t\t\tctnBtn.on('pointerover', ()=> {\n\t\t\t\tthis.hTag.playse!({fn: hArg.enterse, buf: hArg.entersebuf, join: false});\n\t\t\t});\n\t\t}\n\t\tif (hArg.leavese) {\t//\tleavese\tボタン上からマウスカーソルが外れた時に効果音\n\t\t\thArg.leavesebuf ??= 'SYS';\n\t\t\tthis.cfg.searchPath(hArg.leavese, SEARCH_PATH_ARG_EXT.SOUND);// 存在チェック\n\t\t\tctnBtn.on('pointerout', ()=> {\n\t\t\t\tthis.hTag.playse!({fn: hArg.leavese, buf: hArg.leavesebuf, join: false});\n\t\t\t});\n\t\t}\n\n\t\tif (hArg.onenter) {\n\t\t\t// マウス重なり（フォーカス取得）時、ラベルコール。必ず[return]で戻ること\n\t\t\tconst k = key + hArg.onenter.toLowerCase();\n\t\t\tconst o: HArg = {fn: hArg.fn, label: hArg.onenter, call: true, key: k};\n\t\t\tReadingState.setEvt2Fnc(glb, k, ()=> this.main.resumeByJumpOrCall(o));\n\t\t\tctnBtn.on('pointerover', (e: any)=> Reading.fire(k, e));\n\t\t}\n\t\tif (hArg.onleave) {\n\t\t\t// マウス外れ（フォーカス外れ）時、ラベルコール。必ず[return]で戻ること\n\t\t\tconst k = key + hArg.onleave.toLowerCase();\n\t\t\tconst o: HArg = {fn: hArg.fn, label: hArg.onleave, call: true, key: k};\n\t\t\tReadingState.setEvt2Fnc(glb, k, ()=> this.main.resumeByJumpOrCall(o));\n\t\t\tctnBtn.on('pointerout', (e: any)=> Reading.fire(k, e));\n\t\t}\n\t}\n\treadonly\t#elmV = {\n\t\tgetBoundingClientRect: (x = 0, y = 0)=> DOMRect.fromRect({x, y, width: 0, height: 0,}),\n\t};\n\treadonly\t#elmHint\t: HTMLElement;\n\treadonly\t#spanHint\t: HTMLElement;\n\treadonly\t#popper\t\t: InsPop;\n\treadonly\t#oHintOpt\t= {\n\t\tplacement: 'bottom',\n\t\tmodifiers: [\n\t\t\t{\t// Flip | Popper https://popper.js.org/docs/v2/modifiers/flip/\n\t\t\t\tname: 'flip',\n\t\t\t\toptions: {\n\t\t\t\t\tfallbackPlacements: ['top', 'bottom'],\n\t\t\t\t},\n\t\t\t},\n\t\t],\n\t};\n\t#dispHint(hArg: HArg, ctnBtn: Container) {\n\t\tconst rctBtn = ctnBtn instanceof Button\n\t\t\t? ctnBtn.getBtnBounds()\n\t\t\t: ctnBtn.getBounds();\n\t\tconst isLink = (hArg[':タグ名'] === 'link');\n\t\tif (! isLink) {\n\t\t\tconst cpp = ctnBtn.parent.parent;\n\t\t\trctBtn.x += cpp.x;\t// レイヤ位置を加算\n\t\t\trctBtn.y += cpp.y;\n\t\t}\n\t\tif (! hArg.hint) {this.#elmHint.hidden = true; return}\n\n\t\tthis.#elmHint.style.cssText = `position:${this.#elmHint.style.position}; transform:${this.#elmHint.style.transform};`+ (hArg.hint_style ?? '');\n\t\tthis.#spanHint.style.cssText = '';\n\t\tthis.#spanHint.textContent = hArg.hint ?? '';\n\n\t\ttry {\n\t\t\tconst o = hArg.hint_opt ?{...this.#oHintOpt, ...JSON.parse(hArg.hint_opt)}: this.#oHintOpt;\n\t\t\tthis.#popper.setOptions(o);\n\t\t} catch (e) {console.error(mesErrJSON(\n\t\t\thArg,\n\t\t\t'hint_opt', \n\t\t\t`dispHint 引数 hint_opt エラー ${\n\t\t\t\te instanceof SyntaxError ?e.message :''\n\t\t\t}`,\n\t\t))}\n\n\t\tthis.#elmV.getBoundingClientRect = ()=> DOMRect.fromRect({\n\t\t\tx: this.sys.ofsLeft4elm +rctBtn.x *this.sys.cvsScale,\n\t\t\ty: this.sys.ofsTop4elm  +rctBtn.y *this.sys.cvsScale,\n\t\t\twidth: rctBtn.width, height: rctBtn.height,\n\t\t});\n\t\tthis.#popper.update();\n\n\t\tthis.#elmHint.hidden = false;\n\t}\n\thideHint() {this.#elmHint.hidden = true}\n\tcvsResize() {this.hideHint()}\n\n\n\t#event(hArg: HArg): boolean {\n\t\tconst rawKeY = hArg.key;\n\t\tif (! rawKeY) throw 'keyは必須です';\n\t\tconst key = rawKeY.toLowerCase();\n\n\t\tconst call = argChk_Boolean(hArg, 'call', false);\n\t\tconst glb = argChk_Boolean(hArg, 'global', false);\n\t\tif (argChk_Boolean(hArg, 'del', false)) {\n\t\t\tif (hArg.fn || hArg.label || call || hArg.url) throw 'fn/label/callとdelは同時指定できません';\n\n\t\t\tReadingState.clear_eventer(rawKeY, glb, key);\n\n\t\t\t// その他・キーボードイベント\n\t\t\treturn false;\n\t\t}\n\n\t\tif (! hArg.fn && ! hArg.label && ! hArg.url) throw 'fn,label,url いずれかは必須です';\n\t\thArg.fn ??= this.scrItr.scriptFn;\n\n\t\t// domイベント\n\t\tif (rawKeY.startsWith('dom=')) {\n\t\t\tconst g = ReadingState.getHtmlElmList(rawKeY);\n\t\t\tif (g.el.length === 0) {\n\t\t\t\tif (argChk_Boolean(hArg, 'need_err', true)) throw `HTML内にセレクタ（${g.sel}）に対応する要素が見つかりません。存在しない場合を許容するなら、need_err=false と指定してください`;\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tlet aEv = ['click', EVNM_KEY];\t// ラジオボタンも\n\t\t\tconst inp = g.el[0] as HTMLInputElement;\n\t\t\tswitch (inp.type ?? '') {\n\t\t//\tswitch (g.el[0].getAttribute('type') ?? '') { textareaで''になる\n\t\t\t\tcase 'checkbox':\taEv = ['input'];\tbreak;\n\t\t\t\tcase 'range':\t\taEv = ['input'];\tbreak;\n\t\t\t\tcase 'text':\n\t\t\t\tcase 'textarea':\taEv = ['input', 'change'];\tbreak;\n\t\t\t}\n\n\t\t\tconst len = aEv.length;\n\t\t\tfor (let i=0; i<len; ++i) {\n\t\t\t\tconst v = aEv[i]!;\n\t\t\t\tg.el.forEach(elm=> {\n\t\t\t\t\tthis.#elc.add(elm, v, e=> {\n\t\t\t\t\t\tif (! Reading.isWait || this.layMng.getFrmDisabled(g.id)) return;\n\t\t\t\t\t\tif (v === EVNM_KEY && e.key !== 'Enter') return;\n\t\n\t\t\t\t\t\tconst d = elm.dataset;\n\t\t\t\t\t\tfor (const [k, v] of Object.entries(d)) this.val.setVal_Nochk('tmp', `sn.event.domdata.${k}`, v);\n\t\t\t\t\t\tReading.fire(rawKeY, e);\n\t\t\t\t\t});\n\n\t\t\t\t\t// フォーカス処理対象として登録\n\t\t\t\t\tif (i === 0) this.#fcs.add(\n\t\t\t\t\t\telm,\n\t\t\t\t\t\t()=> {\n\t\t\t\t\t\t\tif (! this.#canFocus(elm)) return false;\n\t\t\t\t\t\t\telm.focus();\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t},\n\t\t\t\t\t\t()=> {},\n\t\t\t\t\t);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// return;\t// hGlobalEvt2Fnc(hLocalEvt2Fnc)登録もする\n\t\t}\n\n\t\t// その他・キーボードイベント\n\t\tReadingState.setEvt2Fnc(glb, key, ()=> this.main.resumeByJumpOrCall(hArg));\n\n\t\treturn false;\n\t}\n\t#canFocus(elm: HTMLElement): boolean {\n\t\tif (elm.offsetParent === null) return false;\n\n\t\tlet el: HTMLElement | null = elm;\n\t\tdo {\n\t\t\tconst style = getComputedStyle(el);\n\t\t\tif (style.display === 'none'\n\t\t\t|| el.dataset.focus === 'false'\n\t\t//\t|| style.visibility !== 'visible'\n\t\t\t|| (el as any)?.disabled\n\t\t//\t|| parseFloat(style.opacity ?? '') <= 0.0\n\t\t//\t|| parseInt(style.height ?? '', 10) <= 0\n\t\t//\t|| parseInt(style.width ?? '', 10) <= 0\n\t\t\t) return false;\n\t\t\tel = el.parentElement;\n\t\t}\n\t\twhile (el !== null);\n\n\t\treturn true;\n\t}\n\n\t// フォーカス移動\n\t#set_focus(hArg: HArg) {\n\t\tconst {add, del, to} = hArg;\n\t\tif (add?.startsWith('dom=')) {\n\t\t\tconst g = ReadingState.getHtmlElmList(add);\n\t\t\tif (g.el.length === 0 && argChk_Boolean(hArg, 'need_err', true)) throw `HTML内にセレクタ（${g.sel}）に対応する要素が見つかりません。存在しない場合を許容するなら、need_err=false と指定してください`;\n\n\t\t\tg.el.forEach(elm=> this.#fcs.add(\n\t\t\t\telm,\n\t\t\t\t()=> {\n\t\t\t\t\tif (! this.#canFocus(elm)) return false;\n\t\t\t\t\telm.focus();\n\t\t\t\t\treturn true;\n\t\t\t\t},\n\t\t\t\t()=> {},\n\t\t\t));\n\t\t\treturn false;\n\t\t}\n\n\t\tif (del?.startsWith('dom=')) {\n\t\t\tconst g = ReadingState.getHtmlElmList(del);\n\t\t\tif (g.el.length === 0 && argChk_Boolean(hArg, 'need_err', true)) throw `HTML内にセレクタ（${g.sel}）に対応する要素が見つかりません。存在しない場合を許容するなら、need_err=false と指定してください`;\n\n\t\t\tg.el.forEach(elm=> this.#fcs.remove(elm));\n\t\t\treturn false;\n\t\t}\n\n\t\tif (! to) throw '[set_focus] add か to は必須です';\n\t\tswitch (to) {\n\t\t\tcase 'null':\tthis.#fcs.blur();\tbreak;\n\t\t\tcase 'next':\tthis.#fcs.next();\tbreak;\n\t\t\tcase 'prev':\tthis.#fcs.prev();\tbreak;\n\t\t}\n\t\treturn false;\n\t}\n\n\n\t// キー押しっぱなしスキップ中か\n\tget\tisSkipping(): boolean {\n\t\tif (Reading.isSkipping) return true;\n\t\treturn Object.keys(this.#hDownKeys).some(k=> this.#hDownKeys[k] === eDownKeys.PUSH_REPEATING);\n\t}\n\t// 0:no push  1:one push  2:push repeating\n\treadonly #hDownKeys\t: {[key: string]: number}\t= {\n\t\t'Alt'\t\t: eDownKeys.NO_PUSH,\n\t\t'Meta'\t\t: eDownKeys.NO_PUSH,\t// COMMANDキー\n\t\t'Control'\t: eDownKeys.NO_PUSH,\n\t\t'ArrowDown'\t: eDownKeys.NO_PUSH,\n\t\t'End'\t\t: eDownKeys.NO_PUSH,\n\t\t'Enter'\t\t: eDownKeys.NO_PUSH,\n\t\t'Escape'\t: eDownKeys.NO_PUSH,\n\t\t' '\t\t\t: eDownKeys.NO_PUSH,\n\t\t'GoBack'\t: eDownKeys.NO_PUSH,\t// AndroidのBackキーだと思う\n\t}\n\n}\n","/* ***** BEGIN LICENSE BLOCK *****\n\tCopyright (c) 2025-2025 Famibee (famibee.blog38.fc2.com)\n\n\tThis software is released under the MIT License.\n\thttp://opensource.org/licenses/mit-license.php\n** ***** END LICENSE BLOCK ***** */\n\nimport type {HArg, IHTag} from './Grammar';\nimport type {IEvt2Fnc, IHEvt2Fnc, IMain, IMark, IVariable} from './CmnInterface';\nimport {argChk_Boolean, argChk_Num, CmnLib} from './CmnLib';\nimport type {Config} from './Config';\nimport type {ScriptIterator} from './ScriptIterator';\nimport type {LayerMng} from './LayerMng';\nimport {EVNM_CLICK, type EventMng} from './EventMng';\nimport type {FocusMng} from './FocusMng';\nimport type {SoundMng} from './SoundMng';\nimport {EventListenerCtn} from './EventListenerCtn';\n\nimport {Container} from 'pixi.js';\nimport {Tween, remove} from '@tweenjs/tween.js'\n\ninterface IPageLog {\n\tkey\t\t: string;\n\tfn\t\t: string;\n\tindex\t: number;\n\tmark\t: IMark;\n\tweek\t: boolean;\n};\n\n\nexport class ReadingState {\n\tstatic\t#rs: ReadingState;\n\tstatic\tget rs() {return this.#rs}\n\tconstructor() {ReadingState.#rs = this}\n\n\tstatic\t#hLocalEvt2Fnc\t: IHEvt2Fnc = {};\n\tstatic\t#hGlobalEvt2Fnc\t: IHEvt2Fnc = {};\n\tstatic\tsetEvt2Fnc(glb: boolean, key: string, fnc: IEvt2Fnc) {\n\t\tif (glb)\n\t\t\tthis.#hGlobalEvt2Fnc[key] = fnc;\n\t\telse this.#hLocalEvt2Fnc[key] = fnc;\n\t}\n\tstatic\tgetEvt2Fnc = (key: string): IEvt2Fnc | undefined => this.#hLocalEvt2Fnc[key] ?? this.#hGlobalEvt2Fnc[key];\n\tstatic\tclear_eventer(rawKeY: string, glb: boolean, key: string) {\n\t\tif (! rawKeY.startsWith('dom=')) return;\n\n\t\tconst e2f = glb ? this.#hGlobalEvt2Fnc[key] : this.#hLocalEvt2Fnc[key];\n\t\tif (e2f) this.getHtmlElmList(rawKeY).el.forEach(v=> v.removeEventListener('click', e2f));\n\t\tif (glb) delete this.#hGlobalEvt2Fnc[key];\n\t\telse\tdelete this.#hLocalEvt2Fnc[key];\n\t}\n\n\tstatic\tpopLocalEvts(): IHEvt2Fnc {\n\t\tconst ret = this.#hLocalEvt2Fnc;\n\t\tthis.#hLocalEvt2Fnc = {};\n\t\treturn ret;\n\t}\n\tstatic\tpushLocalEvts(h: IHEvt2Fnc) {this.#hLocalEvt2Fnc = h}\n\n\tstatic\tclear_event(hArg: HArg): boolean {\n\t\tconst glb = argChk_Boolean(hArg, 'global', false);\n\t\tconst h = glb ?this.#hGlobalEvt2Fnc :this.#hLocalEvt2Fnc;\n\t\tfor (const [KeY, e2f] of Object.entries(h)) {\n\t\t\tif (! KeY.startsWith('dom=')) continue;\n\n\t\t\tthis.getHtmlElmList(KeY).el.forEach(v=> v.removeEventListener('click', e2f));\n\t\t}\n\t\tif (glb) this.#hGlobalEvt2Fnc = {}; else this.#hLocalEvt2Fnc = {};\n\n\t\treturn false;\n\t}\n\t\tstatic\tgetHtmlElmList(KeY: string): {el: NodeListOf<HTMLElement>, id: string, sel: string} {\n\t\t\tconst idx = KeY.indexOf(':');\n\t\t\tlet sel = '';\n\t\t\tif (idx >= 0) {\t\t// key='dom=config:#ctrl2val\n\t\t\t\tconst id = KeY.slice(4, idx);\n\t\t\t\tconst frmnm = `const.sn.frm.${id}`;\n\t\t\t\tif (! Reading.val.getVal(`tmp:${frmnm}`, 0)) throw `HTML【${id}】が読み込まれていません`;\n\n\t\t\t\tconst ifrm = document.getElementById(id) as HTMLIFrameElement;\n\t\t\t\tconst win = ifrm.contentWindow!;\n\t\t\t\tsel = KeY.slice(idx +1);\n\t\t\t\treturn {el: win.document.querySelectorAll(sel), id, sel};\n\t\t\t}\n\n\t\t\tsel = KeY.slice(4);\n\t\t\treturn {el: document.querySelectorAll(sel), id: '', sel};\n\t\t}\n\n\t// 予約イベントの発生待ち\n\tstatic\twaitRsvEvent(glb: boolean, onUserAct?: ()=> void): void {\n\t\tReading.val.saveKidoku();\n\n\t\tif (onUserAct) {\n\t\t\t//hTag.event({key:'click', breakout: fnc});\n\t\t\t//hTag.event({key:'middleclick', breakout: fnc});\n\t\t\t//\thTag.event()は内部で使わず、こうする\n\t\t\tthis.#hLocalEvt2Fnc['click'] =\n\t\t\tthis.#hLocalEvt2Fnc['enter'] =\n\t\t\tthis.#hLocalEvt2Fnc['arrowdown'] =\n\n\t\t\t// hTag.event({key:'downwheel', breakout: fnc});\n\t\t\tthis.#hLocalEvt2Fnc['wheel.y>0'] = ()=> onUserAct();\n\t\t}\n\t\telse {\n\t\t\tdelete this.#hLocalEvt2Fnc['click'];\n\t\t\tdelete this.#hLocalEvt2Fnc['enter'];\n\t\t\tdelete this.#hLocalEvt2Fnc['arrowdown'];\n\t\t\tdelete this.#hLocalEvt2Fnc['wheel.y>0'];\n\t\t}\n\t\tthis.getEvt2Fnc = glb\n\t\t\t? key=> this.#hLocalEvt2Fnc[key]\n\t\t\t\t?? this.#hGlobalEvt2Fnc[key]\n\t\t\t: key=> this.#hLocalEvt2Fnc[key];\n\n\t\tReading.scrItr.noticeWait();\n\t\tif (CmnLib.debugLog) {\n\t\t\tconst o = Object.create(null);\n\t\t\to.local = Object.keys(this.#hLocalEvt2Fnc);\n\t\t\to.global= Object.keys(this.#hGlobalEvt2Fnc);\n\t\t\tconsole.log(`🎍 wait event... %o`, o);\n\t\t}\n\t}\n\n\tstatic\twaitRsvEvent4Paging() {\n\t\tthis.waitRsvEvent(true);\n\n\t\tif (this.aKeysAtPaging.length === 0) {\n\t\t\tthis.getEvt2Fnc = key=>\n\t\t\t\tthis.#hLocalEvt2Fnc[key]\n\t\t\t?? this.#hGlobalEvt2Fnc[key];\n\t\t\treturn;\n\t\t}\n\n\t\tconst hGlb: IHEvt2Fnc = {};\n\t\tfor (const k of this.aKeysAtPaging) {\n\t\t\tconst v = this.#hGlobalEvt2Fnc[k];\n\t\t\tif (v) hGlb[k] = v;\n\t\t}\n\t\tthis.getEvt2Fnc = key=> this.#hLocalEvt2Fnc[key] ?? hGlb[key];\n\t}\n\n\n\tfire(rawKeY: string, e: Event) {\n\t\t//if (this.#isDbgBreak) return;\n\n\t\t// 予約実行\n\t\tconst key = rawKeY.toLowerCase();\n\t\tif (CmnLib.debugLog) console.log(`👺 fire<(key:\\`${key}\\` type:${e.type} e:%o)`, {...e});\n\t\tif (key === 'enter') {\n\t\t\tconst em = Reading.fcs.getFocus();\n\t\t\tif (em instanceof Container) {\n\t\t\t\tem.emit('pointerdown', new PointerEvent('pointerdown'));\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tconst ke = ReadingState.getEvt2Fnc(key);\n\t\tif (! ke) return;\t\t// 予約されていないイベントなので無視\n\n\t\te.stopPropagation();\n\t\tif (! key.startsWith('dom=') && Reading.layMng.clickTxtLay()) return;\n\n\t\tke(e);\n\t\t//this.hLocalEvt2Fnc = {};\t// ここで消去禁止、Main.resumeByJumpOrCall()が担当\n\t}\n\tget\tisSkipping() {return Reading.skip_enabled}\n\treadonly\tisWait: boolean\t= false;\n\n\n\tstatic\taPage\t: IPageLog[];\n\tstatic\tlenPage = 0;\n\tstatic\tposPage = 0;\n\tstatic\tstyPaging\t: string;\n\tstatic\treadonly\tINI_STYPAGE = 'color: yellow; text-shadow: 1px 1px 0 #000, -1px 1px 0 #000, 1px -1px 0 #000, -1px -1px 0 #000;';\n\n\tstatic\taKeysAtPaging: string[]\t= [];\n\n\tstatic\trecodePage(week = false) {\n\t\tif (! Reading.val.getVal('save:sn.doRecLog')) return;\n\n\t\tconst {fn, idx} = Reading.scrItr.nowScrIdx();\n\t\tconst key = `${idx -1}:`+ fn;\t// 検索時の都合で -1\n\t\tif (this.aPage.findIndex(p=> p.key === key) > -1) return;\t// 保存済\n\n\t\tif (CmnLib.debugLog) console.log(`📜 %crecodePage === week:${week} lenPage:${this.lenPage} len:${this.aPage.length} POP:${!! this.aPage.at(-1)?.week}`, 'color:#3B0;');\n\n\t\tif (this.aPage.at(-1)?.week) this.aPage.pop();\n\t\tconst {max_len} = Reading.cfg.oCfg.log;\t// 一定数を保つ\n\t\tif (this.aPage.push({key, week,\n\t\t\tfn\t\t: Reading.val.getVal('save:const.sn.scriptFn', fn),\n\t\t\tindex\t: Reading.val.getVal('save:const.sn.scriptIdx', 0),\n\t\t\tmark\t: Reading.scrItr.nowMark(),\n\t\t}) > max_len) this.aPage = this.aPage.slice(-max_len);\n\t\tthis.lenPage = this.aPage.length;\n\n\t\tif (CmnLib.debugLog) {\n\t\t\tconst m = Reading.scrItr.nowMark();\n\t\t\tconsole.log(`   %clenPage:${this.lenPage} (base=${m.hPages.base!.fore.sBkFn} 0=${m.hPages['0']!.fore.sBkFn} mes=${m.hPages.mes!.fore.txs.cssText.match(/color: \\w+;/)})%c mark:%o`, 'color:#3B0;', '', m);\n\t\t\tconsole.table(this.aPage);\n\t\t}\n\n\t\tReading.val.setVal_Nochk('sys', 'const.sn.aPageLog', JSON.stringify(this.aPage));\n\t}\n\tstatic\tplaybackPage(saPageLog: string, $styPaging: string) {\n\t\tthis.aPage = JSON.parse(saPageLog);\n\t\tthis.lenPage = this.aPage.length;\n\t\tif (this.posPage >= this.lenPage) this.posPage = this.lenPage -1;\n\t\tthis.styPaging = $styPaging;\n\t}\n\n\tbeginProc() {new ReadingState_proc}\n\tendProc() {new ReadingState_go}\n\n\n\t// タグ処理\n\tl(hArg: HArg): boolean {\nconsole.log(`fn:Reading.ts line:218 [l] isKidoku:${Reading.scrItr.isKidoku} isNextKidoku:${Reading.scrItr.isNextKidoku} A:${Reading.auto_enabled} B:${Reading.skip_enabled} C:${Reading.skip_all}`);\n\t\tif (! Reading.tagL_enabled) return false;\n\n\t\tReadingState.recodePage(true);\n\n\t\t// クリック待ちを表示\n\t\tif (argChk_Boolean(hArg, 'visible', true)) {\n\t\t\tReading.layMng.breakLine(hArg);\n\t\t\tReading.goTxt();\n\t\t}\n\n\t\tif (Reading.auto_enabled) {\n\t\t\thArg.time = Number(Reading.val.getVal(`sys:sn.auto.msecLineWait${Reading.scrItr.isKidoku ?'_Kidoku' :''}`));\n\t\t\treturn this.wait(hArg);\n\t\t}\n\t\tif (Reading.skip_enabled) {\t// Fスキップ時\n\t\t\tif (! Reading.scrItr.isNextKidoku) {\n\t\t\t\tReading.cancelAutoSkip();\t// 未読で停止\n\t\t\t\tnew ReadingState_wait4Tag(hArg);\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\tif (! Reading.skip_all && ! Reading.scrItr.isNextKidoku) {\n\t\t\t\treturn this.s(hArg);\t// 未読で停止\n\t\t\t}\n\t\t\tif ('ps'.includes(Reading.val.getVal('sys:sn.skip.mode'))) {\n\t\t\t\thArg.time = 50;\t// 改行待ち=しない\t// 魔法数字、見えるぐらい少し待つ\n\t\t\t\treturn this.wait(hArg);\n\t\t\t}\n\t\t}\n\n\t\tnew ReadingState_wait4Tag(hArg);\n\t\treturn true;\n\t}\n\tp(hArg: HArg): boolean {\nconsole.log(`fn:Reading.ts line:248 [p] isKidoku:${Reading.scrItr.isKidoku} isNextKidoku:${Reading.scrItr.isNextKidoku} A:${Reading.auto_enabled} B:${Reading.skip_enabled} C:${Reading.skip_all}`);\n\t\tReadingState.recodePage();\n\n\t\t// クリック待ちを表示\n\t\tif (argChk_Boolean(hArg, 'visible', true)) {\n\t\t\tReading.layMng.breakPage(hArg);\n\t\t\tReading.goTxt();\n\t\t}\n\n\t\tif (Reading.auto_enabled) {\n\t\t\thArg.time = Number(Reading.val.getVal(`sys:sn.auto.msecPageWait${Reading.scrItr.isKidoku ?'_Kidoku' :''}`));\n\t\t\treturn this.wait(hArg);\n\t\t}\n\t\tif (Reading.skip_enabled) {\t// Fスキップ時\n\t\t\tif (! Reading.skip_all && ! Reading.scrItr.isNextKidoku) {\n\t\t\t\treturn this.s(hArg);\t// 未読で停止\n\t\t\t}\n\t\t\tif ('s' == Reading.val.getVal('sys:sn.skip.mode')) {\n\t\t\t\thArg.time = 50;\t// 改行待ち=しない\t// 魔法数字、見えるぐらい少し待つ\n\t\t\t\treturn this.wait(hArg);\n\t\t\t}\n\t\t}\n\n\t\tnew ReadingState_wait4Tag(hArg);\n\t\treturn true;\n\t}\n\ts(hArg: HArg): boolean {\n\t\tReadingState.recodePage();\n\n\t\tReading.cancelAutoSkip();\n\t\tnew ReadingState_wait4Tag(hArg);\n\t\treturn true;\n\t}\n\twait(hArg: HArg): boolean {\n\t\tconst time = argChk_Num(hArg, 'time', NaN);\t// skip時もエラーは出したい\n\t\tif (Reading.skip_enabled) {\t\t// Fスキップ時\n\t\t\tif (! Reading.skip_all && ! Reading.scrItr.isNextKidoku) Reading.cancelAutoSkip();\t// 未読で停止\n\n\t\t\treturn false;\n\t\t}\n\n\t\tconst tw = new Tween({});\n\t\tconst RPN_WAIT = 'wait';\n\t\tconst fin = ()=> {remove(tw); Reading.notifyEndProc(RPN_WAIT)}\n\t\ttw.to({}, time)\n\t\t.onComplete(fin)\n\t\t.start();\n\n\t\tconst canskip = argChk_Boolean(hArg, 'canskip', true);\n\t\tReading.beginProc(RPN_WAIT, fin, true, canskip ?fin :undefined);\n\t\treturn true;\n\t}\n\tpage(hArg: HArg): boolean {\n\t\tif (! ('clear' in hArg || 'to' in hArg || 'style' in hArg)) throw 'clear,style,to いずれかは必須です';\n\n\t\t// ページ移動状態中に有効にするグローバルイベントを限定\n\t\tconst {key, style} = hArg;\n\t\tif (key) ReadingState.aKeysAtPaging = key.split((','));\n\n\t\tif (style) {\n\t\t\tReadingState.styPaging = style;\n\t\t\tReading.val.setVal_Nochk('save', 'const.sn.styPaging', style);\n\t\t\treturn false;\n\t\t}\n\n\t\tif (argChk_Boolean(hArg, 'clear', false)) {\n\t\t\tReadingState.aPage = [];\n\t\t\tReadingState.lenPage = 0;\n\t\t\tReadingState.posPage = 0;\n\t\t\tReading.val.setVal_Nochk('sys', 'const.sn.aPageLog', '[]');\n\t\t\tReading.val.setVal_Nochk('save', 'const.sn.styPaging', ReadingState.INI_STYPAGE);\n\t\t\treturn false;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\n\tstatic\tdestroy() {\n\t\tthis.#hLocalEvt2Fnc = {};\n\t\tthis.#hGlobalEvt2Fnc = {};\n\t\tthis.aPage = [];\n\t\tthis.lenPage = 0;\n\t\tthis.posPage = 0;\n\t}\n\n}\n\n// go 状態\n//\t通常・タグなどを次々に処理\nclass ReadingState_go extends ReadingState {\n\tconstructor() {\n\t\tsuper();\n\t\tif (CmnLib.debugLog) console.log(`📖 => %cReadingState_go`, 'color:#3B0;');\n\n\t\tReading.main.resume();\n\t}\n\toverride\tfire(_KeY: string, _e: Event) {}\t// システムボタンなど無効化\n}\n\n// proc 状態\n//\tスクリプト・画像・音声ロードなど\nclass ReadingState_proc extends ReadingState {\n\tconstructor() {\n\t\tsuper();\n\t\tif (CmnLib.debugLog) console.log(`📖 => %cReadingState_proc`, 'color:#3B0;');\n\t}\n}\n\n// wait 状態\n//\tイベント待ちやクリック待ち\nclass ReadingState_wait4Tag extends ReadingState {\n\tconstructor(hArg: HArg) {\n\t\tsuper();\n\t\tif (CmnLib.debugLog) console.log(`📖 => %cReadingState_wait`, 'color:#3B0;');\n\n\t\t// Reading.scrItr.noticeBreak(true);\n\n\t\tlet onUserAct = ()=> {};\n\t\tconst glb = argChk_Boolean(hArg, 'global', true);\n\t\tswitch (hArg[':タグ名']) {\n\t\t\tcase 'wait':\treturn;\t// 予約イベント待ち【しない】\n\n\t\t\tcase 's':\n\t\t\t\tReadingState.waitRsvEvent(glb);\t// ユーザーイベントに反応しない\n\t\t\t\treturn;\n\n\t\t\tcase 'p':\n\t\t\t\tonUserAct = ()=> {\n\t\t\t\t\tif (argChk_Boolean(hArg, 'er', false)) Reading.hTag.er!(hArg);\n\n\t\t\t\t\tReading.sndMng.clearCache();\n\t\t\t\t\t//scrItr.turnPage();\n\n\t\t\t\t\tnew ReadingState_go;\n\t\t\t\t};\n\t\t\t\tbreak;\n\n\t\t\tdefault:\t// [wait] 以外は、予約イベント待ちを開始\n\t\t\t\tonUserAct = ()=> new ReadingState_go;\n\t\t}\n// console.log(`fn:Reading.ts ${hArg[':タグ名']} 予約イベント待ちを開始`);\n\t\tReadingState.waitRsvEvent(glb, onUserAct);\n\t}\n\n\toverride\treadonly\tisWait\t= true;\n\n\toverride page(hArg: HArg): boolean {\n\t\tconst ret = super.page(hArg);\t// チェックも兼ねて\n\t\tconst {to} = hArg;\n\t\tif (! to) return ret;\n\t\tif (ReadingState.lenPage < 2) return false;\t// 履歴がたまってない\n\n\t\tswitch (to) {\n\t\t\tcase 'oldest':\n\t\t\t\thArg.to = 'prev';\n\t\t\t\tReadingState.posPage = 1;\tbreak;\n\n\t\t\tcase 'newest':\n\t\t\tcase 'prev':\n\t\t\t\thArg.to = 'prev';\n\t\t\t\tReadingState.posPage = ReadingState.lenPage -1;\tbreak;\n\n\t\t\t// case 'next':\t\t// スルー\n\t\t\tdefault:\treturn false;\t// ダイアログ確認などするとここを通る\n\t\t}\n\n\t\treturn ReadingState_page.go(hArg);\n\t}\n\n}\n\n// page 状態\n//\tページ移動中\nclass ReadingState_page extends ReadingState {\n\tprivate\tconstructor() {\n\t\tsuper();\n\t\tif (CmnLib.debugLog) console.log(`📖 => %cReadingState_page`, 'color:#3B0;');\n\t\tReading.val.setVal_Nochk('tmp', 'const.sn.isPaging', true);\n\t}\n\tstatic\tgo(hArg: HArg) {return new ReadingState_page().page(hArg)}\n\n\t#isPaging\t= true;\n\toverride\tget\tisSkipping() {return this.#isPaging}\n\n\toverride\treadonly\tisWait\t= false;\n\n\toverride\tbeginProc() {Reading.main.stop()}\n\toverride\tendProc() {Reading.main.resume()}\n\n\t// タグ処理\n\toverride\tl(hArg: HArg): boolean {\n// console.log(`fn:ReadState.ts [l] len:${ReadingState.lenPage} pos:${ReadingState.posPage} isSkipping:${this.#isPaging}`);\n\t\tif (! this.#isPaging) return super.l(hArg);\t// 基底 ReadingState_go 化\n\n\t\t// ページ末尾ならページ移動終了\n\t\tif (ReadingState.posPage === ReadingState.lenPage -1) {\n\t\t\tthis.#exit();\n\t\t\treturn new ReadingState_go().l(hArg);\n\t\t}\n\n\t\t// クリック待ちを表示\n\t\tif (argChk_Boolean(hArg, 'visible', true)) Reading.layMng.breakLine(hArg);\n\n\t\tReading.layMng.setAllStyle2TxtLay(ReadingState.styPaging);\n\t\tReading.goTxt();\n\t\tif (! ReadingState.aPage[ReadingState.posPage]?.week) return false;\n\n\t\tReadingState.waitRsvEvent4Paging();\n\t\treturn true;\n\t}\n\toverride\tp(hArg: HArg): boolean {\n// console.log(`fn:ReadState.ts [p] len:${ReadingState.lenPage} pos:${ReadingState.posPage}`);\n\t\tif (! this.#isPaging) return super.p(hArg);\t// 基底 ReadingState_go 化\n\n\t\t// ページ末尾ならページ移動終了\n\t\tif (ReadingState.posPage === ReadingState.lenPage -1) {\n\t\t\tthis.#exit();\n\t\t\treturn new ReadingState_go().p(hArg);\n\t\t}\n\n\t\t// クリック待ちを表示\n\t\tif (argChk_Boolean(hArg, 'visible', true)) Reading.layMng.breakPage(hArg);\n\n\t\tReading.layMng.setAllStyle2TxtLay(ReadingState.styPaging);\n\t\tReading.goTxt();\n\n\t\tReadingState.waitRsvEvent4Paging();\n\t\treturn true;\n\t}\n\toverride\ts(hArg: HArg): boolean {\n\t\tnew ReadingState_wait4Tag(hArg);\n\t\treturn true;\n\t}\n\toverride\twait() {return false}\n\toverride\tpage(hArg: HArg): boolean {\n\t\tconst {to, style, clear} = hArg;\n\t\tif (style || clear) return false;\n\n\t\tif (CmnLib.debugLog) console.log(`📜 %cpage() pos:${ReadingState.posPage}%c len:${ReadingState.lenPage} to:${to}`, 'color:#3B0;', '');\n\t\tswitch (to) {\n\t\t\tcase 'oldest':\n\t\t\t\tif (ReadingState.posPage === 0) return false;\n\t\t\t\tReadingState.posPage = 0;\tbreak;\n\n\t\t\tcase 'prev':\n\t\t\t\tif (ReadingState.posPage === 0) return false;\n\t\t\t\t--ReadingState.posPage;\tbreak;\n\n\t\t\tcase 'next':\n\t\t\t\tif (ReadingState.posPage === ReadingState.lenPage -1) return false;\n\t\t\t\t++ReadingState.posPage;\tbreak;\n\n\t\t\tcase 'newest':\n\t\t\t\tif (ReadingState.posPage === ReadingState.lenPage -1) return false;\n\t\t\t\tReadingState.posPage = ReadingState.lenPage -1;\tbreak;\n\n\t\t\tcase 'exit':\n\t\t\t\tReadingState.posPage = ReadingState.lenPage -1;\tbreak;\n\n\t\t\tcase 'load':\n\t\t\t\tReadingState.lenPage = ReadingState.posPage +1;\n\t\t\t\tReadingState.aPage = ReadingState.aPage.slice(0, ReadingState.lenPage);\n\t\t\t\tthis.#exit();\n\t\t\t\tbreak;\n\n\t\t\tdefault:\tthrow `属性to「${to}」は異常です`;\n\t\t}\n\t\t// ページ移動状態を抜ける\n\t\tif (ReadingState.posPage === ReadingState.lenPage -1) this.#exit();\n\n\t\tconst p = ReadingState.aPage[ReadingState.posPage];\n\t\tif (! p) throw `posPage異常:${ReadingState.posPage}`;\n\t\tconst {fn, index, mark} = p;\n\t\tif (CmnLib.debugLog) {\n\t\t\tconst m = Reading.scrItr.nowMark();\n\t\t\tconst {week} = ReadingState.aPage[ReadingState.posPage] ?? {week: false};\n\t\t\tconsole.log(`   -- fn:${fn} i:${index} pos:${ReadingState.posPage} (base=%c${m.hPages.base!.fore.sBkFn}%c 0=%c${m.hPages['0']!.fore.sBkFn}%c mes=%c${m.hPages.mes!.fore.txs.cssText.match(/color: \\w+;/)}%c) week:${week} A:${ReadingState.posPage === ReadingState.lenPage -1}\\n   styPaging=%c${ReadingState.styPaging}%c\\n   mark:%o`, 'background-color:#3B0; color:#000;', '', 'background-color:#B4F; color:#000;', '', 'color:#B68;', '', ReadingState.styPaging, '', mark);\n\t\t}\n\t\treturn Reading.scrItr.loadFromMark({fn, index}, mark);\n\t}\n\n\t#exit() {\n\t\tReading.val.setVal_Nochk('tmp', 'const.sn.isPaging', false);\n\t\tthis.#isPaging = false;\n\t}\n}\n\n\n\nexport class Reading {\n\tstatic\tbeginProc(proc_id: string, onNotify?: ()=> void, endProc = true, onClickSkip?: ()=> void) {\n\t\tif (CmnLib.debugLog) console.log(`📖.beginProc id:%c${proc_id}%c onNotify:${(!! onNotify)} endProc:${endProc} onClickSkip:${!! onClickSkip}`, 'color:#3B0;', '');\n\t\tthis.#clearProc();\n\t\tthis.#procID = proc_id;\n\n\t\t// 通知時コールバック型\n\t\tif (onNotify) {\n\t\t\t// notifyEndProc()を呼べば callBack & EndProc する機能\n\t\t\t// 使用者は、処理終了時に notifyEndProc()を呼ぶ義務がある\n\t\t\tconst {promise, resolve} = Promise.withResolvers<string>();\n\t\t\tpromise.then((proc_id: string)=> {\n\t\t\t\tif (CmnLib.debugLog) console.log(`📖.notifyEndProc id:%c${proc_id}%c`, 'color:#3B0;', '');\n\t\t\t\tonNotify();\n\t\t\t\tif (endProc) this.endProc(proc_id); else this.#clearProc();\n\t\t\t});\n\t\t\tthis.#rsNotify = resolve;\n\t\t}\n\n\t\t// クリックキャンセル機能\n\t\tif (onClickSkip) {\n\t\t\tconst fnc = ()=> {\n\t\t\t\tthis.cancelAutoSkip();\n\t\t\t\tonClickSkip();\n\t\t\t\tif (endProc) this.endProc(proc_id);\n\t\t\t};\n\t\t\tthis.#elc.add(window, EVNM_CLICK, (e: PointerEvent)=> {e.stopPropagation(); fnc()});\n\t\t\tthis.#elc.add(window, 'keyup', (e: KeyboardEvent)=> {\n\t\t\t\t//if (! e.isTrusted) return;\n\t\t\t\tif (e['isComposing']) return; // サポートしてない環境でもいける書き方\n\t\t\t\te.stopPropagation();\n\t\t\t\tfnc();\n\t\t\t});\n\t\t\tthis.procWheel4wle(this.#elc, fnc);\n\t\t}\n\n\t\tReadingState.rs.beginProc();\n\t}\n\t\tstatic\t#clearProc() {\n\t\t\tthis.#procID = '';\n\t\t\tthis.#rsNotify = ()=> {};\n\t\t\tthis.#elc.clear();\n\t\t}\n\t\tstatic\treadonly\t#elc = new EventListenerCtn;\n\n\tstatic\t#rsNotify\t: (proc_id: string)=> void\t= ()=> {};\n\tstatic\tnotifyEndProc(proc_id: string) {this.#rsNotify(proc_id)}\n\n\tstatic\tendProc(proc_id: string) {\n\t\tif (CmnLib.debugLog) console.log(`📖.endProc id:%c${proc_id}%c=${this.#procID === proc_id}`, 'color:#3B0;', '');\n\t\tif (this.#procID !== proc_id) return;\n\n\t\tReadingState.rs.endProc();\n\t\tthis.#clearProc();\n\t}\n\t\tstatic\t#procID\t= '';\n\t\tstatic\tget procID() {return `RP_${this.scrItr.scriptFn}:${this.scrItr.idxToken}_`}\n\n\n\tstatic\tfire(KeY: string, e: Event) {ReadingState.rs.fire(KeY, e)}\n\n\tstatic\tget\tisSkipping() {return ReadingState.rs.isSkipping}\n\tstatic\tget\tisWait() {return ReadingState.rs.isWait}\t// 予約イベントの発生待ち中か\n\n\n\t\tstatic\ttagL_enabled\t= true;\t\t// 頁末まで一気に読み進むか(l無視)\n\t\tstatic\tskip_all\t\t= false;\t// falseなら既読のみをスキップ\n\t\tstatic\tskip_enabled\t= false;\t// 次の選択肢(/未読)まで進むが有効か\n\t\tstatic\tauto_enabled\t= false;\t// 自動読みすすみモードかどうか\n\n\n\tstatic\tcfg\t\t: Config;\n\tstatic\thTag\t: IHTag;\n\tstatic\tmain\t: IMain;\n\tstatic\tval\t\t: IVariable;\n\tstatic\tscrItr\t: ScriptIterator;\n\tstatic\tlayMng\t: LayerMng;\n\tstatic\tgoTxt = ()=> {};\n\tstatic\tget needGoTxt() {return this.layMng.needGoTxt}\n\tstatic\tevtMng\t: EventMng;\n\tstatic\tsndMng\t: SoundMng;\n\tstatic\tprocWheel4wle\t: (elc: EventListenerCtn, onIntr: ()=> void)=> void;\n\n\tstatic\tfcs\t\t: FocusMng;\n\n\tstatic\tinit(cfg: Config, hTag: IHTag, main: IMain, val: IVariable, scrItr: ScriptIterator, layMng: LayerMng, evtMng: EventMng, sndMng: SoundMng, procWheel4wle: (elc: EventListenerCtn, onIntr: ()=> void)=> void) {\n\t\tthis.cfg = cfg;\n\t\tthis.hTag = hTag;\n\t\tthis.main = main;\n\t\tthis.val = val;\n\t\tthis.scrItr = scrItr;\n\t\tthis.layMng = layMng;\n\t\tthis.goTxt = ()=> layMng.goTxt();\n\t\tthis.evtMng = evtMng;\n\t\tthis.sndMng = sndMng;\n\t\tthis.procWheel4wle = procWheel4wle;\n\n\t\tval.defTmp('sn.tagL.enabled', ()=> this.tagL_enabled);\n\t\tval.defValTrg('tmp:sn.tagL.enabled', (_name: string, v: any)=> this.tagL_enabled = String(v) !== 'false');\n\t\tval.defTmp('sn.skip.all', ()=> this.skip_all);\n\t\tval.defValTrg('tmp:sn.skip.all', (_name: string, v: any)=> this.skip_all = String(v) !== 'false');\n\t\tval.defTmp('sn.skip.enabled', ()=> this.skip_enabled);\n\t\tval.defValTrg('tmp:sn.skip.enabled', (_name: string, v: any)=> this.skip_enabled = String(v) !== 'false');\n\t\tval.defTmp('sn.auto.enabled', ()=> this.auto_enabled);\n\t\tval.defValTrg('tmp:sn.auto.enabled', (_name: string, v: any)=> this.auto_enabled = String(v) !== 'false');\n\n\t\thTag.l\t\t\t= o=> ReadingState.rs.l(o);\t\t// 行末クリック待ち\n\t\thTag.p\t\t\t= o=> ReadingState.rs.p(o);\t\t// 改ページクリック待ち\n\t\thTag.s\t\t\t= o=> ReadingState.rs.s(o);\t\t// 停止する\n\t\thTag.wait\t\t= o=> ReadingState.rs.wait(o);\t\t// ウェイトを入れる\n\t\thTag.waitclick\t= o=> ReadingState.rs.s(o);\t\t// クリックを待つ\n\t\thTag.page\t\t= o=> ReadingState.rs.page(o);\t\t// ページ移動\n\n\t\tnew ReadingState_proc;\n\t\thTag.jump!({fn: 'main'});\n\t}\n\tstatic\tsetFcs(fcs: FocusMng) {this.fcs = fcs}\n\n\n\tstatic\tcancelAutoSkip() {\n\t\tif (! this.tagL_enabled) {\t// 頁末まで一気に読み進むか(l無視)\n\t\t\tthis.tagL_enabled = true;\n\t\t\tthis.val.setVal_Nochk('tmp', 'sn.tagL.enabled', true);\n\t\t}\n\n\t\tif (this.skip_enabled) {\t\t// 次の選択肢(/未読)まで進むが有効か\n\t\t\tthis.skip_enabled = false;\n\t\t\tthis.val.setVal_Nochk('tmp', 'sn.skip.enabled', false);\n\t\t}\n\t\tif (this.auto_enabled) {\t\t// 自動読みすすみモードかどうか\n\t\t\tthis.auto_enabled = false;\n\t\t\tthis.val.setVal_Nochk('tmp', 'sn.auto.enabled', false);\n\t\t}\n\t}\n\n}\n"],"names":["Easing","amount","s","power","now","Group","_this","tweenId","tween","time","preserve","tweenIds","autoStart","Interpolation","v","k","m","f","fn","p0","p1","t","Sequence","mainGroup","Tween","_object","_group","target","duration","dynamic","overrideStartingValues","property","tmp","prop","_valuesStart","_valuesEnd","_valuesStartRepeat","startValue","startValueIsArray","propType","isInterpolationList","endValues","temp","i","l","value","nestedObject","numChainedTweens","group","times","yoyo","easingFunction","interpolationFunction","tweens","_i","callback","_a","endTime","elapsedTime","durationAndDelay","totalTime","calculateElapsedPortion","timesRepeated","timeIntoCurrentRepeat","portion","elapsed","completeCount","start","end","startIsArray","endIsArray","endValue","TWEEN","removeAll","remove","update","TW_INT_TRANS","TMP_TSY_NM","CmnTween","#hTwInf","#evtMng","#appPixi","evtMng","appPixi","#fncTicker","tw","hArg","repeat","argChk_Num","argChk_Boolean","#hEase","nm","es","lay","hTo","arg","hdeq","vx","v0","v1","a0","tw_nm","hNow","onUpdate","onComplete","onEnd","path","twLast","CmnLib","groups","#REG_TSY_PATH","x","x2","y","y2","o","o2","json","hArg2","e","hTo2","twNew","ti","Reading","chain","twFrom","_hArg","fnc","#tw_nm","layer","id","name","SpritesMng","csvFn","ctn","fncFirstComp","fncAllComp","#addChild","sp","#aSp","#csv2Sprites","isStop","#cfg","#val","#sys","#main","cfg","val","sys","main","sndMng","#cachePicMov","#dec2cachePicMov","#cacheAniSpr","#dec2cacheAniSpr","vol","#glbVol","#movVol","#hFn2hve","#hFace","#hFn2ResAniSpr","csv","addChild","needLoad","Sprite","utils.TextureCache","Loader","aComp","ldr","a","len","fn0","dx","dy","blendmode","BLEND_MODES","url","SEARCH_PATH_ARG_EXT","xt","LoaderResource","fncLoaded","_","hRes","#mkSprite","res","next","str","aiv","mes","_r","type","data","hve","#charmVideoElm","#sortAFrameName","aFn","a_base_name","is","ie","b","int","r","Texture","DebugMng","spritesheet","meta","frames","getFn","res2","next2","r2","_hRes","baseTexture","aFr","w","h","Rectangle","ras","asp","AnimatedSprite","RPN_WV","stop","Layer","def行頭禁則","def行末禁則","def分割禁止","defぶら下げ","defReg行頭禁則","defReg行末禁則","defReg分割禁止","defRegぶら下げ","Hyphenation","#s行頭禁則","#s行末禁則","#s分割禁止","#sぶら下げ","#reg行頭禁則","#reg行末禁則","#reg分割禁止","#regぶら下げ","#chk禁則の競合_ぶら行末","#chk禁則の競合_ぶら分禁","len行末禁則","lenぶら下げ","c","len分割禁止","to","#genKinsoku","s行頭禁則","s行末禁則","s分割禁止","sぶら下げ","hLay","htmTxt","cnvRect","tategaki","begin","bkHtm","fncFirstChk","#getChRects","sl_xy","elm","rect","ch","xy","p_i","#i2pi","p_elm","p_rect","p_ch","sty","rs","oldI","cont","ins","elm2","pal","br","ppal","ret","rng","pos","pp_i","pp_ch","j","p_j","last_ch","head_ch","ppp_i","ppp_ch","CallStack","idx","csArg","RubySpliter","#sesame","#putCh","putCh","#REG_RUBY","ce","text","ruby","kan_ruby","kan","txt","rb_ses","aR","lenR","len_max","u","n","p","d","g","P","O","A","F","E","C","L","S","M","T","I","R","n.extensions","SndInf","buf","start_ms","end_ms","ret_ms","volume","pan","snd","SsPlaying","SsLoading","#proc_id","#vol_mul_talking","filters","#onStop","BUF_VOICE","hSndBuf","BUF_BGM","_vol","BUF_SE","SndBuf","#MAX_END_MS","speed","vn","savevol","loop","#hLP","sound","#si","s2","sp_nm","os","old","s0","stop2var","#initVol","#playseSub","ab","Sound","RPN_LOADED","$cfg","$val","$main","$sys","$hSndBuf","$evtMng","def","buf1","buf2","n1","f1","n2","v2","f2","src","_ldr","si","SsStop","SsWaitingStop","canskip","fin","bnV","delay","SsFade","SsWaitingFade","RPN_COMP_CHIN","ScriptIterator","hTag","prpPrs","#let_ml","#dump_stack","#dump_script","#endif","#if","#call","#jump","#pop_stack","#return","#bracket2macro","#char2macro","#macro","#load","#reload_script","#record_place","#save","#dbgToken","token","#scriptFn","#lineNum","#idxToken","#aCallStk","#procDebugtag","tag_name","#alzTagArg","#aIfStk","#grm","Grammar","#hHook","#isBreak_base","hLineBP","#regBreakPoint","#hFuncBP","tkn","uc","#script","#jumpWork","AnalyzeTagArg","#hFn2hLineBP","#cnvSnPath4Dbg","#breakState","#aStack","#isIdxOverLast","#idxDx4Dbg","#go_stepover","#REGSTEPIN","#go_stepout","#cnvSnPath","#REG4CODE_FN","out","#csDepth_macro_esc","_token","#subHitCondition","tagToken2Name","bp","isBreak","idx_n","tkn0","tag_name0","ma","lc0","#cnvIdx2lineCol","cs","st","#hScript","lc","_tag_name","args","tag_fnc","hPrm","cond","ps","csa","arg_nm","mac","#setTag2ChIn","promise","resolve","fncBypass","#hTag2SkipBypass","#hTag2CanSkip","#layMng","layMng","ml","hMp","from_macro_nm","call_nm","lN","set_fnc","break_fnc","#fncSet","goto","#fnLastBreak","#hScrCache4Dump","#fncBreak","_goto","#dumpErrLine","ln_txt_width","ln","line","exp","cntDepth","idxGo","lnIf","zLn","tagToken2Name_Args","#eraseKidoku","#callSub","ReadingState","#resvToken","#clearResvToken","after_token","label","#jump_light","#nextToken_Proc","#skipLabel","full_path","RPN_JUMPWORK","fp_diff","scrBase","scrDiff","aBase","aDiff","lenB","lenD","#resolveScript","#seekScript","#errOverScr","#recordKidoku","#REG_NONAME_LABEL","#REG_TOKEN_MACRO_BEGIN","#REG_TOKEN_MACRO_END","inMacro","skipLabel","a_skipLabel","reLabel","in_let_ml","scr","#replaceScript_Wildcard","#REG_WILDCARD","#REG_WILDCARD2","p_fn","ext","nt","areas","#isKidoku","#REG_NG4MAC_NM","#strStepin","hArgM","place","mark","ap","#mark","index","fn2","now_sp","idx_1","TxtStage","Container","canFocus","#htmTxt","#cntTxt","#grpDbgMasume","htm","#scrItr","scrItr","#hChInStyle","#hChOutStyle","Graphics","#hWarnStyle","#hyph","#infTL","cln","key","#lay_sub","#left","#lenHtmTxt","aSpan","#clearText","#lh_half","fs","#isTategaki","#padTx4x","#padTx4y","lh","cvsScale","width","height","#htm2tx","hidden","util","extension","parseExtension","mimes","dataAsUrl","isDataUrl","resolveUrl","getAndEncode","arrayLike","WOFF","JPEG","inliner","newInliner","fontFaces","newFontFaces","embedFonts","node","cssText","styleNode","baseUrl","doc","base","TIMEOUT","request","done","timeout","fail","encoder","content","message","URL_REGEX","inlineAll","shouldProcess","readUrls","result","match","inline","get","dataUrl","urlAsRegex","nothingToInline","urls","string","resolveAll","readAll","webFonts","webFont","cssStrings","getCssRules","selectWebFontRules","rules","newWebFont","cssRules","rule","styleSheets","sheet","webFontRule","img","re","canvas","err","#aGoTxt","instant","#goTxt_Proc","#aRect","#SPAN_LAST","#cntBreak","bcr","sx","sy","ox","oy","fncMasumeLog","fncMasume","rct","ease","#fi_easing","add","cis","cnt","#spWork","eCh","aLnk","st_normal","st_hover","st_clicked","st_r_normal","st_r_hover","st_r_clicked","nlRt","st_bk","fncStyle","st_r","chs","#fncEndChIn","lastElm","#aSpTw","wasChInIng","#REG_NG_CHSTYLE_NAME_CHR","#spsBreak","#fo_easing","sum_wait","cos","#ch_filter","ct","#sss","rnd","tx","_gdc","aStyle","Button","#o","uint","#rctBtnTxt","#hover","#clicked","#sps","#loaded_pic","_isStop","style","TextStyle","mesErrJSON","Text","#loaded_b_pic","#procMasume4txt","style_hover","style_clicked","_me","_txt","#procMasume4pic","_sp","_w3","_h","me","w3","_text","w_3","txNormal","txClicked","txHover","normal","Pages","layname","cls","fore","back","fncF","#pg","valnm","hash","aPrm","DesignCast","bg_col","isLay","_appPixi","_sys","_scrItr","_prpPrs","_cfg","_hPages","_hPrm","_idcCh","_v","_o","GrpLayDesignCast","_ctn","_gl","GrpLayer","#elc","EventListenerCtn","#idc","#setIdcSp","#csvFn","#sBkFn","#sBkFace","RPN_GRP_LAY","#laySub","face","inFn","inFace","#width","#height","#spTsy","#rtTsy","fncRenderFore","oldFnc","#fncRender","RenderTexture","gdc","FrameMng","#add_frame","#let_frame","#set_frame","#frame","#tsy_frame","#hIfrm","#hIfrmVisibleBk","b_color","#rect","RPN_ADD_FRAME","ld","#hDisabled","iLastSep","path_parent","path_pa_pa","win","#loadPic2Img","onload","oUrl","#hEncImgOUrl","aImg","#hARetImg","srcNoPrm","Prm","ld2","u2","ri","var_name","#zIdx","alpha","scale_x","scale_y","rotate","fncA","fncXYSR","fncW","fncH","LayerMng","fncResizeLay","#modeLnSub","#aLayName","#hPages","#frmMng","tid","TxtLayer","#loadplugin","#snapshot","#snapshot4proc","#snapshot4app","#snapshot4web","#add_lay","#clear_lay","#lay","#trans","#quake","#tsy","#add_filter","#clear_filter","#enable_filter","#ch","#clear_text","#current","#endlink","#er","#graph","#link","#r","#rec_ch","#rec_r","#reset_rec","#ruby2","#span","#tcy","#dump_lay","#enable_event","#button","sArg","#cmdTxt","#bg_color","parseColor","grp","#fore","#back","#stage","#spTransBack","#spTransFore","fncTxt_b_alpha","_name","#foreachRedrawTxtLayBack","fncBtnFont","#oLastPage","#aTxtLog","#hProcDbgRes","#selectNode","#curTxtlay","#modeLn","pages","#grpCover","visible","bg_color","#msecChWait","g_alpha","cmd","tl","_record","dt","getDateStr","PROTOCOL_USERDATA","PROTOCOL_DL","RPN_SNAPSHOT","aBk","#getLayers","argChk_Color","autoDetectRenderer","pg","renTx","join","RPN_LOADPLUGIN","addStyle","#chkTxtLay","#getTxtLayer","#$getTxtLayer","#$current","#firstGrplay","#argChk_layer","#rebuildLayerRankInfo","dive","idx_dive","pg_dive","back_dive","fore_dive","idx_back_dive","idx_fore_dive","#sortLayers","#foreachLayers","#srcRuleTransFragment","#rtTransBack","#rtTransFore","sDoTrans","aLayFore","comp","aBackTransAfter","aBack","ticker","renderer","fncRenderBack","render","fncRender","glsl","comp2","uniforms","Filter","sm","aLn","layers","ai","bi","aDo","fncV","finishBlendLayer","arrive","backlay","spBack","#add_filter2","#enable_filter2","record","doRecLog","#pgTxtlay","tf","$hPages","aSort","#isPageFore","#recorder","recorder","isPageFore","#autowc","#ch_in_style","#ch_out_style","initStyle","#doAutoWc","#hAutoWc","#b_color","#b_alpha","#b_alpha_isfixed","#b_do","#b_pic","#txs","#rbSpl","#htmRb","#hWarnR_Style","#cntBtn","#rec","#setFfs","#r_align","#ruby_pd","#mkStyle_r_align","#mkStyle_r_align4ff","#set_ch_in","#set_ch_out","RPN_TXT_LAY","#drawBack","in_style","#$ch_in_style","#ch_in_join","out_style","#$ch_out_style","fncComp","#strNoFFS","#regNoFFS","#ffs","#fncFFSStyle","_ch","doRec","rb","r_align","add_sty","ev","#needGoTxt","a_ruby","add_htm","a1_","a1","#firstCh","#tagCh_sub","#popSpan","#aSpan","#cumDelay","wait","cl","#o2domArg","#pushSpan","lnk","#stkASpan","r_style","#page_text","#page_plain_text","#mergePushSpan","curpos","ht","isAddWait","argWait","stk","btn","FocusMng","#aBtn","#idx","cmp","on","off","fnc4EnterSwitch","inp","#radio_next","cur","op","#allOff","#logFocus","top","bottom","right","left","auto","basePlacements","clippingParents","viewport","popper","reference","variationPlacements","acc","placement","placements","beforeRead","read","afterRead","beforeMain","afterMain","beforeWrite","write","afterWrite","modifierPhases","getNodeName","element","getWindow","ownerDocument","isElement","OwnElement","isHTMLElement","isShadowRoot","applyStyles","_ref","state","attributes","effect","_ref2","initialStyles","styleProperties","attribute","applyStyles$1","getBasePlacement","max","min","round","getUAString","uaData","item","isLayoutViewport","getBoundingClientRect","includeScale","isFixedStrategy","clientRect","scaleX","scaleY","visualViewport","addVisualOffsets","getLayoutRect","contains","parent","child","rootNode","getComputedStyle","isTableElement","getDocumentElement","getParentNode","getTrueOffsetParent","getContainingBlock","isFirefox","isIE","elementCss","currentNode","css","getOffsetParent","window","offsetParent","getMainAxisFromPlacement","within","mathMax","mathMin","withinMaxClamp","getFreshSideObject","mergePaddingObject","paddingObject","expandToHashMap","keys","hashMap","toPaddingObject","padding","arrow","_state$modifiersData$","options","arrowElement","popperOffsets","basePlacement","axis","isVertical","arrowRect","minProp","maxProp","endDiff","startDiff","arrowOffsetParent","clientSize","centerToReference","center","offset","axisProp","_options$element","arrow$1","getVariation","unsetSides","roundOffsetsByDPR","dpr","mapToStyles","_Object$assign2","popperRect","variation","offsets","position","gpuAcceleration","adaptive","roundOffsets","isFixed","_offsets$x","_offsets$y","_ref3","hasX","hasY","sideX","sideY","heightProp","widthProp","offsetY","offsetX","commonStyles","_ref4","_Object$assign","computeStyles","_ref5","_options$gpuAccelerat","_options$adaptive","_options$roundOffsets","computeStyles$1","passive","instance","_options$scroll","scroll","_options$resize","resize","scrollParents","scrollParent","eventListeners","getOppositePlacement","matched","getOppositeVariationPlacement","getWindowScroll","scrollLeft","scrollTop","getWindowScrollBarX","getViewportRect","strategy","html","layoutViewport","getDocumentRect","_element$ownerDocumen","winScroll","body","isScrollParent","_getComputedStyle","overflow","overflowX","overflowY","getScrollParent","listScrollParents","list","isBody","updatedList","rectToClientRect","getInnerBoundingClientRect","getClientRectFromMixedType","clippingParent","getClippingParents","canEscapeClipping","clipperElement","getClippingRect","boundary","rootBoundary","mainClippingParents","firstClippingParent","clippingRect","accRect","computeOffsets","commonX","commonY","mainAxis","detectOverflow","_options","_options$placement","_options$strategy","_options$boundary","_options$rootBoundary","_options$elementConte","elementContext","_options$altBoundary","altBoundary","_options$padding","altContext","clippingClientRect","referenceClientRect","popperClientRect","elementClientRect","overflowOffsets","offsetData","multiply","computeAutoPlacement","flipVariations","_options$allowedAutoP","allowedAutoPlacements","allPlacements","allowedPlacements","overflows","getExpandedFallbackPlacements","oppositePlacement","flip","_options$mainAxis","checkMainAxis","_options$altAxis","checkAltAxis","specifiedFallbackPlacements","_options$flipVariatio","preferredPlacement","isBasePlacement","fallbackPlacements","referenceRect","checksMap","makeFallbackChecks","firstFittingPlacement","_basePlacement","isStartVariation","mainVariationSide","altVariationSide","checks","check","numberOfChecks","_loop","fittingPlacement","_ret","flip$1","getSideOffsets","preventedOffsets","isAnySideFullyClipped","side","hide","referenceOverflow","popperAltOverflow","referenceClippingOffsets","popperEscapeOffsets","isReferenceHidden","hasPopperEscaped","hide$1","distanceAndSkiddingToXY","rects","invertDistance","skidding","distance","_options$offset","_data$state$placement","offset$1","popperOffsets$1","getAltAxis","preventOverflow","_options$tether","tether","_options$tetherOffset","tetherOffset","altAxis","tetherOffsetValue","normalizedTetherOffsetValue","offsetModifierState","_offsetModifierState$","mainSide","altSide","additive","minLen","maxLen","arrowPaddingObject","arrowPaddingMin","arrowPaddingMax","arrowLen","minOffset","maxOffset","clientOffset","offsetModifierValue","tetherMin","tetherMax","preventedOffset","_offsetModifierState$2","_mainSide","_altSide","_offset","_len","_min","_max","isOriginSide","_offsetModifierValue","_tetherMin","_tetherMax","_preventedOffset","preventOverflow$1","getHTMLElementScroll","getNodeScroll","isElementScaled","getCompositeRect","elementOrVirtualElement","isOffsetParentAnElement","offsetParentIsScaled","documentElement","order","modifiers","map","visited","modifier","sort","requires","dep","depModifier","orderModifiers","orderedModifiers","phase","debounce","pending","mergeByName","merged","current","existing","DEFAULT_OPTIONS","areValidElements","_key","popperGenerator","generatorOptions","_generatorOptions","_generatorOptions$def","defaultModifiers","_generatorOptions$def2","defaultOptions","effectCleanupFns","isDestroyed","setOptionsAction","cleanupModifierEffects","runModifierEffects","_state$elements","_state$orderedModifie","_state$orderedModifie2","_ref$options","cleanupFn","noopFn","createPopper","EVNM_CLICK","EVNM_KEY","EventMng","#event","#set_focus","#fcs","KEY","hHook","#elmHint","#spanHint","#popper","#elmV","setBtnNM","nmEvt","#modKey4MouseEvent","#ev_keydown","pressed","tg","fncUpdNavLang","utils.clearTextureCache","fncMql","mq","mql","procWheel4wle","_elc","_onIntr","#ev_wheel","#resvFlameEvent4Wheel","elc","GamepadListener","gamepad","aStick","stick_xy","#hDownKeys","_win","SysBase","#wheeling","#extend_wheel","#ev_wheel_waitstop","ctnBtn","hover","clicked","glb","onHint","#dispHint","nr","hv","#oHintOpt","rctBtn","cpp","rawKeY","call","aEv","#canFocus","el","del","#rs","#hLocalEvt2Fnc","#hGlobalEvt2Fnc","e2f","KeY","sel","frmnm","onUserAct","hGlb","em","ke","week","max_len","saPageLog","$styPaging","ReadingState_proc","ReadingState_go","ReadingState_wait4Tag","RPN_WAIT","_KeY","_e","ReadingState_page","#isPaging","#exit","clear","proc_id","onNotify","endProc","onClickSkip","#clearProc","#procID","#rsNotify","fcs"],"mappings":"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","x_google_ignoreList":[0,6,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71]}