{"version":3,"file":"ScriptIterator.js","names":["#scriptFn","#idxToken","#lineNum","#jumpWork","#grm","#alzTagArg","cfg: Config","hTag: T_HTag","main: T_Main","val: T_Variable","prpPrs: T_PropParser","sndMng: SoundMng","sys: SysBase","#let_ml","#dump_stack","#dump_script","#endif","#if","#call","#jump","#pop_stack","#return","#bracket2macro","#char2macro","#macro","#load","#reload_script","#record_place","#save","#dbgToken","#aCallStk","#procDebugtag","#aIfStk","#hHook","#isBreak_base","#regBreakPoint","#hFuncBP","#hFn2hLineBP","#cnvSnPath4Dbg","#breakState","#aStack","#isIdxOverLast","#idxDx4Dbg","#go_stepover","#script","#REGSTEPIN","#go_stepout","#cnvSnPath","#csDepth_macro_esc","#subHitCondition","#cnvIdx2lineCol","#hScript","hArg: TArg","csa: ICallStackArg","#setTag2ChIn","#setTag2FinishTrans","#evtMng","#hTag2SkipBypass","#hTag2CanSkip","#layMng","#fncSet","#fnLastBreak","#hScrCache4Dump","#fncBreak","#dumpErrLine","#eraseKidoku","#callSub","#resvToken","#clearResvToken","#jump_light","#nextToken_Proc","#skipLabel","scrBase: string","scrDiff: string","aBase: string[]","aDiff: string[]","#resolveScript","#seekScript","#errOverScr","#recordKidoku","#REG_NONAME_LABEL","#REG_TOKEN_MACRO_BEGIN","#REG_TOKEN_MACRO_END","#replaceScript_Wildcard","#REG_WILDCARD","#REG_WILDCARD2","#isKidoku","#REG_NG4MAC_NM","#strStepin","ap: Promise<void>[]","#mark","o: TArg","h: HScript"],"sources":["../src/sn/ScriptIterator.ts"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-explicit-any */\n/* eslint-disable @typescript-eslint/no-unsafe-assignment */\n/* eslint-disable @typescript-eslint/no-non-null-assertion */\n/* ***** BEGIN LICENSE BLOCK *****\n\tCopyright (c) 2018-2025 Famibee (famibee.blog38.fc2.com)\n\n\tThis software is released under the MIT License.\n\thttp://opensource.org/licenses/mit-license.php\n** ***** END LICENSE BLOCK ***** */\n\nimport {argChk_Boolean, getFn, CmnLib, argChk_Num, RPN_COMP_CHIN} from './CmnLib';\nimport type {T_HTag, TArg, Script, TTag} from './Grammar';\nimport type {T_Main, T_Variable, T_Mark, T_PropParser, T_HEvt2Fnc} from './CmnInterface';\nimport {creSAVEDATA} from './CmnInterface';\nimport type {Config} from './Config';\nimport {CallStack, creCSArg, creMP, type ICallStackArg} from './CallStack';\nimport {Grammar, tagToken2Name_Args, tagToken2Name} from './Grammar';\nimport {AnalyzeTagArg} from './AnalyzeTagArg';\nimport {RubySpliter} from './RubySpliter';\nimport type {EventMng} from './EventMng';\nimport type {LayerMng} from './LayerMng';\nimport {DebugMng} from './DebugMng';\nimport type {SoundMng} from './SoundMng';\nimport type {SysBase} from './SysBase';\nimport {SEARCH_PATH_ARG_EXT} from './ConfigBase';\nimport {CmnTween} from './CmnTween';\nimport {Reading, ReadingState} from './Reading';\nimport {BUF_BGM} from './SndBuf';\n\nimport {Loader} from 'pixi.js';\n\ntype HScript = {\n\t[fn: string]: Script;\n}\n\ntype ISeek = {\n\tidx\t\t: number;\n\tln\t\t: number;\n}\n\n\nconst enum BreakState {Running, Wait, Break, Breaking, Step, Stepping, StepOuting, StepOut}\n\nconst enum SndProcOnLoad {\n\tMINIMAL_STOP,\n\tNO_TOUCH,\n\tALL_STOP_AND_PLAY,\n}\n\n\nexport class ScriptIterator {\n\t#script\t\t: Script\t= {aToken: [''], len: 1, aLNum: [1]};\n\n\t#scriptFn\t= '';\n\tget scriptFn() {return this.#scriptFn}\n\t#idxToken\t= 0;\n\tget idxToken() {return this.#idxToken}\n\tsubIdxToken() {--this.#idxToken}\n\t#lineNum\t= 0;\n\tget lineNum() {return this.#lineNum}\n\treadonly addLineNum\t= (len: number)=> {this.#lineNum += len};\n\tjumpJustBefore() {this.#jumpWork(this.#scriptFn, '', --this.#idxToken)}\n\t\t// ç›´å‰ã«ã‚¸ãƒ£ãƒ³ãƒ—\n\n\n\t#aCallStk\t: CallStack[]\t= [];\t// FILOãƒãƒƒãƒ•ã‚¡ï¼ˆpush/popï¼‰\n\n\treadonly\t#grm;\n\treadonly\t#alzTagArg\t= new AnalyzeTagArg;\n\n\n\t//MARK: ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿\n\tconstructor(private readonly cfg: Config, private readonly hTag: T_HTag, private readonly main: T_Main, private readonly val: T_Variable, private readonly prpPrs: T_PropParser, private readonly sndMng: SoundMng, private readonly sys: SysBase) {\n\t\t// å¤‰æ•°æ“ä½œ\n\t\thTag.let_ml\t\t= o=> this.#let_ml(o);\t// ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ãƒ†ã‚­ã‚¹ãƒˆä»£å…¥\n\t\thTag.endlet_ml\t= ()=> false;\t\t\t// ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ãƒ†ã‚­ã‚¹ãƒˆä»£å…¥çµ‚ç«¯\n\t\t\t// [if]ãƒ–ãƒ­ãƒƒã‚¯å†…ã§ã€æœªå®šç¾©ã®ã‚¿ã‚°[endlet_ml]ã§ã™ã€‘ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹å¯¾ç­–\n\n\t\t// ãƒ‡ãƒãƒƒã‚°ãƒ»ãã®ä»–\n\t\thTag.dump_stack\t= ()=> this.#dump_stack();\t// ã‚¹ã‚¿ãƒƒã‚¯ã®ãƒ€ãƒ³ãƒ—\n\t\thTag.dump_script= o=> this.#dump_script(o);\t// ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ãƒ€ãƒ³ãƒ—\n\n\t\t// æ¡ä»¶åˆ†å²\n\t\thTag.else\t\t=\t\t\t\t\t\t\t// ãã®ä»–ifãƒ–ãƒ­ãƒƒã‚¯é–‹å§‹\n\t\thTag.elsif\t\t=\t\t\t\t\t\t\t// åˆ¥æ¡ä»¶ã®ifãƒ–ãƒ­ãƒƒã‚¯é–‹å§‹\n\t\thTag.endif\t\t= ()=> this.#endif();\t\t// ifãƒ–ãƒ­ãƒƒã‚¯ã®çµ‚ç«¯\n\t\thTag.if\t\t\t= o=> this.#if(o);\t\t\t// ifãƒ–ãƒ­ãƒƒã‚¯ã®é–‹å§‹\n\n\t\t// ãƒ©ãƒ™ãƒ«ãƒ»ã‚¸ãƒ£ãƒ³ãƒ—\n\t\t//hTag.button\t// LayerMng.tså†…ã§å®šç¾©\t\t// ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º\n\t\thTag.call\t\t= o=> this.#call(o);\t\t// ã‚µãƒ–ãƒ«ãƒ¼ãƒãƒ³ã‚³ãƒ¼ãƒ«\n\t\thTag.jump\t\t= o=> this.#jump(o);\t\t// ã‚·ãƒŠãƒªã‚ªã‚¸ãƒ£ãƒ³ãƒ—\n\t\t//hTag.page\t\t= // ReadState ãŒæ‹…å½“ã«\t\t// ãƒšãƒ¼ã‚¸ç§»å‹•\n\t\thTag.pop_stack\t= o=> this.#pop_stack(o);\t// ã‚³ãƒ¼ãƒ«ã‚¹ã‚¿ãƒƒã‚¯ç ´æ£„\n\t\thTag.return\t\t= o=> this.#return(o);\t\t// ã‚µãƒ–ãƒ«ãƒ¼ãƒãƒ³ã‹ã‚‰æˆ»ã‚‹\n\n\t\t// ãƒã‚¯ãƒ­\n\t\thTag.bracket2macro\t= o=> this.#bracket2macro(o);// æ‹¬å¼§ãƒã‚¯ãƒ­ã®å®šç¾©\n\t\thTag.char2macro\t\t= o=> this.#char2macro(o);\t// ä¸€æ–‡å­—ãƒã‚¯ãƒ­ã®å®šç¾©\n\t\thTag.endmacro\t\t= o=> this.#return(o);\t\t// ãƒã‚¯ãƒ­å®šç¾©ã®çµ‚äº†\n\t\thTag.macro\t\t\t= o=> this.#macro(o);\t\t// ãƒã‚¯ãƒ­å®šç¾©ã®é–‹å§‹\n\n\t\t// ã—ãŠã‚Š\n\t\t//hTag.copybookmark\t\t// Variable.tså†…ã§å®šç¾©\t// ã—ãŠã‚Šã®è¤‡å†™\n\t\t//hTag.erasebookmark\t// Variable.tså†…ã§å®šç¾©\t// ã—ãŠã‚Šã®æ¶ˆå»\n\t\thTag.load\t\t\t= o=> this.#load(o);\t\t\t// ã—ãŠã‚Šã®èª­è¾¼\n\t\thTag.reload_script\t= o=> this.#reload_script(o);\t// ã‚¹ã‚¯ãƒªãƒ—ãƒˆå†èª­è¾¼\n\t\thTag.record_place\t= ()=> this.#record_place();\t// ã‚»ãƒ¼ãƒ–ãƒã‚¤ãƒ³ãƒˆæŒ‡å®š\n\t\thTag.save\t\t\t= o=> this.#save(o);\t\t\t// ã—ãŠã‚Šã®ä¿å­˜\n\n\n\t\tif (cfg.oCfg.debug.token) this.#dbgToken = token=> {if (token.trim() !== '') console.log(`ğŸŒ± ãƒˆãƒ¼ã‚¯ãƒ³ ${this.#scriptFn}:${String(this.#lineNum)} (i:${String(this.#idxToken)} cs:${String(this.#aCallStk.length)}) %cã€${token}ã€‘`, 'background-color:#350;')};\n\t\tif (cfg.oCfg.debug.tag) this.#procDebugtag = tag_name=> console.log(`ğŸŒ² ã‚¿ã‚°è§£æ ${this.#scriptFn}:${String(this.#lineNum)} (i:${String(this.#idxToken)} cs:${String(this.#aCallStk.length)}) %c[${tag_name} %o]`, 'background-color:#30B;', this.#alzTagArg.hPrm);\n\n\t\tval.defTmp('const.sn.aIfStk.length', ()=> this.#aIfStk.length);\n\t\tval.defTmp('const.sn.vctCallStk.length', ()=> this.#aCallStk.length);\n\n\t\tthis.#grm = new Grammar(cfg);\n\n\t\tconst ce = cfg.oCfg.init.escape;\n\t\tthis.#grm.setEscape(ce);\n\t\tRubySpliter.setEscape(ce);\n\n\t\tif (CmnLib.isDbg) {\n\t\t\t// sys.addHook((type, o)=> (<[nm: string]: ((o: any)=> void)>this.#hHook)[type]?.(o));\n\t\t\tconst _h = this.#hHook;\n\t\t\t// type t = keyof typeof this.#hHook;\n\t\t\t// sys.addHook((type: keyof typeof _h, o)=> this.#hHook[ type ]?.(o));\t// x\n\t\t\tsys.addHook((type, o)=> this.#hHook[ <keyof typeof _h>type ]?.(o));\n\t\t\t// sys.addHook((type, o)=> this.#hHook[type]?.(o));\n\t\t\tthis.isBreak = token=> this.#isBreak_base(token);\n\n\t\t\tconst fnc = ()=> this.analyzeInit();\n\t\t\tthis.analyzeInit = ()=> {\n\t\t\t\tthis.analyzeInit = ()=> { /* empty */ };\n\t\t\t\tthis.sys.send2Dbg('hi', {});\n\t\t\t};\n\t\t\tthis.#hHook.auth = o=> {\n\t\t\t\t// eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n\t\t\t\tconst hLineBP = o.hBreakpoint.hFn2hLineBP;\n\t\t\t\t// eslint-disable-next-line @typescript-eslint/no-unsafe-argument\n\t\t\t\tfor (const [fn, v] of Object.entries(hLineBP)) this.#regBreakPoint(fn, <any>v);\n\n\t\t\t\tScriptIterator.#hFuncBP = {};\n\t\t\t\t// eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n\t\t\t\tfor (const v of o.hBreakpoint.aFunc) {\n\t\t\t\t\t// eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n\t\t\t\t\tScriptIterator.#hFuncBP[v.name] = 1;\n\t\t\t\t}\n\n\t\t\t\t// eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n\t\t\t\tif (o.stopOnEntry) {\n\t\t\t\t\tlet tkn;\n\t\t\t\t\t// eslint-disable-next-line no-cond-assign\n\t\t\t\t\twhile (tkn = this.nextToken()) {\n\t\t\t\t\t\t// if (! tkn) break;\t// åˆæœŸåŒ–å‰ã«çµ‚äº†ã—ãŸå ´åˆå‘ã‘\n\n\t\t\t\t\t\tconst uc = tkn.charCodeAt(0);\t// TokenTopUnicode\n\t\t\t\t\t\tif (uc === 91) break;\t// [ ã‚¿ã‚°é–‹å§‹\n\t\t\t\t\t\tif (uc === 38) break;\t// & å¤‰æ•°æ“ä½œãƒ»å¤‰æ•°è¡¨ç¤º\n\t\t\t\t\t\tif (uc === 42 && tkn.length === 1) break;\t// å˜æ–‡å­—ã® *\n\t\t\t\t\t\tif (uc === 10) this.#lineNum += tkn.length;\t// \\n æ”¹è¡Œ\n\t\t\t\t\t}\n\t\t\t\t\tthis.sys.callHook('stopOnEntry', {});\n\t\t\t\t\tthis.analyzeInit = fnc;\n\t\t\t\t\tthis.analyzeInit();\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tthis.noticeWait = ()=> {\n\t\t\t\t\t\tthis.noticeWait = ()=> { /* empty */ };\n\t\t\t\t\t\tthis.sys.callHook('stopOnEntry', {});\t// snå…¨ä½“ã¸é€šçŸ¥\n\n//\t\t\t\t\t\tthis.sys.callHook('continue', {});\t// snå…¨ä½“ã¸é€šçŸ¥\n//\t\t\t\t\t\tthis.breakState = BreakState.breaking;\n\t\t\t\t\t};\n\n\t\t\t\t\tthis.analyzeInit = fnc;\n\t\t\t\t\tthis.analyzeInit();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse this.recodeDesign = ()=> { /* empty */ };\n\t}\n\tnoticeWait = ()=> { /* empty */ };\n\t#regBreakPoint(fn: string, o: {[ln: number]: any}) {\n\t\tScriptIterator.#hFn2hLineBP[this.#cnvSnPath4Dbg(fn)] = o;\n\t}\n\n\tdestroy() {this.isBreak = this.#record_place = ()=> false}\n\n\t// eslint-disable-next-line @typescript-eslint/consistent-type-assertions\n\treadonly #hHook\t: {[nm: string]: (o: any)=> void;} = {\n\t\tauth: ()=> { /* empty */ }, // constructorã§ã‚»ãƒƒãƒˆ\n\t\t//launch:\t// ã“ã“ã§ã¯å†’é ­åœæ­¢ã«é–“ã«åˆã‚ãªã„ã®ã§analyzeInit()ã§\n\t\tdisconnect: ()=> {\n\t\t\tScriptIterator.#hFn2hLineBP = {};\n\t\t\tScriptIterator.#hFuncBP = {};\n\t\t\tthis.isBreak = ()=> false;\n\n\t\t\tthis.#hHook.continue!({});\n\t\t\tthis.#breakState = BreakState.Running;\n\t\t},\n\t\trestart: ()=> {this.isBreak = ()=> false},\n\n\t\t// ãƒ–ãƒ¬ãƒ¼ã‚¯ãƒã‚¤ãƒ³ãƒˆç™»éŒ²\n\t\t// eslint-disable-next-line @typescript-eslint/no-unsafe-argument, @typescript-eslint/no-unsafe-member-access\n\t\tadd_break: o=> this.#regBreakPoint(o.fn, o.o),\n\t\tdata_break: o=> {\n\t\t\tif (this.#breakState !== BreakState.Running) return;\n\n\t\t\tthis.#breakState = BreakState.Wait;\n\t\t\t// eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n\t\t\tthis.main.setLoop(false, `å¤‰æ•° ${String(o.dataId)}ã€${String(o.old_v)}ã€‘â†’ã€${String(o.new_v)}ã€‘ãƒ‡ãƒ¼ã‚¿ãƒ–ãƒ¬ãƒ¼ã‚¯`);\n\t\t\tthis.sys.callHook('stopOnDataBreakpoint', {});\t// snå…¨ä½“ã¸é€šçŸ¥\n\t\t\tthis.sys.send2Dbg('stopOnDataBreakpoint', {});\n\t\t},\n\t\tset_func_break: o=> {\n\t\t\tScriptIterator.#hFuncBP = {};\n\t\t\t// eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n\t\t\tfor (const v of o.a) ScriptIterator.#hFuncBP[v.name] = 1;\n\t\t\t// eslint-disable-next-line @typescript-eslint/no-unsafe-argument, @typescript-eslint/no-unsafe-member-access\n\t\t\tthis.sys.send2Dbg(o.ri, {});\n\t\t},\n\n\t\t// æƒ…å ±å•ã„åˆã‚ã›ç³»\n\t\t// eslint-disable-next-line @typescript-eslint/no-unsafe-argument, @typescript-eslint/no-unsafe-member-access\n\t\tstack: o=> this.sys.send2Dbg(o.ri, {a: this.#aStack()}),\n\t\t// eslint-disable-next-line @typescript-eslint/no-unsafe-argument, @typescript-eslint/no-unsafe-member-access\n\t\teval: o=> {this.sys.send2Dbg(o.ri, {v: this.prpPrs.parse(o.txt)})},\n\n\t\t// ãƒ‡ãƒãƒƒã‚¬ã‹ã‚‰ã®æ“ä½œç³»\n\t\tcontinue: ()=> {\n\t\t\tif (this.#isIdxOverLast()) return;\n\n\t\t\tthis.#idxToken -= this.#idxDx4Dbg;\n\t\t\tthis.#breakState = BreakState.Breaking;\n\t\t\tthis.main.setLoop(true);\n\t\t\tthis.main.resume();\t// jumpãƒ«ãƒ¼ãƒ—å¾Œãªã©ã§åœæ­¢ã—ã¦ã„ã‚‹å ´åˆãŒã‚ã‚‹ã®ã§\n\t\t},\n\t\tstepover: o=> this.#go_stepover(o),\n\t\tstepin: ()=> {\n\t\t\tif (this.#isIdxOverLast()) return;\n\n\t\t\tconst tkn = this.#script.aToken[this.#idxToken -this.#idxDx4Dbg];\n\t\t\tthis.sys.callHook(`stopOnStep${this.#REGSTEPIN.test(tkn ?? '') ?'In' :''}`, {});\t// snå…¨ä½“ã¸é€šçŸ¥\n\n\t\t\tthis.#idxToken -= this.#idxDx4Dbg;\n\t\t\tthis.#breakState = this.#breakState === BreakState.Wait\n\t\t\t\t? BreakState.Step\n\t\t\t\t: BreakState.Stepping;\n\t\t\tthis.main.setLoop(true);\n\t\t\tthis.main.resume();\t// jumpãƒ«ãƒ¼ãƒ—å¾Œãªã©ã§åœæ­¢ã—ã¦ã„ã‚‹å ´åˆãŒã‚ã‚‹ã®ã§\n\t\t},\n\t\tstepout: o=> {\n\t\t\tif (this.#isIdxOverLast()) return;\n\n\t\t\tif (this.#aCallStk.length > 0) this.#go_stepout(true);\n\t\t\telse this.#go_stepover(o);\n\t\t},\n\t\tpause: ()=> {\n\t\t\tthis.#breakState = BreakState.Step;\n\t\t\tthis.main.setLoop(false, 'ä¸€æ™‚åœæ­¢');\n\t\t\tthis.sys.send2Dbg('stopOnStep', {});\n\t\t},\n\t\tstopOnEntry: ()=> {\n\t\t\tthis.#breakState = BreakState.Step;\n\t\t\tthis.main.setLoop(false, 'ä¸€æ™‚åœæ­¢');\n\t\t\tthis.sys.send2Dbg('stopOnEntry', {});\n\t\t},\n\t} as const;\n\treadonly #cnvSnPath = (fn: string)=> this.cfg.searchPath(fn, SEARCH_PATH_ARG_EXT.SCRIPT);\n\treadonly #cnvSnPath4Dbg = (fn: string)=>\n\t\tthis.sys.pathBaseCnvSnPath4Dbg + this.#cnvSnPath(fn);\n\t#go_stepover(o: any) {\n\t\tif (this.#isIdxOverLast()) return;\n\n\t\tconst tkn = this.#script.aToken[this.#idxToken -this.#idxDx4Dbg];\n\t\tif (this.#REGSTEPIN.test(tkn ?? '')) this.#go_stepout(false);\n\t\telse {\n\t\t\tthis.sys.callHook('stopOnStep', {});\t// snå…¨ä½“ã¸é€šçŸ¥\n\t\t\tthis.#hHook.stepin!(o);\n\t\t}\n\t}\n\t#go_stepout(out: boolean) {\n\t\tthis.sys.callHook(`stopOnStep${out ?'Out' :''}`, {});\t// snå…¨ä½“ã¸é€šçŸ¥\n\t\tthis.#csDepth_macro_esc = this.#aCallStk.length -(out ?1 :0);\n\t\tthis.#idxToken -= this.#idxDx4Dbg;\n\t\tthis.#breakState = out ?BreakState.StepOut :BreakState.StepOuting;\n\t\tthis.main.setLoop(true);\n\t\tthis.main.resume();\t// jumpãƒ«ãƒ¼ãƒ—å¾Œãªã©ã§åœæ­¢ã—ã¦ã„ã‚‹å ´åˆãŒã‚ã‚‹ã®ã§\n\t}\n\t#csDepth_macro_esc\t= 0;\n\tget #idxDx4Dbg() {\n\t\treturn this.#breakState === BreakState.Break\n\t\t\t|| this.#breakState === BreakState.Step ?1 :0\n\t}\n\t#isIdxOverLast(): boolean {\n\t\tif (this.#idxToken < this.#script.len) return false;\n\t\tthis.sys.callHook('stopOnEntry', {});\t// snå…¨ä½“ã¸é€šçŸ¥\n\t\tthis.main.setLoop(false, 'ã‚¹ã‚¯ãƒªãƒ—ãƒˆçµ‚ç«¯ã§ã™ isIdxOverLast');\n\t\treturn true;\n\t}\n\n\t// reload å†ç”Ÿæˆ Main ã«å—ã‘æ¸¡ã™ãŸã‚ static\n\tstatic\t#hFn2hLineBP: {[fn: string]: {[ln: number]: any}} = {};\n\tstatic\t#hFuncBP: {[tag_name: string]: 1} = {};\n\t#breakState\t= BreakState.Running;\n\t\t// https://raw.githubusercontent.com/famibee/SKYNovel-vscode-extension/master/src/doc/BreakStateSMD.pu\n\tisBreak = (_token: string)=> false;\n\t#isBreak_base(token: string): boolean {\n\t\tswitch (this.#breakState) {\n\t\t\tcase BreakState.StepOuting:\tthis.#subHitCondition();\n\t\t\t\tthis.#breakState = BreakState.StepOut;\tbreak;\n\t\t\tcase BreakState.StepOut:\n\t\t\t\tif (this.#aCallStk.length !== this.#csDepth_macro_esc) break;\n\n\t\t\t\tthis.#breakState = BreakState.Step;\n\t\t\t\tthis.main.setLoop(false, 'ã‚¹ãƒ†ãƒƒãƒ—å®Ÿè¡Œ');\n\t\t\t\tthis.sys.send2Dbg('stopOnStep', {});\n\t\t\t\treturn true;\t// ã‚¿ã‚°ã‚’å®Ÿè¡Œã›ãšã€ç›´å‰åœæ­¢\n\n\t\t\tcase BreakState.Stepping:\tthis.#subHitCondition();\n\t\t\t\tthis.#breakState = BreakState.Step;\tbreak;\n\t\t\tcase BreakState.Step:\t\tthis.#subHitCondition();\n\t\t\t\tthis.main.setLoop(false, 'ã‚¹ãƒ†ãƒƒãƒ—å®Ÿè¡Œ');\n\t\t\t\tthis.sys.send2Dbg('stopOnStep', {});\n\t\t\t\treturn true;\t// ã‚¿ã‚°ã‚’å®Ÿè¡Œã›ãšã€ç›´å‰åœæ­¢\n\n\t\t\tcase BreakState.Breaking:\tthis.#subHitCondition();\n\t\t\t\tthis.#breakState = BreakState.Running;\tbreak;\n\n\t\t\tdefault:\n\t\t\t{\t// é–¢æ•°ãƒ–ãƒ¬ãƒ¼ã‚¯ãƒã‚¤ãƒ³ãƒˆ\n\t\t\t\tif (tagToken2Name(token) in ScriptIterator.#hFuncBP) {\n\t\t\t\t\tthis.#breakState = BreakState.Break;\n\t\t\t\t\tthis.main.setLoop(false, `é–¢æ•° ${token} ãƒ–ãƒ¬ãƒ¼ã‚¯`);\n\t\t\t\t\tthis.sys.callHook('stopOnBreakpoint', {});\t// snå…¨ä½“ã¸é€šçŸ¥\n\t\t\t\t\tthis.sys.send2Dbg('stopOnBreakpoint', {});\n\t\t\t\t\treturn true;\t// ã‚¿ã‚°ã‚’å®Ÿè¡Œã›ãšã€ç›´å‰åœæ­¢\n\t\t\t\t}\n\t\t\t}\n\t\t\t{\t// ãƒ–ãƒ¬ãƒ¼ã‚¯ãƒã‚¤ãƒ³ãƒˆ\n\t\t\t\tconst bp = ScriptIterator.#hFn2hLineBP[this.#cnvSnPath4Dbg(this.#scriptFn)];\n\t\t\t\tif (! bp) break;\n\n\t\t\t\tconst o = bp[this.#lineNum];\n\t\t\t\tif (! o) break;\n\n//console.log(`fn:ScriptIterator.ts line:145 ğŸ‘º ã€bs:${this.#breakState} idx:${this.#idxToken} ln:${this.#lineNum} tkn:${this.#script.aToken[this.#idxToken -1]}:ã€‘ o:%o`, o);\n\t\t\t\t// eslint-disable-next-line @typescript-eslint/no-unsafe-argument, @typescript-eslint/no-unsafe-member-access\n\t\t\t\tif (o.condition) {if (! this.prpPrs.parse(o.condition)) break}\n\n\t\t\t\t// eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n\t\t\t\telse if ('hitCondition' in o && --o.hitCondition > 0) break;\n\t\t\t\tconst isBreak = this.#breakState === BreakState.Running;\n\t\t\t\tthis.#breakState = BreakState.Break;\n\t\t\t\tthis.main.setLoop(false, isBreak ?\n\t\t\t\t\t// eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n\t\t\t\t\t(o.condition ? 'æ¡ä»¶' :'ãƒ’ãƒƒãƒˆã‚«ã‚¦ãƒ³ãƒˆ') +'ãƒ–ãƒ¬ãƒ¼ã‚¯'\n\t\t\t\t\t :'ã‚¹ãƒ†ãƒƒãƒ—å®Ÿè¡Œ');\n\t\t\t\tconst type = isBreak ?'stopOnBreakpoint' :'stopOnStep';\n\t\t\t\tthis.sys.callHook(type, {});\t// snå…¨ä½“ã¸é€šçŸ¥\n\t\t\t\tthis.sys.send2Dbg(type, {});\n\t\t\t}\n\t\t\t\treturn true;\t// ã‚¿ã‚°ã‚’å®Ÿè¡Œã›ãšã€ç›´å‰åœæ­¢\n\t\t}\n\n\t\treturn false;\t// no breakã€ã‚¿ã‚°ã‚’å®Ÿè¡Œ\n\t}\n\t#subHitCondition() {\t// stepå®Ÿè¡Œä¸­ã§breakã—ãªã„ãŒãƒ’ãƒƒãƒˆã‚«ã‚¦ãƒ³ãƒˆã ã‘æ¸›ç®—\n\t\tconst o = ScriptIterator.#hFn2hLineBP[getFn(this.#scriptFn)]?.[this.#lineNum];\n\t\t// eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n\t\tif (o?.hitCondition) --o.hitCondition;\n\t}\n\n\t#aStack(): {fn: string, ln: number, col: number, nm: string, ma: string}[] {\n\t\tconst idx_n = this.#breakState === BreakState.Breaking ?1 :0;\n\t\tconst tkn0 = this.#script.aToken[this.#idxToken -1 +idx_n]!;\n\n\t\tconst fn0 = this.#cnvSnPath4Dbg(this.#scriptFn);\n\t\tconst tag_name0 = tagToken2Name(tkn0);\n\t\tconst nm = tag_name0 ?`[${tag_name0}]` :tkn0;\n//console.log(`fn:ScriptIterator.ts aStack breakState:${this.#breakState} idx:${this.#idxToken -1} idx_n:${idx_n} tkn0:${tkn0}: fn0:${fn0} nm:${nm} tkn02:${this.#script.aToken[this.#idxToken -1]}: +tkn02:${this.#script.aToken[this.#idxToken]}:`);\n//console.log(`fn:ScriptIterator.ts     a:%o anum:%o`, this.script.aToken, this.script.aLNum);\n\t\tconst ma = String(this.val.getVal('mp:const.sn.macro') ?? '{}');\n\t\tif (this.#idxToken === 0) return [{fn: fn0, ln: 1, col: 1, nm, ma}];\n\n\t\tconst lc0 = this.#cnvIdx2lineCol(this.#script, this.#idxToken);// -1ä¸è¦\n//console.log(`fn:ScriptIterator.ts     ln:${lc0.ln} col:${lc0.col_s} col2:${this.#script.aLNum[this.#idxToken -1]}`);\n\t\tconst a = [{fn: fn0, ln: lc0.ln, col: lc0.col_s +1, nm, ma}];\n\t\tconst len = this.#aCallStk.length;\n\t\tif (len === 0) return a;\n\n\t\tfor (let i=len -1; i>=0; --i) {\n\t\t\tconst cs = this.#aCallStk[i]!;\n\t\t\tconst st = this.#hScript[cs.fn];\n\t\t\tif (! st) continue;\n\t\t\tconst tkn = st.aToken[cs.idx -1];\n\t\t\tif (! tkn) continue;\n\t\t\tconst lc = this.#cnvIdx2lineCol(st, cs.idx);\t// -1ä¸è¦\n\n\t\t\tconst tag_name = tagToken2Name(tkn);\n\t\t\ta.push({\n\t\t\t\tfn\t: this.#cnvSnPath4Dbg(cs.fn),\n\t\t\t\tln\t: lc.ln,\n\t\t\t\tcol\t: lc.col_s +1,\n\t\t\t\tnm\t: tag_name ?`[${tag_name}]` :tkn,\n\t\t\t\tma\t: cs.csArg[':hMp']['const.sn.macro'],\n\t\t\t});\n\t\t}\n\n\t\treturn a;\n\t}\n\n\t// result = true : waitã™ã‚‹  resume()ã§å†é–‹\n\t#procDebugtag\t= (_tag_name: string)=> { /* empty */ };\n\t//MARK: ã‚¿ã‚°è§£æ\n\tasync\tã‚¿ã‚°è§£æ(tag_name: string, args: string): Promise<boolean> {\n\t\tconst tag_fnc = this.hTag[<keyof T_HTag>tag_name];\n\t\t// eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n\t\tif (! tag_fnc) throw `æœªå®šç¾©ã®ã‚¿ã‚°ã€${tag_name}ã€‘ã§ã™`;\n\n\t\tthis.#alzTagArg.parse(args);\n\t\tthis.#procDebugtag(tag_name);\n\n\t\tconst hPrm = this.#alzTagArg.hPrm;\n\t\tif (hPrm.cond) {\n\t\t\tconst cond = hPrm.cond.val;\n\t\t\tif (! cond || cond.startsWith('&')) throw 'å±æ€§condã¯ã€Œ&ã€ãŒä¸è¦ã§ã™';\n\t\t\tconst p = this.prpPrs.parse(cond);\n\t\t\tconst ps = String(p);\n\t\t\tif (ps === 'null' || ps === 'undefined') return false;\n\t\t\tif (! p) return false;\n\t\t}\n\n\t\tlet hArg: TArg = {};\n\t\tconst csa: ICallStackArg = this.#aCallStk.at(-1)?.csArg ?? creCSArg();\n\n\t\tconst len = this.#aCallStk.length;\n\t\tif (this.#alzTagArg.isKomeParam) {\n\t\t\tif (len === 0) throw 'å±æ€§ã€Œ*ã€ã¯ãƒã‚¯ãƒ­ã®ã¿æœ‰åŠ¹ã§ã™';\n\t\t\thArg = {...csa};\n\t\t}\n\t\thArg[':ã‚¿ã‚°å'] = tag_name;\n\t// #region ã‚¿ã‚°ä½ç½®ã®ã‚³ãƒ¼ãƒ«ã‚¹ã‚¿ãƒƒã‚¯æƒ…å ±ã‚’åŸ‹ã‚è¾¼ã‚€ã‚³ãƒ¼ãƒ‰ï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰\n\t/*\t{\n\t\t\tconst lc0 = this.#cnvIdx2lineCol(this.#script, this.#idxToken);\n\t\t\tlet now = `å­˜åœ¨ä½ç½® fn:${this.#scriptFn} line:${lc0.ln} col:${lc0.col_s +1}`;\n\t\t\thArg[':path'] = now;\n\t\t\tconst len = this.#aCallStk.length;\n\t\t\tif (len > 0) {\n\t\t\t\tfor (let i=len -1; i>=0; --i) {\n\t\t\t\t\tconst cs = this.#aCallStk[i];\n\t\t\t\t\tconst hMp = cs.csArg[':hMp'];\n\t\t\t\t\tconst from_macro_nm = hMp ?hMp[':ã‚¿ã‚°å'] :undefined;\n\t\t\t\t\tconst call_nm = cs.csArg[':ã‚¿ã‚°å'] ?? '';\n\t\t\t\t\tconst lc = this.#cnvIdx2lineCol(this.#hScript[cs.fn], cs.idx);\n\t\t\t\t\tnow += ` <- (${len -i}) fn:${cs.fn} line:${lc.ln\n\t\t\t\t\t\t} col:${lc.col_s +1\n\t\t\t\t\t\t}`+ (from_macro_nm ?'ï¼ˆ['+ from_macro_nm +']ãƒã‚¯ãƒ­å†…ï¼‰' :' ')+\n\t\t\t\t\t\t`ã§ [${call_nm} ...]ã‚’ã‚³ãƒ¼ãƒ«`;\n\t\t\t\t}\n\t\t\t}\n\t\t}*/\n\t// #endregion\n\t// #region ã‚¿ã‚°ä½ç½®æƒ…å ±ã‚’åŸ‹ã‚è¾¼ã‚€ã‚³ãƒ¼ãƒ‰ï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰\n//\t\thArg[':path'] = this.#scriptFn;\n//\t\thArg[':ln'] = this.#lineNum;\n\t// #endregion\n\t\t// valã‚„defã®å€¤ã«ã¤ã„ã¦ã€‚null ã¯ã‚ã‚Šãˆãªã„ã€‚'null'ã‚„'undefined' ã¯ã‚ã‚Šãˆã‚‹ã€‚\n\t\t// çœç•¥æ™‚ä»¥å¤–ã§ undefined ã¯ãªã„ã€‚a=undefined ã¨æ›¸ã„ã¦ã‚‚ 'undefined' ã«ãªã‚‹\n\t\tfor (const [arg_nm, {val, def}] of Object.entries(hPrm)) {\n\t\t\tlet v = val;\n\t\t\tif (val.startsWith('%')) {\n\t\t\t\tif (len === 0) throw 'å±æ€§ã€Œ%ã€ã¯ãƒã‚¯ãƒ­å®šç¾©å†…ã§ã®ã¿ä½¿ç”¨ã§ãã¾ã™ï¼ˆãã®ãƒã‚¯ãƒ­ã®å¼•æ•°ã‚’ç¤ºã™ç°¡ç•¥æ–‡æ³•ã§ã‚ã‚‹ãŸã‚ï¼‰';\n\n\t\t\t\tconst mac = (<{[nm: string]: any}>csa)[v.slice(1)];\n\t\t\t\tif (mac) {(<{[nm: string]: any}>hArg)[arg_nm] = mac; continue}\n\n\t\t\t\tif (def === undefined || def === 'null') continue;\n\t\t\t\t\t// defã®'null'æŒ‡å®šã€‚%å¤‰æ•°ãŒç„¡ã„å ´åˆã€ã‚¿ã‚°ã‚„ãƒã‚¯ãƒ­ã«å±æ€§ã‚’æ¸¡ã•ãªã„\n\t\t\t\tv = def;\n\t\t\t}\n\n\t\t\t// eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n\t\t\tv = this.prpPrs.getValAmpersand(v ?? '');\n\t\t\tif (v !== 'undefined') {(<{[nm: string]: any}>hArg)[arg_nm] = v; continue}\n\n\t\t\tif (def === undefined) continue;\n\t\t\tv = this.prpPrs.getValAmpersand(def);\n\t\t\tif (v !== 'undefined') (<{[nm: string]: any}>hArg)[arg_nm] = v;\n\t\t\t\t// å­˜åœ¨ã—ãªã„å€¤ã®å ´åˆã€å±æ€§ã‚’æ¸¡ã•ãªã„\n\t\t}\n\n\t\t// ï¼ˆä¸€éƒ¨ã‚¿ã‚°ã®å‡¦ç†ç›´å‰ã«ï¼‰æ–‡å­—å‡ºç¾å‡¦ç†ã‚’çµ‚ã‚ã‚‰ã›ã‚‹\n\t\tif (Reading.needGoTxt && this.#setTag2ChIn.has(tag_name)) {\n\t\t\tconst {promise, resolve} = Promise.withResolvers();\n\t\t\tReading.beginProc(RPN_COMP_CHIN, ()=> resolve(0), false, ()=> resolve(0));\n\t\t\tReading.goTxt();\n\t\t\tthis.val.saveKidoku();\n\t\t\tawait promise;\n\t\t}\n\t\t// ï¼ˆä¸€éƒ¨ã‚¿ã‚°ã®å‡¦ç†ç›´å‰ã«ï¼‰ç”»é¢ãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³ã‚’æ­¢ã‚ã‚‹\n\t\tif (this.#setTag2FinishTrans.has(tag_name)) {\n\t\t\tthis.#evtMng.hideHint();\n\t\t\tCmnTween.stopEndTrans();\n\t\t}\n\t\t// ã‚­ãƒ¼æŠ¼ã—ã£ã±ãªã—ã‚¹ã‚­ãƒƒãƒ—ã§å‡¦ç†ã›ãšã‚¹ãƒ«ãƒ¼ã™ã‚‹\n\t\tconst fncBypass = this.#hTag2SkipBypass[tag_name];\n\t\tif (fncBypass\n\t\t\t&& argChk_Boolean(hArg, 'canskip', this.#hTag2CanSkip[tag_name] ?? true)\n\t\t\t&& this.#evtMng.isSkipping) return fncBypass(hArg);\n\n\t\treturn tag_fnc(hArg);\n\t}\n\t\t// æ–‡å­—å‡ºç¾æ¼”å‡ºã‚’å¾…ã¤ã‚¿ã‚°\n\t\t//\tã“ã“ã§åˆ—æŒ™ã›ãšã‚¿ã‚°å‡¦ç†ã§æ–‡å­—è¡¨ç¤ºã‚’å§‹ã‚ãŸã„å ´åˆã€goTxt()ã™ã‚‹ã“ã¨\n\t\treadonly\t#setTag2ChIn = new Set([\n\t\t// å¤‰æ•°æ“ä½œ\n\t\t\t// 'clearsysvar',\t// ã‚·ã‚¹ãƒ†ãƒ å¤‰æ•°ã®å…¨æ¶ˆå»\n\t\t\t// 'clearvar',\t\t// ã‚²ãƒ¼ãƒ å¤‰æ•°ã®å…¨æ¶ˆå»\n\t\t\t// 'let_abs',\t\t// çµ¶å¯¾å€¤\n\t\t\t// 'let_char_at',\t// æ–‡å­—åˆ—ã‹ã‚‰ä¸€å­—å–ã‚Šã ã—\n\t\t\t// 'let_index_of',\t// æ–‡å­—åˆ—ã§æ¤œç´¢\n\t\t\t// 'let_length',\t// æ–‡å­—åˆ—ã®é•·ã•\n\t\t\t// 'let_ml',\t\t// ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ãƒ†ã‚­ã‚¹ãƒˆä»£å…¥\n\n\t\t\t// 'let_replace',\t// æ­£è¦è¡¨ç¾ã§ç½®æ›\n\t\t\t// 'let_round',\t\t// å››æ¨äº”å…¥\n\t\t\t// 'let_search',\t// æ­£è¦è¡¨ç¾ã§æ¤œç´¢\n\t\t\t// 'let_substr',\t// æ–‡å­—åˆ—ã‹ã‚‰æŠœãã ã—\n\t\t\t// 'let',\t\t\t// å¤‰æ•°ä»£å…¥ãƒ»æ¼”ç®—\n\n\t\t// ãƒ¬ã‚¤ãƒ¤å…±é€š\n\t\t\t// 'add_lay',\t\t// ãƒ¬ã‚¤ãƒ¤ã‚’è¿½åŠ ã™ã‚‹\n\t\t\t// 'clear_lay',\t// ãƒ¬ã‚¤ãƒ¤è¨­å®šã®æ¶ˆå»\n\t\t\t// 'finish_trans',\t// ãƒˆãƒ©ãƒ³ã‚¹å¼·åˆ¶çµ‚äº†\n\t\t\t// 'lay',\t// ãƒ¬ã‚¤ãƒ¤è¨­å®š\n\t\t\t'trans',\t// ãƒšãƒ¼ã‚¸è£è¡¨ã‚’äº¤æ›\n\t\t\t'wt',\t// ãƒˆãƒ©ãƒ³ã‚¹çµ‚äº†å¾…ã¡\n\t\t\t// 'add_filter',\t// ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼è¿½åŠ \n\t\t\t// 'clear_filter',\t// ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼å…¨å‰Šé™¤\n\t\t\t// 'enable_filter',// ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼å€‹åˆ¥åˆ‡æ›¿\n\n\t\t// ãƒˆã‚¥ã‚¤ãƒ¼ãƒ³ã‚¢ãƒ‹ãƒ¡\n\t\t\t// 'pause_tsy',\t// ä¸€æ™‚åœæ­¢\n\t\t\t// 'resume_tsy',\t// ä¸€æ™‚åœæ­¢å†é–‹\n\t\t\t// 'stop_tsy',\t// ãƒˆã‚¥ã‚¤ãƒ¼ãƒ³ä¸­æ–­\n\t\t\t// 'tsy',\t\t// ãƒˆã‚¥ã‚¤ãƒ¼ãƒ³é–‹å§‹\n\t\t\t'wait_tsy',\t// ãƒˆã‚¥ã‚¤ãƒ¼ãƒ³çµ‚äº†å¾…ã¡\n\n\t\t// æ–‡å­—ãƒ»æ–‡å­—ãƒ¬ã‚¤ãƒ¤\n\t\t\t// 'autowc',\t// æ–‡å­—ã”ã¨ã®ã‚¦ã‚§ã‚¤ãƒˆ\n\t\t\t// 'ch',\t\t// æ–‡å­—ã‚’è¿½åŠ ã™ã‚‹\n\t\t\t// 'ch_in_style',\t// æ–‡å­—å‡ºç¾æ¼”å‡ºå®šç¾©\n\t\t\t// 'ch_out_style',\t// æ–‡å­—æ¶ˆå»æ¼”å‡ºå®šç¾©\n\t\t\t// 'clear_text',\t// æ–‡å­—æ¶ˆå»\n\t\t\t// 'current',\t// ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæ–‡å­—ãƒ¬ã‚¤ãƒ¤è¨­å®š\n\t\t\t// 'endlet_ml',\t// ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ãƒ†ã‚­ã‚¹ãƒˆä»£å…¥ã®çµ‚ç«¯\n\t\t\t// 'endlink',\t// ãƒã‚¤ãƒ‘ãƒ¼ãƒªãƒ³ã‚¯ã®çµ‚äº†\n\t\t\t// 'er',\t\t// ãƒšãƒ¼ã‚¸ä¸¡é¢ã®æ–‡å­—æ¶ˆå»\n\t\t\t// 'graph',\t\t// ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ç”»åƒè¡¨ç¤º\n\t\t\t// 'link',\t\t// ãƒã‚¤ãƒ‘ãƒ¼ãƒªãƒ³ã‚¯\n\t\t\t// 'r',\t\t\t// æ”¹è¡Œ\n\t\t\t// 'rec_ch',\t// å±¥æ­´æ›¸ãè¾¼ã¿\n\t\t\t// 'rec_r',\t\t// å±¥æ­´æ”¹è¡Œ\n\t\t\t// 'reset_rec',\t// å±¥æ­´ãƒªã‚»ãƒƒãƒˆ\n\t\t\t// 'ruby2',\t\t// æ–‡å­—åˆ—ã¨è¤‡æ•°ãƒ«ãƒ“ã®è¿½åŠ \n\t\t\t// 'set_focus',\t// ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ç§»å‹•\n\t\t\t// 'span',\t\t// ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚¹ã‚¿ã‚¤ãƒ«è¨­å®š\n\t\t\t// 'tcy',\t\t// ç¸¦ä¸­æ¨ªã‚’è¡¨ç¤ºã™ã‚‹\n\n\t\t// ç”»åƒãƒ»ç”»åƒãƒ¬ã‚¤ãƒ¤\n\t\t\t// 'add_face',\t// å·®åˆ†åç§°ã®å®šç¾©\n\t\t\t'wv',\t\t// å‹•ç”»å†ç”Ÿçµ‚äº†å¾…ã¡\n\n\t\t// HTMLãƒ•ãƒ¬ãƒ¼ãƒ \n\t\t\t// 'add_frame',\t// ãƒ•ãƒ¬ãƒ¼ãƒ è¿½åŠ \n\t\t\t// 'frame',\t// ãƒ•ãƒ¬ãƒ¼ãƒ ã«è¨­å®š\n\t\t\t// 'let_frame',\t// ãƒ•ãƒ¬ãƒ¼ãƒ å¤‰æ•°ã‚’å–å¾—\n\t\t\t// 'set_frame',\t// ãƒ•ãƒ¬ãƒ¼ãƒ å¤‰æ•°ã«è¨­å®š\n\t\t\t// 'tsy_frame',\t// ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’ãƒˆã‚¥ã‚¤ãƒ¼ãƒ³é–‹å§‹\n\n\t\t// ã‚¤ãƒ™ãƒ³ãƒˆ\n\t\t\t// 'clear_event',\t// ã‚¤ãƒ™ãƒ³ãƒˆã‚’å…¨æ¶ˆå»\n\t\t\t// 'enable_event',\t// ã‚¤ãƒ™ãƒ³ãƒˆæœ‰ç„¡ã®åˆ‡æ›¿\n\t\t\t// 'event',\t// ã‚¤ãƒ™ãƒ³ãƒˆã‚’äºˆç´„\n\t\t\t'l',\t// è¡Œæœ«ã‚¯ãƒªãƒƒã‚¯å¾…ã¡\n\t\t\t'p',\t// æ”¹ãƒšãƒ¼ã‚¸ã‚¯ãƒªãƒƒã‚¯å¾…ã¡\n\t\t\t's',\t// åœæ­¢ã™ã‚‹\n\t\t\t// [set_cancel_skip] ã‚¹ã‚­ãƒƒãƒ—ä¸­æ–­äºˆç´„\n\t\t\t'wait',\t\t// ã‚¦ã‚§ã‚¤ãƒˆã‚’å…¥ã‚Œã‚‹\n\t\t\t'waitclick',\t// ã‚¯ãƒªãƒƒã‚¯ã‚’å¾…ã¤\n\n\t\t// ï¼¢ï¼§ï¼­ãƒ»åŠ¹æœéŸ³\n\t\t\t// 'fadebgm',\t// BGMã®ãƒ•ã‚§ãƒ¼ãƒ‰\n\t\t\t// 'fadeoutbgm',// BGMã®ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆ\n\t\t\t// 'fadeoutse',\t// åŠ¹æœéŸ³ã®ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆ\n\t\t\t// 'fadese',\t// åŠ¹æœéŸ³ã®ãƒ•ã‚§ãƒ¼ãƒ‰\n\t\t\t// 'playbgm',\t// BGM ã®æ¼”å¥\n\t\t\t// 'playse',\t// åŠ¹æœéŸ³ã®å†ç”Ÿ\n\t\t\t// 'stop_allse',// å…¨åŠ¹æœéŸ³å†ç”Ÿã®åœæ­¢\n\t\t\t// 'stopbgm',\t// BGM æ¼”å¥ã®åœæ­¢\n\t\t\t// 'stopfadese',// éŸ³å£°ãƒ•ã‚§ãƒ¼ãƒ‰ã®åœæ­¢\n\t\t\t// 'stopse',\t// åŠ¹æœéŸ³å†ç”Ÿã®åœæ­¢\n\t\t\t// 'volume',\t// BGMã‚„åŠ¹æœéŸ³ã®éŸ³é‡ã‚’æŒ‡å®š\n\t\t\t'wb',\t// BGM ãƒ•ã‚§ãƒ¼ãƒ‰ã®çµ‚äº†å¾…ã¡\n\t\t\t'wf',\t// åŠ¹æœéŸ³ãƒ•ã‚§ãƒ¼ãƒ‰ã®çµ‚äº†å¾…ã¡\n\t\t\t'wl',\t// BGM å†ç”Ÿã®çµ‚äº†å¾…ã¡\n\t\t\t'ws',\t// åŠ¹æœéŸ³å†ç”Ÿã®çµ‚äº†å¾…ã¡\n\t\t\t// 'xchgbuf',\t// ã‚µã‚¦ãƒ³ãƒ‰ãƒãƒƒãƒ•ã‚¡ã®äº¤æ›\n\n\t\t// æ¡ä»¶åˆ†å²\n\t\t\t// 'else',\t// ãã®ä»–ifãƒ–ãƒ­ãƒƒã‚¯é–‹å§‹\n\t\t\t// 'elsif',\t// åˆ¥æ¡ä»¶ã®ifãƒ–ãƒ­ãƒƒã‚¯é–‹å§‹\n\t\t\t// 'endif',\t// ifãƒ–ãƒ­ãƒƒã‚¯ã®çµ‚ç«¯\n\t\t\t// 'if',\t// ifãƒ–ãƒ­ãƒƒã‚¯ã®é–‹å§‹\n\n\t\t// ãƒ©ãƒ™ãƒ«ãƒ»ã‚¸ãƒ£ãƒ³ãƒ—\n\t\t\t// 'button',\t// ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º\n\t\t\t// 'call',\t\t// ã‚µãƒ–ãƒ«ãƒ¼ãƒãƒ³ã‚³ãƒ¼ãƒ«\n\t\t\t// 'jump',\t\t// ã‚·ãƒŠãƒªã‚ªã‚¸ãƒ£ãƒ³ãƒ—\n\t\t\t// 'page',\t\t// ãƒšãƒ¼ã‚¸ç§»å‹•\n\t\t\t// 'pop_stack',\t// ã‚³ãƒ¼ãƒ«ã‚¹ã‚¿ãƒƒã‚¯ç ´æ£„\n\t\t\t// 'return',\t// ã‚µãƒ–ãƒ«ãƒ¼ãƒãƒ³ã‹ã‚‰æˆ»ã‚‹\n\n\t\t// ãƒã‚¯ãƒ­\n\t\t\t// 'bracket2macro',\t// æ‹¬å¼§ãƒã‚¯ãƒ­ã®å®šç¾©\n\t\t\t// 'char2macro',\t// ä¸€æ–‡å­—ãƒã‚¯ãƒ­ã®å®šç¾©\n\t\t\t// 'endmacro',\t// ãƒã‚¯ãƒ­å®šç¾©ã®çµ‚äº†\n\t\t\t// 'macro',\t\t// ãƒã‚¯ãƒ­å®šç¾©ã®é–‹å§‹\n\n\t\t// ã—ãŠã‚Š\n\t\t\t// 'copybookmark',\t// ã—ãŠã‚Šã®è¤‡å†™\n\t\t\t// 'erasebookmark',\t// ã—ãŠã‚Šã®æ¶ˆå»\n\t\t\t// 'load',\t\t\t// ã—ãŠã‚Šã®èª­è¾¼\n\t\t\t// 'record_place',\t// ã‚»ãƒ¼ãƒ–ãƒã‚¤ãƒ³ãƒˆæŒ‡å®š\n\t\t\t// 'reload_script',\t// ã‚¹ã‚¯ãƒªãƒ—ãƒˆå†èª­è¾¼\n\t\t\t// 'save',\t\t\t// ã—ãŠã‚Šã®ä¿å­˜\n\n\t\t// ç”»é¢æºã‚‰ã—\n\t\t\t'quake',\t\t// ç”»é¢ã‚’æºã‚‰ã™\n\t\t\t// 'stop_quake',// ç”»é¢æºã‚‰ã—ä¸­æ–­\n\t\t\t'wq',\t\t// ç”»é¢æºã‚‰ã—çµ‚äº†å¾…ã¡\n\n\t\t// ã‚·ã‚¹ãƒ†ãƒ \n\t\t\t// 'close',\t\t// ã‚¢ãƒ—ãƒªã®çµ‚äº†\n\t\t\t// 'export',\t// ãƒ—ãƒ¬ã‚¤ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ\n\t\t\t// 'import',\t// ãƒ—ãƒ¬ã‚¤ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ\n\t\t\t// 'loadplugin',\t// ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®èª­ã¿è¾¼ã¿\n\t\t\t// 'navigate_to',\t// ï¼µï¼²ï¼¬ã‚’é–‹ã\n\t\t\t// 'snapshot',\t\t// ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆ\n\t\t\t// 'title',\t\t// ã‚¿ã‚¤ãƒˆãƒ«æŒ‡å®š\n\t\t\t// 'toggle_full_screen',\t// å…¨ç”»é¢çŠ¶æ…‹åˆ‡æ›¿\n\t\t\t// 'update_check',\t// æ›´æ–°ãƒã‚§ãƒƒã‚¯æ©Ÿèƒ½\n\t\t\t// 'window',\t// ã‚¢ãƒ—ãƒªã‚¦ã‚¤ãƒ³ãƒ‰ã‚¦è¨­å®š\n\n\t\t// ãƒ‡ãƒãƒƒã‚°ãƒ»ãã®ä»–\n\t\t\t// 'dump_lay',\t\t// ãƒ¬ã‚¤ãƒ¤ã®ãƒ€ãƒ³ãƒ—\n\t\t\t// 'dump_script',\t// å¤–éƒ¨ã¸ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’è¡¨ç¤º\n\t\t\t// 'dump_stack',\t// ã‚¹ã‚¿ãƒƒã‚¯ã®ãƒ€ãƒ³ãƒ—\n\t\t\t// 'dump_val',\t\t// å¤‰æ•°ã®ãƒ€ãƒ³ãƒ—\n\t\t\t// 'log',\t\t// ãƒ­ã‚°å‡ºåŠ›\n\t\t\t// 'trace',\t\t// ãƒ‡ãƒãƒƒã‚°è¡¨ç¤ºã¸å‡ºåŠ›\n\t\t]);\n\t\treadonly\t#setTag2FinishTrans = new Set([\n\t\t\t'finish_trans',\t// ãƒˆãƒ©ãƒ³ã‚¹å¼·åˆ¶çµ‚äº†\n\t\t\t'trans',\t\t// ãƒšãƒ¼ã‚¸è£è¡¨ã‚’äº¤æ›\n\t\t\t'quake',\t\t// ç”»é¢ã‚’æºã‚‰ã™\n\t\t\t'stop_quake',\t// ç”»é¢æºã‚‰ã—ä¸­æ–­\n\t\t\t'add_filter',\t// ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼è¿½åŠ \n\t\t]);\n\t\t// ã‚­ãƒ¼æŠ¼ã—ã£ã±ãªã—ã‚¹ã‚­ãƒƒãƒ—ã§å‡¦ç†ã›ãšã‚¹ãƒ«ãƒ¼ã™ã‚‹ã‚¿ã‚°\n\t\treadonly\t#hTag2SkipBypass: {[tag_name: string]: TTag} = {\n\t\t\t'wt'\t\t: ()=> {CmnTween.stopEndTrans(); return false},\n\t\t\t\t\t\t\t\t\t\t\t// ãƒˆãƒ©ãƒ³ã‚¹çµ‚äº†å¾…ã¡\n\t\t\t'wait_tsy'\t: o=> this.hTag.stop_tsy(o),\t// ãƒˆã‚¥ã‚¤ãƒ¼ãƒ³çµ‚äº†å¾…ã¡\n\t\t\t// 'wv',\t\tï¼šã‚¿ã‚°å†…éƒ¨ã§å‡¦ç†\t// å‹•ç”»å†ç”Ÿçµ‚äº†å¾…ã¡\n\t\t\t'wait'\t\t\t: ()=> false,\t// ã‚¦ã‚§ã‚¤ãƒˆã‚’å…¥ã‚Œã‚‹\n\t\t\t// 'playbgm',\tï¼šã‚¹ãƒ«ãƒ¼ä¸å¯\t\t// BGM ã®æ¼”å¥\n\t\t\t// 'playse',\tï¼šã‚¿ã‚°å†…éƒ¨ã§å‡¦ç†\t// åŠ¹æœéŸ³ã®å†ç”Ÿ\n\t\t\t'wb'\t: ()=> this.hTag.stopfadese({buf: BUF_BGM}),\n\t\t\t\t\t\t\t\t\t\t\t// BGM ãƒ•ã‚§ãƒ¼ãƒ‰ã®çµ‚äº†å¾…ã¡\n\t\t\t'wf'\t: o=> this.hTag.stopfadese(o),\t// åŠ¹æœéŸ³ãƒ•ã‚§ãƒ¼ãƒ‰ã®çµ‚äº†å¾…ã¡\n\t\t\t// 'ws'\t\tï¼šã‚¿ã‚°å†…éƒ¨ã§å‡¦ç†\t// åŠ¹æœéŸ³å†ç”Ÿã®çµ‚äº†å¾…ã¡\n\t\t\t'wq'\t: ()=> this.hTag.stop_quake({}),\t// ç”»é¢æºã‚‰ã—çµ‚äº†å¾…ã¡\n\t\t\t// fadeç³»\tï¼šã‚¿ã‚°å†…éƒ¨ã§å‡¦ç†\n\t\t\t// 'ch'\t\tï¼šã‚¿ã‚°å†…éƒ¨ã§å‡¦ç†\t// æ–‡å­—ã‚’è¿½åŠ ã™ã‚‹\n\t\t\t// 'tsy'\tï¼šã‚¿ã‚°å†…éƒ¨ã§å‡¦ç†\t// ãƒˆã‚¥ã‚¤ãƒ¼ãƒ³é–‹å§‹\n\t\t\t// 'trans'\tï¼šã‚¿ã‚°å†…éƒ¨ã§å‡¦ç†\t// ãƒšãƒ¼ã‚¸è£è¡¨ã‚’äº¤æ›\n\t\t\t'quake'\t\t: ()=> false,\t\t// ç”»é¢ã‚’æºã‚‰ã™\n\t\t};\n\t\t// ã‚¿ã‚°å‡¦ç†ä¸­ã«ã‚¯ãƒªãƒƒã‚¯ãªã©ã§å³çµ‚ã‚ã‚‰ã›ã‚‰ã‚Œã‚‹ã‚¿ã‚°ï¼ˆcanskip å±æ€§ãŒã‚ã‚‹ï¼‰\n\t\treadonly\t#hTag2CanSkip: {[tag_name: string]: boolean} = {\n\t\t\t\t\t\t// ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤\n\t\t\t'wt'\t\t: true ,\t// [wt]ãƒˆãƒ©ãƒ³ã‚¹çµ‚äº†å¾…ã¡\n\t\t\t'wait_tsy'\t: true ,\t// [wait_tsy]ãƒˆã‚¥ã‚¤ãƒ¼ãƒ³çµ‚äº†å¾…ã¡\n\t\t\t'wv'\t\t: true ,\t// [wv]å‹•ç”»å†ç”Ÿçµ‚äº†å¾…ã¡\n\t\t\t'wait'\t\t: true ,\t// [wait]ã‚¦ã‚§ã‚¤ãƒˆã‚’å…¥ã‚Œã‚‹\n\t\t\t'playbgm'\t: false,\t// [playbgm]BGM ã®æ¼”å¥\n\t\t\t'playse'\t: true ,\t// [playse]åŠ¹æœéŸ³ã®å†ç”Ÿ\n\t\t\t'wb'\t\t: false,\t// [wb]BGM ãƒ•ã‚§ãƒ¼ãƒ‰ã®çµ‚äº†å¾…ã¡\n\t\t\t'wf'\t\t: false,\t// [wf]åŠ¹æœéŸ³ãƒ•ã‚§ãƒ¼ãƒ‰ã®çµ‚äº†å¾…ã¡\n\t\t\t'ws'\t\t: false,\t// [ws]åŠ¹æœéŸ³å†ç”Ÿã®çµ‚äº†å¾…ã¡\n\t\t\t'wq'\t\t: true ,\t// [wq]ç”»é¢æºã‚‰ã—çµ‚äº†å¾…ã¡\n\t\t};\n\n\n\t#evtMng\t: EventMng;\n\t#layMng\t: LayerMng;\n\tsetOtherObj(evtMng: EventMng, layMng: LayerMng): void {\n\t\tthis.#evtMng = evtMng;\n\t\tthis.#layMng = layMng;\n\t}\n\n\n\t//MARK: ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ãƒ†ã‚­ã‚¹ãƒˆä»£å…¥\n\t#let_ml(hArg: TArg) {\n\t\tconst {name} = hArg;\n\t\tif (! name) throw 'nameã¯å¿…é ˆã§ã™';\n\n\t\tlet ml = '';\n\t\tconst len = this.#script.len;\n\t\tfor (; this.#idxToken<len; ++this.#idxToken) {\n\t\t\tml = this.#script.aToken[this.#idxToken]!;\n\t\t\tif (ml !== '') break;\n\t\t}\n\t\thArg.text = ml;\n\t\thArg.cast = 'str';\n\t\tthis.hTag.let(hArg);\n\t\tthis.#idxToken += 2;\n\t\tthis.#lineNum += (ml.match(/\\n/g) ?? []).length;\n\n\t\treturn false;\n\t}\n\n\n\t//MARK: ã‚¹ã‚¿ãƒƒã‚¯ã®ãƒ€ãƒ³ãƒ—\n\t#dump_stack() {\n\t\tif (this.#idxToken === 0) {\n\t\t\tconsole.group(`ğŸ¥Ÿ [dump_stack] ã‚¹ã‚¯ãƒªãƒ—ãƒˆç¾åœ¨åœ° fn:${this.#scriptFn} line:1 col:0`);\n\t\t\tconsole.groupEnd();\n\t\t\treturn false;\n\t\t}\n\n\t\tconst lc0 = this.#cnvIdx2lineCol(this.#script, this.#idxToken);\n\t\tconst now = `ã‚¹ã‚¯ãƒªãƒ—ãƒˆç¾åœ¨åœ° fn:${this.#scriptFn} line:${String(lc0.ln)} col:${String(lc0.col_s +1)}`;\n\t\tconsole.group(`ğŸ¥Ÿ [dump_stack] ${now}`);\n\t\tconst len = this.#aCallStk.length;\n\t\tif (len > 0) {\n\t\t\tconsole.info(now);\n\t\t\tfor (let i=len -1; i>=0; --i) {\n\t\t\t\tconst cs = this.#aCallStk[i]!;\n\t\t\t\tconst hMp = cs.csArg[':hMp'];\n\t\t\t\t// eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n\t\t\t\tconst from_macro_nm = hMp\n\t\t\t\t\t? <string>(<{[nm: string]: any}>hMp)[':ã‚¿ã‚°å']\n\t\t\t\t\t: undefined;\n\t\t\t\tconst call_nm = cs.csArg[':ã‚¿ã‚°å'] ?? '';\n\t\t\t\tconst lc = this.#cnvIdx2lineCol(this.#hScript[cs.fn], cs.idx);\n\t\t\t\tconsole.info(\n\t\t\t\t\t`${String(len -i)}ã¤å‰ã®ã‚³ãƒ¼ãƒ«å…ƒ fn:${cs.fn} line:${\n\t\t\t\t\t\tString(lc.ln)} col:${String(lc.col_s +1)\n\t\t\t\t\t}${\n\t\t\t\t\t\tfrom_macro_nm ?'ï¼ˆ['+ from_macro_nm +']ãƒã‚¯ãƒ­å†…ï¼‰' :' '\n\t\t\t\t\t}ã§ [${call_nm} ...]ã‚’ã‚³ãƒ¼ãƒ«`\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t\tconsole.groupEnd();\n\n\t\treturn false;\n\t}\n\t#cnvIdx2lineCol(st: Script | undefined, idx: number): {ln: number, col_s: number, col_e: number} {\n\t\tconst ret = {ln: 1, col_s: 0, col_e: 0};\n\t\tif (! st) return ret;\n\n\t\tlet i = idx -1;\n\t\tconst lN = ret.ln = st.aLNum[i]!;\n\t\twhile (st.aLNum[i] === lN) {\n\t\t\tconst tkn = st.aToken[i]!;\n\t\t\tif (! tkn.startsWith('\\n')) {\n\t\t\t\tconst len = tkn.length;\n//console.log(`fn:ScriptIterator.ts line:586 cnvIdx2lineCol tkn:${st.aToken[i]} len:${len} s:${ret.col_s} e:${ret.col_e}`);\n\t\t\t\tif (ret.col_e > 0) ret.col_s += len;\n\t\t\t\tret.col_e += len;\n\t\t\t}\n\t\t\tif (--i < 0) break;\n\t\t}\n\n\t\treturn ret;\n\t}\n\n\n\t//MARK: å¤–éƒ¨ã¸ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’è¡¨ç¤º\n\t#dump_script(hArg: TArg) {\n\t\tconst {set_fnc, break_fnc} = hArg;\n\t\tif (! set_fnc) throw 'set_fncã¯å¿…é ˆã§ã™';\t// ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’è¿”ã™ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯\n\n\t\t// eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n\t\tthis.#fncSet = (<any>globalThis)[set_fnc];\n\t\t// eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n\t\tif (! this.#fncSet) {\n\t\t\tif (argChk_Boolean(hArg, 'need_err', true)) throw `HTMLå†…ã«é–¢æ•°${set_fnc}ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“`;\n\t\t\tthis.#fncSet = ()=> { /* empty */ };\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.noticeBreak = (goto: boolean)=> {\n\t\t\tif (this.#fnLastBreak !== this.#scriptFn) {\n\t\t\t\tthis.#fnLastBreak = this.#scriptFn;\n\t\t\t\tthis.#fncSet(\n\t\t\t\t\tthis.#hScrCache4Dump[this.#scriptFn] ??= this.#script.aToken.join('')\n\t\t\t\t);\n\t\t\t}\n\t\t\tthis.#fncBreak(this.#lineNum, goto);\n\t\t};\n\t\tthis.noticeBreak(true);\t// ä¸€åº¦ç›®ã®this.fncBreak()ã¯ã‚¹ãƒ«ãƒ¼ï¼ˆã¾ã èª­ã‚“ã§ãªã„ã—ï¼‰\n\n\t\tif (! break_fnc) return false;\t// Breaké€šçŸ¥ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯\n\n\t\t// eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n\t\tthis.#fncBreak = (<any>globalThis)[break_fnc];\n\t\t// eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n\t\tif (! this.#fncBreak) {\n\t\t\tif (argChk_Boolean(hArg, 'need_err', true)) throw `HTMLå†…ã«é–¢æ•°${break_fnc}ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“`;\n\t\t\tthis.#fncBreak = ()=> { /* empty */ };\n\t\t}\n\n\t\treturn false;\n\t}\n\t#fncSet: (txt: string)=> void = ()=> { /* empty */ };\n\t#fncBreak: (ln: number, goto: boolean)=> void = ()=> { /* empty */ };\n\t#fnLastBreak = '';\n\t#hScrCache4Dump: {[fn: string]: string;} = {};\n\tnoticeBreak = (_goto: boolean)=> { /* empty */ };\n\n\n\t#dumpErrLine = 5;\n\tdumpErrForeLine() {\n\t\tif (this.#idxToken === 0) {\n\t\t\tconsole.group(`ğŸ¥Ÿ Error line (from 0 rows before) fn:${this.#scriptFn}`);\n\t\t\tconsole.groupEnd();\n\t\t\treturn;\n\t\t}\n\n\t\tlet s = '';\n\t\tfor (let i=this.#idxToken -1; i>=0; --i) {\n\t\t\ts = String(this.#script.aToken[i]) + s;\n\t\t\tif ((s.match(/\\n/g) ?? []).length >= this.#dumpErrLine) break;\n\t\t}\n\t\tconst a = s.split('\\n').slice(-this.#dumpErrLine);\n\t\tconst len = a.length;\n\t\tconsole.group(`ğŸ¥Ÿ Error line (from ${String(len)} rows before) fn:${this.#scriptFn}`);\n\t\tconst ln_txt_width = String(this.#lineNum).length;\n\t\tconst lc = this.#cnvIdx2lineCol(this.#script, this.#idxToken);\n\t\tfor (let i=0; i<len; ++i) {\n\t\t\tconst ln = this.#lineNum -len +i +1;\n\t\t\tconst mes = `${String(ln).padStart(ln_txt_width, ' ')}: %c`;\n\t\t\tconst e = a[i]!;\n\t\t\tconst line = e.length > 75 ?e.slice(0, 75) +'â€¦' :e;\t// é•·ã„å ´åˆã¯å¾Œç•¥\n\t\t\tif (i === len -1) console.info(\n\t\t\t\tmes + line.slice(0, lc.col_s) +'%c'+ line.slice(lc.col_s),\n\t\t\t\t'color: black; background-color: skyblue;', 'color: black; background-color: pink;'\n\t\t\t)\n\t\t\telse console.info(mes + line, 'color: black; background-color: skyblue;');\n\t\t}\n\t\tconsole.groupEnd();\n\t\t//console.log('Linkã®å‡ºåŠ›   : %o', 'file:///Volumes/MacHD2/_Famibee/SKYNovel/prj/mat/main.sn');\n\t}\n\n\n\t#aIfStk\t: number[]\t= [-1];\t// å…ˆé ­ã«ç©ã‚€ FIFOãƒãƒƒãƒ•ã‚¡ï¼ˆunshift / shiftï¼‰\n\t//MARK: ifãƒ–ãƒ­ãƒƒã‚¯ã®çµ‚ç«¯\n\t#endif() {\n\t\tconst t = this.#aIfStk[0];\n\t\tif (! t) throw 'this.#aIfStk ãŒç•°å¸¸ã§ã™';\n\t\tif (t === -1) throw 'ifãƒ–ãƒ­ãƒƒã‚¯å†…ã§ã¯ã‚ã‚Šã¾ã›ã‚“';\n\n\t\tthis.#idxToken = t;\n\t\tthis.#aIfStk.shift();\t// æœ€åˆã®è¦ç´ ã‚’å–ã‚Šé™¤ã\n\n\t\treturn false;\n\t}\n\t//MARK: ifãƒ–ãƒ­ãƒƒã‚¯ã®é–‹å§‹\n\t#if(hArg: TArg) {\n\t\t//console.log('if idxToken:'+ this.#idxToken);\n\t\tconst {exp} = hArg;\n\t\tif (! exp) throw 'expã¯å¿…é ˆã§ã™';\n\t\tif (exp.startsWith('&')) throw 'å±æ€§expã¯ã€Œ&ã€ãŒä¸è¦ã§ã™';\n\n\t\tlet cntDepth = 0;\t\t// ifæ·±åº¦ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼\n\t\tlet\tidxGo = this.prpPrs.parse(exp) ?this.#idxToken :-1;\n\t\tconst lnIf = this.#script.aLNum[this.#idxToken];\n\t\tconst zLn = this.#lineNum -((lnIf ?? 0) || 0);\t// ??ã§ã¯ãªãã€‚NaN ã¯ falsy\n\t\tconst len = this.#script.len;\n\t\tfor (; this.#idxToken<len; ++this.#idxToken) {\n\t\t\tconst ln = this.#script.aLNum[this.#idxToken];\n\t\t\tthis.#script.aLNum[this.#idxToken] = ((ln ?? 0) || 0)+ zLn; // ??ã¯NaNä¸å¯\n\t\t\tconst tkn = this.#script.aToken[this.#idxToken];\n\t\t\t//console.log(`[if]ãƒˆãƒ¼ã‚¯ãƒ³ ${this.#scriptFn}:${this.#lineNum} idx:${this.#idxToken} realLn:${this.#script.aLNum[this.#idxToken]} idxGo:${idxGo} cntDepth:${cntDepth} token<${tkn}>`);\n\t\t\tif (! tkn) continue;\n\n\t\t\tconst uc = tkn.charCodeAt(0);\t// TokenTopUnicode\n\t\t\tif (uc === 10) {this.#lineNum += tkn.length; continue}\t// \\n æ”¹è¡Œ\n\t\t\tif (uc !== 91) continue;\t// [ ã‚¿ã‚°é–‹å§‹ä»¥å¤–\n\n\t\t\tconst [tag_name, args] = tagToken2Name_Args(tkn);\n\t\t\tif (! (tag_name in this.hTag)) throw `æœªå®šç¾©ã®ã‚¿ã‚°[${tag_name}]ã§ã™`;\n\t\t\tthis.#alzTagArg.parse(args);\n\n\t\t\tswitch (tag_name) {\n\t\t\tcase 'if':\t++cntDepth; break;\n\n\t\t\tcase 'elsif':{\n\t\t\t\tif (cntDepth > 0) break;\n\t\t\t\tif (idxGo > -1) break;\n\n\t\t\t\tconst e = this.#alzTagArg.hPrm.exp?.val;\n\t\t\t\tif (! e) throw 'expã¯å¿…é ˆã§ã™';\n\t\t\t\tif (e.startsWith('&')) throw 'å±æ€§expã¯ã€Œ&ã€ãŒä¸è¦ã§ã™';\n\t\t\t\tif (this.prpPrs.parse(e)) idxGo = this.#idxToken +1;\n\t\t\t}\tbreak;\n\n\t\t\tcase 'else':\n\t\t\t\tif (cntDepth > 0) break;\n\t\t\t\tif (idxGo === -1) idxGo = this.#idxToken +1;\n\t\t\t\tbreak;\n\n\t\t\tcase 'endif':\n\t\t\t\tif (cntDepth > 0) {--cntDepth; break}\n\t\t\t\tif (idxGo === -1) {\n\t\t\t\t\t++this.#idxToken;\n\t\t\t\t\tthis.#script.aLNum[this.#idxToken]! += zLn;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tthis.#aIfStk.unshift(this.#idxToken +1);\t// å…ˆé ­ã«è¦ç´ è¿½åŠ \n\t\t\t\t\tthis.#idxToken = idxGo;\n\t\t\t\t\tthis.#lineNum = this.#script.aLNum[this.#idxToken]!;\n\t\t\t\t\t\t// +zLn ä¸è¦\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t\tthrow '[endif]ãŒãªã„ã¾ã¾ã‚¹ã‚¯ãƒªãƒ—ãƒˆçµ‚ç«¯ã§ã™';\n\t\t//return false;\n\t}\n\n\n\t//MARK: ã‚µãƒ–ãƒ«ãƒ¼ãƒãƒ³ã‚³ãƒ¼ãƒ«\n\t#call(hArg: TArg) {\n\t\tif (! argChk_Boolean(hArg, 'count', false)) this.#eraseKidoku();\n\n\t\tconst {fn} = hArg;\n\t\tif (fn) this.#cnvSnPath(fn);\t// chk only\n\t\tthis.#callSub({...hArg}, ReadingState.popLocalEvts());\n\t\t\t// ':hEvt1Time'ã®æ‰±ã„ã ã‘ã¯[macro]ã¨ç•°ãªã‚‹\n\n\t\tif (argChk_Boolean(hArg, 'clear_local_event', false)) this.hTag.clear_event({});\n\t\treturn this.#jumpWork(fn, hArg.label);\n\t}\n\t#callSub(hArg: TArg, hEvt1Time?: T_HEvt2Fnc) {\n\t\tconst csa: ICallStackArg = {\n\t\t\t...hArg,\n\t\t\t...hEvt1Time ?{':hEvt1Time': hEvt1Time} :{},\n\t\t\t':hMp'\t\t: this.val.cloneMp(),\n\t\t\t':lenIfStk'\t: this.#aIfStk.length,\n\t\t};\n\t\tthis.#script.aLNum[this.#idxToken] = this.#lineNum;\t// æˆ»ã£ãŸã¨ãã®è¡Œç•ªå·\n\t\tif (! this.#resvToken) {csa[':resvToken'] = ''; this.#clearResvToken()}\n\t\tthis.#aCallStk.push(new CallStack(this.#scriptFn, this.#idxToken, csa));\n\t\tthis.#aIfStk.unshift(-1);\t// æœ€åˆã«è¦ç´ ã‚’è¿½åŠ \n\t}\n\n\t//MARK: ã‚·ãƒŠãƒªã‚ªã‚¸ãƒ£ãƒ³ãƒ—\n\t#jump(hArg: TArg) {\n\t\tif (! argChk_Boolean(hArg, 'count', true)) this.#eraseKidoku();\n\n\t\tthis.#aIfStk[0] = -1;\n\t\treturn this.#jumpWork(hArg.fn, hArg.label);\n\t}\n\n\t//MARK: ã‚³ãƒ¼ãƒ«ã‚¹ã‚¿ãƒƒã‚¯ç ´æ£„\n\t#pop_stack(hArg: TArg) {\n\t\tif (argChk_Boolean(hArg, 'clear', false)) this.#aCallStk = [];\n\t\telse if (! this.#aCallStk.pop()) throw 'ã‚¹ã‚¿ãƒƒã‚¯ãŒç©ºã§ã™';\n\t\tthis.#clearResvToken();\n\t\tthis.#aIfStk = [-1];\n\t\tthis.val.setMp(creMP());\n\n\t\treturn false;\n\t}\n\n\t//MARK: ã‚µãƒ–ãƒ«ãƒ¼ãƒãƒ³ã‹ã‚‰æˆ»ã‚‹\n\t#return(hArg: TArg) {\n\t\tconst cs = this.#aCallStk.pop();\n\t\tif (! cs) throw 'ã‚¹ã‚¿ãƒƒã‚¯ãŒç©ºã§ã™';\n\t\tconst csa = cs.csArg;\n\t\tthis.#aIfStk = this.#aIfStk.slice(-csa[':lenIfStk']);\t// æœ€åˆã®è¦ç´ ã‚’å–ã‚Šé™¤ã\n\n\t\tconst hMp = csa[':hMp'];\t// ãƒã‚¯ãƒ­ã‹ã‚‰ã®å¾©å¸°ã®å ´åˆã«mp:å€¤ã‚‚å¾©å¸°\n\t\t// eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n\t\tif (hMp) this.val.setMp(hMp);\n\t\t\t// ãŸã¶ã‚“å‹ãƒã‚§ãƒƒã‚¯çš„ã« if (hMp) ã¯ä¸è¦ã ãŒã€\n\t\t\t// ã‚ã¨ã‹ã‚‰ESLintå¯¾å¿œãªã®ã§å®‰æ˜“ã«æŒ™å‹•ã‚’å¤‰ãˆãªã„æ–¹é‡ã§\n\n\t\tconst after_token = csa[':resvToken'];\n\t\tif (after_token) this.nextToken = ()=> {\n\t\t\tthis.#clearResvToken();\n\t\t\treturn after_token;\n\t\t}\n\t\telse this.#clearResvToken();\n\n\t\tif (csa[':hEvt1Time']) ReadingState.pushLocalEvts(csa[':hEvt1Time']);\n\n\t\tconst {fn, label} = hArg;\n\t\tif (fn || label) return this.#jumpWork(fn, label);\n\n\t\tif (cs.fn in this.#hScript) {this.#jump_light(cs); return false}\n\t\treturn this.#jumpWork(cs.fn, '', cs.idx);\t// ç¢ºå®Ÿã«ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ­ãƒ¼ãƒ‰ãªã®ã§\n\t}\n\n\t#resvToken\t= '';\n\t#clearResvToken() {\n\t\tthis.#resvToken = '';\n\t\tthis.nextToken = ()=> this.#nextToken_Proc();\n\t}\n\n\n\t#skipLabel = '';\n\t#jumpWork(fn = '', label = '', idx = 0): boolean {\n\t\tif (CmnLib.debugLog) console.log(`ğŸ“œ %c1:jumpWork%c fn:${fn} lbl:${label} idx:${String(idx)}`, 'color:#3B0;', '');\n\t\tif (! fn && ! label) this.main.errScript('[jumpç³»] fnã¾ãŸã¯labelã¯å¿…é ˆã§ã™');\n\t\tif (label) {\n\t\t\tif (! label.startsWith('*')) this.main.errScript('[jumpç³»] labelã¯*ã§å§‹ã¾ã‚Šã¾ã™');\n\t\t\tthis.#skipLabel = label;\n\t\t\tif (! this.#skipLabel.startsWith('**')) this.#idxToken = idx;\n\t\t}\n\t\telse {\n\t\t\tthis.#skipLabel = '';\n\t\t\tthis.#idxToken = idx;\n\t\t}\n\n\t\tif (! fn) {this.analyzeInit(); return false}\n\t\tif (fn.includes('@')) throw '[jumpç³»] fn ã«ã¯æ–‡å­—ã€Œ@ã€ã¯ç¦æ­¢ã§ã™';\n\n\t\tconst full_path = this.#cnvSnPath(fn);\n\t\tif (fn === this.#scriptFn) {this.analyzeInit(); return false}\n\t\tthis.#scriptFn = fn;\n\t\tconst st = this.#hScript[fn];\n\t\tif (st) {this.#script = st; this.analyzeInit(); return false}\n\n\t\tconst RPN_JUMPWORK = `jumpWork fn:${fn}`;\n\t\tReading.beginProc(RPN_JUMPWORK);\n\t\tlet fp_diff = '';\n\t\tconst ldr = new Loader;\n\t\ttry {\n\t\t\tfp_diff = this.#cnvSnPath(fn +'@');\n\t\t\t// æ´¾ç”Ÿãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã™ã‚‹å ´åˆ\n\t\t\tldr.add({name: fn +':base', url: full_path});\n\t\t\tldr.add({name: fn, url: fp_diff});\n\t\t} catch {\n\t\t\t// æ´¾ç”Ÿãƒ•ã‚¡ã‚¤ãƒ«ã¯ãªã„\n\t\t\tldr.add({name: fn, url: full_path});\n\t\t}\n\t\tldr.use((res, next)=> {\n\t\t\t// eslint-disable-next-line @typescript-eslint/no-unsafe-argument\n\t\t\tthis.sys.dec(res.extension, res.data).then(d=> {\n\t\t\t\tres.data = d;\n\t\t\t\tnext();\n\t\t\t})\n\t\t\t.catch((e: unknown)=> {\n\t\t\t\tthis.main.errScript(`[jumpç³»]snãƒ­ãƒ¼ãƒ‰å¤±æ•—ã§ã™ fn:${res.name} ${String(e)}`, false);\n\t\t\t\tnext();\n\t\t\t});\n\t\t})\n\t\t.load((_ldr, hRes)=> {\n\t\t\tReading.endProc(RPN_JUMPWORK);\n\t\t\tif (fp_diff) {\t// æ´¾ç”Ÿãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã™ã‚‹å ´åˆ\n\t\t\t\tconst scrBase: string = hRes[fn +':base']!.data;\n\t\t\t\tconst scrDiff: string = hRes[fn]!.data;\n\t\t\t\tconst aBase: string[] = scrBase.split('\\n');\n\t\t\t\tconst aDiff: string[] = scrDiff.split('\\n');\n\t\t\t\tconst lenB = aBase.length;\n\t\t\t\tconst lenD = aDiff.length;\n\t\t\t\t// ã€æ´¾ç”Ÿã‚¹ã‚¯ãƒªãƒ—ãƒˆã€‘ã®ç©ºè¡Œã¸ã€ã€åŸºåº•ã‚¹ã‚¯ãƒªãƒ—ãƒˆã€‘ã®åŒã˜è¡Œã®å†…å®¹ã‚’ã‚³ãƒ”ãƒ¼\n\t\t\t\tfor (let i=0; i<lenD && i<lenB; ++i) aDiff[i] ||= aBase[i] ?? '';\n\n\t\t\t\t// ã€æ¥å°¾è¾ã¤ããƒ•ã‚¡ã‚¤ãƒ«ã€‘ã¨ã—ã¦æ‰±ã†\n\t\t\t\thRes[fn]!.data = aDiff.join('\\n');\n\t\t\t\t// eslint-disable-next-line @typescript-eslint/no-dynamic-delete\n\t\t\t\tdelete hRes[fn +':base'];\n\t\t\t}\n\n\t\t\t// eslint-disable-next-line @typescript-eslint/unbound-method\n\t\t\tthis.nextToken = this.#nextToken_Proc;\n\t\t\tthis.#lineNum = 1;\n\n\t\t\t// eslint-disable-next-line @typescript-eslint/no-unsafe-argument\n\t\t\tthis.#resolveScript(hRes[fn]!.data);\n\t\t\tthis.hTag.record_place({});\n\t\t\tthis.analyzeInit();\n\t\t});\n\n\t\treturn true;\n\t}\n\tprivate\tanalyzeInit(): void {\n\t\tif (CmnLib.debugLog) console.log(`ğŸ“œ %c9:analyzeInit%c fn:${this.#scriptFn} lbl:${this.#skipLabel} idx:${String(this.#idxToken)}`, 'color:#3B0;', '');\n\t\tconst o = this.#seekScript(this.#script, Boolean(this.val.getVal('mp:const.sn.macro.name')), this.#lineNum, this.#skipLabel, this.#idxToken);\n\t\tthis.#idxToken\t= o.idx;\n\t\tthis.#lineNum\t= o.ln;\n\t}\n\n\t// ã‚·ãƒŠãƒªã‚ªè§£æå‡¦ç†ãƒ«ãƒ¼ãƒ—ãƒ»å†’é ­å‡¦ç†\n\tnextToken = ()=> '';\t// åˆæœŸåŒ–å‰ã«çµ‚äº†ã—ãŸå ´åˆå‘ã‘\n\t#nextToken_Proc(): string {\n\t\tif (this.#errOverScr()) return '';\n\n\t\tthis.#recordKidoku();\n\n\t\t// ãƒˆãƒ¼ã‚¯ãƒ³ã®è¡Œç•ªå·æ›´æ–°\n\t\tthis.#script.aLNum[this.#idxToken] ||= this.#lineNum;\t// ??ã¯NaNä¸å¯\n\t\tconst token = this.#script.aToken[this.#idxToken]!;\n\t\tthis.#dbgToken(token);\n\t\t++this.#idxToken;\n\n\t\treturn token;\n\t}\n\t#dbgToken = (_token: string)=> { /* empty */ };\n\t#errOverScr(): boolean {\n\t\tif (this.#idxToken < this.#script.len) return false;\n\t\tthis.main.errScript('ã‚¹ã‚¯ãƒªãƒ—ãƒˆçµ‚ç«¯ã§ã™ errOverScr');\n\t\treturn true;\n\t}\n\n\n\treadonly #REG_NONAME_LABEL\t\t= /(\\*{2,})([^|]*)/;\n\treadonly #REG_TOKEN_MACRO_BEGIN\t= /^\\[macro\\s/;\n\treadonly #REG_TOKEN_MACRO_END\t= /^\\[endmacro[\\s\\]]/;\n\t#seekScript(st: Script, inMacro: boolean, iln: number, iskipLabel: string, idx: number): ISeek {\n\t\t//console.log(`seekScript (from)inMacro:${inMacro} (from)ln:${ln} (to)skipLabel:${skipLabel}: (to)idx:${idx}`);\n\t\tconst len = st.aToken.length;\n\t\tlet ln = iln, skipLabel = iskipLabel;\n\t\tif (! skipLabel) {\t// ãƒ©ãƒ™ãƒ«ã‚¸ãƒ£ãƒ³ãƒ—ä»¥å¤–ï¼ˆå…ˆé ­ã‹ã‚‰é–‹å§‹ï¼‰\n\t\t\tif (this.#errOverScr()) return {idx, ln};\n\n\t\t\tif (! st.aLNum[idx]) {\t// NaNã€undefined ã¯ falsy\n\t\t\t\tln = 1;\n\t\t\t\tfor (let j=0; j<idx; ++j) {\n\t\t\t\t\t// èµ°æŸ»ã¤ã„ã§ã«ãƒˆãƒ¼ã‚¯ãƒ³ã®è¡Œç•ªå·ã‚‚æ›´æ–°\n\t\t\t\t\tst.aLNum[j] ||= ln;\t// ??ã¯NaNä¸å¯\n\n\t\t\t\t\tconst tkn = st.aToken[j]!;\n\t\t\t\t\tif (tkn.startsWith('\\n')) ln += tkn.length;\t// \\n æ”¹è¡Œ\n\t\t\t\t\telse ln += (tkn.match(/\\n/g) ?? []).length;\n\t\t\t\t}\n\t\t\t\tst.aLNum[idx] = ln;\n\t\t\t}\n\t\t\telse ln = st.aLNum[idx];\n\n\t\t\treturn {idx, ln};\n\t\t}\n\n\t\t// ç„¡åãƒ©ãƒ™ãƒ«ã‚¸ãƒ£ãƒ³ãƒ—\n\t\tst.aLNum[0] = 1;\n\t\tconst a_skipLabel = skipLabel.match(this.#REG_NONAME_LABEL);\n\t\tif (a_skipLabel) {\n\t\t\tskipLabel = a_skipLabel[1]!;\n\t\t\tlet i = idx;\n\t\t\tswitch (a_skipLabel[2]) {\n\t\t\tcase 'before':\n\t\t\t\twhile (st.aToken[--i] !== skipLabel) {\n\t\t\t\t\tif (i === 0) DebugMng.myTrace(`[jumpç³» ç„¡åãƒ©ãƒ™ãƒ«before] \n\t\t\t\t\t\t${String(ln)} è¡Œç›®ä»¥å‰ã§ ${inMacro ?'ãƒã‚¯ãƒ­å†…ã«' :''} ãƒ©ãƒ™ãƒ«ã€ ${skipLabel} ã€‘ãŒã‚ã‚Šã¾ã›ã‚“`, 'ET');\n\t\t\t\t\tif (inMacro && st.aToken[i]!.search(this.#REG_TOKEN_MACRO_BEGIN) > -1) DebugMng.myTrace('[jumpç³» ç„¡åãƒ©ãƒ™ãƒ«before] ãƒã‚¯ãƒ­å†…ã«ãƒ©ãƒ™ãƒ«ã€'+ skipLabel +'ã€‘ãŒã‚ã‚Šã¾ã›ã‚“', 'ET');\n\t\t\t\t}\n\t\t\t\treturn {idx: i +1, ln: st.aLNum[i]!};\t//\tbreak;\n\n\t\t\tcase 'after':\n\t\t\t\twhile (st.aToken[++i] !== skipLabel) {\n\t\t\t\t\tif (i === len) DebugMng.myTrace(`[jumpç³» ç„¡åãƒ©ãƒ™ãƒ«after] ${String(ln)} è¡Œç›®ä»¥å¾Œã§ãƒã‚¯ãƒ­å†…ã«ãƒ©ãƒ™ãƒ«ã€${skipLabel}ã€‘ãŒã‚ã‚Šã¾ã›ã‚“`, 'ET');\n\t\t\t\t\tif (st.aToken[i]!.search(this.#REG_TOKEN_MACRO_END) > -1) DebugMng.myTrace(`[jumpç³» ç„¡åãƒ©ãƒ™ãƒ«after] ${String(ln)} è¡Œç›®ä»¥å¾Œã§ãƒã‚¯ãƒ­å†…ã«ãƒ©ãƒ™ãƒ«ã€ ${skipLabel} ã€‘ãŒã‚ã‚Šã¾ã›ã‚“`, 'ET');\n\t\t\t\t}\n\t\t\t\treturn {idx: i +1, ln: st.aLNum[i]!};\t//\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tDebugMng.myTrace('[jumpç³»] ç„¡åãƒ©ãƒ™ãƒ«æŒ‡å®šã€label='+ skipLabel +'ã€‘ãŒé–“é•ã£ã¦ã„ã¾ã™', 'ET');\n\t\t\t}\n\t\t}\n\n\t\t// ãƒ©ãƒ™ãƒ«ã‚¸ãƒ£ãƒ³ãƒ—\n\t\tln = 1;\n\t\t// (new RegExp(\"~\")) ã®å ´åˆã¯ã€ãƒãƒƒã‚¯ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ã¯ï¼’ã¤å¿…è¦\n\t\tconst reLabel = new RegExp(\n\t\t\t'^'+ skipLabel.replaceAll('*', '\\\\*') +'(?=\\\\s|;|\\\\[|\\\\||$)');\n\t\tlet in_let_ml = false;\n\t\tfor (let i=0; i<len; ++i) {\n\t\t\t// èµ°æŸ»ã¤ã„ã§ã«ãƒˆãƒ¼ã‚¯ãƒ³ã®è¡Œç•ªå·ã‚‚æ›´æ–°\n\t\t\tst.aLNum[i] ||= ln;\t// ??ã¯NaNä¸å¯\n\n\t\t\tconst tkn = st.aToken[i]!;\n\t\t\tif (in_let_ml) {\n\t\t\t\tif (this.#grm.testTagEndLetml(tkn)) in_let_ml = false;\n\t\t\t\telse ln += (tkn.match(/\\n/g) ?? []).length;\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst uc = tkn.charCodeAt(0);\t// TokenTopUnicode\n\t\t\tif (uc === 10) {ln += tkn.length; continue}\t// \\n æ”¹è¡Œ\n\t\t\tif (uc === 42) {\t// 42 = *\n\t\t\t\tif (tkn.search(reLabel) > -1) return {idx: i +1, ln};//\tbreak;\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif (uc !== 91) continue;\t// [ ã‚¿ã‚°é–‹å§‹\n\n\t\t\tln += (tkn.match(/\\n/g) ?? []).length;\n\t\t\tif (this.#grm.testTagLetml(tkn)) in_let_ml = true;\n\t\t}\n\t\tif (in_let_ml) throw '[let_ml]ã®çµ‚ç«¯ãƒ»[endlet_ml]ãŒã‚ã‚Šã¾ã›ã‚“';\n\n\t\tDebugMng.myTrace(`[jumpç³»] ãƒ©ãƒ™ãƒ«ã€${skipLabel}ã€‘ãŒã‚ã‚Šã¾ã›ã‚“`, 'ET');\n\t\tthrow 'Dummy';\n\t}\n\n\t#hScript\t: HScript\t= Object.create(null);\t//{} ã‚·ãƒŠãƒªã‚ªã‚­ãƒ£ãƒƒã‚·ãƒ¥\n\t#resolveScript(txt: string) {\n\t\tlet mes = '';\n\t\ttry {\n\t\t\tmes = 'ScriptIterator.resolveScript';\n\t\t\tconst scr = this.#grm.resolveScript(txt);\n\t\t\tmes = 'ScriptIterator.replaceScript_Wildcard';\n\t\t\tthis.#replaceScript_Wildcard(scr);\n\t\t\tthis.#hScript[this.#scriptFn] = this.#script = scr;\n\t\t}\n\t\tcatch (e) {\n\t\t\tif (e instanceof Error) mes += `ä¾‹å¤– mes=${e.message}(${e.name})`;\n\t\t\telse mes = String(e);\n\t\t\tthis.main.errScript(mes, false);\n\t\t}\n\t\tthis.val.touchAreaKidoku(this.#scriptFn);\n\t}\n\n\t#jump_light(cs: CallStack) {\n\t\t// jumpã§ã¯é€£ç¶šãƒã‚¯ãƒ­ã§ã‚¹ã‚¿ãƒƒã‚¯ã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼ã«ãªã‚‹ã®ã§ç°¡æ˜“ç‰ˆã‚’\n\t\t// ä¸»ã«[return]ã‚„ãƒã‚¯ãƒ­çµ‚äº†ã§ã‚¸ãƒ£ãƒ³ãƒ—å…ˆãŒãƒã‚§ãƒƒã‚¯ä¸è¦ãªå ´åˆç”¨\n\t\t// analyzeInit()ã¨ã‹ã‚‚ã‚¸ãƒ£ãƒ³ãƒ—å‰ã«ã‚„ã£ã¦ã¦ä¸è¦ã ã—\n\t\tthis.#scriptFn\t= cs.fn;\n\t\tthis.#idxToken\t= cs.idx;\n\t\tconst st = this.#hScript[this.#scriptFn];\n\t\tif (st) this.#script = st;\n\t\tthis.#lineNum = this.#script.aLNum[cs.idx]!;\n//console.log(`fn:ScriptIterator.ts %cjump_light cs ${cs.fn}:${this.#lineNum} idx:${cs.idx}`, 'background-color:#a03b79;');\n\t}\n\n\n\treadonly #REG_WILDCARD\t= /^\\[(call|loadplugin)\\s/;\n\treadonly #REG_WILDCARD2\t= /\\bfn\\s*=\\s*[^\\s\\]]+/;\n\t#replaceScript_Wildcard(scr: Script) {\n\t\tfor (let i=scr.len -1; i>=0; --i) {\n\t\t\tconst token = scr.aToken[i]!;\n\t\t\tif (! this.#REG_WILDCARD.test(token)) continue;\n\n\t\t\tconst [tag_name, args] = tagToken2Name_Args(token);\n\t\t\tthis.#alzTagArg.parse(args);\n\n\t\t\tconst p_fn = this.#alzTagArg.hPrm.fn;\n\t\t\tif (! p_fn) continue;\n\t\t\tconst {val: fn} = p_fn;\n\t\t\tif (! fn.endsWith('*')) continue;\n\n\t\t\tscr.aToken.splice(i, 1, '\\t', '; '+ token);\n\t\t\tscr.aLNum.splice(i, 1, NaN, NaN);\n\n\t\t\tconst ext = tag_name === 'loadplugin'\n\t\t\t\t? SEARCH_PATH_ARG_EXT.CSS\n\t\t\t\t: SEARCH_PATH_ARG_EXT.SN;\n\t\t\tconst a = this.cfg.matchPath('^'+ fn.slice(0, -1) +'.*', ext);\n\t\t\tfor (const v of a) {\n\t\t\t\tconst nt = token.replace(\n\t\t\t\t\tthis.#REG_WILDCARD2,\n\t\t\t\t\t'fn='+ decodeURIComponent(getFn(v[ext]!))\n\t\t\t\t);\n\t\t\t\t//console.log('\\t='+ nt +'=');\n\t\t\t\tscr.aToken.splice(i, 0, nt);\n\t\t\t\tscr.aLNum.splice(i, 0, NaN);\n\t\t\t}\n\t\t}\n\t\tscr.len = scr.aToken.length;\n\t}\n\n\n\t#recordKidoku() {\n\t\tconst ar = this.val.touchAreaKidoku(this.#scriptFn);\n\n\t\t// ãƒã‚¯ãƒ­å†…ã‚„ã‚µãƒ–ãƒ«ãƒ¼ãƒãƒ³ã§ã¯isKidokuã‚’å¤‰æ›´ã•ã›ãªã„\n\t\tif (this.#aCallStk.length > 0) {ar.record(this.#idxToken); return}\n\n\t\tthis.#isKidoku = ar.search(this.#idxToken);\n\t\tthis.val.setVal_Nochk('tmp', 'const.sn.isKidoku', this.#isKidoku);\n\t\tif (this.#isKidoku) return;\n\n\t\tar.record(this.#idxToken);\n\t\t// saveKidoku()\n\t\t\t// å³å¯†ã«ã¯ã“ã“ã§ã™ã¹ãã ãŒã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã«å•é¡ŒãŒã‚ã‚‹ã®ã§\n\t\t\t// ã‚¯ãƒªãƒƒã‚¯å¾…ã¡ã‚’æœŸå¾…ã§ãã‚‹waitã€waitclickã€sã€lã€pã‚¿ã‚°ã§\n\t\t\t// saveKidoku()ã‚’ã‚³ãƒ¼ãƒ«ã€‚\n\t}\n\t#isKidoku\t= false;\n\tget isKidoku() {return this.#isKidoku}\n\t#eraseKidoku() {\n\t\tthis.val.getAreaKidoku(this.#scriptFn)?.erase(this.#idxToken);\n\t\tthis.#isKidoku = false;\n\t}\n\tget isNextKidoku(): boolean {\n\t\tlet fn\t= this.#scriptFn;\n\t\tlet idx\t= this.#idxToken;\n\t\tlet len\t= this.#script.len;\n\t\tif (this.#aCallStk.length > 0) {\n\t\t\tconst cs = this.#aCallStk[0]!;\n\t\t\tfn  = cs.fn;\n\t\t\tidx = cs.idx;\n\t\t\tconst st = this.#hScript[fn];\n\t\t\tif (st) len = st.len;\n\t\t}\n\t\tif (idx === len) return false;\t// ã‚¹ã‚¯ãƒªãƒ—ãƒˆçµ‚ç«¯\n\n\t\tconst areas = this.val.getAreaKidoku(fn);\n\t\treturn areas?.search(idx) ?? false;\n\t}\n\n\n\tget normalWait(): number {\n\t\treturn this.#isKidoku\n\t\t?\n\t\t\tthis.val.tagCh_doWait_Kidoku\n\t\t\t?\tthis.val.tagCh_msecWait_Kidoku\n\t\t\t:\t0\n\t\t:\n\t\t\tthis.val.tagCh_doWait\n\t\t\t?\tthis.val.tagCh_msecWait\n\t\t\t:\t0\n\t\t;\n\t}\n\n\n\t//MARK: æ‹¬å¼§ãƒã‚¯ãƒ­ã®å®šç¾©\n\t#bracket2macro(hArg: TArg) {\n\t\tthis.#grm.bracket2macro(hArg, this.hTag, this.#script, this.#idxToken);\n\n\t\treturn false;\n\t}\n\n\t//MARK: ä¸€æ–‡å­—ãƒã‚¯ãƒ­ã®å®šç¾©\n\t#char2macro(hArg: TArg) {\n\t\tthis.#grm.char2macro(hArg, this.hTag, this.#script, this.#idxToken);\n\n\t\treturn false;\n\t}\n\n\t//MARK: ãƒã‚¯ãƒ­å®šç¾©ã®é–‹å§‹\n\t// eslint-disable-next-line no-irregular-whitespace\n\treadonly\t#REG_NG4MAC_NM = /[\"'#;\\\\]ã€€]+/;\n\t#macro(hArg: TArg) {\n\t\tconst {name} = hArg;\n\t\tif (! name) throw 'nameã¯å¿…é ˆã§ã™';\n\t\tif (name in this.hTag) throw `[${name}]ã¯ã‚¿ã‚°ã‹ã™ã§ã«å®šç¾©æ¸ˆã¿ã®ãƒã‚¯ãƒ­ã§ã™`;\n\t\tif (this.#REG_NG4MAC_NM.test(name)) throw `[${name}]ã¯ãƒã‚¯ãƒ­åã¨ã—ã¦ç•°å¸¸ã§ã™`;\n\n\t\tconst ln = this.#lineNum;\n\t\tconst cs = new CallStack(this.#scriptFn, this.#idxToken);\n\t\tthis.#strStepin += '|'+ name;\n\t\t// (new RegExp(\"~\")) ã®å ´åˆã¯ã€ãƒãƒƒã‚¯ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ã¯ï¼’ã¤å¿…è¦\n\t\tthis.#REGSTEPIN = new RegExp(`\\\\[(${this.#strStepin})\\\\b`);\n\t\tthis.hTag[<keyof T_HTag>name] = hArgM=> {\n\t\t\t// hArgM.design_unit = hArg.design_unit;\n\t\t\tthis.#callSub(hArgM);\n\n\t\t\t// AIRNovelã®ä»•æ§˜ï¼šè¦ªãƒã‚¯ãƒ­ãŒå­ãƒã‚¯ãƒ­ã‚³ãƒ¼ãƒ«æ™‚ã€*ãŒãªã„ã®ã«å€¤ã‚’å¼•ãç¶™ã\n\t\t\t//for (const k of Object.keys(hArg)) this.val.setVal_Nochk('mp', k, hArg[k]);\n\t\t\tthis.val.setMp({\n\t\t\t\t...hArgM,\n\t\t\t\t'const.sn.macro': JSON.stringify({name: hArg.name}),\n\t\t\t\t\t// ãƒ ãƒ€ã«å¤§ãã„ã‚¹ã‚¯ãƒªãƒ—ã‚¿ãƒ¼ç”¨æƒ…å ±ã‚’å‰Šé™¤ã€åå‰ã ã‘ã«\n\t\t\t\t'const.sn.me_call_scriptFn': this.#scriptFn,\n\t\t\t});\n\t\t\tthis.val.setVal_Nochk('mp', 'const.sn.me_call_scriptFn', this.#scriptFn);\n\n\t\t\tthis.#lineNum = ln;\n\t\t\tthis.#jump_light(cs);\n\n\t\t\treturn false;\n\t\t};\n\n\t\tfor (; this.#idxToken < this.#script.len; ++this.#idxToken) {\n\t\t\t// ãƒˆãƒ¼ã‚¯ãƒ³ã®è¡Œç•ªå·æ›´æ–°\n\t\t\tthis.#script.aLNum[this.#idxToken] ||= this.#lineNum; // ??ã¯NaNä¸å¯\n\n\t\t\tconst token = this.#script.aToken[this.#idxToken]!;\n\t\t\tif (token.search(this.#REG_TOKEN_MACRO_END) > -1) {\n\t\t\t\t++this.#idxToken;\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tconst uc = token.charCodeAt(0);\t// TokenTopUnicode\n\t\t\tif (uc === 10) this.#lineNum += token.length;\t// \\n æ”¹è¡Œ\n\t\t\telse if (uc === 91) this.#lineNum += (token.match(/\\n/g) ?? []).length;\t// [ ã‚¿ã‚°é–‹å§‹\n\t\t}\n\t\tthrow `ãƒã‚¯ãƒ­[${name}]å®šç¾©ã®çµ‚ç«¯ãƒ»[endmacro]ãŒã‚ã‚Šã¾ã›ã‚“`;\n\t}\n\t#strStepin\t= 'call';\n\t#REGSTEPIN\t= /\\[(call)\\b/;\t// https://regex101.com/r/Lk9ASK/1\n\n\n\t//MARK: ã—ãŠã‚Šã®èª­è¾¼\n\t#load(hArg: TArg) {\n\t\tif ('fn' in hArg !== 'label' in hArg) throw 'fnã¨labelã¯ã‚»ãƒƒãƒˆã§æŒ‡å®šã—ã¦ä¸‹ã•ã„';\n\n\t\tconst place = argChk_Num(hArg, 'place', 0);\n\t\tconst mark = this.val.getMark(place);\n\t\tif (! mark) throw `place=${String(place)} ã¯å­˜åœ¨ã—ã¾ã›ã‚“`\n\n\t\treturn this.loadFromMark(hArg, mark, SndProcOnLoad.ALL_STOP_AND_PLAY);\n\t}\n\tloadFromMark(hArg: TArg, mark: T_Mark, snd: SndProcOnLoad = SndProcOnLoad.MINIMAL_STOP) {\n\t\tthis.hTag.clear_event({});\n\t\tthis.val.mark2save(mark);\n\t\tthis.val.setMp(creMP());\n\t\tthis.#layMng.recPagebreak();\n\n\t\tlet ap: Promise<void>[] = [];\n\t\tif (snd !== SndProcOnLoad.NO_TOUCH) ap = this.sndMng\n\t\t.playLoopFromSaveObj(snd === SndProcOnLoad.ALL_STOP_AND_PLAY);\n\n\t\tif (argChk_Boolean(hArg, 'do_rec', true)) this.#mark = {\n\t\t\thSave\t: this.val.cloneSave(),\n\t\t\thPages\t: {...mark.hPages},\n\t\t\taIfStk\t: [...mark.aIfStk],\n\t\t}\n\n\t\tconst o: TArg = {\n\t\t\tenabled\t: Boolean(this.val.getVal('save:const.sn.autowc.enabled')),\n\t\t\ttext\t: String(this.val.getVal('save:const.sn.autowc.text')),\n\t\t\ttime\t: Number(this.val.getVal('save:const.sn.autowc.time')),\n\t\t};\n\t\tthis.hTag.autowc(o);\n\n\t\tthis.#aIfStk = [...this.#mark.aIfStk];\n\t\tthis.#aCallStk = [];\n\t\tCmnTween.stopAllTw();\n\n\t\tconst p = Promise.allSettled([...ap, ...this.#layMng.playback(this.#mark.hPages)])\n\t\t.then(()=> this.#layMng.cover(false));\n\t\tconst {index, fn} = hArg;\n\t\tif (index) {\t// ãƒšãƒ¼ã‚¸ç§»å‹•ç”¨\n\t\t\tif (CmnLib.debugLog) console.log(`ğŸ“œ %cloadFromMark index:${String(index)} move!%c fn:${fn ?? ''}`, 'color:#3B0;', '');\n\t\t\tp.then(()=> {\n\t\t\t\tif (! this.#jumpWork(fn, '', index)) this.main.resume();\n\t\t\t\t// if (ret)\t\t// ä¸­ã§éåŒæœŸã§ endProc() ã‚’å‘¼ã¶ã®ã§ã¾ã‹ã›ã‚‹\n\t\t\t\t// if (! ret)\t// åŒæœŸã§ãªã«ã‚‚ã›ãšã™ãè¿”ã‚‹\n\t\t\t})\n\t\t\t.catch((e: unknown)=> console.error('loadFromMark e:%o', e));\n\t\t\treturn true;\n\t\t}\n\n\t\tthis.#layMng.cover(true);\t// ãƒšãƒ¼ã‚¸ç§»å‹•ã§ã¯å…¨ç”»é¢é»’ã§è¦†ã‚ãªã„\n\t\tconst fn2 = String(this.val.getVal('save:const.sn.scriptFn'));\n\t\tconst idx = Number(this.val.getVal('save:const.sn.scriptIdx'));\n\t\t// eslint-disable-next-line @typescript-eslint/no-dynamic-delete\n\t\tdelete this.#hScript[fn2];\t// å¿…ãšã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å†èª­è¾¼ã€‚å‰é‡Œå‰é‡Œã«å‹•ä½œã‚’åˆã‚ã›ã‚‹\n\t\tconst {label} = hArg;\n\t\tp.then(label ?()=> {\n\t\t\tthis.#scriptFn = fn2;\n\t\t\tthis.#idxToken = idx;\n\t\t\tif (! this.hTag.call({\n\t\t\t\t...fn ?{fn} :{},\n\t\t\t\tlabel,\n\t\t\t})) this.main.resume();\n\t\t}\n\t\t: ()=> {\n\t\t\tif (! this.#jumpWork(fn2, '', idx)) this.main.resume();\n\t\t})\n\t\t.catch((e: unknown)=> console.error('loadFromMark e:%o', e));\n\n\t\treturn true;\n\t}\n\n\t//MARK: ã‚¹ã‚¯ãƒªãƒ—ãƒˆå†èª­è¾¼\n\t#reload_script(hArg: TArg) {\t// æœ€å¾Œã®[record_place]ã‹ã‚‰å†é–‹\n\t\tconst mark = this.val.getMark(0);\n\t\tif (! mark) return false;\n\n\t\t// èµ·å‹•ã‹ã‚‰å†èª­è¾¼ã¾ã§ã®é–“ã«è¿½åŠ ãƒ»å¤‰æ›´ãƒ»å‰Šé™¤ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚‹ã‹ã‚‚ã€ã«å¯¾å¿œ\n\t\t//\tdelete this.hScript[this.#scriptFn];\t// ã“ã‚Œã ã¨[reload_script]ä½ç½®ã«ãªã‚‹\n\t\t// eslint-disable-next-line @typescript-eslint/no-dynamic-delete\n\t\tdelete this.#hScript[getFn(mark.hSave['const.sn.scriptFn'])];\n\n\t\t// æ´¾ç”Ÿãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤\n\t\tconst h: HScript = {};\n\t\tfor (const fn in this.#hScript) {\n\t\t\ttry {this.#cnvSnPath(fn +'@')}\n\t\t\tcatch {h[fn] = this.#hScript[fn]!}\t// æ´¾ç”Ÿãƒ•ã‚¡ã‚¤ãƒ«ä»¥å¤–ã‚’æ®‹ã™\n\t\t}\n\t\tthis.#hScript = h;\n\n\t\thArg.do_rec = false;\n\t\treturn this.loadFromMark(hArg, mark, SndProcOnLoad.NO_TOUCH);\n\t}\n\n\n\t//MARK: ã‚»ãƒ¼ãƒ–ãƒã‚¤ãƒ³ãƒˆæŒ‡å®š\n\t#mark: T_Mark = {\n\t\thSave\t: creSAVEDATA(),\n\t\thPages\t: {},\n\t\taIfStk\t: [-1],\n\t};\n\t#record_place = ()=> {\n\t\tconst {fn, idx} = this.nowScrIdx();\n\t\tthis.val.setVal_Nochk('save', 'const.sn.scriptFn', fn);\n\t\tthis.val.setVal_Nochk('save', 'const.sn.scriptIdx', idx);\n\t\tthis.#mark = {\n\t\t\thSave\t: this.val.cloneSave(),\n\t\t\thPages\t: this.#layMng.record(),\n\t\t\taIfStk\t: this.#aIfStk.slice(this.#aCallStk.length),\n\t\t};\n\n\t\treturn false;\n\t}\n\tnowScrIdx(): {fn: string, idx: number} {\n\t\tconst len = this.#aCallStk.length;\n\t\tif (len === 0) return {\n\t\t\tfn\t: this.#scriptFn,\n\t\t\tidx\t: this.#idxToken,\n\t\t};\n\n\t\tconst cs = this.#aCallStk[0]!;\n\t\treturn {\n\t\t\tfn\t: cs.fn,\n\t\t\tidx\t: cs.idx,\n\t\t}\n\t}\n\tnowMark(): T_Mark {return {...this.#mark}}\t// ã‚³ãƒ”ãƒ¼ã¯ã“ã“ã§ã™ã‚‹\n\n\t//MARK: ã‚¹ã‚¯ãƒªãƒ—ãƒˆåœæ­¢ä½ç½®ï¼ˆãƒã‚¯ãƒ­ãªã©ãªã‚‰æœ€ä¸Šä½ã®å‘¼ã³å…ƒï¼‰\n\tnowScrFnLn(): {fn: string, ln: number, col_s: number, col_e: number} {\n\t\tconst {fn, idx} = this.nowScrIdx();\n\t\tconst st = this.#hScript[fn]!;\n\t\tconst o = this.#cnvIdx2lineCol(st, idx);\t// -1ä¸è¦\n\t\treturn {fn, ...o};\n\t}\n\n\t//MARK: ã—ãŠã‚Šã®ä¿å­˜\n\t#save(hArg: TArg) {\n\t\tif (! ('place' in hArg)) throw 'placeã¯å¿…é ˆã§ã™';\n\t\tconst place = hArg.place;\n\n\t\tdelete hArg[':ã‚¿ã‚°å'];\n\t\tdelete hArg.place;\n\t\thArg.text = hArg.text ?? '';\n\t\tthis.#mark.json = hArg;\n\t\tthis.val.setMark(place, this.#mark);\n\n\t\tconst now_sp = Number(this.val.getVal('sys:const.sn.save.place'));\n\t\tif (place === now_sp) this.val.setVal_Nochk('sys', 'const.sn.save.place', now_sp +1);\n\n\t\treturn false;\n\t}\n\n\n\trecodeDesign(hArg: TArg) {\n\t\tlet fn = '';\n\t\tlet idx = 0;\n\n\t\tconst len = this.#aCallStk.length;\n\t\tif (hArg.design_unit && len > 0) {\n\t\t\t// ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ¢ãƒ¼ãƒ‰ã§ã“ã®ãƒã‚¯ãƒ­ã¸ã®å¼•æ•°å¤‰æ›´ã¨ã™ã‚‹ã‹ï¼ˆå†…éƒ¨ã‚’ã‚µãƒ¼ãƒã•ã›ãªã„ï¼‰\n\t\t\tconst cs = this.#aCallStk[0]!;\n\t\t\tfn = cs.fn;\n\t\t\tidx = cs.idx;\n\t\t}\n\t\telse {\n\t\t\tfn = this.#scriptFn;\n\t\t\tidx = this.#idxToken;\n\t\t}\n\t\thArg[':path']\t= this.#cnvSnPath4Dbg(fn);\n\t\tconst scr = this.#hScript[fn]!;\n\t\tconst lc = this.#cnvIdx2lineCol(scr, idx);\n\t\thArg[':ln']\t\t= lc.ln;\n\t\thArg[':col_s']\t= lc.col_s;\n\t\thArg[':col_e']\t= lc.col_e;\n\t\tconst idx_1 = idx -1;\n\t\thArg[':idx_tkn']= idx_1;\n\t\thArg[':token']\t= scr.aToken[idx_1] ?? '';\n\n\t\tthis.sys.send2Dbg('_recodeDesign', hArg);\n\t}\n\treplace(idx: number, val: string) {this.#script.aToken[idx] = val}\n\n}\n"],"mappings":"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"}